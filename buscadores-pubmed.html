<!--
=====================
 buscadores-pubmed.html
filtros estructurados para profesionales sanitarios
=====================
-->

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buscador PubMed Avanzado | @ernestob</title>
    <meta
      name="description"
      content="Buscador avanzado de PubMed con filtros estructurados para profesionales sanitarios"
    />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="Buscador PubMed con Filtros Estructurados | @ernestob"
    />
    <meta
      property="og:site_name"
      content="Recursos para la gesti√≥n de informaci√≥n sanitaria üîéü©∫‚öï"
    />
    <meta
      property="og:url"
      content="https://ernestobarrera.github.io/t/pubmed.html"
    />
    <meta
      property="og:image"
      content="https://ernestobarrera.github.io/assets/images/me.png"
    />
    <link rel="icon" href="/assets/images/icon.webp" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/components.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/intro.js/minified/introjs.min.css"
    />

    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
        background: #1c1e26;
      }
      .main-container {
        max-width: 1400px;
        margin-left: auto;
        margin-right: auto;
        padding: 0rem 0rem;
      }
      .hero-section {
        border-radius: 8px;
        padding: 0;
        margin-bottom: 0.5rem;
      }
      .main-title {
        margin-bottom: 0.5rem;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-primary, #fff);
      }
      .search-container {
        max-width: 100%;
        margin: 0 auto;
        padding: 0;
        color: var(--text-primary, #fff);
        position: relative;
      }
      .intro-text {
        font-size: 0.95rem;
        line-height: 1.4;
        background: rgba(59, 130, 246, 0.15);
        border-radius: 8px;
        padding: 0.5rem;
        color: var(--text-secondary, #94a3b8);
        margin-bottom: 0.5rem;
      }
      .search-box {
        background: var(--card-bg, #2a3b4d);
        padding: 1rem;
        border-radius: 12px;
        margin-bottom: 1rem;
        position: relative;
      }
      .search-textarea {
        width: 100%;
        padding: 0.5rem;
        background: var(--primary-bg, #1c1e26);
        border: 1px solid var(--secondary-bg, #2c3e50);
        border-radius: 6px;
        color: var(--text-primary, #fff);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        font-size: 1rem;
        line-height: 1.5;
        margin-bottom: 0;
        transition: border-color 0.3s ease, height 0.3s ease;
        resize: vertical;
        overflow-y: auto;
        min-height: 3rem;
        max-height: 150px;
      }
      .search-textarea:focus {
        border-color: var(--accent-color, #ffd700);
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
      }
      .filters-section {
        display: grid;
        grid-template-columns: minmax(300px, 1fr) minmax(300px, 1.75fr) minmax(
            450px,
            1.85fr
          );
        gap: 0rem;
        margin-top: 1rem;
      }
      .filter-category {
        background: var(--primary-bg, #1c1e26);
        padding: 0.7rem;
        border-radius: 8px;
        border-left: 4px solid transparent;
        transition: all 0.4s ease;
      }
      .filter-category.methodological {
        border-left-color: rgba(59, 130, 246, 0.5);
      }
      .filter-category.clinical {
        border-left-color: rgba(16, 185, 129, 0.5);
      }
      .filter-category.clinical .filter-buttons-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }
      .filter-category.scope {
        border-left-color: rgba(139, 92, 246, 0.5);
      }
      .filter-category.scope .filter-buttons-container {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.5rem;
      }
      .category-title {
        font-size: 1.05rem;
        color: var(--accent-color, #ffd700);
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 600;
      }
      .filter-button {
        width: 100%;
        padding: 0.45rem 0.45rem;
        margin-bottom: 0.35rem;
        background: var(--secondary-bg, #2c3e50);
        border: none;
        border-left: 4px solid transparent;
        border-radius: 6px;
        color: var(--text-primary, #fff);
        text-align: left;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
      }
      .filter-button:hover {
        background: var(--hover-color, #34495e);
        transform: translateX(2px);
      }
      .filter-button.active.methodological {
        background: rgba(59, 130, 246, 0.2);
        border-left-color: rgb(59, 130, 246);
      }
      .filter-button.active.clinical {
        background: rgba(16, 185, 129, 0.2);
        border-left-color: rgb(16, 185, 129);
      }
      .filter-button.active.scope {
        background: rgba(139, 92, 246, 0.2);
        border-left-color: rgb(139, 92, 246);
      }
      .versions-toggle {
        margin-left: auto;
        display: flex;
        gap: 0.3rem;
        align-items: center;
      }
      .versions-toggle input[type="radio"] {
        margin-right: 0rem;
        transform: scale(0.9);
      }
      .info-section {
        margin-top: 1rem;
        background: rgba(59, 130, 246, 0.1);
        padding: 0.5rem;
        border-radius: 8px;
      }
      .info-title {
        font-size: 1.1rem;
        color: var(--accent-color, #ffd700);
        margin-bottom: 0.3rem;
        display: flex;
        align-items: center;
        gap: 0.3rem;
      }
      .info-text {
        color: var(--text-secondary, #94a3b8);
        line-height: 1.4;
        font-size: 0.9rem;
        margin: 0;
      }
      .centered-controls select {
        background: var(--card-bg);
        color: var(--text-primary);
        border: 1px solid var(--accent-color);
        border-radius: 8px;
        padding: 0.7rem;
        font-size: 0.9rem;
        cursor: pointer;
      }
      .centered-controls label {
        color: var(--text-primary);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .centered-controls {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 0.8rem;
        flex-wrap: wrap;
      }
      .centered-controls .filter-controls {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      .search-button {
        background: linear-gradient(135deg, #ffd700, #ff9a00);
        border: none;
        border-radius: 8px;
        color: #1c1e26;
        font-weight: 600;
        font-size: 1.2rem;
        padding: 0.7rem 1.25rem;
        cursor: pointer;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .search-button:hover {
        transform: translateY(-2px) scale(1.03);
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.25);
      }
      .filter-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 1.1rem;
        font-weight: 500;
        color: #fff;
      }
      .filter-count {
        min-width: 2.2rem;
        min-height: 2.2rem;
        background: linear-gradient(135deg, #2a3b4d, #3b4f66);
        color: #ffffff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9rem;
        font-weight: 600;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        border: 2px solid #ffd700;
      }
      @media (max-width: 1200px) {
        .filters-section {
          grid-template-columns: 1fr;
          max-height: none;
          overflow-y: visible;
        }
        .filter-category {
          margin-bottom: 1rem;
        }
      }
      @media (max-width: 768px) {
        .main-container {
          padding: 0.75rem;
        }
        .search-box {
          padding: 0.75rem;
        }
        .filter-button {
          margin-bottom: 0.25rem;
        }
      }
      .introjs-tooltip {
        animation: fadeIn 0.8s ease;
        background-color: #fef9c3 !important;
        color: #1a2634 !important;
        border: 1px solid #fbbf24 !important;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(251, 191, 36, 0.2) !important;
        padding: 0.2rem !important;
        max-width: 380px;
        min-width: 280px;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: scale(0.95);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
      .introjs-arrow {
        border-color: #fef9c3 transparent transparent transparent !important;
      }
      .introjs-helperNumberLayer {
        background: #ffd700 !important;
        color: #1a2634 !important;
      }
      .introjs-bullets .introjs-bullet {
        background: #34495e !important;
      }
      .introjs-bullets .introjs-bullet.active {
        box-shadow: 0 0 0 2px #ffd700 !important;
      }
      .introjs-tooltipbuttons {
        white-space: nowrap;
        border-top: 1px solid #fbbf24 !important;
        padding-top: 0.75rem;
      }
      .introjs-skipbutton {
        position: absolute;
        font-size: 1rem;
        right: 0rem !important;
        top: 0rem;
        padding: 0.2rem 0rem !important;
        border-radius: 4px;
        color: #1e2328c0 !important;
      }
      .introjs-prevbutton,
      .introjs-nextbutton,
      .introjs-donebutton {
        background: #1a2634 !important;
        color: #ffffff !important;
        border: 1px solid #ffd700 !important;
        padding: 0.4rem 0.4rem !important;
        border-radius: 4px;
        margin: 0 0.2rem;
        font-size: 1rem !important;
        transition: all 0.2s ease;
        text-shadow: none !important;
        font-weight: normal !important;
      }
      .introjs-prevbutton:hover,
      .introjs-nextbutton:hover,
      .introjs-donebutton:hover {
        background: #ffd700 !important;
        color: #1a2634 !important;
      }
      .introjs-tooltiptext {
        color: #1a2634 !important;
        font-size: 1.1rem !important;
        line-height: 1.4 !important;
        font-family: system-ui, -apple-system, sans-serif !important;
      }
      .myHighlight {
        background: #333;
        box-shadow: 0 0 8px 4px rgba(255, 215, 0, 0.8) !important;
        border: 2px solid #ffd700 !important;
        border-radius: 8px !important;
        transition: box-shadow 0.6s ease;
      }
      .final-query-box {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        color: #ffd700;
        font-size: 0.85rem;
      }
      .category-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      }
      .operator-selector {
        background: var(--card-bg);
        padding: 0.3rem 0.6rem;
        border-radius: 6px;
      }
      .operator-selector label {
        color: var(--text-secondary);
        font-size: 0.9rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .category-operator {
        background: var(--primary-bg);
        color: var(--text-primary);
        border: 1px solid var(--accent-color);
        border-radius: 4px;
        padding: 0.3rem;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .category-operator:hover {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 1px var(--accent-color);
      }
      .tippy-box {
        background-color: #333 !important;
        color: white !important;
        padding: 5px 10px !important;
        border-radius: 4px !important;
        font-size: 14px !important;
      }
      .tippy-arrow {
        color: #333 !important;
      }
      .tippy-box[data-animation="fade"][data-state="visible"] {
        z-index: 9999 !important;
      }
      .tippy-box[data-theme~="custom"] {
        background-color: var(--card-bg, #2a3b4d) !important;
        border: 1px solid var(--accent-color, #ffd700) !important;
        color: var(--text-primary, #fff) !important;
        font-size: 0.85rem !important;
        z-index: 9999 !important;
      }
      .tippy-box[data-theme~="custom"][data-placement^="top"]
        > .tippy-arrow::before {
        border-top-color: var(--accent-color, #ffd700) !important;
      }
      .tippy-box[data-theme~="custom"] .tippy-content {
        white-space: pre-line !important;
        line-height: 1.4 !important;
        padding: 0rem 0rem !important;
      }
      .venn-container {
        margin-top: 1rem;
        background: var(--primary-bg);
        border-radius: 8px;
        padding: 1rem;
        display: none;
      }
      .venn-container.visible {
        display: grid;
        grid-template-columns: 250px 500px 250px;
        gap: 1rem;
        align-items: start;
      }
      #venn-diagram {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 300px;
        position: relative;
        grid-column: 2;
        min-height: 400px;
      }
      #venn-tooltip {
        position: absolute;
        background: var(--card-bg);
        border: 1px solid var(--accent-color);
        padding: 0.75rem;
        border-radius: 6px;
        font-size: 0.9rem;
        color: var(--text-primary);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1000;
        max-width: 300px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      .venn-circle path {
        stroke: var(--accent-color);
        stroke-width: 2px;
        fill-opacity: 0.2;
        transition: all 0.3s ease;
      }
      .venn-circle:hover path {
        fill-opacity: 0.4;
        cursor: pointer;
      }
      .venn-intersection path {
        fill-opacity: 0.4;
      }
      .venn-circle text,
      .venn-intersection text {
        fill: var(--text-primary);
        font-size: 14px;
        font-weight: 500;
      }
      .venn-lists-column {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .venn-lists {
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        font-size: 0.9rem;
      }
      .venn-lists h4 {
        color: var(--accent-color);
        margin: 0 0 0.5rem 0;
        font-size: 1rem;
      }
      .venn-lists ul {
        list-style: none;
        padding: 0;
        margin: 0 0 1rem 0;
      }
      .venn-lists li {
        color: var(--text-primary);
        padding: 0.2rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .methodology-list {
        color: #3b82f6;
      }
      .clinical-list {
        color: #10b981;
      }
      .scope-list {
        color: #8b5cf6;
      }
      .info-button {
        margin: 0 0.5rem;
        background: var(--card-bg);
        color: var(--text-primary);
        border: 1px solid var(--accent-color);
        border-radius: 8px;
        padding: 0.7rem;
        font-size: 0.9rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: all 0.3s ease;
      }
      .info-button:hover,
      .info-button.active {
        background: var(--accent-color);
        color: var(--primary-bg);
      }
      .search-tips {
        margin-top: 1rem;
        background: var(--primary-bg);
        border-radius: 8px;
        overflow: hidden;
      }
      .search-tips-header {
        padding: 0.75rem 1rem;
        background: rgba(255, 215, 0, 0.1);
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
      }
      .search-tips-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }
      .search-tips.expanded .search-tips-content {
        max-height: none;
      }
      .search-tips-title {
        color: var(--accent-color);
        font-size: 1.1rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .tip {
        padding: 1rem;
        border-bottom: 1px solid rgba(255, 215, 0, 0.1);
        background: var(--tip-bg, #1c1e26);
      }
      .tip:hover {
        background: var(--tip-bg-hover, #2a2c35);
      }
      .tip-title {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        color: var(--text-primary);
        margin: 0 0 0.75rem 0;
        font-size: 1.1rem;
      }
      .tip-number {
        background: var(--accent-color);
        color: var(--tip-bg);
        padding: 0.25rem 0.5rem;
        border-radius: 4px;
        font-size: 0.9rem;
        font-weight: bold;
        min-width: 2rem;
        text-align: center;
      }
      .tip-content {
        color: var(--text-secondary);
        line-height: 1.6;
        font-size: 0.95rem;
      }
      .tip-section {
        margin-bottom: 0.75rem;
      }
      .tip-section:last-child {
        margin-bottom: 0;
      }
      .tip-section strong {
        color: var(--text-primary);
        display: block;
        margin-bottom: 0.25rem;
      }
      .example-box {
        background: rgba(255, 215, 0, 0.1);
        padding: 0.75rem;
        border-radius: 4px;
        margin: 0.5rem 0;
        font-family: monospace;
      }
      .pro-tip {
        background: rgba(255, 215, 0, 0.15);
        padding: 0.75rem;
        border-radius: 4px;
        margin-top: 0.75rem;
      }
      .search-tips-icon {
        transition: transform 0.3s ease;
      }
      .search-tips.expanded .search-tips-icon {
        transform: rotate(180deg);
      }
      .search-tips-header .subtitle {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-left: 0.5rem;
      }
      .search-header-icons {
        position: absolute;
        top: 10px;
        right: 10px;
        display: flex;
        gap: 0.5rem;
      }
      .search-header-icons button {
        background: transparent;
        border: none;
        color: #ffd700;
        font-size: 1.5rem;
        cursor: pointer;
      }
      .search-header-icons button:hover {
        color: #fff;
      }

      /* Contenedor principal para la Query final */
      .final-query-box {
        margin-top: 0.5rem;
        padding: 0.5rem;
        background: rgba(0, 0, 0, 0.15);
        border-radius: 8px;
        color: #ffd700;
        font-size: 0.85rem;
      }

      /* MODALES PARA GUARDAR/RECUPERAR/BORRAR/EXPORTAR/IMPORTAR */
      .modal-backdrop {
        position: fixed;
        z-index: 9999;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.65);
        display: none;
        align-items: center;
        justify-content: center;
      }
      .modal-backdrop.show {
        display: flex;
      }
      .modal {
        background: #2a3b4d;
        border: 2px solid #ffd700;
        border-radius: 8px;
        width: 350px;
        padding: 1rem;
        color: #fff;
        position: relative;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid #ffd700;
        margin-bottom: 0.75rem;
        padding-bottom: 0.5rem;
      }
      .modal-title {
        font-size: 1rem;
        font-weight: bold;
        margin: 0;
        color: #ffd700;
      }
      .close-modal {
        background: transparent;
        border: none;
        cursor: pointer;
        color: #ffd700;
        font-size: 1.2rem;
      }
      .modal-body {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        font-size: 0.9rem;
      }
      .modal-body input,
      .modal-body select {
        background: #1c1e26;
        border: 1px solid #2c3e50;
        border-radius: 4px;
        padding: 0.4rem;
        color: #fff;
        font-size: 0.85rem;
        width: 100%;
      }
      .modal-body button {
        background: #ffd700;
        color: #1c1e26;
        border: none;
        border-radius: 4px;
        padding: 0.5rem 1rem;
        cursor: pointer;
        font-size: 0.85rem;
      }
      .modal-body button:hover {
        background: #ffca1c;
      }
    </style>
    <!-- libreria tooltip con metadatos del filtro -->
    <script src="https://unpkg.com/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.7/dist/tippy.umd.min.js"></script>
    <!-- venn-->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/venn.js@0.2.20/build/venn.js"></script>
  </head>
  <body>
    <include src="header.html"></include>

    <main class="main-container">
      <section class="hero-section">
        <h1 class="main-title">
          <i class="fas fa-search"></i>
          <span>Buscador PubMed con Filtros Estructurados</span>
          <span
            style="
              margin-left: 30px;
              cursor: pointer;
              color: white;
              font-size: 0.8rem;
              background: rgba(255, 255, 255, 0.15);
              padding: 4px 8px;
              border-radius: 4px;
            "
            id="startTutorialBtn"
          >
            <i class="fas fa-graduation-cap"></i>
            Ver Gu√≠a Interactiva
          </span>
        </h1>
        <p class="intro-text">
          Optimiza tus b√∫squedas bibliogr√°ficas combinando filtros
          metodol√≥gicos, cl√≠nicos y de √°mbito predefinidos. Esta herramienta
          construye autom√°ticamente b√∫squedas avanzadas utilizando t√©rminos MeSH
          y operadores booleanos para obtener resultados m√°s precisos y
          reproducibles. Selecciona los filtros que necesites y deja que la
          herramienta construya la estrategia de b√∫squeda √≥ptima.
        </p>
      </section>

      <div class="search-container">
        <div class="search-box">
          <textarea
            id="searchTerm"
            class="search-textarea"
            placeholder="Introduce t√©rminos de b√∫squeda..."
            data-intro="Aqu√≠ escribes tus t√©rminos de b√∫squeda. Tambi√©n puedes pulsar Enter para iniciar la b√∫squeda."
            data-step="2"
            rows="1"
          ></textarea>

          <div class="search-header-icons">
            <button id="btn_guardar" title="Guardar b√∫squeda">
              <i class="fas fa-save"></i>
            </button>
            <button id="btn_recuperar" title="Recuperar b√∫squeda">
              <i class="fas fa-folder-open"></i>
            </button>
            <button id="btn_borrar" title="Borrar b√∫squeda">
              <i class="fas fa-trash-alt"></i>
            </button>
            <button id="btn_exportar" title="Exportar b√∫squedas">
              <i class="fas fa-download"></i>
            </button>
            <button id="btn_importar" title="Importar b√∫squedas">
              <i class="fas fa-upload"></i>
            </button>
          </div>

          <!-- Secci√≥n de filtros (tres columnas): metodolog√≠a, cl√≠nico, √°mbito -->
          <div
            class="filters-section"
            data-intro="Estos son los filtros que puedes seleccionar antes de buscar."
            data-step="1"
          >
            <div class="filter-category methodological">
              <div class="category-header">
                <h3 class="category-title">
                  <i class="fas fa-flask"></i>
                  Metodolog√≠a
                </h3>
                <div class="operator-selector">
                  <label
                    >Operador:
                    <select
                      class="category-operator"
                      data-category="methodology"
                    >
                      <option value="OR" selected>OR</option>
                      <option value="AND">AND</option>
                    </select>
                  </label>
                </div>
              </div>
              <button class="filter-button methodological" data-type="mbe">
                üîç MBE
              </button>
              <button class="filter-button methodological" data-type="gpc">
                üìã GPC
              </button>
              <button
                class="filter-button methodological"
                data-type="metaanalysis"
              >
                ‚≠ê Rev Sist/Meta-an√°lisis/HTA
              </button>
              <button
                class="filter-button methodological"
                data-type="qualitative"
              >
                üìù Estudios cualitativos
              </button>
              <button
                class="filter-button methodological with-toggle"
                data-base="clinical_rules"
              >
                üìä Reglas Predicci√≥n Cl√≠nica-CQ
                <div class="versions-toggle">
                  <label>
                    <input
                      type="radio"
                      name="clinical_rules_mode"
                      value="sensible"
                      checked
                    />
                    S
                  </label>
                  <label>
                    <input
                      type="radio"
                      name="clinical_rules_mode"
                      value="especifico"
                    />
                    E
                  </label>
                </div>
              </button>
              <button class="filter-button methodological" data-type="horizon">
                üî≠ Horizon Scanning
              </button>
              <button
                class="filter-button methodological"
                data-type="clinical_rules_ap"
              >
                üìä Reglas Predicci√≥n Cl√≠nica-AP
              </button>
              <button
                class="filter-button methodological"
                data-type="indirect_comparison"
              >
                üíä Comparaciones Indirectas
              </button>
            </div>

            <div class="filter-category clinical">
              <div class="category-header">
                <h3 class="category-title">
                  <i class="fas fa-stethoscope"></i>
                  Enfoque Cl√≠nico
                </h3>
                <div class="operator-selector">
                  <label
                    >Operador:
                    <select class="category-operator" data-category="clinical">
                      <option value="OR" selected>OR</option>
                      <option value="AND">AND</option>
                    </select>
                  </label>
                </div>
              </div>
              <div class="filter-buttons-container">
                <button
                  class="filter-button clinical with-toggle"
                  data-base="diagnosis"
                >
                  üîç Diagn√≥stico-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="diagnosis_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="diagnosis_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="etiology"
                >
                  üî¨ Etiolog√≠a-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="etiology_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="etiology_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="prognosis"
                >
                  üìà Pron√≥stico-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="prognosis_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="prognosis_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="treatment"
                >
                  üíä Tratamiento-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="treatment_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="treatment_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="predictors"
                >
                  üöÄ Predictores Tratamiento
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="predictors_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="predictors_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button class="filter-button clinical" data-type="surgery_ae">
                  üè∑Ô∏è Efectos Adversos Cirug√≠a
                </button>
                <button class="filter-button clinical" data-type="devices_ae">
                  üîß Efectos Adversos Dispositivos
                </button>
                <button class="filter-button clinical" data-type="drugs_ae">
                  üíä Efectos adversos Medicamentos
                </button>
                <button class="filter-button clinical" data-type="car_t">
                  üß¨ Terapias CAR-T
                </button>
                <button
                  class="filter-button clinical"
                  data-type="deprescription"
                >
                  ‚öïÔ∏è Deprescripci√≥n
                </button>
                <button
                  class="filter-button clinical"
                  data-type="simulation_clinical"
                >
                  üéØ Simulaci√≥n Cl√≠nica V.1
                </button>
                <button
                  class="filter-button clinical"
                  data-type="clinical_examination"
                >
                  üîé Examen Cl√≠nico
                </button>
                <button class="filter-button clinical" data-type="NNT_NNH">
                  ‚úÖ NNT-NNH
                </button>
              </div>
            </div>

            <div class="filter-category scope">
              <div class="category-header">
                <h3 class="category-title">
                  <i class="fas fa-users"></i>
                  √Åmbito y Poblaci√≥n
                </h3>
                <div class="operator-selector">
                  <label
                    >Operador:
                    <select class="category-operator" data-category="scope">
                      <option value="OR" selected>OR</option>
                      <option value="AND">AND</option>
                    </select>
                  </label>
                </div>
              </div>
              <div class="filter-buttons-container">
                <button class="filter-button scope with-toggle" data-base="ai">
                  ü§ñ IA Generativa
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="ai_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input type="radio" name="ai_mode" value="especifico" />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="palliative"
                >
                  üè• Cuidados Paliativos
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="palliative_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="palliative_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="primary"
                >
                  üë®‚Äç‚öïÔ∏è Atenci√≥n Primaria
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="primary_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="primary_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="safety"
                >
                  üõ°Ô∏è Seguridad Paciente
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="safety_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="safety_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button class="filter-button scope" data-type="pearls">
                  üíé Perlas Cl√≠nicas
                </button>
                <button class="filter-button scope" data-type="perspective">
                  üë• Perspectiva Pacientes
                </button>
                <button class="filter-button scope" data-type="nursing">
                  üë©‚Äç‚öïÔ∏è Revistas de Enfermer√≠a
                </button>
                <button class="filter-button scope" data-type="humans">
                  üßë Humanos
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="geriatrics"
                >
                  üë¥ Geriatr√≠a
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="geriatrics_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="geriatrics_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button class="filter-button scope" data-type="pediatrics">
                  üë∂ Pediatr√≠a
                </button>
                <button class="filter-button scope" data-type="adults">
                  üßë Personas adultas
                </button>
                <button class="filter-button scope" data-type="ocde">
                  üåç Pa√≠ses OCDE
                </button>
                <button class="filter-button scope" data-type="spanish">
                  üá™üá∏ Publicaciones Espa√±olas
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="economic"
                >
                  üí∞ Evaluaciones econ√≥micas
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="economic_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="economic_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <div class="centered-controls">
            <div class="filter-controls">
              <label>
                Fecha:
                <select id="dateRange" style="border-radius: 8px">
                  <option value="">Sin Filtro</option>
                  <option value="7">√öltimos 7 d√≠as</option>
                  <option value="30">√öltimos 30 d√≠as</option>
                  <option value="180">√öltimos 6 meses</option>
                  <option value="365">√öltimo a√±o</option>
                  <option value="1825">√öltimos 5 a√±os</option>
                </select>
              </label>
              <label>
                Orden:
                <select id="sortMode" style="border-radius: 8px">
                  <option value="date">Por fecha</option>
                  <option value="best">Best match</option>
                </select>
              </label>
            </div>

            <button
              id="searchButton"
              class="search-button"
              data-intro="Haz clic aqu√≠ para lanzar la b√∫squeda en PubMed."
              data-step="3"
            >
              <i class="fas fa-search"></i>
              <span>Buscar en PubMed</span>
            </button>

            <div class="filter-info">
              <span>Filtros activos:</span>
              <span id="filterCount" class="filter-count">0</span>
            </div>

            <button id="infoModeToggle" class="info-button">
              <i class="fas fa-info-circle"></i>
              <span>Ver Detalles de Filtros</span>
            </button>

            <button id="toggleVennButton" class="info-button">
              <i class="fas fa-project-diagram"></i>
              Ver Diagrama
            </button>

            <button
              id="resetButton"
              style="
                background: linear-gradient(135deg, #777, #555);
                color: #fff;
                border: none;
                border-radius: 8px;
                padding: 0.7rem;
                font-size: 0.9rem;
                cursor: pointer;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
              "
            >
              Limpiar
            </button>
          </div>

          <div class="venn-container">
            <div class="venn-lists-column">
              <div class="venn-lists methodology-list">
                <h4>Metodolog√≠a</h4>
                <div id="methodology-filters"></div>
              </div>
              <div class="venn-lists clinical-list">
                <h4>Cl√≠nico</h4>
                <div id="clinical-filters"></div>
              </div>
            </div>
            <div id="venn-diagram"></div>
            <div class="venn-lists scope-list">
              <h4>√Åmbito</h4>
              <div id="scope-filters"></div>
            </div>
            <div id="venn-tooltip"></div>
          </div>

          <div class="final-query-box" id="finalQuery"></div>
        </div>

        <!-- Tips de b√∫squeda -->
        <div class="search-tips">
          <div class="search-tips-header">
            <h3 class="search-tips-title">
              <i class="fas fa-lightbulb"></i>
              Tips Avanzados para B√∫squedas en PubMed
              <span class="subtitle"
                >Optimiza tus b√∫squedas bibliogr√°ficas usando nuestros filtros
                estructurados</span
              >
            </h3>
            <i class="fas fa-chevron-down search-tips-icon"></i>
          </div>

          <div class="search-tips-content">
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">01</span>
                Best Match como Herramienta de Descubrimiento
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>¬øQu√© es Best Match?</strong>
                  Best Match es el algoritmo de relevancia de PubMed que ordena
                  los resultados seg√∫n su importancia para tu b√∫squeda. Utiliza
                  factores como la coincidencia de t√©rminos, fecha de
                  publicaci√≥n y relevancia del journal.
                </div>
                <div class="tip-section">
                  <strong>C√≥mo aprovecharlo con nuestros filtros:</strong>
                  1. Realiza tu b√∫squeda inicial usando los filtros
                  metodol√≥gicos (como MBE o Meta-an√°lisis) 2. Selecciona "Best
                  match" en el ordenamiento de resultados 3. Revisa los primeros
                  10-20 resultados para identificar: ‚Ä¢ T√©rminos MeSH relevantes
                  ‚Ä¢ Variantes terminol√≥gicas ‚Ä¢ Conceptos relacionados
                </div>
                <div class="example-box">
                  Ejemplo: Para una b√∫squeda sobre "cancer screening", Best
                  Match podr√≠a revelarte t√©rminos como "Early Detection of
                  Cancer"[Mesh] o "Mass Screening"[Mesh]
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Combina Best Match con los filtros de √°mbito (como
                  Atenci√≥n Primaria o Geriatr√≠a) para descubrir terminolog√≠a
                  espec√≠fica de cada contexto.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">02</span>
                B√∫squeda por Proximidad en PubMed
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Nueva funcionalidad de PubMed</strong>
                  La b√∫squeda por proximidad permite encontrar t√©rminos cercanos
                  entre s√≠, incluso si no est√°n exactamente juntos o en el mismo
                  orden.
                </div>
                <div class="tip-section">
                  <strong>Sintaxis b√°sica:</strong>
                  "t√©rmino1 t√©rmino2"[campo:~N] Donde N = n√∫mero m√°ximo de
                  palabras entre los t√©rminos
                </div>
                <div class="example-box">
                  "diabetes treatment"[Title/Abstract:~2] Encuentra: "diabetes
                  and its treatment", "treatment of diabetes", "diabetes
                  receiving treatment"
                </div>
                <div class="tip-section">
                  <strong>Uso con nuestros filtros:</strong>
                  Combina la b√∫squeda por proximidad con filtros cl√≠nicos para
                  mayor precisi√≥n: ‚Ä¢ Con filtro de Tratamiento-CQ: mayor
                  especificidad en resultados terap√©uticos ‚Ä¢ Con filtro de
                  Efectos Adversos: mejor detecci√≥n de complicaciones
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Usa N=0 para encontrar t√©rminos adyacentes en
                  cualquier orden. Especialmente √∫til con los filtros de √Åmbito
                  y Poblaci√≥n.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">03</span>
                Estrategia Sensible/Espec√≠fica
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>¬øPor qu√© usar dos enfoques?</strong>
                  La estrategia sensible/espec√≠fica permite evolucionar desde
                  una b√∫squeda amplia que captura todo lo relevante hacia una
                  m√°s precisa que elimina el ruido.
                </div>
                <div class="tip-section">
                  <strong>Uso con nuestros filtros:</strong>
                  ‚Ä¢ En filtros cl√≠nicos (Diagn√≥stico, Etiolog√≠a, etc.): usa
                  primero la versi√≥n Sensible (S) para identificar toda la
                  terminolog√≠a relevante ‚Ä¢ En filtros de √°mbito (IA, Atenci√≥n
                  Primaria): cambia a versi√≥n Espec√≠fica (E) cuando necesites
                  mayor precisi√≥n
                </div>
                <div class="example-box">
                  Ejemplo para b√∫squeda sobre diagn√≥stico de diabetes: 1. Inicia
                  con "Diagn√≥stico-CQ (S)" + t√©rminos b√°sicos 2. Identifica
                  t√©rminos clave en resultados 3. Refina usando "Diagn√≥stico-CQ
                  (E)" + t√©rminos identificados
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Combina versiones Sensibles para temas poco
                  estudiados y Espec√≠ficas para temas con mucha literatura.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">04</span>
                Clinical Queries Estrat√©gicos
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Filtros Clinical Queries (CQ)</strong>
                  Son filtros metodol√≥gicos validados cient√≠ficamente para
                  diferentes tipos de estudios cl√≠nicos, optimizados para
                  maximizar la recuperaci√≥n de art√≠culos relevantes.
                </div>
                <div class="tip-section">
                  <strong>Uso √≥ptimo en nuestra herramienta:</strong>
                  ‚Ä¢ Diagn√≥stico-CQ: Para pruebas diagn√≥sticas y screening ‚Ä¢
                  Tratamiento-CQ: Para intervenciones terap√©uticas ‚Ä¢
                  Etiolog√≠a-CQ: Para factores de riesgo y causas ‚Ä¢
                  Pron√≥stico-CQ: Para evoluci√≥n y resultados
                </div>
                <div class="example-box">
                  Para estudio sobre tratamiento nuevo: "nuevo f√°rmaco" +
                  Tratamiento-CQ (E) + Efectos Adversos Medicamentos
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Combina CQ con filtros de √°mbito para contextos
                  espec√≠ficos (ej: Tratamiento-CQ + Atenci√≥n Primaria).
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">05</span>
                Control Temporal Inteligente
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Estrategia en dos fases</strong>
                  Combina b√∫squedas recientes para capturar terminolog√≠a actual
                  con b√∫squedas hist√≥ricas para no perder estudios
                  fundamentales.
                </div>
                <div class="tip-section">
                  <strong>Implementaci√≥n con nuestros filtros:</strong>
                  1. B√∫squeda reciente (√∫ltimos 6 meses): ‚Ä¢ Usa filtros
                  metodol√≥gicos en versi√≥n Sensible ‚Ä¢ Activa "√öltimos 6 meses"
                  en el selector de fecha 2. B√∫squeda hist√≥rica (5 a√±os): ‚Ä¢
                  Incorpora t√©rminos descubiertos ‚Ä¢ Cambia a versi√≥n Espec√≠fica
                  de los filtros
                </div>
                <div class="example-box">
                  Fase 1: IA Generativa (S) + "√∫ltimos 6 meses" Fase 2: IA
                  Generativa (E) + nuevos t√©rminos + "√∫ltimos 5 a√±os"
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Para temas emergentes, prioriza resultados
                  recientes. Para temas establecidos, ampl√≠a el rango temporal.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">06</span>
                Validaci√≥n Sistem√°tica
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Proceso de validaci√≥n</strong>
                  Verifica la calidad de tu estrategia de b√∫squeda mediante un
                  an√°lisis sistem√°tico de los resultados.
                </div>
                <div class="tip-section">
                  <strong>Lista de verificaci√≥n:</strong>
                  1. Relevancia de resultados: ‚Ä¢ ¬øLos primeros 10 resultados son
                  pertinentes? ‚Ä¢ ¬øHay ruido tem√°tico significativo? 2. Cobertura
                  tem√°tica: ‚Ä¢ ¬øSe recuperan todos los aspectos relevantes? ‚Ä¢
                  ¬øFaltan conceptos importantes?
                </div>
                <div class="example-box">
                  Para validar b√∫squeda sobre seguridad del paciente: 1. Aplicar
                  Safety (S) + Best Match 2. Verificar primeros resultados 3.
                  Ajustar a Safety (E) si hay exceso de ruido
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Si encuentras art√≠culos irrelevantes en los
                  primeros resultados, considera cambiar de versi√≥n Sensible a
                  Espec√≠fica.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">07</span>
                Refinamiento Iterativo
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Proceso de mejora continua</strong>
                  Optimiza tu b√∫squeda mediante ciclos de refinamiento,
                  incorporando nuevos t√©rminos y ajustando filtros seg√∫n los
                  resultados.
                </div>
                <div class="tip-section">
                  <strong>Ciclo de refinamiento:</strong>
                  1. B√∫squeda inicial con filtros base 2. An√°lisis de mejores
                  resultados 3. Identificaci√≥n de nuevos t√©rminos 4. Ajuste de
                  filtros y operadores 5. Validaci√≥n de cambios
                </div>
                <div class="example-box">
                  Iteraci√≥n para b√∫squeda en geriatr√≠a: 1. Geriatr√≠a (S) +
                  t√©rminos iniciales 2. Identificar subgrupos relevantes 3.
                  A√±adir Cuidados Paliativos si aparece frecuentemente
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Documenta cada iteraci√≥n y su impacto para crear
                  un hist√≥rico de mejoras.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">08</span>
                Combinaci√≥n de Campos
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Estrategia de campos m√∫ltiples</strong>
                  Maximiza la precisi√≥n combinando b√∫squeda por proximidad en
                  t√≠tulo/abstract con t√©rminos MeSH y nuestros filtros
                  estructurados.
                </div>
                <div class="tip-section">
                  <strong>Estructura √≥ptima:</strong>
                  1. T√©rminos de proximidad en [Title/Abstract] 2. T√©rminos MeSH
                  relevantes 3. Filtros metodol√≥gicos o cl√≠nicos 4. Filtros de
                  √°mbito seg√∫n necesidad
                </div>
                <div class="example-box">
                  "diabetes management"[Title/Abstract:~2] AND "Diabetes
                  Mellitus/therapy"[Mesh] AND {Aplicar filtro Primary (E) +
                  Treatment (E)}
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Usa diferentes valores de proximidad (~1, ~2, ~3)
                  para encontrar el balance √≥ptimo de resultados.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">09</span>
                An√°lisis de Resultados
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Evaluaci√≥n de calidad</strong>
                  Analiza sistem√°ticamente los resultados para garantizar que tu
                  estrategia de b√∫squeda es efectiva.
                </div>
                <div class="tip-section">
                  <strong>Criterios de evaluaci√≥n:</strong>
                  ‚Ä¢ Precisi√≥n: relevancia de los primeros resultados ‚Ä¢
                  Exhaustividad: recuperaci√≥n de art√≠culos clave ‚Ä¢ Balance:
                  proporci√≥n de resultados √∫tiles ‚Ä¢ Actualidad: distribuci√≥n
                  temporal adecuada
                </div>
                <div class="example-box">
                  Para evaluar b√∫squeda de terapias CAR-T: 1. Aplicar filtro
                  CAR-T + Best Match 2. Verificar presencia de papers clave 3.
                  Analizar distribuci√≥n temporal
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: La calidad de los primeros 10-20 resultados es un
                  buen predictor de la efectividad global de tu b√∫squeda.
                </div>
              </div>
            </div>

            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">10</span>
                Verificaci√≥n Final
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Lista de verificaci√≥n completa</strong>
                  Asegura la calidad de tu b√∫squeda mediante una revisi√≥n
                  sistem√°tica de todos los componentes.
                </div>
                <div class="tip-section">
                  <strong>Elementos a verificar:</strong>
                  1. Estructura de b√∫squeda: ‚Ä¢ T√©rminos MeSH apropiados ‚Ä¢
                  Operadores booleanos correctos ‚Ä¢ Filtros metodol√≥gicos
                  adecuados 2. Resultados: ‚Ä¢ Art√≠culos clave recuperados ‚Ä¢
                  Balance sensibilidad/especificidad 3. Documentaci√≥n: ‚Ä¢
                  Estrategia documentada ‚Ä¢ Filtros utilizados registrados
                </div>
                <div class="example-box">
                  Checklist final: ‚òê T√©rminos principales incluidos ‚òê Filtros
                  apropiados seleccionados ‚òê Operadores verificados ‚òê Resultados
                  validados
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Guarda tu estrategia final completa para futuras
                  actualizaciones o refinamientos.
                </div>
              </div>
            </div>
          </div>
          <div class="info-section">
            <h2 class="info-title">
              <i class="fas fa-info-circle"></i>
              Sobre las B√∫squedas
            </h2>
            <p class="info-text">
              Los filtros se combinan autom√°ticamente usando operadores
              booleanos:
              <strong>OR</strong> entre filtros de la misma categor√≠a y
              <strong>AND</strong> entre diferentes categor√≠as (por defecto).
              Esto permite construir b√∫squedas precisas que encuentran
              exactamente lo que necesitas.
              <br />
              <span style="font-size: 0.8rem; color: grey"
                ><b>CQ:</b> Clinical Queries PubMed</span
              >
            </p>
          </div>
        </div>
      </div>
    </main>

    <include src="footer.html"></include>
    <script src="/assets/js/include.js"></script>
    <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>

    <!-- MODALES INDIVIDUALES PARA GUARDAR / RECUPERAR / BORRAR / EXPORTAR / IMPORTAR -->
    <div class="modal-backdrop" id="modalGuardarFondo">
      <div class="modal" id="modalGuardar">
        <div class="modal-header">
          <h2 class="modal-title">Guardar B√∫squeda</h2>
          <button class="close-modal" data-close="modalGuardarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="nombreNuevaBusqueda">Nombre de la b√∫squeda:</label>
          <input type="text" id="nombreNuevaBusqueda" />
          <button id="guardarBusquedaConfirm">Guardar</button>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalRecuperarFondo">
      <div class="modal" id="modalRecuperar">
        <div class="modal-header">
          <h2 class="modal-title">Recuperar B√∫squeda</h2>
          <button class="close-modal" data-close="modalRecuperarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="recuperarSelect">B√∫squedas guardadas:</label>
          <select id="recuperarSelect"></select>
          <button id="recuperarBusquedaConfirm">Recuperar</button>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalBorrarFondo">
      <div class="modal" id="modalBorrar">
        <div class="modal-header">
          <h2 class="modal-title">Borrar B√∫squeda</h2>
          <button class="close-modal" data-close="modalBorrarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="borrarSelect">B√∫squedas guardadas:</label>
          <select id="borrarSelect"></select>
          <button id="borrarBusquedaConfirm">Borrar</button>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalExportarFondo">
      <div class="modal" id="modalExportar">
        <div class="modal-header">
          <h2 class="modal-title">Exportar B√∫squedas</h2>
          <button class="close-modal" data-close="modalExportarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p>
            Se descargar√° un archivo JSON con todas las b√∫squedas guardadas.
          </p>
          <button id="exportarBusquedaConfirm">Exportar</button>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalImportarFondo">
      <div class="modal" id="modalImportar">
        <div class="modal-header">
          <h2 class="modal-title">Importar B√∫squedas</h2>
          <button class="close-modal" data-close="modalImportarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="importarArchivo">Archivo JSON:</label>
          <input type="file" accept="application/json" id="importarArchivo" />
          <button id="importarBusquedaConfirm">Importar</button>
        </div>
      </div>
    </div>
    <!-- FIN DE MODALES -->

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        /* Variables globales que ya exist√≠an o se necesitan para la b√∫squeda */
        var searchTerm = document.getElementById("searchTerm");
        var searchButton = document.getElementById("searchButton");
        var resetButton = document.getElementById("resetButton");
        var filterCount = document.getElementById("filterCount");
        var finalQueryBox = document.getElementById("finalQuery");
        var dateRange = document.getElementById("dateRange");
        var sortMode = document.getElementById("sortMode");

        var activeFilters = new Set();
        var filterMap = {};
        var filterTooltips = {};

        /* Manejo del diagrama de Venn */
        var toggleVennButton = document.getElementById("toggleVennButton");
        var vennContainer = document.querySelector(".venn-container");

        /* Categor√≠as y su operator */
        var categories = {
          methodology: [
            "mbe",
            "gpc",
            "metaanalysis",
            "qualitative",
            "clinical_rules_sensible",
            "clinical_rules_especifico",
            "horizon",
            "clinical_rules_ap",
            "indirect_comparison",
          ],
          clinical: [
            "diagnosis_sensible",
            "diagnosis_especifico",
            "etiology_sensible",
            "etiology_especifico",
            "prognosis_sensible",
            "prognosis_especifico",
            "treatment_sensible",
            "treatment_especifico",
            "predictors_sensible",
            "predictors_especifico",
            "surgery_ae",
            "devices_ae",
            "drugs_ae",
            "car_t",
            "deprescription",
            "simulation_clinical",
            "clinical_examination",
            "NNT_NNH",
          ],
          scope: [
            "ai_sensible",
            "ai_especifico",
            "palliative_sensible",
            "palliative_especifico",
            "primary_sensible",
            "primary_especifico",
            "safety_sensible",
            "safety_especifico",
            "pearls",
            "perspective",
            "nursing",
            "humans",
            "geriatrics_sensible",
            "geriatrics_especifico",
            "pediatrics",
            "adults",
            "ocde",
            "spanish",
            "economic_sensible",
            "economic_especifico",
          ],
        };

        var categoryOperators = {
          methodology: "OR",
          clinical: "OR",
          scope: "OR",
        };

        /* Carga as√≠ncrona de filtros (se mantienen igual que en el original) */
        function formatTooltipContent(metadata) {
          var parts = [];
          function isValidMetric(value) {
            return (
              value !== undefined &&
              value !== null &&
              value !== 0 &&
              !isNaN(value) &&
              value.toString().trim() !== ""
            );
          }
          function formatMetricSection(metrics) {
            var formatted = [];
            if (isValidMetric(metrics.sensitivity)) {
              formatted.push(
                "<strong>Sensibilidad:</strong> " + metrics.sensitivity + "%"
              );
            }
            if (isValidMetric(metrics.specificity)) {
              formatted.push(
                "<strong>Especificidad:</strong> " + metrics.specificity + "%"
              );
            }
            if (isValidMetric(metrics.precision)) {
              formatted.push(
                "<strong>Precisi√≥n:</strong> " + metrics.precision + "%"
              );
            }
            if (isValidMetric(metrics.NNR)) {
              formatted.push("<strong>NNR:</strong> " + metrics.NNR);
            }
            return formatted;
          }
          if (metadata.validation && metadata.validation.metrics) {
            if ("sensitivity" in metadata.validation.metrics) {
              var section = formatMetricSection(metadata.validation.metrics);
              parts.push.apply(parts, section);
            } else if ("sensitive" in metadata.validation.metrics) {
              var sensitiveSection = formatMetricSection(
                metadata.validation.metrics.sensitive
              );
              var specificSection = formatMetricSection(
                metadata.validation.metrics.specific
              );
              if (sensitiveSection.length > 0) {
                parts.push("<u>Versi√≥n Sensible:</u>");
                parts.push.apply(parts, sensitiveSection);
              }
              if (specificSection.length > 0) {
                if (parts.length > 0) parts.push("");
                parts.push("<u>Versi√≥n Espec√≠fica:</u>");
                parts.push.apply(parts, specificSection);
              }
            }
          }
          if (
            metadata.validation &&
            metadata.validation.reference &&
            metadata.validation.reference.trim()
          ) {
            if (parts.length > 0) parts.push("");
            parts.push(
              "<strong>Fuente:</strong> " + metadata.validation.reference.trim()
            );
          }
          return parts.join("\n");
        }

        function cargarFiltros() {
          var promises = [];
          Object.keys(categories).forEach(function (cat) {
            categories[cat].forEach(function (id) {
              var url =
                "https://ernestobarrera.github.io/pubmed-filters/filters/" +
                cat +
                "/" +
                id +
                ".txt";
              var prom = fetch(url)
                .then(function (r) {
                  return r.ok ? r.text() : "";
                })
                .then(function (txt) {
                  var partes = txt.split("@@@FILTER_METADATA@@@");
                  var filterText = (partes[0] || "")
                    .split("\n")
                    .filter(function (line) {
                      return !line.trim().startsWith("#");
                    })
                    .join("\n");
                  filterMap[id] = filterText.trim();
                  if (partes[1]) {
                    try {
                      var metadata = JSON.parse(partes[1].trim());
                      var tooltipContent = formatTooltipContent(metadata);
                      filterTooltips[id] = tooltipContent;
                    } catch (e) {
                      /* Error parseando metadata */
                    }
                  }
                })
                .catch(function () {
                  filterMap[id] = "";
                });
              promises.push(prom);
            });
          });
          return Promise.all(promises);
        }

        /* Inicializar tooltips */
        cargarFiltros().then(function () {
          document
            .querySelectorAll(".filter-button")
            .forEach(function (button) {
              var id;
              if (button.classList.contains("with-toggle")) {
                id = button.dataset.base + "_sensible";
              } else {
                id = button.dataset.type;
              }
              if (filterTooltips[id]) {
                button.setAttribute("data-tippy-content", filterTooltips[id]);
                tippy(button, {
                  content: filterTooltips[id],
                  placement: "top",
                  arrow: true,
                  theme: "custom",
                  animation: "shift-away",
                  delay: [200, 0],
                  maxWidth: 400,
                  allowHTML: true,
                  trigger: "mouseenter",
                  onShow: function () {
                    return infoModeActive;
                  },
                });
              }
            });
        });

        /* Manejo de infoMode */
        var infoModeToggle = document.getElementById("infoModeToggle");
        var infoModeActive = false;

        function showTooltip(event) {
          var tippyInstance = event.currentTarget._tippy;
          if (tippyInstance) {
            tippyInstance.show();
          }
        }
        function hideTooltip(event) {
          var tippyInstance = event.currentTarget._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
        }
        infoModeToggle.addEventListener("click", function () {
          infoModeActive = !infoModeActive;
          infoModeToggle.style.background = infoModeActive
            ? "var(--accent-color)"
            : "var(--card-bg)";
          infoModeToggle.style.color = infoModeActive
            ? "var(--primary-bg)"
            : "var(--text-primary)";
          document
            .querySelectorAll(".filter-button")
            .forEach(function (button) {
              var tippyInstance = button._tippy;
              if (tippyInstance) {
                if (infoModeActive) {
                  button.addEventListener("mouseenter", showTooltip);
                  button.addEventListener("mouseleave", hideTooltip);
                } else {
                  button.removeEventListener("mouseenter", showTooltip);
                  button.removeEventListener("mouseleave", hideTooltip);
                  tippyInstance.hide();
                }
              }
            });
        });

        /* Event Listeners para la textarea y selects */
        ["input", "change"].forEach((event) => {
          searchTerm.addEventListener(event, mostrarQueryFinal);
          dateRange.addEventListener(event, mostrarQueryFinal);
          sortMode.addEventListener(event, mostrarQueryFinal);
        });

        /* Activar/Desactivar filtros simples */
        document
          .querySelectorAll(".filter-button:not(.with-toggle)")
          .forEach(function (button) {
            button.addEventListener("click", function () {
              button.classList.toggle("active");
              var filterType = button.dataset.type;
              if (filterType) {
                if (button.classList.contains("active")) {
                  activeFilters.add(filterType);
                } else {
                  activeFilters.delete(filterType);
                }
                filterCount.textContent = activeFilters.size;
                mostrarQueryFinal();
              }
            });
          });

        /* Filtros con toggle (versiones S/E) */
        document
          .querySelectorAll(".filter-button.with-toggle")
          .forEach(function (btn) {
            var baseId = btn.dataset.base;
            btn.addEventListener("click", function (e) {
              if (
                e.target.tagName === "INPUT" ||
                e.target.closest(".versions-toggle")
              ) {
                return;
              }
              btn.classList.toggle("active");
              var selectedRadio = btn.querySelector(
                'input[type="radio"]:checked'
              );
              var filterType = baseId + "_" + selectedRadio.value;
              if (btn.classList.contains("active")) {
                activeFilters.add(filterType);
              } else {
                activeFilters.delete(filterType);
              }
              filterCount.textContent = activeFilters.size;
              mostrarQueryFinal();
            });
            var radios = btn.querySelectorAll('input[type="radio"]');
            radios.forEach(function (radio) {
              radio.addEventListener("change", function () {
                if (!btn.classList.contains("active")) return;
                var oldType =
                  baseId +
                  "_" +
                  (radio.value === "sensible" ? "especifico" : "sensible");
                var newType = baseId + "_" + radio.value;
                activeFilters.delete(oldType);
                activeFilters.add(newType);
                filterCount.textContent = activeFilters.size;
                mostrarQueryFinal();
              });
            });
          });

        /* Operadores de categor√≠a */
        document
          .querySelectorAll(".category-operator")
          .forEach(function (select) {
            select.addEventListener("change", function () {
              categoryOperators[this.dataset.category] = this.value;
              mostrarQueryFinal();
            });
          });

        /* Funci√≥n para construir la consulta final */
        function constructQuery(term) {
          if (!term && activeFilters.size === 0) return "";
          var query = term;
          Object.keys(categories).forEach(function (cat) {
            var operator = categoryOperators[cat];
            var activeInCat = categories[cat]
              .filter(function (f) {
                return activeFilters.has(f);
              })
              .map(function (f) {
                return filterMap[f] || "";
              })
              .filter(function (q) {
                return q !== "";
              });
            if (activeInCat.length > 0) {
              var notFilters = activeInCat.filter(function (f) {
                return /^NOT/.test(f);
              });
              var regularFilters = activeInCat.filter(function (f) {
                return !/^NOT/.test(f);
              });
              if (regularFilters.length > 0) {
                var categoryQuery =
                  "(" + regularFilters.join(" " + operator + " ") + ")";
                query = query
                  ? "(" + query + ") AND " + categoryQuery
                  : categoryQuery;
              }
              notFilters.forEach(function (filter) {
                query = query ? "(" + query + ") " + filter : filter;
              });
            }
          });
          if (dateRange.value) {
            var dateFilter = '("last ' + dateRange.value + ' days"[dp])';
            query = query ? "(" + query + ") AND " + dateFilter : dateFilter;
          }
          return query.trim();
        }

        function mostrarQueryFinal() {
          var built = constructQuery(searchTerm.value.trim());
          finalQueryBox.textContent = built;
          updateVennDiagram();
        }

        /* B√∫squeda real en PubMed */
        function hacerBusqueda() {
          var term = searchTerm.value.trim();
          var finalQ = constructQuery(term);
          if (!finalQ) {
            alert("Por favor, introduce un t√©rmino o selecciona alg√∫n filtro.");
            return;
          }
          var url =
            "https://pubmed.ncbi.nlm.nih.gov/?term=" +
            encodeURIComponent(finalQ);
          if (sortMode.value === "date") {
            url += "&sort=date";
          } else {
            url += "&sort=best";
          }
          url += "&size=50";
          window.open(url, "_blank");
        }

        searchButton.addEventListener("click", hacerBusqueda);
        searchTerm.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            hacerBusqueda();
          }
        });

        /* Bot√≥n reset */
        resetButton.addEventListener("click", function () {
          activeFilters.clear();
          filterCount.textContent = 0;
          searchTerm.value = "";
          dateRange.value = "";
          sortMode.value = "date";
          document
            .querySelectorAll(".category-operator")
            .forEach(function (sel) {
              sel.value = "OR";
              categoryOperators[sel.dataset.category] = "OR";
            });
          document.querySelectorAll(".filter-button").forEach(function (b) {
            b.classList.remove("active");
          });
          document
            .querySelectorAll('.versions-toggle input[type="radio"]')
            .forEach(function (r) {
              if (r.value === "sensible") {
                r.checked = true;
              }
            });
          finalQueryBox.textContent = "";
          updateVennDiagram();
        });

        /* Diagrama de Venn */
        toggleVennButton.addEventListener("click", function () {
          vennContainer.classList.toggle("visible");
          toggleVennButton.classList.toggle("active");
          toggleVennButton.innerHTML = vennContainer.classList.contains(
            "visible"
          )
            ? '<i class="fas fa-project-diagram"></i> Ocultar Diagrama'
            : '<i class="fas fa-project-diagram"></i> Ver Diagrama';
          if (vennContainer.classList.contains("visible")) {
            updateVennDiagram();
          }
        });

        function updateVennDiagram() {
          var methodologyFilters = Array.from(
            document.querySelectorAll(".filter-button.methodological.active")
          ).map(function (btn) {
            return {
              text: btn.textContent.trim(),
              type:
                btn.dataset.type ||
                btn.dataset.base +
                  "_" +
                  btn.querySelector('input[type="radio"]:checked')?.value,
            };
          });
          var clinicalFilters = Array.from(
            document.querySelectorAll(".filter-button.clinical.active")
          ).map(function (btn) {
            return {
              text: btn.textContent.trim(),
              type:
                btn.dataset.type ||
                btn.dataset.base +
                  "_" +
                  btn.querySelector('input[type="radio"]:checked')?.value,
            };
          });
          var scopeFilters = Array.from(
            document.querySelectorAll(".filter-button.scope.active")
          ).map(function (btn) {
            return {
              text: btn.textContent.trim(),
              type:
                btn.dataset.type ||
                btn.dataset.base +
                  "_" +
                  btn.querySelector('input[type="radio"]:checked')?.value,
            };
          });

          var sets = [];
          if (methodologyFilters.length > 0) {
            sets.push({
              sets: ["Metodolog√≠a"],
              size: methodologyFilters.length,
              items: methodologyFilters.map(function (f) {
                return f.text;
              }),
            });
          }
          if (clinicalFilters.length > 0) {
            sets.push({
              sets: ["Cl√≠nico"],
              size: clinicalFilters.length,
              items: clinicalFilters.map(function (f) {
                return f.text;
              }),
            });
          }
          if (scopeFilters.length > 0) {
            sets.push({
              sets: ["√Åmbito"],
              size: scopeFilters.length,
              items: scopeFilters.map(function (f) {
                return f.text;
              }),
            });
          }
          if (sets.length > 1) {
            var categoriesArr = sets.map(function (s) {
              return s.sets[0];
            });
            for (var i = 0; i < categoriesArr.length; i++) {
              for (var j = i + 1; j < categoriesArr.length; j++) {
                var size2 =
                  Math.min(
                    sets.find(function (s) {
                      return s.sets[0] === categoriesArr[i];
                    }).size,
                    sets.find(function (s) {
                      return s.sets[0] === categoriesArr[j];
                    }).size
                  ) / 3;
                sets.push({
                  sets: [categoriesArr[i], categoriesArr[j]],
                  size: size2,
                });
              }
            }
            if (categoriesArr.length === 3) {
              var size3 =
                Math.min(sets[0].size, sets[1].size, sets[2].size) / 4;
              sets.push({
                sets: categoriesArr,
                size: size3,
              });
            }
          }
          var vennDiv = d3.select("#venn-diagram").html("");
          var methodologyList = document.getElementById("methodology-filters");
          var clinicalList = document.getElementById("clinical-filters");
          var scopeList = document.getElementById("scope-filters");
          var methodologySet = sets.find(function (s) {
            return s.sets[0] === "Metodolog√≠a";
          });
          var clinicalSet = sets.find(function (s) {
            return s.sets[0] === "Cl√≠nico";
          });
          var scopeSet = sets.find(function (s) {
            return s.sets[0] === "√Åmbito";
          });

          methodologyList.innerHTML = methodologySet
            ? methodologySet.items
                .map(function (item) {
                  return "<li>" + item + "</li>";
                })
                .join("")
            : "";
          clinicalList.innerHTML = clinicalSet
            ? clinicalSet.items
                .map(function (item) {
                  return "<li>" + item + "</li>";
                })
                .join("")
            : "";
          scopeList.innerHTML = scopeSet
            ? scopeSet.items
                .map(function (item) {
                  return "<li>" + item + "</li>";
                })
                .join("")
            : "";

          if (sets.length > 0) {
            var chart = venn.VennDiagram().width(500).height(400);
            var div = vennDiv.datum(sets).call(chart);
            div
              .selectAll(".venn-circle path")
              .style("fill-opacity", 0.2)
              .style("stroke-width", 2);
            div
              .selectAll("g")
              .filter(function (d) {
                return d.sets.length === 1;
              })
              .each(function (d) {
                var g = d3.select(this);
                g.select("text")
                  .style("font-weight", "bold")
                  .style("font-size", "16px")
                  .style("fill", "#ffd700")
                  .text(d.sets[0] + " (" + d.size + ")");
              })
              .select("path")
              .style("fill", function (d) {
                var colors = {
                  Metodolog√≠a: "#3b82f6",
                  Cl√≠nico: "#10b981",
                  √Åmbito: "#8b5cf6",
                };
                return colors[d.sets[0]];
              });
            var tooltip = d3.select("#venn-tooltip");
            div
              .selectAll("g")
              .on("mouseover", function (event, d) {
                venn.sortAreas(div, d);
                tooltip.transition().duration(200).style("opacity", 0.9);
                var content = "";
                if (d.sets.length === 1) {
                  var setD = sets.find(function (s) {
                    return s.sets[0] === d.sets[0];
                  });
                  if (setD) {
                    content =
                      "<strong>" +
                      d.sets[0] +
                      "</strong><br>" +
                      setD.items
                        .map(function (item) {
                          return "‚Ä¢ " + item;
                        })
                        .join("<br>");
                  }
                } else {
                  content =
                    "<strong>Intersecci√≥n</strong><br>" + d.sets.join(" + ");
                }
                tooltip
                  .html(content)
                  .style("left", event.pageX + 10 + "px")
                  .style("top", event.pageY - 10 + "px");
              })
              .on("mousemove", function (event) {
                tooltip
                  .style("left", event.pageX + 10 + "px")
                  .style("top", event.pageY - 10 + "px");
              })
              .on("mouseout", function () {
                tooltip.transition().duration(200).style("opacity", 0);
              });
          }
        }

        /* Manejo del tutorial con intro.js */
        function iniciarTutorial() {
          var intro = introJs();
          intro.setOptions({
            steps: [
              {
                element: document.querySelector("#searchTerm"),
                intro:
                  'Escribe tus t√©rminos de b√∫squeda. Para mayor precisi√≥n, usa descriptores MeSH que puedes consultar en <a href="https://www.ncbi.nlm.nih.gov/mesh" target="_blank" style="color: #0e04c8; text-decoration: underline;">MeSH Database</a>.',
                position: "top",
              },
              {
                element: document.querySelector(".filters-section"),
                intro:
                  "Aqu√≠ encontrar√°s tres categor√≠as de filtros: Metodolog√≠a, Enfoque Cl√≠nico y √Åmbito/Poblaci√≥n. Cada categor√≠a tiene su propio operador booleano para combinar los filtros dentro de ella.",
                position: "right",
              },
              {
                element: document.querySelector("#infoModeToggle"),
                intro:
                  "Activa este bot√≥n para ver informaci√≥n detallada sobre cada filtro al pasar el cursor sobre ellos. Incluye la fuente del filtro y sus caracter√≠sticas espec√≠ficas.",
                position: "bottom",
              },
              {
                element: document.querySelector(".operator-selector"),
                intro:
                  "Cada categor√≠a tiene su propio operador booleano: OR ampl√≠a resultados (m√°s sensible), AND los restringe (m√°s espec√≠fico). Puedes combinar diferentes operadores en diferentes categor√≠as.",
                position: "left",
              },
              {
                element: document.querySelector(".versions-toggle"),
                intro:
                  "Algunos filtros tienen versiones Sensible (S) o Espec√≠fica (E). Sensible encuentra m√°s resultados pero menos precisos, Espec√≠fica encuentra menos pero m√°s relevantes.",
                position: "left",
              },
              {
                element: document.querySelector("#dateRange"),
                intro:
                  "Filtra resultados por fecha: 7 d√≠as (muy reciente), 30 d√≠as (√∫ltimo mes), 6 meses, 1 a√±o o 5 a√±os.",
                position: "top",
              },
              {
                element: document.querySelector("#sortMode"),
                intro:
                  "'Por fecha' muestra los m√°s recientes primero, 'Best match' ordena por relevancia seg√∫n el algoritmo de PubMed.",
                position: "bottom",
              },
              {
                element: document.querySelector("#searchButton"),
                intro:
                  "Lanza la b√∫squeda en PubMed con todos los filtros seleccionados. Se abrir√° en una nueva pesta√±a.",
                position: "left",
              },
              {
                element: document.querySelector("#toggleVennButton"),
                intro:
                  "Visualiza la relaci√≥n entre los filtros activos mediante un diagrama de Venn interactivo. Al activar el diagrama podr√°s ver c√≥mo se agrupan los filtros por categor√≠a y sus intersecciones.",
                position: "bottom",
                scrollTo: "tooltip",
              },
              {
                element: document.querySelector("#finalQuery"),
                intro:
                  "Aqu√≠ ver√°s la estrategia de b√∫squeda completa que combina tus t√©rminos con los filtros seleccionados usando los operadores booleanos espec√≠ficos de cada categor√≠a.",
                position: "top",
              },
              {
                element: document.querySelector(".search-header-icons"),
                intro:
                  "Tus b√∫squedas se guardan localmente en este navegador; si borras la cach√© o usas otro dispositivo, se perder√°n. Usa los botones de exportar e importar para hacer una copia de seguridad y restaurarlas cuando lo necesites.",
                position: "bottom",
              },
              {
                element: document.querySelector(".search-tips"),
                intro:
                  "Encuentra consejos √∫tiles para mejorar tus b√∫squedas, como el uso de operadores booleanos y t√©rminos MeSH. Haz clic en el encabezado para expandir y ver todos los tips.",
                position: "top",
              },
            ],
            overlayOpacity: 0.9,
            highlightClass: "myHighlight",
            disableInteraction: true,
            skipLabel: "Saltar",
            nextLabel: "Siguiente",
            prevLabel: "Anterior",
            doneLabel: "Hecho",
            showStepNumbers: false,
            scrollToElement: true,
            scrollPadding: 1,
          });
          intro.oncomplete(function () {
            localStorage.setItem("tutorial_visto", "true");
          });
          intro.onexit(function () {
            localStorage.setItem("tutorial_visto", "true");
          });
          intro.start();
        }

        var tutorialVisto = localStorage.getItem("tutorial_visto");
        if (!tutorialVisto) {
          // iniciarTutorial(); // descomenta si quieres iniciar tutorial autom√°ticamente
        }
        var startTutorialBtn = document.getElementById("startTutorialBtn");
        if (startTutorialBtn) {
          startTutorialBtn.addEventListener("click", iniciarTutorial);
        }

        /* Manejo del toggle de tips */
        var searchTips = document.querySelector(".search-tips");
        var searchTipsHeader = document.querySelector(".search-tips-header");
        searchTipsHeader.addEventListener("click", function () {
          searchTips.classList.toggle("expanded");
        });

        /* Auto-ajuste del textarea */
        var searchTextarea = document.getElementById("searchTerm");
        function autoResizeTextarea() {
          this.style.height = "auto";
          this.style.height = this.scrollHeight + "px";
        }
        searchTextarea.addEventListener("input", autoResizeTextarea);
        searchTextarea.addEventListener("focus", autoResizeTextarea);

        /* Mostrar la query final al cargar */
        mostrarQueryFinal();
      });
    </script>

    <!-- Manejo de LocalStorage + Modales de Guardar/Recuperar/Borrar/Exportar/Importar -->
    <script>
      /* Funciones de guardado local */
      function obtenerBusquedasGuardadas() {
        var data = localStorage.getItem("saved_searches");
        return data ? JSON.parse(data) : {};
      }
      function guardarBusquedasGuardadas(obj) {
        localStorage.setItem("saved_searches", JSON.stringify(obj));
      }

      /* Abrir / Cerrar modales */
      function abrirModal(idBackdrop) {
        document.getElementById(idBackdrop).classList.add("show");
      }
      function cerrarModal(idBackdrop) {
        document.getElementById(idBackdrop).classList.remove("show");
      }

      document.querySelectorAll(".close-modal").forEach(function (btn) {
        btn.addEventListener("click", function () {
          var backdropId = btn.getAttribute("data-close");
          cerrarModal(backdropId);
        });
      });
      document.querySelectorAll(".modal-backdrop").forEach((backdrop) => {
        backdrop.addEventListener("click", function (e) {
          if (e.target === backdrop) {
            backdrop.classList.remove("show");
          }
        });
      });

      /* Botones que abren cada modal */
      document
        .getElementById("btn_guardar")
        .addEventListener("click", function () {
          document.getElementById("nombreNuevaBusqueda").value = "";
          abrirModal("modalGuardarFondo");
        });
      document
        .getElementById("btn_recuperar")
        .addEventListener("click", function () {
          refrescarRecuperarSelect();
          abrirModal("modalRecuperarFondo");
        });
      document
        .getElementById("btn_borrar")
        .addEventListener("click", function () {
          refrescarBorrarSelect();
          abrirModal("modalBorrarFondo");
        });
      document
        .getElementById("btn_exportar")
        .addEventListener("click", function () {
          abrirModal("modalExportarFondo");
        });
      document
        .getElementById("btn_importar")
        .addEventListener("click", function () {
          abrirModal("modalImportarFondo");
        });

      /* Guardar B√∫squeda */
      document
        .getElementById("guardarBusquedaConfirm")
        .addEventListener("click", function () {
          var nombre = document
            .getElementById("nombreNuevaBusqueda")
            .value.trim();
          if (!nombre) {
            alert("Ingrese un nombre v√°lido");
            return;
          }
          /* Recopilar estado actual. A√±adir aqu√≠ lo que necesites (activeFilters, etc.) */
          var searchTerm = document.getElementById("searchTerm").value.trim();
          var dateRangeValue = document.getElementById("dateRange").value;
          var sortModeValue = document.getElementById("sortMode").value;
          var activeFilters = Array.from(activeFilters);

          var estadoActual = {
            termino: searchTerm,
            fecha: dateRangeValue,
            orden: sortModeValue,
          };
          var almacen = obtenerBusquedasGuardadas();
          almacen[nombre] = estadoActual;
          guardarBusquedasGuardadas(almacen);
          alert("B√∫squeda guardada: " + nombre);
          cerrarModal("modalGuardarFondo");
        });

      /* Recuperar B√∫squeda */
      function refrescarRecuperarSelect() {
        var sel = document.getElementById("recuperarSelect");
        sel.innerHTML = "";
        var almacen = obtenerBusquedasGuardadas();
        var nombres = Object.keys(almacen);
        if (nombres.length === 0) {
          var opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No hay b√∫squedas guardadas";
          sel.appendChild(opt);
        } else {
          nombres.forEach(function (n) {
            var o = document.createElement("option");
            o.value = n;
            o.textContent = n;
            sel.appendChild(o);
          });
        }
      }
      document
        .getElementById("recuperarBusquedaConfirm")
        .addEventListener("click", function () {
          var sel = document.getElementById("recuperarSelect");
          var nombre = sel.value;
          var almacen = obtenerBusquedasGuardadas();
          if (!almacen[nombre]) {
            alert("No existe esa b√∫squeda");
            return;
          }
          var estado = almacen[nombre];
          document.getElementById("searchTerm").value = estado.termino || "";
          document.getElementById("dateRange").value = estado.fecha || "";
          document.getElementById("sortMode").value = estado.orden || "date";

          /* Si guardaste activeFilters u otras cosas, deber√≠as restaurarlas aqu√≠. 
         De momento, solo restauramos lo anterior (termino, fecha, orden). */
          alert("B√∫squeda recuperada: " + nombre);
          /* Llamamos a la funci√≥n que actualiza la query final */
          document.dispatchEvent(new Event("DOMContentLoaded"));
          cerrarModal("modalRecuperarFondo");
        });

      /* Borrar B√∫squeda */
      function refrescarBorrarSelect() {
        var sel = document.getElementById("borrarSelect");
        sel.innerHTML = "";
        var almacen = obtenerBusquedasGuardadas();
        var nombres = Object.keys(almacen);
        if (nombres.length === 0) {
          var opt = document.createElement("option");
          opt.value = "";
          opt.textContent = "No hay b√∫squedas guardadas";
          sel.appendChild(opt);
        } else {
          nombres.forEach(function (n) {
            var o = document.createElement("option");
            o.value = n;
            o.textContent = n;
            sel.appendChild(o);
          });
        }
      }
      document
        .getElementById("borrarBusquedaConfirm")
        .addEventListener("click", function () {
          var sel = document.getElementById("borrarSelect");
          var nombre = sel.value;
          var almacen = obtenerBusquedasGuardadas();
          if (!almacen[nombre]) {
            alert("No existe esa b√∫squeda");
            return;
          }
          delete almacen[nombre];
          guardarBusquedasGuardadas(almacen);
          alert("B√∫squeda borrada: " + nombre);
          refrescarBorrarSelect();
          cerrarModal("modalBorrarFondo");
        });

      /* Exportar B√∫squedas */
      document
        .getElementById("exportarBusquedaConfirm")
        .addEventListener("click", function () {
          var datos = obtenerBusquedasGuardadas();
          var blob = new Blob([JSON.stringify(datos, null, 2)], {
            type: "application/json",
          });
          var url = URL.createObjectURL(blob);
          var a = document.createElement("a");
          a.href = url;
          a.download = "saved_searches.json";
          a.click();
          URL.revokeObjectURL(url);
          alert("Se han exportado las b√∫squedas a saved_searches.json");
          cerrarModal("modalExportarFondo");
        });

      /* Importar B√∫squedas */
      document
        .getElementById("importarBusquedaConfirm")
        .addEventListener("click", function () {
          var inputFile = document.getElementById("importarArchivo");
          var file = inputFile.files[0];
          if (!file) {
            alert("Seleccione un archivo JSON");
            return;
          }
          var reader = new FileReader();
          reader.onload = function (e) {
            try {
              var obj = JSON.parse(e.target.result);
              guardarBusquedasGuardadas(obj);
              alert("B√∫squedas importadas correctamente");
              cerrarModal("modalImportarFondo");
            } catch (err) {
              alert("Error al parsear el archivo JSON");
            }
          };
          reader.readAsText(file);
        });
    </script>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-YFKR6RB1ZC"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-YFKR6RB1ZC");
    </script>
  </body>
</html>
