<!--
=====================
 buscadores-pubmed.html
filtros estructurados para profesionales sanitarios
=====================
-->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asistente para buscar en PubMed Avanzado | @ernestob</title>
    <meta
      name="description"
      content="Asistente para realizar b√∫squedas avanzadas en PubMed con filtros estructurados para profesionales sanitarios"
    />
    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="Asistente para b√∫squedas en PubMed con Filtros Estructurados | @ernestob"
    />
    <meta
      property="og:site_name"
      content="Recursos para la gesti√≥n de informaci√≥n sanitaria üîéü©∫‚öï"
    />
    <meta
      property="og:url"
      content="https://ernestobarrera.github.io/buscar-pubmed.html"
    />
    <meta
      property="og:image"
      content="https://ernestobarrera.github.io/assets/images/me.png"
    />
    <link rel="icon" href="/assets/images/icon.webp" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/components.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/intro.js/7.2.0/introjs.min.css"
    />
    <link rel="stylesheet" href="/assets/css/buscar-pubmed.css" />

    <!-- libreria tooltip con metadatos del filtro -->
    <!-- Primero los archivos de tippy -->
    <script src="https://unpkg.com/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.7/dist/tippy.umd.min.js"></script>
    <!-- venn-->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/venn.js@0.2.20/build/venn.js"></script>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-YFKR6RB1ZC"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-YFKR6RB1ZC");
    </script>
  </head>
  <body>
    <include src="header.html"></include>
    <main class="main-container">
      <section class="hero-section">
        <h1 class="main-title">
          <i class="fas fa-search"></i>
          <span>Asistente para buscar en PubMed con Filtros Estructurados</span>
          <span
            style="
              margin-left: 30px;
              cursor: pointer;
              color: white;
              font-size: 0.8rem;
              background: rgba(255, 255, 255, 0.15);
              padding: 4px 8px;
              border-radius: 4px;
            "
            id="startTutorialBtn"
          >
            <i class="fas fa-graduation-cap"></i>
            Ver Gu√≠a Interactiva
          </span>
        </h1>
        <p class="intro-text">
          Optimiza tus b√∫squedas bibliogr√°ficas combinando filtros
          metodol√≥gicos, cl√≠nicos y de √°mbito predefinidos. Esta herramienta
          construye autom√°ticamente b√∫squedas avanzadas utilizando t√©rminos MeSH
          y operadores booleanos para obtener resultados m√°s precisos y
          reproducibles. Selecciona los filtros que necesites y deja que la
          herramienta construya la estrategia de b√∫squeda √≥ptima.
        </p>
      </section>

      <div class="search-container">
        <div class="search-box">
          <textarea
            id="searchTerm"
            class="search-textarea"
            placeholder="Introduce t√©rminos de b√∫squeda..."
            data-intro="Aqu√≠ escribes tus t√©rminos de b√∫squeda. Tambi√©n puedes pulsar Enter para iniciar la b√∫squeda."
            data-step="2"
            rows="1"
          ></textarea>

          <div
            id="persistentSearchCountContainer"
            class="search-count-display-container"
            style="display: none"
          >
            <span id="persistentSearchCountText"></span>
          </div>
          <div class="search-header-icons">
            <div class="main-icons" id="mainIconsContainer">
              <button id="btn_guardar" title="Guardar b√∫squeda">
                <i class="fas fa-save"></i>
              </button>
              <button id="btn_recuperar" title="Recuperar b√∫squeda">
                <i class="fas fa-folder-open"></i>
              </button>
              <button id="btn_borrar" title="Borrar b√∫squeda">
                <i class="fas fa-trash-alt"></i>
              </button>
              <button id="btn_exportar" title="Exportar b√∫squedas">
                <i class="fas fa-download"></i>
              </button>
              <button id="btn_importar" title="Importar b√∫squedas">
                <i class="fas fa-upload"></i>
              </button>
            </div>
            <button
              id="toggleCountersBtn"
              title="Cargando contadores..."
              disabled
              style="cursor: default; color: #888"
            >
              <i class="fas fa-spinner fa-spin"></i>
            </button>
            <button
              id="btn_chatgpt"
              title="Asistente ChatGPT"
              class="chatgpt-button"
            >
              <i class="fas fa-robot"></i>
            </button>
          </div>

          <div
            class="filters-section"
            data-intro="Estos son los filtros que puedes seleccionar antes de buscar."
            data-step="1"
          >
            <div class="filter-category methodological">
              <div class="category-header">
                <h3 class="category-title">
                  <i class="fas fa-flask"></i>
                  Metodolog√≠a
                </h3>
                <div class="operator-selector">
                  <label
                    >Operador:
                    <select
                      class="category-operator"
                      data-category="methodology"
                    >
                      <option value="OR" selected>OR</option>
                      <option value="AND">AND</option>
                    </select>
                  </label>
                </div>
              </div>
              <button class="filter-button methodological" data-type="mbe">
                üîç MBE
              </button>
              <button class="filter-button methodological" data-type="gpc">
                üìã GPC
              </button>
              <button
                class="filter-button methodological"
                data-type="metaanalysis"
              >
                ‚≠ê Rev Sist/Meta-an√°lisis/HTA
              </button>
              <button
                class="filter-button methodological"
                data-type="qualitative"
              >
                üìù Estudios cualitativos
              </button>
              <button
                class="filter-button methodological with-toggle"
                data-base="clinical_rules"
              >
                üìä Reglas Predicci√≥n Cl√≠nica-CQ
                <div class="versions-toggle">
                  <label>
                    <input
                      type="radio"
                      name="clinical_rules_mode"
                      value="sensible"
                      checked
                    />
                    S
                  </label>
                  <label>
                    <input
                      type="radio"
                      name="clinical_rules_mode"
                      value="especifico"
                    />
                    E
                  </label>
                </div>
              </button>
              <button class="filter-button methodological" data-type="horizon">
                üî≠ Horizon Scanning
              </button>
              <button
                class="filter-button methodological"
                data-type="clinical_rules_ap"
              >
                üìä Reglas Predicci√≥n Cl√≠nica-AP
              </button>
              <button
                class="filter-button methodological"
                data-type="indirect_comparison"
              >
                üíä Comparaciones Indirectas
              </button>
            </div>

            <div class="filter-category clinical">
              <div class="category-header">
                <h3 class="category-title">
                  <i class="fas fa-stethoscope"></i>
                  Enfoque Cl√≠nico
                </h3>
                <div class="operator-selector">
                  <label
                    >Operador:
                    <select class="category-operator" data-category="clinical">
                      <option value="OR" selected>OR</option>
                      <option value="AND">AND</option>
                    </select>
                  </label>
                </div>
              </div>
              <div class="filter-buttons-container">
                <button
                  class="filter-button clinical with-toggle"
                  data-base="diagnosis"
                >
                  üîç Diagn√≥stico-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="diagnosis_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="diagnosis_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="etiology"
                >
                  üî¨ Etiolog√≠a-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="etiology_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="etiology_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="prognosis"
                >
                  üìà Pron√≥stico-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="prognosis_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="prognosis_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="treatment"
                >
                  üíä Tratamiento-CQ
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="treatment_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="treatment_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button clinical with-toggle"
                  data-base="predictors"
                >
                  üöÄ Predictores Tratamiento
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="predictors_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="predictors_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button class="filter-button clinical" data-type="surgery_ae">
                  üè∑Ô∏è Efectos Adversos Cirug√≠a
                </button>
                <button class="filter-button clinical" data-type="devices_ae">
                  üîß Efectos Adversos Dispositivos
                </button>
                <button class="filter-button clinical" data-type="drugs_ae">
                  üíä Efectos adversos Medicamentos
                </button>
                <button class="filter-button clinical" data-type="car_t">
                  üß¨ Terapias CAR-T
                </button>
                <button
                  class="filter-button clinical"
                  data-type="deprescription"
                >
                  ‚öïÔ∏è Deprescripci√≥n
                </button>
                <button
                  class="filter-button clinical"
                  data-type="simulation_clinical"
                >
                  üéØ Simulaci√≥n Cl√≠nica V.1
                </button>
                <button
                  class="filter-button clinical"
                  data-type="clinical_examination"
                >
                  üîé Examen Cl√≠nico
                </button>
                <button class="filter-button clinical" data-type="NNT_NNH">
                  ‚úÖ NNT-NNH
                </button>
                <button class="filter-button clinical" data-type="mortality">
                  ‚ò†Ô∏è Mortalidad
                </button>
              </div>
            </div>

            <div class="filter-category scope">
              <div class="category-header">
                <h3 class="category-title">
                  <i class="fas fa-users"></i>
                  √Åmbito y Poblaci√≥n
                </h3>
                <div class="operator-selector">
                  <label
                    >Operador:
                    <select class="category-operator" data-category="scope">
                      <option value="OR" selected>OR</option>
                      <option value="AND">AND</option>
                    </select>
                  </label>
                </div>
              </div>
              <div class="filter-buttons-container">
                <button class="filter-button scope with-toggle" data-base="ai">
                  ü§ñ IA Generativa
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="ai_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input type="radio" name="ai_mode" value="especifico" />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="palliative"
                >
                  üè• Cuidados Paliativos
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="palliative_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="palliative_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="primary"
                >
                  üë®‚Äç‚öïÔ∏è Atenci√≥n Primaria
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="primary_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="primary_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="safety"
                >
                  üõ°Ô∏è Seguridad Paciente
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="safety_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="safety_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button class="filter-button scope" data-type="pearls">
                  üíé Perlas Cl√≠nicas
                </button>
                <button class="filter-button scope" data-type="perspective">
                  üë• Perspectiva Pacientes
                </button>
                <button class="filter-button scope" data-type="nursing">
                  üë©‚Äç‚öïÔ∏è Revistas de Enfermer√≠a
                </button>
                <button class="filter-button scope" data-type="humans">
                  üßë Humanos
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="geriatrics"
                >
                  üë¥ Geriatr√≠a
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="geriatrics_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="geriatrics_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
                <button class="filter-button scope" data-type="pediatrics">
                  üë∂ Pediatr√≠a
                </button>
                <button class="filter-button scope" data-type="adults">
                  üßë Personas adultas
                </button>
                <button class="filter-button scope" data-type="ocde">
                  üåç Pa√≠ses OCDE
                </button>
                <button class="filter-button scope" data-type="spanish">
                  üá™üá∏ Publicaciones Espa√±olas
                </button>
                <button
                  class="filter-button scope with-toggle"
                  data-base="economic"
                >
                  üí∞ Evaluaciones econ√≥micas
                  <div class="versions-toggle">
                    <label>
                      <input
                        type="radio"
                        name="economic_mode"
                        value="sensible"
                        checked
                      />
                      S
                    </label>
                    <label>
                      <input
                        type="radio"
                        name="economic_mode"
                        value="especifico"
                      />
                      E
                    </label>
                  </div>
                </button>
              </div>
            </div>
          </div>

          <div class="centered-controls">
            <div class="filter-controls">
              <label>
                Fecha:
                <select id="dateRange" style="border-radius: 8px">
                  <option value="">Sin Filtro</option>
                  <option value="7">√öltimos 7 d√≠as</option>
                  <option value="30">√öltimos 30 d√≠as</option>
                  <option value="180">√öltimos 6 meses</option>
                  <option value="365">√öltimo a√±o</option>
                  <option value="1825">√öltimos 5 a√±os</option>
                </select>
              </label>
              <label>
                Orden:
                <select id="sortMode" style="border-radius: 8px">
                  <option value="date">Por fecha</option>
                  <option value="best">Best match</option>
                </select>
              </label>
            </div>

            <button
              id="searchButton"
              class="search-button"
              data-intro="Haz clic aqu√≠ para lanzar la b√∫squeda en PubMed."
              data-step="3"
            >
              <i class="fas fa-search"></i>
              <span>Buscar en PubMed</span>
            </button>
            <div class="filter-info">
              <span>Filtros activos:</span>
              <span id="filterCount" class="filter-count">0</span>
            </div>
            <button id="infoModeToggle" class="info-button">
              <i class="fas fa-info-circle"></i>
              <span>Ver Detalles de Filtros</span>
            </button>
            <button id="toggleVennButton" class="info-button">
              <i class="fas fa-project-diagram"></i>
              Ver Diagrama
            </button>
            <button
              id="resetButton"
              style="
                background: linear-gradient(135deg, #777, #555);
                color: #fff;
                border: none;
                border-radius: 8px;
                padding: 0.7rem;
                font-size: 0.9rem;
                cursor: pointer;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
              "
            >
              Limpiar
            </button>
          </div>

          <div class="venn-container">
            <div class="venn-lists-column">
              <div class="venn-lists methodology-list">
                <h4>Metodolog√≠a</h4>
                <div id="methodology-filters"></div>
              </div>
              <div class="venn-lists clinical-list">
                <h4>Cl√≠nico</h4>
                <div id="clinical-filters"></div>
              </div>
            </div>
            <div id="venn-diagram"></div>
            <div class="venn-lists scope-list">
              <h4>√Åmbito</h4>
              <div id="scope-filters"></div>
            </div>
            <div id="venn-tooltip"></div>
          </div>
          <div class="final-query-box" id="finalQuery"></div>
        </div>
        <!-- Container principal para los tips de b√∫squeda -->
        <div class="search-tips">
          <div class="search-tips-header">
            <h3 class="search-tips-title">
              <i class="fas fa-lightbulb"></i>
              Tips Avanzados para B√∫squedas en PubMed
              <span class="subtitle"
                >Optimiza tus b√∫squedas bibliogr√°ficas usando nuestros filtros
                estructurados</span
              >
            </h3>
            <i class="fas fa-chevron-down search-tips-icon"></i>
          </div>

          <div class="search-tips-content">
            <!-- Tip 1 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">01</span>
                Best Match como Herramienta de Descubrimiento
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>¬øQu√© es Best Match?</strong>
                  Best Match es el algoritmo de relevancia de PubMed que ordena
                  los resultados seg√∫n su importancia para tu b√∫squeda. Utiliza
                  factores como la coincidencia de t√©rminos, fecha de
                  publicaci√≥n y relevancia del journal.
                </div>
                <div class="tip-section">
                  <strong>C√≥mo aprovecharlo con nuestros filtros:</strong>
                  1. Realiza tu b√∫squeda inicial usando los filtros
                  metodol√≥gicos (como MBE o Meta-an√°lisis)<br />
                  2. Selecciona "Best match" en el ordenamiento de resultados<br />
                  3. Revisa los primeros 10-20 resultados para identificar:<br />
                  &nbsp;&nbsp;‚Ä¢ T√©rminos MeSH relevantes<br />
                  &nbsp;&nbsp;‚Ä¢ Variantes terminol√≥gicas<br />
                  &nbsp;&nbsp;‚Ä¢ Conceptos relacionados
                </div>
                <div class="example-box">
                  Ejemplo: Para una b√∫squeda sobre "cancer screening", Best
                  Match podr√≠a revelarte t√©rminos como "Early Detection of
                  Cancer"[Mesh] o "Mass Screening"[Mesh]
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Combina Best Match con los filtros de √°mbito (como
                  Atenci√≥n Primaria o Geriatr√≠a) para descubrir terminolog√≠a
                  espec√≠fica de cada contexto.
                </div>
              </div>
            </div>

            <!-- Tip 2 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">02</span>
                B√∫squeda por Proximidad en PubMed
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Nueva funcionalidad de PubMed</strong>
                  La b√∫squeda por proximidad permite encontrar t√©rminos cercanos
                  entre s√≠, incluso si no est√°n exactamente juntos o en el mismo
                  orden.
                </div>
                <div class="tip-section">
                  <strong>Sintaxis b√°sica:</strong>
                  "t√©rmino1 t√©rmino2"[campo:~N]<br />
                  Donde N = n√∫mero m√°ximo de palabras entre los t√©rminos
                </div>
                <div class="example-box">
                  "diabetes treatment"[Title/Abstract:~2]<br />
                  Encuentra: "diabetes and its treatment", "treatment of
                  diabetes", "diabetes receiving treatment"
                </div>
                <div class="tip-section">
                  <strong>Uso con nuestros filtros:</strong>
                  Combina la b√∫squeda por proximidad con filtros cl√≠nicos para
                  mayor precisi√≥n:<br />
                  ‚Ä¢ Con filtro de Tratamiento-CQ: mayor especificidad en
                  resultados terap√©uticos<br />
                  ‚Ä¢ Con filtro de Efectos Adversos: mejor detecci√≥n de
                  complicaciones
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Usa N=0 para encontrar t√©rminos adyacentes en
                  cualquier orden. Especialmente √∫til con los filtros de √Åmbito
                  y Poblaci√≥n.
                </div>
              </div>
            </div>

            <!-- Tip 3 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">03</span>
                Estrategia Sensible/Espec√≠fica
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>¬øPor qu√© usar dos enfoques?</strong>
                  La estrategia sensible/espec√≠fica permite evolucionar desde
                  una b√∫squeda amplia que captura todo lo relevante hacia una
                  m√°s precisa que elimina el ruido.
                </div>
                <div class="tip-section">
                  <strong>Uso con nuestros filtros:</strong>
                  ‚Ä¢ En filtros cl√≠nicos (Diagn√≥stico, Etiolog√≠a, etc.): usa
                  primero la versi√≥n Sensible (S) para identificar toda la
                  terminolog√≠a relevante<br />
                  ‚Ä¢ En filtros de √°mbito (IA, Atenci√≥n Primaria): cambia a
                  versi√≥n Espec√≠fica (E) cuando necesites mayor precisi√≥n
                </div>
                <div class="example-box">
                  Ejemplo para b√∫squeda sobre diagn√≥stico de diabetes:<br />
                  1. Inicia con "Diagn√≥stico-CQ (S)" + t√©rminos b√°sicos<br />
                  2. Identifica t√©rminos clave en resultados<br />
                  3. Refina usando "Diagn√≥stico-CQ (E)" + t√©rminos identificados
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Combina versiones Sensibles para temas poco
                  estudiados y Espec√≠ficas para temas con mucha literatura.
                </div>
              </div>
            </div>

            <!-- Tip 4 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">04</span>
                Clinical Queries Estrat√©gicos
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Filtros Clinical Queries (CQ)</strong>
                  Son filtros metodol√≥gicos validados cient√≠ficamente para
                  diferentes tipos de estudios cl√≠nicos, optimizados para
                  maximizar la recuperaci√≥n de art√≠culos relevantes.
                </div>
                <div class="tip-section">
                  <strong>Uso √≥ptimo en nuestra herramienta:</strong>
                  ‚Ä¢ Diagn√≥stico-CQ: Para pruebas diagn√≥sticas y screening<br />
                  ‚Ä¢ Tratamiento-CQ: Para intervenciones terap√©uticas<br />
                  ‚Ä¢ Etiolog√≠a-CQ: Para factores de riesgo y causas<br />
                  ‚Ä¢ Pron√≥stico-CQ: Para evoluci√≥n y resultados
                </div>
                <div class="example-box">
                  Para estudio sobre tratamiento nuevo:<br />
                  "nuevo f√°rmaco" + Tratamiento-CQ (E) + Efectos Adversos
                  Medicamentos
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Combina CQ con filtros de √°mbito para contextos
                  espec√≠ficos (ej: Tratamiento-CQ + Atenci√≥n Primaria).
                </div>
              </div>
            </div>

            <!-- Tip 5 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">05</span>
                Control Temporal Inteligente
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Estrategia en dos fases</strong>
                  Combina b√∫squedas recientes para capturar terminolog√≠a actual
                  con b√∫squedas hist√≥ricas para no perder estudios
                  fundamentales.
                </div>
                <div class="tip-section">
                  <strong>Implementaci√≥n con nuestros filtros:</strong>
                  1. B√∫squeda reciente (√∫ltimos 6 meses):<br />
                  &nbsp;&nbsp;‚Ä¢ Usa filtros metodol√≥gicos en versi√≥n Sensible<br />
                  &nbsp;&nbsp;‚Ä¢ Activa "√öltimos 6 meses" en el selector de
                  fecha<br />
                  2. B√∫squeda hist√≥rica (5 a√±os):<br />
                  &nbsp;&nbsp;‚Ä¢ Incorpora t√©rminos descubiertos<br />
                  &nbsp;&nbsp;‚Ä¢ Cambia a versi√≥n Espec√≠fica de los filtros
                </div>
                <div class="example-box">
                  Fase 1: IA Generativa (S) + "√∫ltimos 6 meses"<br />
                  Fase 2: IA Generativa (E) + nuevos t√©rminos + "√∫ltimos 5 a√±os"
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Para temas emergentes, prioriza resultados
                  recientes. Para temas establecidos, ampl√≠a el rango temporal.
                </div>
              </div>
            </div>

            <!-- Tip 6 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">06</span>
                Validaci√≥n Sistem√°tica
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Proceso de validaci√≥n</strong>
                  Verifica la calidad de tu estrategia de b√∫squeda mediante un
                  an√°lisis sistem√°tico de los resultados.
                </div>
                <div class="tip-section">
                  <strong>Lista de verificaci√≥n:</strong>
                  1. Relevancia de resultados:<br />
                  &nbsp;&nbsp;‚Ä¢ ¬øLos primeros 10 resultados son pertinentes?<br />
                  &nbsp;&nbsp;‚Ä¢ ¬øHay ruido tem√°tico significativo?<br />
                  2. Cobertura tem√°tica:<br />
                  &nbsp;&nbsp;‚Ä¢ ¬øSe recuperan todos los aspectos relevantes?<br />
                  &nbsp;&nbsp;‚Ä¢ ¬øFaltan conceptos importantes?
                </div>
                <div class="example-box">
                  Para validar b√∫squeda sobre seguridad del paciente:<br />
                  1. Aplicar Safety (S) + Best Match<br />
                  2. Verificar primeros resultados<br />
                  3. Ajustar a Safety (E) si hay exceso de ruido
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Si encuentras art√≠culos irrelevantes en los
                  primeros resultados, considera cambiar de versi√≥n Sensible a
                  Espec√≠fica.
                </div>
              </div>
            </div>

            <!-- Tip 7 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">07</span>
                Refinamiento Iterativo
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Proceso de mejora continua</strong>
                  Optimiza tu b√∫squeda mediante ciclos de refinamiento,
                  incorporando nuevos t√©rminos y ajustando filtros seg√∫n los
                  resultados.
                </div>
                <div class="tip-section">
                  <strong>Ciclo de refinamiento:</strong>
                  1. B√∫squeda inicial con filtros base<br />
                  2. An√°lisis de mejores resultados<br />
                  3. Identificaci√≥n de nuevos t√©rminos<br />
                  4. Ajuste de filtros y operadores<br />
                  5. Validaci√≥n de cambios
                </div>
                <div class="example-box">
                  Iteraci√≥n para b√∫squeda en geriatr√≠a:<br />
                  1. Geriatr√≠a (S) + t√©rminos iniciales<br />
                  2. Identificar subgrupos relevantes<br />
                  3. A√±adir Cuidados Paliativos si aparece frecuentemente
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Documenta cada iteraci√≥n y su impacto para crear
                  un hist√≥rico de mejoras.
                </div>
              </div>
            </div>

            <!-- Tip 8 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">08</span>
                Combinaci√≥n de Campos
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Estrategia de campos m√∫ltiples</strong>
                  Maximiza la precisi√≥n combinando b√∫squeda por proximidad en
                  t√≠tulo/abstract con t√©rminos MeSH y nuestros filtros
                  estructurados.
                </div>
                <div class="tip-section">
                  <strong>Estructura √≥ptima:</strong>
                  1. T√©rminos de proximidad en [Title/Abstract]<br />
                  2. T√©rminos MeSH relevantes<br />
                  3. Filtros metodol√≥gicos o cl√≠nicos<br />
                  4. Filtros de √°mbito seg√∫n necesidad
                </div>
                <div class="example-box">
                  "diabetes management"[Title/Abstract:~2] AND<br />
                  "Diabetes Mellitus/therapy"[Mesh] AND<br />
                  {Aplicar filtro Primary (E) + Treatment (E)}
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Usa diferentes valores de proximidad (~1, ~2, ~3)
                  para encontrar el balance √≥ptimo de resultados.
                </div>
              </div>
            </div>

            <!-- Tip 9 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">09</span>
                An√°lisis de Resultados
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Evaluaci√≥n de calidad</strong>
                  Analiza sistem√°ticamente los resultados para garantizar que tu
                  estrategia de b√∫squeda es efectiva.
                </div>
                <div class="tip-section">
                  <strong>Criterios de evaluaci√≥n:</strong>
                  ‚Ä¢ Precisi√≥n: relevancia de los primeros resultados<br />
                  ‚Ä¢ Exhaustividad: recuperaci√≥n de art√≠culos clave<br />
                  ‚Ä¢ Balance: proporci√≥n de resultados √∫tiles<br />
                  ‚Ä¢ Actualidad: distribuci√≥n temporal adecuada
                </div>
                <div class="example-box">
                  Para evaluar b√∫squeda de terapias CAR-T:<br />
                  1. Aplicar filtro CAR-T + Best Match<br />
                  2. Verificar presencia de papers clave<br />
                  3. Analizar distribuci√≥n temporal
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: La calidad de los primeros 10-20 resultados es un
                  buen predictor de la efectividad global de tu b√∫squeda.
                </div>
              </div>
            </div>

            <!-- Tip 10 -->
            <div class="tip">
              <h3 class="tip-title">
                <span class="tip-number">10</span>
                Verificaci√≥n Final
              </h3>
              <div class="tip-content">
                <div class="tip-section">
                  <strong>Lista de verificaci√≥n completa</strong>
                  Asegura la calidad de tu b√∫squeda mediante una revisi√≥n
                  sistem√°tica de todos los componentes.
                </div>
                <div class="tip-section">
                  <strong>Elementos a verificar:</strong>
                  1. Estructura de b√∫squeda:<br />
                  &nbsp;&nbsp;‚Ä¢ T√©rminos MeSH apropiados<br />
                  &nbsp;&nbsp;‚Ä¢ Operadores booleanos correctos<br />
                  &nbsp;&nbsp;‚Ä¢ Filtros metodol√≥gicos adecuados<br />
                  2. Resultados:<br />
                  &nbsp;&nbsp;‚Ä¢ Art√≠culos clave recuperados<br />
                  &nbsp;&nbsp;‚Ä¢ Balance sensibilidad/especificidad<br />
                  3. Documentaci√≥n:<br />
                  &nbsp;&nbsp;‚Ä¢ Estrategia documentada<br />
                  &nbsp;&nbsp;‚Ä¢ Filtros utilizados registrados
                </div>
                <div class="example-box">
                  Checklist final:<br />
                  ‚òê T√©rminos principales incluidos<br />
                  ‚òê Filtros apropiados seleccionados<br />
                  ‚òê Operadores verificados<br />
                  ‚òê Resultados validados
                </div>
                <div class="pro-tip">
                  üí° Pro-tip: Guarda tu estrategia final completa para futuras
                  actualizaciones o refinamientos.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="info-section">
          <h2 class="info-title">
            <i class="fas fa-info-circle"></i>
            Sobre las B√∫squedas
          </h2>
          <p class="info-text">
            Los filtros se combinan autom√°ticamente usando operadores booleanos:
            <strong>OR</strong> entre filtros de la misma categor√≠a y
            <strong>AND</strong> entre diferentes categor√≠as (por defecto). Esto
            permite construir b√∫squedas precisas que encuentran exactamente lo
            que necesitas.
            <br />
            <span style="font-size: 0.8rem; color: grey"
              ><b>CQ:</b> Clinical Queries PubMed</span
            >
          </p>
        </div>
      </div>
    </main>

    <include src="footer.html"></include>
    <script src="/assets/js/include.js"></script>
    <script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // 1. Variables globales
        var searchTerm = document.getElementById("searchTerm");
        window.searchTerm = searchTerm;
        var searchButton = document.getElementById("searchButton");
        var resetButton = document.getElementById("resetButton");
        var filterCount = document.getElementById("filterCount");
        var finalQueryBox = document.getElementById("finalQuery");
        var dateRange = document.getElementById("dateRange");
        var sortMode = document.getElementById("sortMode");
        /*         var internalOperator = document.getElementById("internalOperator");
         */
        var activeFilters = new Set();
        var filterMap = {};
        window.filterMap = filterMap;
        var filterTooltips = {};
        // Manejo del toggle del diagrama de Venn
        const toggleVennButton = document.getElementById("toggleVennButton");
        const vennContainer = document.querySelector(".venn-container");

        toggleVennButton.addEventListener("click", () => {
          vennContainer.classList.toggle("visible");
          toggleVennButton.classList.toggle("active"); // A√±ade esta l√≠nea

          toggleVennButton.innerHTML = vennContainer.classList.contains(
            "visible"
          )
            ? '<i class="fas fa-project-diagram"></i> Ocultar Diagrama'
            : '<i class="fas fa-project-diagram"></i> Ver Diagrama';
          if (vennContainer.classList.contains("visible")) {
            updateVennDiagram(); // Actualizar el diagrama cuando se muestra
          }
        });

        // ================================
        // Componente de Guardar / Recuperar / Borrar / Exportar / Importar b√∫squedas
        // ================================

        // Bot√≥n para guardar b√∫squeda
        document
          .getElementById("btn_guardar")
          .addEventListener("click", function () {
            document.getElementById("nombreNuevaBusqueda").value = "";
            abrirModal("modalGuardarFondo");
          });
        document
          .getElementById("guardarBusquedaConfirm")
          .addEventListener("click", function () {
            const nombre = document
              .getElementById("nombreNuevaBusqueda")
              .value.trim();
            if (!nombre) {
              return;
            }

            // Recoger operadores actuales
            const operadores = {};
            document
              .querySelectorAll(".category-operator")
              .forEach((select) => {
                operadores[select.dataset.category] = select.value;
              });

            const b√∫squedaActual = {
              termino: searchTerm.value.trim(),
              filtros: Array.from(activeFilters),
              fecha: dateRange.value,
              orden: sortMode.value,
              operadores: operadores, // A√±adimos los operadores
            };

            const b√∫squedas = obtenerB√∫squedasGuardadas();
            b√∫squedas[nombre] = b√∫squedaActual;
            guardarB√∫squedasGuardadas(b√∫squedas);
            mostrarToast(`B√∫squeda "${nombre}" guardada correctamente.`);
            cerrarModal("modalGuardarFondo");
          });

        // Bot√≥n para recuperar b√∫squeda
        document
          .getElementById("btn_recuperar")
          .addEventListener("click", function () {
            const b√∫squedas = obtenerB√∫squedasGuardadas();
            const nombres = Object.keys(b√∫squedas);
            const select = document.getElementById("recuperarSelect");
            select.innerHTML = "";

            if (nombres.length === 0) {
              const opt = document.createElement("option");
              opt.value = "";
              opt.textContent = "No hay b√∫squedas guardadas";
              select.appendChild(opt);
              mostrarToast("No hay b√∫squedas guardadas.");
              return;
            }

            nombres.forEach((nombre) => {
              const opt = document.createElement("option");
              opt.value = nombre;
              opt.textContent = nombre;
              select.appendChild(opt);
            });

            abrirModal("modalRecuperarFondo");
          });

        document
          .getElementById("recuperarBusquedaConfirm")
          .addEventListener("click", function () {
            const select = document.getElementById("recuperarSelect");
            const nombre = select.value;
            const b√∫squedas = obtenerB√∫squedasGuardadas();

            if (!nombre || !b√∫squedas[nombre]) {
              mostrarToast("No se encontr√≥ la b√∫squeda con ese nombre.");
              return;
            }

            const estado = b√∫squedas[nombre];

            // Restaurar valores b√°sicos
            searchTerm.value = estado.termino || "";
            autoResizeTextarea.call(searchTerm);
            dateRange.value = estado.fecha || "";
            sortMode.value = estado.orden || "date";

            // Restaurar operadores si existen
            if (estado.operadores) {
              Object.entries(estado.operadores).forEach(([category, value]) => {
                const select = document.querySelector(
                  `.category-operator[data-category="${category}"]`
                );
                if (select) {
                  select.value = value;
                  categoryOperators[category] = value; // Actualizar tambi√©n el objeto de operadores
                }
              });
            }

            // Restaurar filtros
            document.querySelectorAll(".filter-button").forEach(function (btn) {
              btn.classList.remove("active");
            });
            activeFilters.clear();

            estado.filtros.forEach(function (filtro) {
              activeFilters.add(filtro);
              let btn = document.querySelector(
                '.filter-button[data-type="' + filtro + '"]'
              );
              if (!btn) {
                const base = filtro.split("_")[0];
                btn = document.querySelector(
                  '.filter-button[data-base="' + base + '"]'
                );
              }
              if (btn) {
                btn.classList.add("active");
              }
            });

            updateFilterCounterDisplay(); // Actualizar el contador de filtros
            mostrarQueryFinal();

            // Llamar al trigger externo si existe nuevo cambio estaba antes de updateFilterCounterDisplay

            // ---> ¬°A√ëADIR ESTA L√çNEA! <---
            // Disparar la actualizaci√≥n de los contadores con el estado recuperado
            if (typeof window.triggerPubMedCounterUpdate === "function") {
              window.triggerPubMedCounterUpdate();
            }
            // ---> FIN DE L√çNEA A A√ëADIR <---
            mostrarToast(`B√∫squeda "${nombre}" recuperada correctamente.`);
            cerrarModal("modalRecuperarFondo");
          });

        // Bot√≥n para borrar b√∫squeda
        document
          .getElementById("btn_borrar")
          .addEventListener("click", function () {
            const b√∫squedas = obtenerB√∫squedasGuardadas();
            const nombres = Object.keys(b√∫squedas);
            const select = document.getElementById("borrarSelect");
            select.innerHTML = "";

            if (nombres.length === 0) {
              const opt = document.createElement("option");
              opt.value = "";
              opt.textContent = "No hay b√∫squedas guardadas";
              select.appendChild(opt);
              mostrarToast("No hay b√∫squedas guardadas.");
              return;
            }

            nombres.forEach((nombre) => {
              const opt = document.createElement("option");
              opt.value = nombre;
              opt.textContent = nombre;
              select.appendChild(opt);
            });

            abrirModal("modalBorrarFondo");
          });

        document
          .getElementById("borrarBusquedaConfirm")
          .addEventListener("click", function () {
            const select = document.getElementById("borrarSelect");
            const nombre = select.value;
            const b√∫squedas = obtenerB√∫squedasGuardadas();

            if (!nombre || !b√∫squedas[nombre]) {
              mostrarToast("No se encontr√≥ la b√∫squeda con ese nombre.");

              return;
            }

            delete b√∫squedas[nombre];
            guardarB√∫squedasGuardadas(b√∫squedas);
            mostrarToast(`B√∫squeda "${nombre}" borrada correctamente.`);

            cerrarModal("modalBorrarFondo");

            // Actualizar el select despu√©s de borrar
            const nombres = Object.keys(b√∫squedas);
            select.innerHTML = "";
            if (nombres.length === 0) {
              const opt = document.createElement("option");
              opt.value = "";
              opt.textContent = "No hay b√∫squedas guardadas";
              select.appendChild(opt);
            } else {
              nombres.forEach((nombre) => {
                const opt = document.createElement("option");
                opt.value = nombre;
                opt.textContent = nombre;
                select.appendChild(opt);
              });
            }
          });

        // Bot√≥n para exportar b√∫squedas
        document
          .getElementById("btn_exportar")
          .addEventListener("click", function () {
            abrirModal("modalExportarFondo");
          });

        document
          .getElementById("exportarBusquedaConfirm")
          .addEventListener("click", function () {
            const b√∫squedas = obtenerB√∫squedasGuardadas();
            const jsonString = JSON.stringify(b√∫squedas, null, 2);
            const blob = new Blob([jsonString], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = "saved_searches.json";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            mostrarToast(
              "Las b√∫squedas se han exportado a un archivo llamado 'saved_searches.json'.\nGu√°rdalo en un lugar seguro para futuras importaciones."
            );
            cerrarModal("modalExportarFondo");
          });

        // Bot√≥n para importar b√∫squedas
        document
          .getElementById("btn_importar")
          .addEventListener("click", function () {
            abrirModal("modalImportarFondo");
          });

        document
          .getElementById("importarBusquedaConfirm")
          .addEventListener("click", function () {
            const input = document.getElementById("importarArchivo");
            const file = input.files[0];
            if (!file) {
              mostrarToast("No se seleccion√≥ ning√∫n archivo.");
              return;
            }
            const reader = new FileReader();
            reader.onload = function (e) {
              try {
                const b√∫squedasImportadas = JSON.parse(e.target.result);
                const b√∫squedasActuales = obtenerB√∫squedasGuardadas();

                // Merge inteligente
                Object.entries(b√∫squedasImportadas).forEach(
                  ([nombre, b√∫squeda]) => {
                    let nombreFinal = nombre;
                    let counter = 1;

                    // Si existe y es diferente, a√±adir numeraci√≥n
                    while (
                      b√∫squedasActuales[nombreFinal] &&
                      JSON.stringify(b√∫squedasActuales[nombreFinal]) !==
                        JSON.stringify(b√∫squeda)
                    ) {
                      nombreFinal = `${nombre} (${counter})`;
                      counter++;
                    }

                    // Solo guardar si es nueva o diferente
                    if (
                      !b√∫squedasActuales[nombreFinal] ||
                      JSON.stringify(b√∫squedasActuales[nombreFinal]) !==
                        JSON.stringify(b√∫squeda)
                    ) {
                      b√∫squedasActuales[nombreFinal] = b√∫squeda;
                    }
                  }
                );

                guardarB√∫squedasGuardadas(b√∫squedasActuales);
                mostrarToast("B√∫squedas importadas correctamente.");
                cerrarModal("modalImportarFondo");
                input.value = "";
              } catch (error) {
                mostrarToast(
                  "Error al parsear el archivo JSON. Verifique el formato."
                );
              }
            };
            reader.readAsText(file);
          });
        // ================================
        // Fin del componente de Guardar/Recuperar/Borrar/Exportar/Importar b√∫squedas
        // ================================

        // 2. Configuraci√≥n de categor√≠as
        var categories = {
          methodology: [
            "mbe",
            "gpc",
            "metaanalysis",
            "qualitative",
            "clinical_rules_sensible",
            "clinical_rules_especifico",
            "horizon",
            "clinical_rules_ap",
            "indirect_comparison",
          ],
          clinical: [
            "diagnosis_sensible",
            "diagnosis_especifico",
            "etiology_sensible",
            "etiology_especifico",
            "prognosis_sensible",
            "prognosis_especifico",
            "treatment_sensible",
            "treatment_especifico",
            "predictors_sensible",
            "predictors_especifico",
            "surgery_ae",
            "devices_ae",
            "drugs_ae",
            "car_t",
            "deprescription",
            "simulation_clinical",
            "clinical_examination",
            "NNT_NNH",
            "mortality",
          ],
          scope: [
            "ai_sensible",
            "ai_especifico",
            "palliative_sensible",
            "palliative_especifico",
            "primary_sensible",
            "primary_especifico",
            "safety_sensible",
            "safety_especifico",
            "pearls",
            "perspective",
            "nursing",
            "humans",
            "geriatrics_sensible",
            "geriatrics_especifico",
            "pediatrics",
            "adults",
            "ocde",
            "spanish",
            "economic_sensible",
            "economic_especifico",
          ],
        };
        window.categories = categories;
        // 3. Funciones de manejo de metadata y tooltips
        function formatTooltipContent(metadata) {
          const parts = [];

          // Funci√≥n auxiliar para validar si una m√©trica debe mostrarse
          const isValidMetric = (value) => {
            return (
              value !== undefined &&
              value !== null &&
              value !== 0 &&
              !isNaN(value) &&
              value.toString().trim() !== ""
            );
          };

          // Funci√≥n auxiliar para formatear una secci√≥n de m√©tricas
          const formatMetricSection = (metrics, prefix = "") => {
            const formattedMetrics = [];

            if (isValidMetric(metrics.sensitivity)) {
              formattedMetrics.push(
                `${prefix}<strong>Sensibilidad:</strong> ${metrics.sensitivity}%`
              );
            }
            if (isValidMetric(metrics.specificity)) {
              formattedMetrics.push(
                `${prefix}<strong>Especificidad:</strong> ${metrics.specificity}%`
              );
            }
            if (isValidMetric(metrics.precision)) {
              formattedMetrics.push(
                `${prefix}<strong>Precisi√≥n:</strong> ${metrics.precision}%`
              );
            }
            if (isValidMetric(metrics.NNR)) {
              formattedMetrics.push(
                `${prefix}<strong>NNR:</strong> ${metrics.NNR}`
              );
            }

            return formattedMetrics;
          };

          if (metadata.validation?.metrics) {
            // Para filtros con versi√≥n √∫nica
            if ("sensitivity" in metadata.validation.metrics) {
              parts.push(...formatMetricSection(metadata.validation.metrics));
            }
            // Para filtros con versiones sensible/espec√≠fica
            else if ("sensitive" in metadata.validation.metrics) {
              const sensitiveParts = formatMetricSection(
                metadata.validation.metrics.sensitive
              );
              const specificParts = formatMetricSection(
                metadata.validation.metrics.specific
              );

              if (sensitiveParts.length > 0) {
                parts.push("<u>Versi√≥n Sensible:</u>");
                parts.push(...sensitiveParts);
              }

              if (specificParts.length > 0) {
                if (parts.length > 0) parts.push(""); // L√≠nea en blanco como separador
                parts.push("<u>Versi√≥n Espec√≠fica:</u>");
                parts.push(...specificParts);
              }
            }
          }

          // A√±adir referencia si existe y no est√° vac√≠a
          if (metadata.validation?.reference?.trim()) {
            if (parts.length > 0) parts.push(""); // L√≠nea en blanco como separador
            parts.push(
              `<strong>Fuente:</strong> ${metadata.validation.reference.trim()}`
            );
          }

          return parts.join("\n");
        }

        function cargarFiltros() {
          console.log("Iniciando carga de filtros..."); // Debugging
          var promises = [];
          Object.keys(categories).forEach(function (cat) {
            categories[cat].forEach(function (id) {
              var url =
                "https://ernestobarrera.github.io/pubmed-filters/filters/" +
                cat +
                "/" +
                id +
                ".txt";
              console.log("Cargando filtro:", url); // Debugging
              var prom = fetch(url)
                .then(function (r) {
                  return r.ok ? r.text() : "";
                })
                .then(function (txt) {
                  // Separar contenido del filtro y metadatos
                  const [filter, metadataStr] = txt.split(
                    "@@@FILTER_METADATA@@@"
                  );

                  // Procesar solo el contenido del filtro, ignorando l√≠neas que empiezan con "#"
                  const cleanedFilter = filter
                    .split("\n")
                    .filter((line) => !line.trim().startsWith("#"))
                    .join("\n");

                  filterMap[id] = cleanedFilter.trim(); // Guardar el filtro limpio

                  // Parsear los metadatos si existen
                  if (metadataStr) {
                    try {
                      const metadata = JSON.parse(metadataStr.trim());
                      const tooltipContent = formatTooltipContent(metadata);
                      filterTooltips[id] = tooltipContent;
                    } catch (e) {
                      console.warn(`Error parseando metadata para ${id}:`, e);
                    }
                  }
                })
                .catch(function (error) {
                  console.error("Error cargando filtro:", url, error); // Debugging
                  filterMap[id] = ""; // Si falla, asegura que el filtro no existe
                });
              promises.push(prom);
            });
          });
          return Promise.all(promises);
        }

        // 4. Inicializaci√≥n de tooltips
        cargarFiltros().then(() => {
          console.log("Filtros cargados, inicializando tooltips...");

          document
            .querySelectorAll(".filter-button")
            .forEach(function (button) {
              let id;
              if (button.classList.contains("with-toggle")) {
                // Para botones con toggle, usar el ID base + "_sensible"
                id = button.dataset.base + "_sensible";
                console.log("Bot√≥n con toggle, usando ID:", id);
              } else {
                // Para botones sin toggle, usar el ID tipo
                id = button.dataset.type;
                console.log("Bot√≥n sin toggle, usando ID:", id);
              }

              if (filterTooltips[id]) {
                console.log(
                  "A√±adiendo tooltip a:",
                  id,
                  "con contenido:",
                  filterTooltips[id]
                );
                button.setAttribute("data-tippy-content", filterTooltips[id]);
                tippy(button, {
                  content: filterTooltips[id],
                  placement: "auto", // Cambiado de 'top' a 'auto' para mejor posicionamiento

                  placement: "top",
                  arrow: true,
                  theme: "custom",
                  animation: "shift-away",
                  delay: [200, 0],
                  maxWidth: 400,
                  allowHTML: true, // A√±adimos esta l√≠nea para permitir HTML en el contenido
                  trigger: "mouseenter",
                  onShow(instance) {
                    return infoModeActive;
                  },
                });
              } else {
                console.log("No se encontr√≥ tooltip para:", id);
              }
            });

          // Manejar el toggle de informaci√≥n
          const infoModeToggle = document.getElementById("infoModeToggle");
          let infoModeActive = false;

          // Definir las funciones de mostrar/ocultar fuera para poder removerlas
          function showTooltip(event) {
            const tippyInstance = event.currentTarget._tippy;
            if (tippyInstance) {
              tippyInstance.show();
            }
          }

          function hideTooltip(event) {
            const tippyInstance = event.currentTarget._tippy;
            if (tippyInstance) {
              tippyInstance.hide();
            }
          }

          infoModeToggle.addEventListener("click", () => {
            infoModeActive = !infoModeActive;

            // Cambiar estilo del bot√≥n
            infoModeToggle.style.background = infoModeActive
              ? "var(--accent-color)"
              : "var(--card-bg)";
            infoModeToggle.style.color = infoModeActive
              ? "var(--primary-bg)"
              : "var(--text-primary)";

            // Activar/desactivar tooltips
            document.querySelectorAll(".filter-button").forEach((button) => {
              const tippyInstance = button._tippy;
              if (tippyInstance) {
                if (infoModeActive) {
                  button.addEventListener("mouseenter", showTooltip);
                  button.addEventListener("mouseleave", hideTooltip);
                } else {
                  button.removeEventListener("mouseenter", showTooltip);
                  button.removeEventListener("mouseleave", hideTooltip);
                  tippyInstance.hide(); // Ocultar tooltip si est√° visible
                }
              }
            });
          });
        });

        // ---> NUEVA FUNCI√ìN CENTRALIZADA PARA ACTUALIZAR EL CONTADOR <---
        function updateFilterCounterDisplay() {
          const buttonFilterCount = activeFilters.size; // N√∫mero de filtros de bot√≥n activos
          const isDateFilterActive = dateRange.value !== ""; // ¬øHay un filtro de fecha seleccionado? (' !== "" ' significa que cualquier opci√≥n excepto "Sin Filtro" est√° seleccionada)

          // Calcula el total de filtros activos (botones + fecha)
          const totalActiveFilters =
            buttonFilterCount + (isDateFilterActive ? 1 : 0);

          // Actualiza el texto del contador
          filterCount.textContent = totalActiveFilters;

          // Resalta el contador si hay 1 o m√°s filtros activos
          if (totalActiveFilters > 0) {
            filterCount.classList.add("highlighted");
          } else {
            filterCount.classList.remove("highlighted");
          }
        }
        // ---> FIN NUEVA FUNCI√ìN <---

        // 5. Event Listeners b√°sicos (MODIFICADOS)
        // ... resto del script ...
        // 5. Event Listeners b√°sicos (REEMPLAZO CONSERVADOR)

        // Listener para searchTerm (Input) - Solo para mostrar query.
        // (La actualizaci√≥n de contadores la dispara counters.js con debounce)
        if (searchTerm) {
          // A√±adir comprobaci√≥n por si acaso
          searchTerm.addEventListener("input", mostrarQueryFinal);
        }

        // Listener para dateRange (Change) - Muestra query Y actualiza contador VISUAL
        if (dateRange) {
          dateRange.addEventListener("change", function () {
            mostrarQueryFinal();
            updateFilterCounterDisplay(); // <-- USA LA NUEVA FUNCI√ìN para actualizar n√∫mero y resaltado
            // Llama a la funci√≥n global del script de contadores externo si existe
            if (typeof window.triggerPubMedCounterUpdate === "function") {
              window.triggerPubMedCounterUpdate();
            }
          });
        }

        // Listener para sortMode (Change) - Solo muestra query (no afecta contadores)
        if (sortMode) {
          // A√±adir comprobaci√≥n
          sortMode.addEventListener("change", mostrarQueryFinal);
        }

        // 6. Manejo de filtros simples
        document
          .querySelectorAll(".filter-button:not(.with-toggle)")
          .forEach(function (button) {
            button.addEventListener("click", function () {
              button.classList.toggle("active");
              var filterType = button.dataset.type;
              if (filterType) {
                if (button.classList.contains("active")) {
                  activeFilters.add(filterType);
                } else {
                  activeFilters.delete(filterType);
                }
                updateFilterCounterDisplay(); // <-- USA LA NUEVA FUNCI√ìN para actualizar n√∫mero y resaltado
                mostrarQueryFinal();
                // ---> ¬°A√ëADIR ESTA L√çNEA! <---
                if (typeof window.triggerPubMedCounterUpdate === "function") {
                  window.triggerPubMedCounterUpdate();
                }
                // ---> FIN DE L√çNEA A A√ëADIR <---
              }
            });
          });

        // 7. Manejo de filtros con toggle
        document
          .querySelectorAll(".filter-button.with-toggle")
          .forEach(function (btn) {
            var baseId = btn.dataset.base;
            btn.addEventListener("click", function (e) {
              if (
                e.target.tagName === "INPUT" ||
                e.target.closest(".versions-toggle")
              ) {
                return;
              }
              btn.classList.toggle("active");
              var selectedRadio = btn.querySelector(
                'input[type="radio"]:checked'
              );
              var filterType = baseId + "_" + selectedRadio.value;
              if (btn.classList.contains("active")) {
                activeFilters.add(filterType);
              } else {
                activeFilters.delete(filterType);
              }
              updateFilterCounterDisplay(); // <-- USA LA NUEVA FUNCI√ìN para actualizar n√∫mero y resaltado
              mostrarQueryFinal();
              // ---> ¬°A√ëADIR ESTA L√çNEA! <---
              if (typeof window.triggerPubMedCounterUpdate === "function") {
                window.triggerPubMedCounterUpdate();
              }
              // ---> FIN DE L√çNEA A A√ëADIR <---
            });
            var radios = btn.querySelectorAll('input[type="radio"]');
            radios.forEach(function (radio) {
              radio.addEventListener("change", function () {
                if (!btn.classList.contains("active")) return;
                var oldType =
                  baseId +
                  "_" +
                  (radio.value === "sensible" ? "especifico" : "sensible");
                var newType = baseId + "_" + radio.value;
                activeFilters.delete(oldType);
                activeFilters.add(newType);
                updateFilterCounterDisplay(); // <-- USA LA NUEVA FUNCI√ìN para actualizar n√∫mero y resaltado
                mostrarQueryFinal();
              });
            });
          });

        // 8. Configuraci√≥n de operadores por categor√≠a
        const categoryOperators = {
          methodology: "OR",
          clinical: "OR",
          scope: "OR",
        };

        // 9. Funciones de construcci√≥n de consultas

        function constructQuery(term) {
          // Elimina las l√≠neas que empiezan con "#"
          term = term
            .split("\n")
            .filter((line) => !line.trim().startsWith("#"))
            .join(" ");
          if (!term && activeFilters.size === 0) return "";

          let query = term;

          Object.keys(categories).forEach(function (cat) {
            const operator = categoryOperators[cat];
            const activeInCat = categories[cat]
              .filter((f) => activeFilters.has(f))
              .map((f) => filterMap[f] || "")
              .filter((q) => q !== "");

            if (activeInCat.length > 0) {
              const notFilters = activeInCat.filter((f) => /^NOT/.test(f));
              const regularFilters = activeInCat.filter((f) => !/^NOT/.test(f));

              if (regularFilters.length > 0) {
                const categoryQuery = `(${regularFilters.join(
                  ` ${operator} `
                )})`;
                query = query
                  ? `(${query}) AND ${categoryQuery}`
                  : categoryQuery;
              }

              notFilters.forEach((filter) => {
                query = query ? `(${query}) ${filter}` : filter;
              });
            }
          });

          if (dateRange.value) {
            const dateFilter = `("last ${dateRange.value} days"[dp])`;
            query = query ? `(${query}) AND ${dateFilter}` : dateFilter;
          }

          return query.trim();
        }
        window.constructQuery = constructQuery;
        function mostrarQueryFinal() {
          var built = constructQuery(searchTerm.value.trim());
          finalQueryBox.textContent = built;
        }

        function hacerBusqueda() {
          var term = searchTerm.value.trim();
          var finalQ = constructQuery(term);
          if (!finalQ) {
            mostrarToast(
              "Por favor, introduce un t√©rmino o selecciona alg√∫n filtro."
            );
            return;
          }
          var url =
            "https://pubmed.ncbi.nlm.nih.gov/?term=" +
            encodeURIComponent(finalQ);
          if (sortMode.value === "date") {
            url += "&sort=date";
          }
          url += "&size=50";
          window.open(url, "_blank");
        }

        // 10. Event listeners para b√∫squeda
        searchTerm.addEventListener("keypress", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            hacerBusqueda();
          }
        });
        searchButton.addEventListener("click", hacerBusqueda);

        // 11. Event listener para reset
        resetButton.addEventListener("click", function () {
          activeFilters.clear();
          searchTerm.value = "";
          dateRange.value = "";
          sortMode.value = "date";

          document.querySelectorAll(".category-operator").forEach((select) => {
            select.value = "OR";
            categoryOperators[select.dataset.category] = "OR";
          });

          document.querySelectorAll(".filter-button").forEach(function (b) {
            b.classList.remove("active");
          });

          document
            .querySelectorAll('.versions-toggle input[type="radio"]')
            .forEach(function (r) {
              if (r.value === "sensible") {
                r.checked = true;
              }
            });

          finalQueryBox.textContent = "";
          updateFilterCounterDisplay();

          mostrarQueryFinal();
          // ---> A√ëADIR ESTA L√çNEA (Opcional) <---
          if (typeof window.triggerPubMedCounterUpdate === "function") {
            window.triggerPubMedCounterUpdate(); // Actualizar contadores a estado inicial
          }
          // ---> FIN <---
        });

        // 12. Operadores de categor√≠a
        document.querySelectorAll(".category-operator").forEach((select) => {
          select.addEventListener("change", function () {
            categoryOperators[this.dataset.category] = this.value;
            mostrarQueryFinal();
            // ---> ¬°A√ëADIR ESTA L√çNEA! <---
            // Llama a la funci√≥n global del script de contadores para actualizar
            if (typeof window.triggerPubMedCounterUpdate === "function") {
              window.triggerPubMedCounterUpdate();
            }
            // ---> FIN DE L√çNEA A A√ëADIR <---
          });
        });
        // 13. Diagrama de Venn
        function updateVennDiagram() {
          const methodologyFilters = Array.from(
            document.querySelectorAll(".filter-button.methodological.active")
          ).map((btn) => ({
            text: btn.textContent.trim(),
            type:
              btn.dataset.type ||
              `${btn.dataset.base}_${
                btn.querySelector('input[type="radio"]:checked')?.value
              }`,
          }));

          const clinicalFilters = Array.from(
            document.querySelectorAll(".filter-button.clinical.active")
          ).map((btn) => ({
            text: btn.textContent.trim(),
            type:
              btn.dataset.type ||
              `${btn.dataset.base}_${
                btn.querySelector('input[type="radio"]:checked')?.value
              }`,
          }));

          const scopeFilters = Array.from(
            document.querySelectorAll(".filter-button.scope.active")
          ).map((btn) => ({
            text: btn.textContent.trim(),
            type:
              btn.dataset.type ||
              `${btn.dataset.base}_${
                btn.querySelector('input[type="radio"]:checked')?.value
              }`,
          }));

          const searchTermValue = searchTerm.value.trim();

          const sets = [];

          if (methodologyFilters.length > 0) {
            sets.push({
              sets: ["Metodolog√≠a"],
              size: methodologyFilters.length,
              items: [...methodologyFilters.map((f) => f.text)],
            });
          }

          if (clinicalFilters.length > 0) {
            sets.push({
              sets: ["Cl√≠nico"],
              size: clinicalFilters.length,
              items: clinicalFilters.map((f) => f.text),
            });
          }

          if (scopeFilters.length > 0) {
            sets.push({
              sets: ["√Åmbito"],
              size: scopeFilters.length,
              items: scopeFilters.map((f) => f.text),
            });
          }

          // A√±adir intersecciones
          if (sets.length > 1) {
            const categories = sets.map((s) => s.sets[0]);
            for (let i = 0; i < categories.length; i++) {
              for (let j = i + 1; j < categories.length; j++) {
                let size =
                  Math.min(
                    sets.find((s) => s.sets[0] === categories[i]).size,
                    sets.find((s) => s.sets[0] === categories[j]).size
                  ) / 3;
                sets.push({
                  sets: [categories[i], categories[j]],
                  size: size,
                });
              }
            }
            if (categories.length === 3) {
              let size = Math.min(sets[0].size, sets[1].size, sets[2].size) / 4;
              sets.push({
                sets: categories,
                size: size,
              });
            }
          }

          // Limpiar y dibujar
          const vennDiv = d3.select("#venn-diagram").html("");
          // Actualizar listas laterales
          const methodologyList = document.getElementById(
            "methodology-filters"
          );
          const clinicalList = document.getElementById("clinical-filters");
          const scopeList = document.getElementById("scope-filters");

          methodologyList.innerHTML =
            sets
              .find((s) => s.sets[0] === "Metodolog√≠a")
              ?.items.map((item) => `<li>${item}</li>`)
              .join("") || "";

          clinicalList.innerHTML =
            sets
              .find((s) => s.sets[0] === "Cl√≠nico")
              ?.items.map((item) => `<li>${item}</li>`)
              .join("") || "";

          scopeList.innerHTML =
            sets
              .find((s) => s.sets[0] === "√Åmbito")
              ?.items.map((item) => `<li>${item}</li>`)
              .join("") || "";
          if (sets.length > 0) {
            const chart = venn.VennDiagram().width(500).height(400);

            const div = vennDiv.datum(sets).call(chart);

            // Colorear c√≠rculos
            div
              .selectAll(".venn-circle path")
              .style("fill-opacity", 0.2)
              .style("stroke-width", 2);

            // Mejorar la visualizaci√≥n de texto
            div
              .selectAll("g")
              .filter((d) => d.sets.length === 1)
              .each(function (d) {
                const set = sets.find((s) => s.sets[0] === d.sets[0]);
                const g = d3.select(this);

                // T√≠tulo principal con n√∫mero de filtros
                // T√≠tulo principal con n√∫mero de filtros
                g.select("text")
                  .style("font-weight", "bold")
                  .style("font-size", "16px")
                  .style("fill", "#ffd700")
                  .text(`${d.sets[0]} (${set.items.length})`);
              })
              .select("path")
              .style("fill", (d) => {
                const colors = {
                  Metodolog√≠a: "#3b82f6",
                  Cl√≠nico: "#10b981",
                  √Åmbito: "#8b5cf6",
                };
                return colors[d.sets[0]];
              });

            // Mantener el tooltip para informaci√≥n detallada
            const tooltip = d3.select("#venn-tooltip");

            div
              .selectAll("g")
              .on("mouseover", function (event, d) {
                venn.sortAreas(div, d);
                tooltip.transition().duration(200).style("opacity", 0.9);

                let content = "";
                if (d.sets.length === 1) {
                  const set = sets.find((s) => s.sets[0] === d.sets[0]);
                  if (set) {
                    content = `<strong>${d.sets[0]}</strong><br>`;
                    content += set.items
                      .map((item) => `‚Ä¢ ${item}`)
                      .join("<br>");
                  }
                } else {
                  content = `<strong>Intersecci√≥n</strong><br>${d.sets.join(
                    " + "
                  )}`;
                }

                tooltip
                  .html(content)
                  .style("left", event.pageX + 10 + "px")
                  .style("top", event.pageY - 10 + "px");
              })
              .on("mousemove", function (event) {
                tooltip
                  .style("left", event.pageX + 10 + "px")
                  .style("top", event.pageY - 10 + "px");
              })
              .on("mouseout", function () {
                tooltip.transition().duration(200).style("opacity", 0);
              });
          }
        }

        // Actualizar la funci√≥n mostrarQueryFinal para incluir el diagrama
        function mostrarQueryFinal() {
          var built = constructQuery(searchTerm.value.trim());
          finalQueryBox.textContent = built;
          updateVennDiagram();
        }

        // Actualizar el reset para incluir el diagrama
        resetButton.addEventListener("click", function () {
          activeFilters.clear();
          filterCount.textContent = 0;
          searchTerm.value = "";
          dateRange.value = "";
          sortMode.value = "date";

          document.querySelectorAll(".category-operator").forEach((select) => {
            select.value = "OR";
            categoryOperators[select.dataset.category] = "OR";
          });

          document.querySelectorAll(".filter-button").forEach(function (b) {
            b.classList.remove("active");
          });

          document
            .querySelectorAll('.versions-toggle input[type="radio"]')
            .forEach(function (r) {
              if (r.value === "sensible") {
                r.checked = true;
              }
            });

          finalQueryBox.textContent = "";
          updateVennDiagram();
        });
        // 14. Tutorial
        function iniciarTutorial() {
          var intro = introJs();
          intro.setOptions({
            steps: [
              {
                element: document.querySelector("#searchTerm"),
                intro:
                  'Escribe tus t√©rminos de b√∫squeda. Al pulsar Enter se iniciar√° la b√∫squeda, mientras que Shift+Enter insertar√° un salto de l√≠nea para que puedas estructurar tu consulta de forma clara. Cualquier bloque de texto iniciado con ‚Äò#‚Äô se omite en la b√∫squeda, permiti√©ndote documentar tu estrategia sin alterar el resultado. Para mayor precisi√≥n, usa descriptores MeSH que puedes consultar en <a href="https://www.ncbi.nlm.nih.gov/mesh" target="_blank" style="color: #0e04c8; text-decoration: underline;">MeSH Database</a>. <br><br><strong>Importante:</strong> Al escribir, justo debajo de este cuadro, aparecer√° autom√°ticamente un <strong>contador con el n√∫mero total de resultados</strong> para tu consulta (incluyendo filtros y fecha)',
                position: "top",
              },

              {
                element: document.querySelector(".filters-section"),
                intro:
                  "Aqu√≠ encontrar√°s tres categor√≠as de filtros: Metodolog√≠a, Enfoque Cl√≠nico y √Åmbito/Poblaci√≥n. Cada categor√≠a tiene su propio operador booleano para combinar los filtros dentro de ella.",
                position: "right",
              },
              {
                element: document.querySelector("#infoModeToggle"),
                intro:
                  "Activa este bot√≥n para ver informaci√≥n detallada sobre cada filtro al pasar el cursor sobre ellos. Incluye la fuente del filtro y sus caracter√≠sticas espec√≠ficas.",
                position: "bottom",
              },
              {
                element: document.querySelector(".operator-selector"),
                intro:
                  "Cada categor√≠a tiene su propio operador booleano: OR ampl√≠a resultados (m√°s sensible), AND los restringe (m√°s espec√≠fico). Puedes combinar diferentes operadores en diferentes categor√≠as.",
                position: "left",
              },
              {
                element: document.querySelector(".versions-toggle"),
                intro:
                  "Algunos filtros tienen versiones Sensible (S) o Espec√≠fica (E). Sensible encuentra m√°s resultados pero menos precisos, Espec√≠fica encuentra menos pero m√°s relevantes.",
                position: "left",
              },

              {
                element: document.querySelector("#dateRange"),
                intro:
                  "Filtra resultados por fecha: 7 d√≠as (muy reciente), 30 d√≠as (√∫ltimo mes), 6 meses, 1 a√±o o 5 a√±os.",
                position: "top",
              },
              {
                element: document.querySelector("#sortMode"),
                intro:
                  "'Por fecha' muestra los m√°s recientes primero, 'Best match' ordena por relevancia seg√∫n el algoritmo de PubMed.",
                position: "bottom",
              },
              {
                element: document.querySelector("#searchButton"),
                intro:
                  "Lanza la b√∫squeda en PubMed con todos los filtros seleccionados. Se abrir√° en una nueva pesta√±a.",
                position: "left",
              },
              {
                element: document.querySelector("#toggleVennButton"),
                intro:
                  "Visualiza la relaci√≥n entre los filtros activos mediante un diagrama de Venn interactivo. Al activar el diagrama podr√°s ver c√≥mo se agrupan los filtros por categor√≠a y sus intersecciones.",
                position: "bottom",
                scrollTo: "tooltip",
              },
              {
                element: document.querySelector("#finalQuery"),
                intro:
                  "Aqu√≠ ver√°s la estrategia de b√∫squeda completa que combina tus t√©rminos con los filtros seleccionados usando los operadores booleanos espec√≠ficos de cada categor√≠a.",
                position: "top",
              },
              {
                element: document.querySelector("#mainIconsContainer"),
                intro:
                  "Las b√∫squedas se almacenan localmente en este navegador, por lo que se perder√°n si borras la cach√© o utilizas otro dispositivo. Para evitarlo, utiliza los botones de exportar e importar y crea una copia de seguridad que puedas restaurar cuando lo necesites. Se recomienda guardar esta copia en un servicio en la nube o en otro sistema de almacenamiento que permita la sincronizaci√≥n entre navegadores en distintos dispositivos, incluido el smartphone.",
                position: "bottom",
              },
              {
                element: document.querySelector("#toggleCountersBtn"),
                intro:
                  "Este bot√≥n <i class='fas fa-eye-slash'></i> (ojo tachado) o <i class='fas fa-eye'></i> (ojo visible) te permite <strong>mostrar u ocultar los contadores de resultados individuales</strong> que aparecen en cada bot√≥n de filtro. Cuando est√°n visibles, estos peque√±os n√∫meros te indican cu√°ntos art√≠culos recupera cada filtro espec√≠fico (combinado con tu t√©rmino de b√∫squeda principal y el filtro de fecha). ¬°Muy √∫til para refinar tu estrategia!",
                position: "bottom", // O 'left'/'right' dependiendo de su posici√≥n final en #mainIconsContainer
              },
              {
                element: document.querySelector("#btn_chatgpt"),
                intro:
                  "Con este bot√≥n se abre el asistente de ChatGPT en una nueva pesta√±a para sugerir t√©rminos y ayudarte a crear o refinar b√∫squedas avanzadas en PubMed. Ten presente que cualquier bloque de texto iniciado con ‚Äò#‚Äô (usado por ChatGPT para anotar descriptores o comentarios) se omite en la b√∫squeda, permiti√©ndote documentar tu estrategia sin alterar el resultado.",
                position: "bottom",
              },

              {
                element: document.querySelector(".search-tips"),
                intro:
                  "Encuentra consejos √∫tiles para mejorar tus b√∫squedas, como el uso de operadores booleanos y t√©rminos MeSH. Haz clic en el encabezado para expandir y ver todos los tips.",
                position: "top",
              },
            ],
            overlayOpacity: 0.9,
            highlightClass: "myHighlight",
            disableInteraction: true,
            skipLabel: "Saltar",
            nextLabel: "Siguiente",
            prevLabel: "Anterior",
            doneLabel: "Hecho",
            showStepNumbers: false,
            scrollToElement: true,
            scrollPadding: 1,
          });

          intro.oncomplete(function () {
            localStorage.setItem("tutorial_visto_v3", "true");
          });

          intro.onexit(function () {
            localStorage.setItem("tutorial_visto_v3", "true");
          });

          intro.start();
        }

        var tutorialVisto = localStorage.getItem("tutorial_visto_v3");
        if (!tutorialVisto) {
          // Peque√±o retraso para dar tiempo a que counters-buscar-pubmed.js inicialice el bot√≥n #toggleCountersBtn
          setTimeout(iniciarTutorial, 500); // 500ms suele ser suficiente
        }

        var startTutorialBtn = document.getElementById("startTutorialBtn");
        if (startTutorialBtn) {
          startTutorialBtn.addEventListener("click", function () {
            // Peque√±o retraso tambi√©n aqu√≠ por si acaso
            setTimeout(iniciarTutorial, 100);
          });
        }
        // Llamada inicial para establecer el estado correcto del contador al cargar la p√°gina
        updateFilterCounterDisplay();
        // Llamada inicial para mostrar la query (por si hubiera valores prellenados o restaurados)
        mostrarQueryFinal(); // (Esta llamada probablemente ya estaba o es buena idea tenerla)
      });
      // Activar/desactivar botones seg√∫n contenido
      document
        .getElementById("nombreNuevaBusqueda")
        ?.addEventListener("input", function (e) {
          const confirmBtn = document.getElementById("guardarBusquedaConfirm");
          confirmBtn.classList.toggle("active", e.target.value.trim() !== "");
        });

      document
        .getElementById("importarArchivo")
        ?.addEventListener("change", function (e) {
          const confirmBtn = document.getElementById("importarBusquedaConfirm");
          confirmBtn.classList.toggle("active", e.target.files.length > 0);
        });
      // Manejo del toggle de tips
      const searchTips = document.querySelector(".search-tips");
      const searchTipsHeader = document.querySelector(".search-tips-header");

      searchTipsHeader.addEventListener("click", () => {
        searchTips.classList.toggle("expanded");
      });
    </script>
    <script>
      // Manejo del autoajuste del textarea
      const searchTextarea = document.getElementById("searchTerm");

      function autoResizeTextarea() {
        this.style.height = "auto";
        this.style.height = this.scrollHeight + "px";
      }

      searchTextarea.addEventListener("input", autoResizeTextarea);
      searchTextarea.addEventListener("focus", autoResizeTextarea);
    </script>

    <script>
      // Funciones de manejo de modales
      function abrirModal(idBackdrop) {
        document.getElementById(idBackdrop).classList.add("show");
      }

      function cerrarModal(idBackdrop) {
        const modal = document.getElementById(idBackdrop);
        if (modal) {
          modal.classList.remove("show");
          // Limpiar inputs
          const inputs = modal.querySelectorAll('input[type="text"]');
          inputs.forEach((input) => (input.value = ""));
          // Resetear estado del bot√≥n confirmar
          const confirmBtn = modal.querySelector(".modal-confirm");
          if (confirmBtn) {
            confirmBtn.classList.remove("active");
          }
        }
      }

      // Manejo de la tecla ESC y eventos del modal
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          const modalAbierto = document.querySelector(".modal-backdrop.show");
          if (modalAbierto) {
            cerrarModal(modalAbierto.id);
          }
        }
      });

      // Activar/desactivar bot√≥n guardar seg√∫n contenido del input
      document
        .getElementById("nombreNuevaBusqueda")
        .addEventListener("input", function (e) {
          const confirmBtn = document.getElementById("guardarBusquedaConfirm");
          if (e.target.value.trim()) {
            confirmBtn.classList.add("active");
          } else {
            confirmBtn.classList.remove("active");
          }
        });

      // Mejorar el manejo del guardado
      document
        .getElementById("guardarBusquedaConfirm")
        .addEventListener("click", function (e) {
          const input = document.getElementById("nombreNuevaBusqueda");
          const nombre = input.value.trim();

          if (!nombre) {
            return; // No hacer nada si no hay nombre
          }

          const b√∫squedaActual = {
            termino: searchTerm.value.trim(),
            filtros: Array.from(activeFilters),
            fecha: dateRange.value,
            orden: sortMode.value,
          };
          const b√∫squedas = obtenerB√∫squedasGuardadas();
          b√∫squedas[nombre] = b√∫squedaActual;
          guardarB√∫squedasGuardadas(b√∫squedas);
          mostrarToast(`B√∫squeda "${nombre}" guardada correctamente.`);
          cerrarModal("modalGuardarFondo");
        });

      // Delegaci√≥n de eventos mejorada
      document.addEventListener("click", function (e) {
        // Cerrar al hacer click en el backdrop
        if (e.target.classList.contains("modal-backdrop")) {
          cerrarModal(e.target.id);
        }

        // Cerrar al hacer click en bot√≥n de cierre o cancelar
        if (
          e.target.classList.contains("close-modal") ||
          e.target.classList.contains("modal-cancel")
        ) {
          const modalId = e.target.getAttribute("data-close");
          if (modalId) {
            cerrarModal(modalId);
          }
        }
      });

      // Prevenir que clicks dentro del modal cierren el modal
      document.querySelectorAll(".modal").forEach((modal) => {
        modal.addEventListener("click", function (e) {
          e.stopPropagation();
        });
      });
    </script>
    <script>
      // Funciones de localStorage
      function obtenerB√∫squedasGuardadas() {
        const almacenado = localStorage.getItem("saved_searches");
        return almacenado ? JSON.parse(almacenado) : {};
      }

      function guardarB√∫squedasGuardadas(b√∫squedas) {
        localStorage.setItem("saved_searches", JSON.stringify(b√∫squedas));
      }

      // Funciones de manejo de modales
      function abrirModal(id_backdrop) {
        const backdrop = document.getElementById(id_backdrop);
        backdrop.classList.add("show");

        /* Enfocar el primer input o textarea que haya en el modal */
        const primer_input = backdrop.querySelector(
          ".modal input, .modal textarea"
        );
        if (primer_input) {
          primer_input.focus();
        }

        /* Opcional: si quieres que Enter cierre el modal o confirme */
        const confirm_btn = backdrop.querySelector(".modal-confirm");
        if (confirm_btn) {
          backdrop.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
              /* Si el bot√≥n est√° activo, haz clic autom√°ticamente */
              if (confirm_btn.classList.contains("active")) {
                confirm_btn.click();
              }
            }
          });
        }
      }
      function cerrarModal(idBackdrop) {
        const modal = document.getElementById(idBackdrop);
        if (modal) {
          modal.classList.remove("show");
          const inputs = modal.querySelectorAll('input[type="text"]');
          inputs.forEach((input) => (input.value = ""));
          const confirmBtn = modal.querySelector(".modal-confirm");
          if (confirmBtn) {
            confirmBtn.classList.remove("active");
          }
        }
      }

      // Event listeners globales para modales
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          const modalAbierto = document.querySelector(".modal-backdrop.show");
          if (modalAbierto) {
            cerrarModal(modalAbierto.id);
          }
        }
      });

      document.addEventListener("click", function (e) {
        if (e.target.classList.contains("modal-backdrop")) {
          cerrarModal(e.target.id);
        }

        if (
          e.target.classList.contains("close-modal") ||
          e.target.classList.contains("modal-cancel")
        ) {
          const modalId = e.target.getAttribute("data-close");
          if (modalId) {
            cerrarModal(modalId);
          }
        }
      });
    </script>
    <script>
      /* manejo de alerts cuando se ejecutan modales */
      function mostrarToast(mensaje) {
        // Tomamos el div contenedor
        var toastContainer = document.getElementById("toastContainer");

        // Creamos el div que contendr√° el texto de la notificaci√≥n
        var nuevoToast = document.createElement("div");
        nuevoToast.style.background = "#ffd700";
        nuevoToast.style.color = "#1c1e26";
        nuevoToast.style.padding = "10px 15px";
        nuevoToast.style.marginBottom = "10px";
        nuevoToast.style.borderRadius = "8px";
        nuevoToast.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";
        nuevoToast.style.position = "relative"; // Para posicionar el bot√≥n de cierre
        nuevoToast.textContent = mensaje;

        // Creamos un bot√≥n de cierre manual
        var closeBtn = document.createElement("button");
        closeBtn.textContent = "X";
        closeBtn.style.position = "absolute";
        closeBtn.style.top = "5px";
        closeBtn.style.right = "10px";
        closeBtn.style.border = "none";
        closeBtn.style.background = "transparent";
        closeBtn.style.color = "#1c1e26";
        closeBtn.style.cursor = "pointer";
        closeBtn.style.fontWeight = "bold";

        // Evento para cerrar manualmente la notificaci√≥n
        closeBtn.addEventListener("click", function () {
          toastContainer.removeChild(nuevoToast);
          // Si el contenedor se queda sin toasts, lo ocultamos
          if (!toastContainer.hasChildNodes()) {
            toastContainer.style.display = "none";
          }
        });

        // Agregamos el bot√≥n de cierre al toast
        nuevoToast.appendChild(closeBtn);

        // Mostramos el contenedor (por si estaba oculto)
        toastContainer.style.display = "block";

        // A√±adimos el toast al contenedor
        toastContainer.appendChild(nuevoToast);

        // Temporizador para borrar el toast autom√°ticamente tras 3 segundos
        setTimeout(function () {
          // Antes de borrarlo, comprobamos si sigue en pantalla
          if (toastContainer.contains(nuevoToast)) {
            toastContainer.removeChild(nuevoToast);
            if (!toastContainer.hasChildNodes()) {
              toastContainer.style.display = "none";
            }
          }
        }, 3000); // 3000 ms = 3 segundos
      }
    </script>
    <!-- Gesti√≥n de API Key NCBI -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Solo ejecutar si existe el gestor de API
        if (!window.ApiKeyManager) return;

        // Crear bot√≥n de configuraci√≥n de API
        const mainIconsContainer =
          document.getElementById("mainIconsContainer");
        if (mainIconsContainer) {
          const btnApiConfig = document.createElement("button");
          btnApiConfig.id = "btnApiConfig";
          btnApiConfig.innerHTML = '<i class="fas fa-key"></i>';
          btnApiConfig.title = "Configurar API Key NCBI";
          btnApiConfig.style.cssText =
            "background: transparent; border: none; color: inherit; cursor: pointer; padding: 8px; border-radius: 8px; transition: all 0.3s ease; position: relative;";

          // Verificar si hay API key guardada
          if (window.ApiKeyManager.hasApiKey()) {
            btnApiConfig.classList.add("has-api");
            btnApiConfig.title = "API Key configurada (10 req/s)";

            // A√±adir indicador verde
            const indicator = document.createElement("span");
            indicator.style.cssText =
              "position: absolute; top: 5px; right: 5px; width: 8px; height: 8px; background: #4caf50; border-radius: 50%; box-shadow: 0 0 4px #4caf50;";
            btnApiConfig.appendChild(indicator);
          }

          // Insertar al final de mainIconsContainer (antes del √∫ltimo bot√≥n)
          const lastButton = mainIconsContainer.lastElementChild;
          mainIconsContainer.insertBefore(btnApiConfig, lastButton);

          // Event listener para abrir modal
          btnApiConfig.addEventListener("click", function () {
            openApiKeyModal();
          });
        }

        // Funci√≥n para abrir el modal de API Key
        function openApiKeyModal() {
          const modal = document.getElementById("modalApiKeyFondo");
          const statusIcon = modal.querySelector(".status-icon");
          const statusText = modal.querySelector(".status-text");
          const apiBenefits = modal.querySelector(".api-benefits");
          const apiKeyInput = document.getElementById("apiKeyInput");
          const apiKeyExisting = document.getElementById("apiKeyExisting");
          const saveBtn = document.getElementById("saveApiKey");
          const errorDiv = document.getElementById("apiKeyError");

          // Resetear estado
          errorDiv.style.display = "none";
          apiKeyInput.value = "";

          // Verificar estado actual
          const hasKey = window.ApiKeyManager.hasApiKey();

          if (hasKey) {
            statusIcon.className = "status-icon";
            statusIcon.style.cssText =
              "width: 12px; height: 12px; border-radius: 50%; display: inline-block; background: #4caf50; box-shadow: 0 0 8px #4caf50;";
            statusText.textContent = "API Key configurada y activa";
            apiBenefits.style.display = "block";
            apiKeyExisting.style.display = "block";
            saveBtn.querySelector(".btn-text").textContent =
              "Actualizar API Key";
          } else {
            statusIcon.className = "status-icon";
            statusIcon.style.cssText =
              "width: 12px; height: 12px; border-radius: 50%; display: inline-block; background: #ff9800; box-shadow: 0 0 8px #ff9800;";
            statusText.textContent =
              "Sin API Key configurada (usando l√≠mite p√∫blico: 3 req/s)";
            apiBenefits.style.display = "none";
            apiKeyExisting.style.display = "none";
            saveBtn.querySelector(".btn-text").textContent = "Guardar API Key";
          }

          // Mostrar modal usando la funci√≥n existente
          abrirModal("modalApiKeyFondo");
        }

        // Toggle visibilidad de API Key
        const toggleVisBtn = document.getElementById("toggleApiKeyVisibility");
        const apiKeyInput = document.getElementById("apiKeyInput");

        if (toggleVisBtn && apiKeyInput) {
          toggleVisBtn.addEventListener("click", function () {
            const isPassword = apiKeyInput.type === "password";
            apiKeyInput.type = isPassword ? "text" : "password";
            this.innerHTML = isPassword
              ? '<i class="fas fa-eye-slash"></i>'
              : '<i class="fas fa-eye"></i>';
          });
        }

        // Guardar API Key
        const saveApiKeyBtn = document.getElementById("saveApiKey");
        if (saveApiKeyBtn) {
          saveApiKeyBtn.addEventListener("click", async function () {
            const apiKey = apiKeyInput.value.trim();
            const errorDiv = document.getElementById("apiKeyError");
            const btnText = this.querySelector(".btn-text");
            const btnLoading = this.querySelector(".btn-loading");

            if (!apiKey) {
              errorDiv.textContent = "Por favor ingresa una API Key";
              errorDiv.style.display = "block";
              return;
            }

            // Mostrar estado de carga
            btnText.style.display = "none";
            btnLoading.style.display = "inline";
            this.disabled = true;

            try {
              const result = await window.ApiKeyManager.saveApiKey(apiKey);

              if (result.success) {
                mostrarToast(
                  "API Key guardada correctamente. Los contadores ahora se actualizar√°n 3x m√°s r√°pido."
                );
                cerrarModal("modalApiKeyFondo");

                // Actualizar indicador visual
                const btnApi = document.getElementById("btnApiConfig");
                if (btnApi) {
                  if (!btnApi.querySelector("span")) {
                    const indicator = document.createElement("span");
                    indicator.style.cssText =
                      "position: absolute; top: 5px; right: 5px; width: 8px; height: 8px; background: #4caf50; border-radius: 50%; box-shadow: 0 0 4px #4caf50;";
                    btnApi.appendChild(indicator);
                  }
                  btnApi.classList.add("has-api");
                  btnApi.title = "API Key configurada (10 req/s)";
                }
              }
            } catch (error) {
              errorDiv.textContent = error.message;
              errorDiv.style.display = "block";
            } finally {
              // Restaurar bot√≥n
              btnText.style.display = "inline";
              btnLoading.style.display = "none";
              this.disabled = false;
            }
          });
        }

        // Eliminar API Key
        const removeApiKeyBtn = document.getElementById("removeApiKey");
        if (removeApiKeyBtn) {
          removeApiKeyBtn.addEventListener("click", function () {
            if (
              confirm(
                "¬øEst√°s seguro de que deseas eliminar tu API Key? Los contadores se actualizar√°n m√°s lentamente."
              )
            ) {
              window.ApiKeyManager.removeApiKey();
              mostrarToast(
                "API Key eliminada. Usando l√≠mite p√∫blico (3 req/s)."
              );
              cerrarModal("modalApiKeyFondo");

              // Actualizar indicador visual
              const btnApi = document.getElementById("btnApiConfig");
              if (btnApi) {
                const indicator = btnApi.querySelector("span");
                if (indicator) indicator.remove();
                btnApi.classList.remove("has-api");
                btnApi.title = "Configurar API Key NCBI";
              }
            }
          });
        }
      });
    </script>
    <!-- bot√≥n asistente GPT -->
    <script>
      document
        .getElementById("btn_chatgpt")
        .addEventListener("click", function () {
          window.open(
            "https://chatgpt.com/g/g-679fc8b5a99481919ee408d9c064f2ed-pubmed-help-asistente-para-busquedas-avanzadas",
            "_blank"
          );
        });
    </script>

    <!-- MODALES INDIVIDUALES PARA GUARDAR / RECUPERAR / BORRAR / EXPORTAR / IMPORTAR -->
    <!-- Modal Guardar -->
    <div class="modal-backdrop" id="modalGuardarFondo">
      <div class="modal" id="modalGuardar">
        <div class="modal-header">
          <h2 class="modal-title">Guardar B√∫squeda</h2>
          <button class="close-modal" data-close="modalGuardarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="nombreNuevaBusqueda">Nombre de la b√∫squeda:</label>
          <input type="text" id="nombreNuevaBusqueda" />
          <div class="modal-buttons">
            <button class="modal-cancel" data-close="modalGuardarFondo">
              Cancelar
            </button>
            <button id="guardarBusquedaConfirm" class="modal-confirm active">
              Guardar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Recuperar -->
    <div class="modal-backdrop" id="modalRecuperarFondo">
      <div class="modal" id="modalRecuperar">
        <div class="modal-header">
          <h2 class="modal-title">Recuperar B√∫squeda</h2>
          <button class="close-modal" data-close="modalRecuperarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="recuperarSelect">B√∫squedas guardadas:</label>
          <select id="recuperarSelect"></select>
          <div class="modal-buttons">
            <button class="modal-cancel" data-close="modalRecuperarFondo">
              Cancelar
            </button>
            <button id="recuperarBusquedaConfirm" class="modal-confirm active">
              Recuperar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Borrar -->
    <div class="modal-backdrop" id="modalBorrarFondo">
      <div class="modal" id="modalBorrar">
        <div class="modal-header">
          <h2 class="modal-title">Borrar B√∫squeda</h2>
          <button class="close-modal" data-close="modalBorrarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="borrarSelect">B√∫squedas guardadas:</label>
          <select id="borrarSelect"></select>
          <div class="modal-buttons">
            <button class="modal-cancel" data-close="modalBorrarFondo">
              Cancelar
            </button>
            <button id="borrarBusquedaConfirm" class="modal-confirm active">
              Borrar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalExportarFondo">
      <div class="modal" id="modalExportar">
        <div class="modal-header">
          <h2 class="modal-title">Exportar B√∫squedas</h2>
          <button class="close-modal" data-close="modalExportarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <p>
            Se descargar√° un archivo JSON con todas las b√∫squedas guardadas.
          </p>
          <div class="modal-buttons">
            <button class="modal-cancel" data-close="modalExportarFondo">
              Cancelar
            </button>
            <button id="exportarBusquedaConfirm" class="modal-confirm active">
              Exportar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal-backdrop" id="modalImportarFondo">
      <div class="modal" id="modalImportar">
        <div class="modal-header">
          <h2 class="modal-title">Importar B√∫squedas</h2>
          <button class="close-modal" data-close="modalImportarFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <label for="importarArchivo">Archivo JSON:</label>
          <input type="file" accept="application/json" id="importarArchivo" />
          <div class="modal-buttons">
            <button class="modal-cancel" data-close="modalImportarFondo">
              Cancelar
            </button>
            <button id="importarBusquedaConfirm" class="modal-confirm active">
              Importar
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Modal API Key -->
    <div class="modal-backdrop" id="modalApiKeyFondo">
      <div class="modal" id="modalApiKey" style="max-width: 600px">
        <div class="modal-header">
          <h2 class="modal-title">
            <i class="fas fa-key"></i> Configuraci√≥n de API Key NCBI
          </h2>
          <button class="close-modal" data-close="modalApiKeyFondo">
            &times;
          </button>
        </div>
        <div class="modal-body">
          <div id="apiKeyStatus" class="api-status-box">
            <div class="status-indicator">
              <span class="status-icon"></span>
              <span class="status-text"></span>
            </div>
            <div class="api-benefits" style="display: none">
              <p><strong>Beneficios de usar API Key:</strong></p>
              <ul style="margin: 10px 0 0 20px">
                <li>‚úì 10 peticiones/segundo (vs 3 sin key)</li>
                <li>‚úì Actualizaci√≥n 3x m√°s r√°pida de contadores</li>
                <li>‚úì Menor probabilidad de l√≠mites de tasa</li>
              </ul>
            </div>
          </div>

          <div id="apiKeyForm">
            <label for="apiKeyInput">
              <strong>API Key de NCBI:</strong>
              <a
                href="https://www.ncbi.nlm.nih.gov/account/settings/"
                target="_blank"
                style="
                  margin-left: 10px;
                  color: #0e04c8;
                  text-decoration: underline;
                  font-size: 0.9em;
                "
              >
                ¬øC√≥mo obtener una API Key?
              </a>
            </label>
            <div style="position: relative">
              <input
                type="password"
                id="apiKeyInput"
                placeholder="Ingresa tu API Key de NCBI (36-40 caracteres)"
                style="width: 100%; padding-right: 40px"
              />
              <button
                type="button"
                id="toggleApiKeyVisibility"
                style="
                  position: absolute;
                  right: 10px;
                  top: 50%;
                  transform: translateY(-50%);
                  background: none;
                  border: none;
                  cursor: pointer;
                  color: #666;
                "
              >
                <i class="fas fa-eye"></i>
              </button>
            </div>

            <div
              id="apiKeyError"
              class="error-message"
              style="display: none; color: #d32f2f; margin-top: 10px"
            ></div>

            <div
              class="help-box"
              style="
                margin-top: 15px;
                padding: 10px;
                background: #f5f5f5;
                border-radius: 8px;
              "
            >
              <p style="margin: 0 0 10px 0; font-size: 0.9em">
                <strong>Para obtener tu API Key gratuita:</strong>
              </p>
              <ol style="margin: 0; padding-left: 20px; font-size: 0.85em">
                <li>
                  Crea una cuenta en
                  <a
                    href="https://www.ncbi.nlm.nih.gov/account/"
                    target="_blank"
                    >NCBI</a
                  >
                </li>
                <li>
                  Ve a
                  <a
                    href="https://www.ncbi.nlm.nih.gov/account/settings/"
                    target="_blank"
                    >Settings</a
                  >
                </li>
                <li>En "API Key Management", haz clic en "Create API Key"</li>
                <li>Copia la key generada y p√©gala aqu√≠</li>
              </ol>
              <p style="margin: 10px 0 0 0; font-size: 0.8em; color: #666">
                <i class="fas fa-lock"></i> Tu API key se almacena de forma
                segura en tu navegador local y nunca se env√≠a a servidores
                externos.
              </p>
            </div>
          </div>

          <div id="apiKeyExisting" style="display: none; margin-top: 15px">
            <button
              id="removeApiKey"
              class="btn-danger"
              style="
                background: #d32f2f;
                color: white;
                padding: 10px 20px;
                border: none;
                border-radius: 6px;
                cursor: pointer;
              "
            >
              <i class="fas fa-trash"></i> Eliminar API Key
            </button>
          </div>

          <div class="modal-buttons">
            <button class="modal-cancel" data-close="modalApiKeyFondo">
              Cancelar
            </button>
            <button id="saveApiKey" class="modal-confirm">
              <span class="btn-text">Guardar API Key</span>
              <span class="btn-loading" style="display: none">
                <i class="fas fa-spinner fa-spin"></i> Validando...
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div
      id="toastContainer"
      style="
        position: fixed;
        top: 200px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 9999;
        display: none;
      "
    ></div>
    <!-- Preparado para componente js  
    
<script src="/assets/js/buscar-pubmed.js"></script>
 -->
    <script src="/assets/js/api-key-manager.js"></script>
    <script defer src="/assets/js/counters-buscar-pubmed.js"></script>
  </body>
</html>
