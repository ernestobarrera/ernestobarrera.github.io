<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Calculadora de Productividad HCE - Análisis Científico</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #2c5aa0 0%, #1e4176 100%);
        min-height: 100vh;
        padding: 20px;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.98);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding: 20px;
        background: linear-gradient(135deg, #4caf50, #45a049);
        border-radius: 15px;
        color: white;
      }

      .header h1 {
        font-size: 2.2em;
        margin-bottom: 10px;
      }

      /* Interruption Indicator */
      .interruption-indicator {
        background: linear-gradient(45deg, #ff5722, #ff7043);
        color: white;
        padding: 15px;
        border-radius: 10px;
        margin: 15px 0;
        text-align: center;
        display: none;
        animation: urgentPulse 1s ease-in-out infinite;
        border: 3px solid #bf360c;
        box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
      }

      .interruption-indicator.active {
        display: block;
      }

      .interruption-indicator .interruption-icon {
        font-size: 1.5em;
        display: block;
        margin-bottom: 5px;
      }

      /* Enhanced Timer Display */
      .timer-enhanced {
        background: linear-gradient(135deg, #1a237e, #303f9f);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        margin: 15px 0;
        box-shadow: 0 6px 20px rgba(26, 35, 126, 0.3);
      }

      .timer-main {
        font-size: 2.5em;
        font-weight: bold;
        margin-bottom: 8px;
        font-family: "Courier New", monospace;
      }

      /* Simulation Enhancements */
      .simulation-section {
        background: #f8f9fa;
        padding: 30px;
        border-radius: 15px;
        margin: 30px 0;
        position: relative;
      }

      .simulation-title {
        text-align: center;
        color: #2c5aa0;
        font-size: 1.8em;
        margin-bottom: 25px;
      }

      .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: start;
        margin-bottom: 30px;
      }

      .interface-simulation {
        background: white;
        border: 2px solid #ddd;
        border-radius: 12px;
        padding: 20px;
        min-height: 500px;
        position: relative;
        transition: all 0.3s ease;
      }

      .interface-simulation.active {
        border-color: #4caf50;
        box-shadow: 0 0 20px rgba(76, 175, 80, 0.2);
      }

      .interface-simulation.interrupted {
        border-color: #f44336;
        box-shadow: 0 0 20px rgba(244, 67, 54, 0.2);
      }

      .interface-title {
        background: #2c5aa0;
        color: white;
        padding: 12px 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
        font-weight: bold;
        font-size: 1.1em;
      }

      .interface-title.optimized {
        background: #4caf50;
      }

      .hce-mockup {
        border: 1px solid #ccc;
        background: #fafafa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      /* Enhanced Notes Area */
      .notes-area {
        background: white;
        border: 2px solid #ddd;
        padding: 12px;
        border-radius: 5px;
        min-height: 120px;
        margin-bottom: 15px;
        font-family: Arial, sans-serif;
        font-size: 0.9em;
        color: #333;
        transition: all 0.3s ease;
        outline: none;
        resize: none;
        width: 100%;
        position: relative;
      }

      .notes-area:empty::before {
        content: attr(data-placeholder);
        color: #999;
        font-style: italic;
      }

      .notes-area:focus {
        border-color: #4caf50;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
      }

      .notes-area.typing {
        border-color: #ff9800;
        background: #fff8e1;
      }

      .notes-area.interrupted {
        border-color: #f44336;
        background: #ffebee;
      }

      .notes-display {
        background: #f0f8f0;
        border: 2px solid #4caf50;
        padding: 12px;
        border-radius: 5px;
        min-height: 120px;
        margin-bottom: 15px;
        font-family: Arial, sans-serif;
        font-size: 0.9em;
        color: #2e7d32;
        position: relative;
        line-height: 1.5;
      }

      /* Cognitive Load Indicator */
      .cognitive-load {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 15px 0;
        padding: 10px;
        background: linear-gradient(45deg, #ffeb3b, #ffc107);
        border-radius: 8px;
        font-weight: bold;
        color: #333;
        display: none;
      }

      .cognitive-load.active {
        display: flex;
        animation: cognitiveStress 2s ease-in-out infinite;
      }

      @keyframes cognitiveStress {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      .shortcut-pill {
        display: inline-block;
        background: #4caf50;
        color: white;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
        margin: 0 3px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        animation: pillGlow 2s ease-in-out;
      }

      @keyframes pillGlow {
        0% {
          background: #4caf50;
          transform: scale(1);
        }
        50% {
          background: #45a049;
          transform: scale(1.05);
          box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        100% {
          background: #4caf50;
          transform: scale(1);
        }
      }

      /* Toolbar improvements - disposición horizontal como en HCE real */
      .toolbar {
        background: #f0f0f0;
        padding: 4px;
        border-radius: 4px;
        border: 1px solid #ccc;
        display: flex;
        flex-wrap: nowrap;
        justify-content: center;
        align-items: center;
        gap: 2px;
        max-width: 600px;
        margin: 0 auto;
        transition: all 0.3s ease;
        overflow-x: auto;
      }

      .toolbar.searching {
        border-color: #ff9800;
        box-shadow: 0 0 15px rgba(255, 152, 0, 0.3);
      }

      .icon-btn {
        width: 24px;
        height: 20px;
        background: #fff;
        border: 1px solid #999;
        border-radius: 2px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        transition: all 0.2s ease;
        position: relative;
        margin: 1px;
        flex-shrink: 0;
      }

      .icon-btn:hover {
        background: #e3f2fd;
        border-color: #2196f3;
        transform: scale(1.1);
      }

      .icon-btn.clicked {
        background: #4caf50;
        color: white;
        border-color: #4caf50;
        animation: successPop 0.3s ease-out;
      }

      .icon-btn.wrong-click {
        background: #f44336;
        color: white;
        border-color: #f44336;
        animation: errorShake 0.5s ease-in-out;
      }

      /* Ocultar tooltips por defecto como en HCE real */
      .tooltip {
        display: none;
      }

      @keyframes successPop {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }

      @keyframes errorShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-3px);
        }
        75% {
          transform: translateX(3px);
        }
      }

      @keyframes urgentPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      /* Enhanced Controls */
      .start-controls {
        background: #e8f5e8;
        border: 2px solid #4caf50;
        border-radius: 12px;
        padding: 15px;
        text-align: center;
        margin: 15px 0;
      }

      .control-btn {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        margin: 0 8px 8px 8px;
        transition: all 0.3s ease;
      }

      .control-btn:hover {
        background: #45a049;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      }

      .control-btn:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .control-btn.secondary {
        background: #6c757d;
      }

      .control-btn.secondary:hover {
        background: #5a6268;
      }

      .control-btn.danger {
        background: #dc3545;
      }

      .control-btn.danger:hover {
        background: #c82333;
      }

      /* Enhanced Metrics */
      .metrics-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 15px;
        margin: 30px 0;
      }

      .metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .metric-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        text-align: center;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        transition: transform 0.3s ease;
      }

      .metric-card:hover {
        transform: translateY(-5px);
      }

      .metric-value {
        font-size: 2.2em;
        font-weight: bold;
        margin-bottom: 8px;
      }

      .metric-label {
        font-size: 0.9em;
        opacity: 0.9;
      }

      .dual-time-display {
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .time-comparison {
        font-size: 1.1em;
        margin-top: 8px;
        font-weight: 700;
        background: rgba(255, 255, 255, 0.9);
        padding: 4px 8px;
        border-radius: 6px;
        border: 2px solid #fff;
      }

      .time-comparison.real {
        color: #1a237e !important;
        background: #ffeb3b !important;
        border-color: #ffc107 !important;
        animation: realTimePulse 2s ease-in-out infinite;
      }

      @keyframes realTimePulse {
        0%,
        100% {
          transform: scale(1);
          box-shadow: 0 2px 8px rgba(255, 193, 7, 0.3);
        }
        50% {
          transform: scale(1.05);
          box-shadow: 0 4px 16px rgba(255, 193, 7, 0.6);
        }
      }

      /* Progress Bar */
      .progress-bar {
        width: 100%;
        height: 8px;
        background: #e0e0e0;
        border-radius: 4px;
        overflow: hidden;
        margin: 10px 0;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #45a049);
        transition: width 0.1s ease-out;
        width: 0%;
      }

      /* Notification System */
      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #28a745;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        z-index: 1001;
        max-width: 300px;
      }

      .notification.show {
        transform: translateX(0);
      }

      .notification.warning {
        background: #ff9800;
      }

      .notification.error {
        background: #f44336;
      }

      /* Tutorial Overlay */
      .tutorial-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 2000;
        display: none;
        justify-content: center;
        align-items: center;
      }

      .tutorial-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        text-align: center;
        position: relative;
      }

      .tutorial-close {
        position: absolute;
        top: 15px;
        right: 20px;
        font-size: 24px;
        cursor: pointer;
        color: #999;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .comparison-grid {
          grid-template-columns: 1fr;
          gap: 20px;
        }

        .toolbar {
          max-width: 100%;
          padding: 2px;
        }

        .icon-btn {
          width: 20px;
          height: 18px;
          font-size: 9px;
        }

        .control-btn {
          margin: 5px;
          padding: 8px 15px;
          font-size: 0.9em;
        }

        .explanation-section {
          padding: 15px;
        }

        .explanation-section div[style*="grid-template-columns"] {
          grid-template-columns: 1fr !important;
          gap: 10px;
        }
      }

      /* Accessibility improvements */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Focus indicators */
      button:focus,
      .icon-btn:focus {
        outline: 3px solid #4caf50;
        outline-offset: 2px;
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        .icon-btn {
          border-width: 2px;
        }

        .notes-area {
          border-width: 3px;
        }
      }

      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Print styles */
      @media print {
        .container {
          box-shadow: none;
          background: white;
        }

        .tutorial-overlay,
        .notification {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>📊 Calculadora de Productividad HCE</h1>
        <p>
          Análisis científico: Compara tu método actual vs atajos optimizados
        </p>
      </div>

      <div
        style="
          background: #e3f2fd;
          padding: 15px;
          border-radius: 10px;
          margin-bottom: 30px;
        "
      >
        <div style="text-align: center">
          <label
            for="dailyUses"
            style="font-weight: bold; color: #2c5aa0; margin-right: 10px"
          >
            📊 Prescripciones diarias estimadas:
          </label>
          <input
            type="number"
            id="dailyUses"
            value="45"
            min="1"
            max="200"
            style="
              padding: 5px 10px;
              border: 2px solid #2196f3;
              border-radius: 5px;
              font-size: 1em;
              width: 80px;
              text-align: center;
            "
          />
          <span style="color: #666; margin-left: 10px; font-size: 0.9em">
            (operaciones por jornada)
          </span>
        </div>
      </div>

      <div class="simulation-section">
        <h2 class="simulation-title">🎯 Simula tu Flujo de Trabajo Real</h2>

        <div class="comparison-grid">
          <div class="interface-simulation" id="currentMethodInterface">
            <div class="interface-title">
              📝 Flujo Tradicional (con búsqueda visual)
            </div>
            <div class="hce-mockup">
              <div
                style="font-weight: bold; margin-bottom: 10px; color: #2c5aa0"
              >
                1. Escribe una evolución típica acompañada de prescripción:
              </div>
              <div
                class="instruction-box"
                style="
                  background: linear-gradient(135deg, #ffeaa7, #fdcb6e);
                  border: 2px solid #e17055;
                  border-radius: 10px;
                  padding: 15px;
                  margin: 15px 0;
                  color: #2d3436;
                  font-weight: 500;
                  text-align: center;
                "
              >
                💡 <strong>Ejemplo:</strong> "Paciente refiere persistencia del
                dolor. Exploración sin cambios. Prescribir ibuprofeno 600mg
                c/8h"
              </div>
              <div
                class="notes-area"
                id="notesInput"
                contenteditable="true"
                style="cursor: text; white-space: pre-wrap"
                data-placeholder="Escribe aquí: Paciente refiere persistencia del dolor. Exploración sin cambios. Prescribir ibuprofeno 600mg c/8h..."
                aria-label="Área de escritura de notas clínicas"
              ></div>

              <!-- Interruption Indicator -->
              <div class="interruption-indicator" id="interruptionIndicator">
                <span class="interruption-icon">⚡🚨</span>
                <strong>FLUJO INTERRUMPIDO</strong><br />
                <span style="font-size: 0.9em"
                  >Ahora debes buscar visualmente el icono correcto</span
                >
              </div>

              <!-- Cognitive Load Indicator -->
              <div class="cognitive-load" id="cognitiveLoad">
                🧠 Carga cognitiva aumentada: Cambio de tarea + Búsqueda visual
              </div>

              <div
                style="
                  font-size: 0.85em;
                  margin: 8px 0;
                  color: #666;
                  text-align: center;
                "
                id="iconSearchText"
              >
                3. Selecciona el icono 💊 entre estos 12 botones:
              </div>
              <div
                class="toolbar"
                id="iconToolbar"
                aria-label="Barra de herramientas con iconos de funciones"
              ></div>

              <div class="start-controls">
                <button class="control-btn danger" onclick="resetSimulation()">
                  🔄 Reiniciar
                </button>
              </div>
            </div>

            <!-- Enhanced Timer -->
            <div class="timer-enhanced" id="iconTimerEnhanced">
              <div class="timer-main" id="iconTimerMain">0.0s</div>
              <div style="font-size: 0.9em; opacity: 0.9; margin-top: 5px">
                Tiempo teórico esperado: ~2.9s
              </div>
            </div>

            <div class="progress-bar">
              <div class="progress-fill" id="iconProgress"></div>
            </div>
            <div
              class="error-indicator"
              id="iconError"
              style="
                background: #ffebee;
                border: 2px solid #f44336;
                border-radius: 8px;
                padding: 10px;
                margin: 10px 0;
                text-align: center;
                color: #c62828;
                font-weight: bold;
                display: none;
              "
            >
              ❌ Error de clic - Inténtalo de nuevo
            </div>
            <div
              class="success-indicator"
              id="iconSuccess"
              style="
                background: #e8f5e8;
                border: 2px solid #4caf50;
                border-radius: 8px;
                padding: 10px;
                margin: 10px 0;
                text-align: center;
                color: #2e7d32;
                font-weight: bold;
                display: none;
              "
            >
              ✅ Acción completada
            </div>
          </div>

          <div class="interface-simulation" id="optimizedMethodInterface">
            <div class="interface-title optimized">
              ⚡ Flujo con Atajos de Teclado
            </div>
            <div class="hce-mockup">
              <div
                style="font-weight: bold; margin-bottom: 10px; color: #2e7d32"
              >
                1. Tu nota aparece en tiempo real:
              </div>
              <div class="notes-display" id="notesDisplay">
                Cuando escribas una nota en el lado izquierdo, aparecerá aquí
                automáticamente...
              </div>

              <div
                style="font-weight: bold; margin: 15px 0 10px 0; color: #2e7d32"
                id="optimizedText"
              >
                2. ✅ SIN INTERRUMPIR la escritura, ejecutas directamente:
              </div>

              <div
                class="keyboard-sequence"
                id="keyboardSequence"
                style="
                  background: #2c3e50;
                  color: white;
                  padding: 15px;
                  border-radius: 12px;
                  margin: 15px 0;
                  font-family: 'Courier New', monospace;
                  font-size: 1.1em;
                "
              >
                <span
                  class="key"
                  style="
                    background: #34495e;
                    padding: 6px 10px;
                    border-radius: 4px;
                    margin: 0 3px;
                    border: 2px solid #4a5f7a;
                    box-shadow: 0 2px 0 #2c3e50;
                    font-size: 0.9em;
                  "
                  >Alt</span
                >
                +
                <span
                  class="key"
                  style="
                    background: #34495e;
                    padding: 6px 10px;
                    border-radius: 4px;
                    margin: 0 3px;
                    border: 2px solid #4a5f7a;
                    box-shadow: 0 2px 0 #2c3e50;
                    font-size: 0.9em;
                  "
                  >R</span
                >
                = 💊 Recetas/Prescripciones
              </div>

              <div
                class="shortcut-input"
                style="
                  background: #e8f5e8;
                  border: 2px solid #4caf50;
                  border-radius: 8px;
                  padding: 15px;
                  margin: 15px 0;
                  text-align: center;
                "
              >
                <div style="margin-bottom: 10px; font-weight: bold">
                  Usa tu teclado real:
                </div>
                <div style="font-size: 0.9em; color: #666" id="shortcutHint">
                  💡 Presiona Alt+R en tu teclado para probar el atajo
                </div>
              </div>
            </div>

            <div class="timer-enhanced" id="keyboardTimerEnhanced">
              <div class="timer-main" id="keyboardTimerMain">0.0s</div>
              <div style="font-size: 0.9em; opacity: 0.9; margin-top: 5px">
                Memoria Muscular + Ejecución Directa
              </div>
            </div>

            <div class="progress-bar">
              <div class="progress-fill" id="keyboardProgress"></div>
            </div>
            <div
              class="success-indicator"
              id="keyboardSuccess"
              style="
                background: #e8f5e8;
                border: 2px solid #4caf50;
                border-radius: 8px;
                padding: 10px;
                margin: 10px 0;
                text-align: center;
                color: #2e7d32;
                font-weight: bold;
                display: none;
              "
            >
              ✅ Atajo ejecutado instantáneamente
            </div>
          </div>
        </div>
      </div>

      <!-- Nueva sección explicativa didáctica -->
      <div
        class="explanation-section"
        style="
          background: #fff3cd;
          padding: 25px;
          border-radius: 15px;
          margin: 30px 0;
          border-left: 4px solid #ffc107;
        "
      >
        <h3 style="color: #856404; text-align: center; margin-bottom: 20px">
          🔍 ¿Qué Acabas de Experimentar?
        </h3>

        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
          "
        >
          <div style="background: white; padding: 15px; border-radius: 10px">
            <h4 style="color: #d63384; margin-bottom: 10px">
              📝 Flujo Tradicional (Limitaciones Físicas):
            </h4>
            <ol style="margin: 0; padding-left: 20px; line-height: 1.6">
              <li><strong>Escribes fluidamente</strong> tu nota clínica</li>
              <li>
                <strong>Te detienes</strong> para buscar el icono correcto
              </li>
              <li>
                <strong>Tiempo mecánico:</strong> Movimiento físico del cursor
                (Ley de Fitts)
              </li>
              <li>
                <strong>Tiempo cognitivo:</strong> Decisión entre opciones
                visuales (Ley de Hick)
              </li>
              <li>
                <strong>Umbral máximo:</strong> ~2.9s insuperable por
                limitaciones físicas
              </li>
              <li>
                <strong>Retomas</strong> la escritura (si recuerdas dónde
                estabas)
              </li>
            </ol>
          </div>

          <div style="background: white; padding: 15px; border-radius: 10px">
            <h4 style="color: #198754; margin-bottom: 10px">
              ⚡ Flujo con Atajos (Optimización Cognitiva):
            </h4>
            <ol style="margin: 0; padding-left: 20px; line-height: 1.6">
              <li><strong>Escribes fluidamente</strong> tu nota clínica</li>
              <li><strong>Sin detenerte,</strong> activas memoria muscular</li>
              <li>
                <strong>Tiempo cognitivo puro:</strong> Recuerdo automático del
                atajo
              </li>
              <li>
                <strong>Ejecución directa:</strong> Sin búsqueda visual ni
                movimiento
              </li>
              <li>
                <strong>Velocidad natural:</strong> ~0.4s (velocidad de
                pensamiento)
              </li>
              <li>
                <strong>Continúas escribiendo</strong> sin pérdida de contexto
              </li>
            </ol>
          </div>
        </div>

        <!-- Indicadores explicativos -->
        <div
          style="
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
          "
        >
          <div
            style="
              background: linear-gradient(45deg, #ff5722, #ff7043);
              color: white;
              padding: 15px;
              border-radius: 10px;
              text-align: center;
            "
          >
            <div style="font-size: 1.2em; margin-bottom: 5px">⚡🚨</div>
            <strong>FLUJO INTERRUMPIDO</strong><br />
            <span style="font-size: 0.9em; opacity: 0.9"
              >Cambio de contexto: redacción → búsqueda visual → selección
              física</span
            >
          </div>

          <div
            style="
              background: linear-gradient(45deg, #ffeb3b, #ffc107);
              color: #333;
              padding: 15px;
              border-radius: 10px;
              text-align: center;
            "
          >
            <div style="font-size: 1.2em; margin-bottom: 5px">🧠</div>
            <strong>Limitaciones Físicas vs Cognitivas</strong><br />
            <span style="font-size: 0.9em"
              >Tiempo mecánico fijo vs memoria muscular instantánea</span
            >
          </div>
        </div>

        <div
          style="
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
          "
        >
          <strong style="color: #2e7d32">💡 Conclusión Científica:</strong> Los
          atajos trascienden las limitaciones físicas del diseño tradicional.
          <strong
            >El tiempo mecánico tiene un techo máximo, la memoria muscular
            optimiza el proceso cognitivo.</strong
          >
        </div>
      </div>

      <div class="metrics-section">
        <h3 style="text-align: center; color: #2c5aa0; margin-bottom: 20px">
          📊 Resultados de Productividad
        </h3>

        <div class="metrics-grid">
          <div class="metric-card">
            <div class="dual-time-display">
              <div class="metric-value" id="currentTime">2.9s</div>
              <div class="time-comparison" id="timeComparison">teórico</div>
            </div>
            <div class="metric-label">Método actual (buscar icono)</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="optimizedTime">0.4s</div>
            <div class="metric-label">Con atajos de teclado</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="improvement">86%</div>
            <div class="metric-label">Mejora obtenida</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="dailySaving">1.9m</div>
            <div class="metric-label" id="dailySavingLabel">
              Ahorro diario (45 usos)
            </div>
          </div>
        </div>

        <div
          style="
            background: #e8f5e8;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4caf50;
            margin-top: 20px;
          "
        >
          <h4 style="color: #2e7d32; margin-bottom: 15px">
            💡 Impacto Anual Estimado
          </h4>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 15px;
            "
          >
            <div>
              <strong>⏰ Tiempo:</strong><br />
              <span id="yearlyTime">8.3 horas</span> recuperadas
            </div>
            <div>
              <strong>🎯 Operaciones:</strong><br />
              <span id="operationsDisplay">45 usos</span> diarios optimizados
            </div>
            <div>
              <strong>💰 Valor:</strong><br />
              Flujo clínico ininterrumpido
            </div>
            <div>
              <strong>📈 ROI:</strong><br />
              Beneficio desde el primer día
            </div>
          </div>

          <div
            style="
              background: #f0f8ff;
              padding: 15px;
              border-radius: 8px;
              margin-top: 15px;
              border: 1px solid #2196f3;
            "
          >
            <h5 style="color: #1976d2; margin-bottom: 10px">
              🏥 Impacto Organizacional Escalado
            </h5>
            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 15px;
                font-size: 0.9em;
              "
            >
              <div>
                <strong>Centro de Salud (8 médicos):</strong><br />
                <span id="smallOrgImpact">66 horas/año</span> ahorradas<br />
                <span style="color: #666"
                  >Equivale a 1.6 semanas de consulta</span
                >
              </div>
              <div>
                <strong>Hospital (50 médicos):</strong><br />
                <span id="largeOrgImpact">415 horas/año</span> ahorradas<br />
                <span style="color: #666"
                  >Equivale a 10.4 semanas de consulta</span
                >
              </div>
            </div>
            <div
              style="
                margin-top: 10px;
                padding: 8px;
                background: rgba(76, 175, 80, 0.1);
                border-radius: 4px;
                font-size: 0.85em;
                color: #2e7d32;
              "
            >
              💡 <strong>Nota:</strong> El impacto se multiplica
              exponencialmente con el número de profesionales
            </div>
          </div>
        </div>
      </div>

      <div
        class="action-buttons"
        style="
          display: flex;
          gap: 15px;
          justify-content: center;
          margin-top: 30px;
          flex-wrap: wrap;
        "
      >
        <button
          class="btn btn-primary"
          onclick="generateReport()"
          style="
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
          "
        >
          📋 Generar Informe
        </button>
        <button
          class="btn btn-secondary"
          onclick="showScientificBasis()"
          style="
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            background: #6c757d;
            color: white;
          "
        >
          🔬 Fundamento Científico
        </button>
        <button
          class="btn btn-success"
          onclick="showTutorial()"
          style="
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            background: #28a745;
            color: white;
          "
        >
          🎓 Tutorial Interactivo
        </button>
      </div>

      <div
        class="scientific-section"
        id="scientificSection"
        style="
          background: #f8f9fa;
          padding: 25px;
          border-radius: 15px;
          margin: 30px 0;
          border-top: 3px solid #2c5aa0;
          display: none;
        "
      >
        <h3 style="color: #2c5aa0; text-align: center; margin-bottom: 20px">
          🔬 Fundamento Científico
        </h3>

        <div
          class="law-explanation"
          style="
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
          "
        >
          <h4 style="color: #2c5aa0">
            📏 Ley de Fitts (Paul Fitts, 1954) - Limitación Física
          </h4>
          <p>
            El tiempo para alcanzar un objetivo depende de su tamaño y
            distancia:
          </p>
          <div
            class="formula"
            style="
              background: #e8f5e8;
              padding: 12px;
              border-radius: 6px;
              font-family: 'Courier New', monospace;
              font-size: 1em;
              text-align: center;
              margin: 10px 0;
              border: 1px solid #4caf50;
            "
          >
            T = a + b × log₂(D/S + 1)
          </div>
          <p>
            <strong>En tu HCE:</strong> Iconos de 24×20px a 150px promedio =
            <strong>2.1 segundos</strong>
          </p>
          <div
            style="
              background: #ffebee;
              padding: 10px;
              border-radius: 5px;
              margin: 10px 0;
              font-size: 0.9em;
              border-left: 3px solid #f44336;
            "
          >
            <strong>⚠️ Umbral físico insuperable:</strong> El tiempo mecánico
            tiene un límite máximo definido por las leyes de la física
            (distancia, tamaño, precisión motora).
          </div>
        </div>

        <div
          class="law-explanation"
          style="
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
          "
        >
          <h4 style="color: #2c5aa0">
            ⚡ Ley de Hick-Hyman (1952) - Carga Cognitiva
          </h4>
          <p>
            El tiempo de decisión aumenta logarítmicamente con el número de
            opciones:
          </p>
          <div
            class="formula"
            style="
              background: #e8f5e8;
              padding: 12px;
              border-radius: 6px;
              font-family: 'Courier New', monospace;
              font-size: 1em;
              text-align: center;
              margin: 10px 0;
              border: 1px solid #4caf50;
            "
          >
            T = b × log₂(n + 1)
          </div>
          <p>
            <strong>En tu HCE:</strong> 12 opciones visualmente similares =
            <strong>0.8 segundos</strong> de decisión
          </p>
          <div
            style="
              background: #ffebee;
              padding: 10px;
              border-radius: 5px;
              margin: 10px 0;
              font-size: 0.9em;
              border-left: 3px solid #f44336;
            "
          >
            <strong>⚠️ Procesamiento cognitivo obligatorio:</strong> Cada opción
            adicional incrementa logarítmicamente el tiempo de análisis visual y
            decisión.
          </div>
        </div>

        <div
          style="
            background: #fff3cd;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
          "
        >
          <h4 style="color: #856404">🧮 Cálculo Total Validado</h4>
          <p>
            <strong>Método actual:</strong> 2.1s (Fitts) + 0.8s (Hick) =
            <strong>2.9s por operación</strong>
          </p>
          <p>
            <strong>Con atajos:</strong> 0.4s directo (muscle memory) =
            <strong>86% de mejora</strong>
          </p>
          <p>
            <strong>Ahorro anual:</strong> 2.5s × 45 usos × 220 días laborales =
            <strong>8.3 horas</strong>
          </p>
          <p>
            <strong>Base científica:</strong> Estudios de HCI aplicados a
            entornos médicos
          </p>
        </div>
      </div>
    </div>

    <!-- Tutorial Overlay -->
    <div class="tutorial-overlay" id="tutorialOverlay">
      <div class="tutorial-content">
        <span class="tutorial-close" onclick="closeTutorial()">&times;</span>
        <h3 id="tutorialTitle">🎓 Tutorial Interactivo</h3>
        <div id="tutorialContent">
          <p>
            <strong
              >Descubre cómo esta herramienta demuestra científicamente el
              impacto de la usabilidad:</strong
            >
          </p>
          <ol style="text-align: left; margin: 20px 0">
            <li>
              <strong>Configura</strong> las prescripciones diarias que realizas
            </li>
            <li>
              <strong>Escribe</strong> una nota clínica típica en el área de
              texto
            </li>
            <li>
              <strong>Experimenta</strong> la interrupción del flujo al buscar
              iconos
            </li>
            <li>
              <strong>Compara</strong> con la fluidez de los atajos de teclado
            </li>
            <li>
              <strong>Analiza</strong> los resultados basados en leyes
              científicas de HCI
            </li>
          </ol>
          <p
            style="
              background: #e8f5e8;
              padding: 10px;
              border-radius: 5px;
              margin: 15px 0;
            "
          >
            💡 <strong>Tip:</strong> Esta herramienta cuantifica el costo real
            de interrumpir el flujo de trabajo médico por decisiones de diseño.
          </p>
        </div>
        <button
          class="control-btn"
          onclick="closeTutorial()"
          style="margin-top: 15px"
        >
          🚀 ¡Empezar!
        </button>
      </div>
    </div>

    <!-- Modal -->
    <div
      class="modal"
      id="analysisModal"
      style="
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      "
    >
      <div
        class="modal-content"
        style="
          background: white;
          padding: 30px;
          border-radius: 15px;
          max-width: 600px;
          max-height: 80vh;
          overflow-y: auto;
          position: relative;
        "
      >
        <span
          class="modal-close"
          onclick="closeModal()"
          style="
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #999;
          "
          >&times;</span
        >
        <h3 id="modalTitle">📊 Análisis Detallado</h3>
        <div id="modalContent"></div>
      </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
      // Iconos exactos de HCE (12 opciones) con mapeo corregido
      const hceIcons = [
        { icon: "📋", tooltip: "Historia", action: "historia" },
        { icon: "💊", tooltip: "Recetas", action: "recetas" },
        { icon: "📄", tooltip: "IT/Informes", action: "it" },
        { icon: "🔬", tooltip: "Analíticas", action: "analiticas" },
        { icon: "💉", tooltip: "Vacunas", action: "vacunas" },
        { icon: "📅", tooltip: "Citas", action: "citas" },
        { icon: "📊", tooltip: "Gráficas", action: "graficas" },
        { icon: "🏥", tooltip: "Derivación", action: "derivacion" },
        { icon: "📞", tooltip: "Contacto", action: "contacto" },
        { icon: "💰", tooltip: "Facturación", action: "facturacion" },
        { icon: "📈", tooltip: "Estadísticas", action: "estadisticas" },
        { icon: "🖨️", tooltip: "Imprimir", action: "imprimir" },
      ];

      let simulationRunning = false;
      let startTime = 0;
      let targetAction = "recetas";
      let typingTimer = null;
      let autoStartTimer = null;
      let demoInterval = null;
      let measuredTime = null; // Para almacenar tiempo real medido
      const theoreticalTime = 2.9; // Tiempo teórico basado en leyes de HCI

      function updateProductivityMetrics() {
        const dailyUses =
          parseInt(document.getElementById("dailyUses").value) || 45;
        const currentTime = measuredTime || theoreticalTime;
        const optimizedTime = 0.4; // segundos

        const timeSaved = currentTime - optimizedTime;
        const improvement = (timeSaved / currentTime) * 100;
        const dailySavingSeconds = timeSaved * dailyUses;
        const dailySavingMinutes = dailySavingSeconds / 60;
        const yearlyHours = (dailySavingMinutes * 220) / 60; // 220 días laborales

        // Cálculos organizacionales
        const smallOrgHours = yearlyHours * 8; // 8 médicos
        const largeOrgHours = yearlyHours * 50; // 50 médicos

        // Actualizar métricas con ambos tiempos
        const currentTimeElement = document.getElementById("currentTime");
        const timeComparisonElement = document.getElementById("timeComparison");

        if (measuredTime) {
          currentTimeElement.textContent = `${measuredTime.toFixed(1)}s`;
          timeComparisonElement.innerHTML = `TU TIEMPO REAL<br>(teórico: ${theoreticalTime}s)`;
          timeComparisonElement.className = "time-comparison real";
        } else {
          currentTimeElement.textContent = `${theoreticalTime}s`;
          timeComparisonElement.textContent = "CALCULADO (HCI)";
          timeComparisonElement.className = "time-comparison";
        }

        document.getElementById(
          "improvement"
        ).textContent = `${improvement.toFixed(0)}%`;
        document.getElementById(
          "dailySaving"
        ).textContent = `${dailySavingMinutes.toFixed(1)}m`;
        document.getElementById(
          "dailySavingLabel"
        ).textContent = `Ahorro diario (${dailyUses} usos)`;
        document.getElementById(
          "yearlyTime"
        ).textContent = `${yearlyHours.toFixed(1)} horas`;
        document.getElementById(
          "operationsDisplay"
        ).textContent = `${dailyUses} usos`;

        // Actualizar impacto organizacional
        if (document.getElementById("smallOrgImpact")) {
          document.getElementById(
            "smallOrgImpact"
          ).textContent = `${smallOrgHours.toFixed(0)} horas/año`;
        }
        if (document.getElementById("largeOrgImpact")) {
          document.getElementById(
            "largeOrgImpact"
          ).textContent = `${largeOrgHours.toFixed(0)} horas/año`;
        }

        return {
          currentTime,
          optimizedTime,
          improvement,
          dailySavingMinutes,
          yearlyHours,
          dailyUses,
          timeSaved,
          theoreticalTime,
          measuredTime,
          smallOrgHours,
          largeOrgHours,
        };
      }

      function addShortcutPill(shortcut) {
        const notesDisplay = document.getElementById("notesDisplay");
        const currentText = notesDisplay.innerHTML;

        // Crear la píldora del atajo
        const pill = `<span class="shortcut-pill">${shortcut}</span>`;

        // Añadir al final del texto actual
        if (currentText.includes("Cuando escribas una nota")) {
          // Si es el texto por defecto, reemplazar
          notesDisplay.innerHTML = `Nota procesada → ${pill} ejecutado instantáneamente`;
        } else {
          // Si hay texto real, añadir al final
          notesDisplay.innerHTML = currentText + ` → ${pill}`;
        }

        // Auto-limpiar después de 3 segundos
        setTimeout(() => {
          const notesInput = document.getElementById("notesInput");
          if (notesInput.textContent.trim()) {
            notesDisplay.textContent = notesInput.textContent;
          } else {
            notesDisplay.textContent =
              "Cuando escribas una nota en el lado izquierdo, aparecerá aquí automáticamente...";
          }
        }, 3000);
      }

      function generateIconToolbar() {
        const toolbar = document.getElementById("iconToolbar");
        toolbar.innerHTML = "";

        hceIcons.forEach((iconData, index) => {
          const iconBtn = document.createElement("div");
          iconBtn.className = "icon-btn";
          iconBtn.textContent = iconData.icon;
          iconBtn.onclick = () => handleIconClick(iconBtn, iconData.action);
          iconBtn.setAttribute("role", "button");
          iconBtn.setAttribute("tabindex", "0");
          iconBtn.setAttribute(
            "aria-label",
            `${iconData.tooltip} - ${iconData.icon}`
          );

          const tooltip = document.createElement("div");
          tooltip.className = "tooltip";
          tooltip.textContent = iconData.tooltip;
          iconBtn.appendChild(tooltip);

          // Keyboard support
          iconBtn.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              handleIconClick(iconBtn, iconData.action);
            }
          });

          toolbar.appendChild(iconBtn);
        });
      }

      function stopDemoAutomatic() {
        // Detener demo automático cuando hay interacción
        if (demoInterval) {
          clearInterval(demoInterval);
          demoInterval = null;
        }
      }

      // Enhanced input detection
      document
        .getElementById("notesInput")
        .addEventListener("input", function () {
          stopDemoAutomatic(); // Parar demo cuando usuario interactúa

          const notesDisplay = document.getElementById("notesDisplay");

          // Sincronizar con el lado derecho
          const text = this.textContent.trim();
          notesDisplay.textContent =
            text ||
            "Cuando escribas una nota en el lado izquierdo, aparecerá aquí automáticamente...";

          if (text.length > 0) {
            // Indicar interfaz activa
            document
              .getElementById("currentMethodInterface")
              .classList.add("active");
            this.classList.add("typing");

            // Limpiar timers previos
            clearTimeout(typingTimer);
            clearTimeout(autoStartTimer);

            // Timer para detectar pausa en escritura
            typingTimer = setTimeout(() => {
              // Mostrar interrupción del flujo
              document
                .getElementById("currentMethodInterface")
                .classList.add("interrupted");

              this.classList.remove("typing");
              this.classList.add("interrupted");

              // Auto-iniciar cronómetro después de mostrar interrupción
              showNotificationEnhanced(
                "🚨 Flujo interrumpido - Cronómetro iniciado",
                "warning"
              );
              if (!simulationRunning && text.trim()) {
                setTimeout(() => {
                  startIconSimulation();
                }, 1500);
              }
            }, 1500); // 1.5 segundos sin escribir
          } else {
            // Si no hay texto, reset
            document
              .getElementById("currentMethodInterface")
              .classList.remove("active", "interrupted");
            this.classList.remove("typing", "interrupted");
            clearTimeout(typingTimer);
            clearTimeout(autoStartTimer);
          }
        });

      function startIconSimulation() {
        if (simulationRunning) return;

        stopDemoAutomatic();
        simulationRunning = true;

        // Siempre target recetas ya que es el único caso
        targetAction = "recetas";

        // Marcar toolbar como en búsqueda
        document.getElementById("iconToolbar").classList.add("searching");

        // Reset visuales
        const toolbar = document.getElementById("iconToolbar");
        const icons = toolbar.querySelectorAll(".icon-btn");
        icons.forEach((icon) => {
          icon.classList.remove("clicked", "wrong-click");
        });

        startTime = Date.now();
        document.getElementById("iconError").style.display = "none";
        document.getElementById("iconSuccess").style.display = "none";
        document.getElementById("iconProgress").style.width = "0%";

        showNotificationEnhanced(
          `🎯 Selecciona el icono 💊 (Recetas) - Cronómetro en marcha`,
          "warning"
        );
        updateIconTimerEnhanced();
      }

      function resetSimulation() {
        simulationRunning = false;
        targetAction = "recetas";
        measuredTime = null;

        // Limpiar timers
        clearTimeout(typingTimer);
        clearTimeout(autoStartTimer);

        // Reset interfaces
        document
          .getElementById("currentMethodInterface")
          .classList.remove("active", "interrupted");
        document
          .getElementById("optimizedMethodInterface")
          .classList.remove("active");

        // Reset timers
        document.getElementById("iconTimerMain").textContent = "0.0s";
        document.getElementById("keyboardTimerMain").textContent = "0.0s";
        document.getElementById("iconProgress").style.width = "0%";
        document.getElementById("keyboardProgress").style.width = "0%";

        // Reset displays
        document.getElementById("iconError").style.display = "none";
        document.getElementById("iconSuccess").style.display = "none";
        document.getElementById("keyboardSuccess").style.display = "none";

        // Reset toolbar
        const toolbar = document.getElementById("iconToolbar");
        toolbar.classList.remove("searching");
        const icons = toolbar.querySelectorAll(".icon-btn");
        icons.forEach((icon) =>
          icon.classList.remove("clicked", "wrong-click")
        );

        // Reset notas
        const notesInput = document.getElementById("notesInput");
        notesInput.textContent = "";
        notesInput.classList.remove("typing", "interrupted");
        document.getElementById("notesDisplay").textContent =
          "Cuando escribas una nota en el lado izquierdo, aparecerá aquí automáticamente...";

        // Recalcular métricas con valores por defecto
        updateProductivityMetrics();

        // Reiniciar demo automático después del reset
        startDemoAutomatic();

        showNotificationEnhanced(
          "🔄 Simulación reiniciada - Escribe una nota para empezar"
        );
      }

      function updateIconTimerEnhanced() {
        if (!simulationRunning) return;

        const currentTime = (Date.now() - startTime) / 1000;

        // Actualizar timer principal
        document.getElementById(
          "iconTimerMain"
        ).textContent = `${currentTime.toFixed(1)}s`;

        // Actualizar progreso
        document.getElementById("iconProgress").style.width = `${Math.min(
          currentTime * 20,
          100
        )}%`;

        requestAnimationFrame(updateIconTimerEnhanced);
      }

      function handleIconClick(iconBtn, action) {
        if (!simulationRunning) return;

        stopDemoAutomatic();

        const finalTime = (Date.now() - startTime) / 1000;

        if (action === targetAction) {
          // Éxito
          simulationRunning = false;

          iconBtn.classList.add("clicked");
          document.getElementById("iconToolbar").classList.remove("searching");
          document
            .getElementById("currentMethodInterface")
            .classList.remove("interrupted");
          document.getElementById("iconSuccess").style.display = "block";
          document.getElementById("iconProgress").style.width = "100%";

          // Actualizar tiempo medido y recalcular métricas
          measuredTime = finalTime;
          updateProductivityMetrics();

          showNotificationEnhanced(
            `✅ ¡Correcto! Tiempo real: ${finalTime.toFixed(
              1
            )}s - Ahora prueba Alt+R`
          );

          // Activar interfaz optimizada
          document
            .getElementById("optimizedMethodInterface")
            .classList.add("active");

          // Reiniciar demo después de tiempo suficiente
          setTimeout(startDemoAutomatic, 18000);
        } else {
          // Error
          iconBtn.classList.add("wrong-click");
          setTimeout(() => {
            iconBtn.classList.remove("wrong-click");
          }, 1000);

          document.getElementById("iconError").style.display = "block";
          setTimeout(() => {
            document.getElementById("iconError").style.display = "none";
          }, 1500);
          startTime += 1000; // Penalización de 1 segundo

          showNotificationEnhanced(
            `❌ Icono incorrecto - Selecciona 💊 (Recetas)`,
            "error"
          );
        }
      }

      function simulateShortcut(shortcut) {
        stopDemoAutomatic();

        // Activar interfaz optimizada visualmente
        document
          .getElementById("optimizedMethodInterface")
          .classList.add("active");

        const startTime = Date.now();

        // Añadir píldora visual al texto
        addShortcutPill(shortcut);

        document.getElementById("keyboardSuccess").style.display = "none";
        document.getElementById("keyboardProgress").style.width = "0%";

        const interval = setInterval(() => {
          const currentTime = (Date.now() - startTime) / 1000;
          document.getElementById(
            "keyboardTimerMain"
          ).textContent = `${currentTime.toFixed(1)}s`;
          document.getElementById("keyboardProgress").style.width = `${
            (currentTime / 0.4) * 100
          }%`;

          if (currentTime >= 0.4) {
            clearInterval(interval);
            document.getElementById("keyboardSuccess").style.display = "block";
            document.getElementById("keyboardProgress").style.width = "100%";
            showNotificationEnhanced(
              `⚡ ${shortcut} ejecutado - ¡Flujo ininterrumpido!`
            );

            // Reiniciar demo después de usar atajos
            setTimeout(startDemoAutomatic, 8000);
          }
        }, 50);
      }

      function startDemoAutomatic() {
        // Detener cualquier demo previo
        if (demoInterval) {
          clearInterval(demoInterval);
        }

        // Demo automático ocasional solo si no hay interacción activa
        demoInterval = setInterval(() => {
          if (!simulationRunning && Math.random() > 0.9) {
            simulateShortcut("Alt+R");
          }
        }, 45000); // Cada 45 segundos, probabilidad 10%
      }

      function showScientificBasis() {
        const section = document.getElementById("scientificSection");
        if (section.style.display === "none") {
          section.style.display = "block";
          section.scrollIntoView({ behavior: "smooth" });
          showNotificationEnhanced("📚 Fundamento científico mostrado");
        } else {
          section.style.display = "none";
          showNotificationEnhanced("📚 Fundamento científico ocultado");
        }
      }

      function showTutorial() {
        document.getElementById("tutorialOverlay").style.display = "flex";
      }

      function closeTutorial() {
        document.getElementById("tutorialOverlay").style.display = "none";
      }

      function generateReport() {
        const metrics = updateProductivityMetrics();

        const shareText = `🚀 ¡Mi análisis de productividad HCE es revelador!

📊 COMPARATIVA DE TIEMPOS:
${
  metrics.measuredTime
    ? `📝 Mi tiempo real: ${metrics.measuredTime.toFixed(1)}s
📐 Tiempo teórico: ${metrics.theoreticalTime}s`
    : `📝 Tiempo calculado: ${metrics.theoreticalTime}s (Leyes de Fitts + Hick)`
}
⚡ Con atajo Alt+R: ${metrics.optimizedTime}s

🎯 Resultados con ${metrics.dailyUses} prescripciones diarias:
• ${metrics.improvement.toFixed(0)}% de mejora en eficiencia
• ${metrics.dailySavingMinutes.toFixed(1)} minutos ahorrados cada día
• ${metrics.yearlyHours.toFixed(1)} horas recuperadas al año
• ROI inmediato desde el primer día

💡 EL PROBLEMA: Interrumpir la escritura para buscar iconos pequeños
✅ LA SOLUCIÓN: Alt+R → 💊 Prescripciones sin parar de escribir

🔬 Basado en ciencia de usabilidad (Leyes de Fitts y Hick-Hyman)
${
  metrics.measuredTime
    ? "✅ Validado con mi tiempo real medido"
    : "📐 Calculado con medidas precisas del HCE"
}

🩺 Beneficio: Flujo clínico más natural y centrado en el paciente

#ProductividadHCE #HistoriaClinica #SaludDigital #Eficiencia #UX #Medicina #AtajosDeTeclado #FluidezClinica`;

        // Mostrar el contenido en modal
        document.getElementById("modalTitle").textContent =
          "📋 Vista Previa del Informe";
        document.getElementById("modalContent").innerHTML = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <h4 style="color: #2c5aa0; margin-bottom: 10px;">📊 Resumen de tu análisis:</h4>
                    <p><strong>Tiempo actual:</strong> ${
                      metrics.measuredTime
                        ? `${metrics.measuredTime.toFixed(1)}s (medido)`
                        : `${metrics.theoreticalTime}s (teórico)`
                    }</p>
                    <p><strong>Mejora obtenida:</strong> ${metrics.improvement.toFixed(
                      0
                    )}%</p>
                    <p><strong>Ahorro anual:</strong> ${metrics.yearlyHours.toFixed(
                      1
                    )} horas</p>
                </div>
                
                <div style="background: #fff; border: 1px solid #ddd; padding: 15px; border-radius: 8px; max-height: 300px; overflow-y: auto; font-family: monospace; font-size: 0.9em; line-height: 1.4; white-space: pre-wrap;">${shareText}</div>
                
                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn btn-primary" onclick="copyReportToClipboard()">📋 Copiar al Portapapeles</button>
                    <button class="btn btn-secondary" onclick="closeModal()" style="margin-left: 10px;">❌ Cancelar</button>
                </div>
            `;
        document.getElementById("analysisModal").style.display = "flex";

        // Guardar el texto para copiarlo después
        window.reportText = shareText;
      }

      function copyReportToClipboard() {
        const shareText = window.reportText;

        navigator.clipboard
          .writeText(shareText)
          .then(() => {
            showNotificationEnhanced(
              "📋 ¡Informe completo copiado al portapapeles! Listo para compartir"
            );
            closeModal();
          })
          .catch(() => {
            // Fallback para navegadores que no soportan clipboard API
            const textArea = document.createElement("textarea");
            textArea.value = shareText;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand("copy");
            document.body.removeChild(textArea);
            showNotificationEnhanced("📋 ¡Informe copiado al portapapeles!");
            closeModal();
          });
      }

      function closeModal() {
        document.getElementById("analysisModal").style.display = "none";
      }

      function showNotificationEnhanced(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.classList.add("show");

        setTimeout(() => {
          notification.classList.remove("show");
        }, 4000);
      }

      // Event listeners
      document
        .getElementById("analysisModal")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeModal();
          }
        });

      document
        .getElementById("tutorialOverlay")
        .addEventListener("click", function (e) {
          if (e.target === this) {
            closeTutorial();
          }
        });

      // Event listener para prescripciones diarias
      document
        .getElementById("dailyUses")
        .addEventListener("input", function () {
          updateProductivityMetrics();
          showNotificationEnhanced(
            `📊 Cálculos actualizados para ${this.value} prescripciones diarias`
          );
        });

      // Atajos de teclado reales
      document.addEventListener("keydown", function (e) {
        if (e.altKey && e.key.toLowerCase() === "r") {
          e.preventDefault();
          simulateShortcut("Alt+R");
        }
      });

      // Keyboard navigation support
      document.addEventListener("keydown", function (e) {
        if (e.key === "Escape") {
          if (
            document.getElementById("tutorialOverlay").style.display === "flex"
          ) {
            closeTutorial();
          }
          if (
            document.getElementById("analysisModal").style.display === "flex"
          ) {
            closeModal();
          }
        }
      });

      // Inicialización mejorada
      document.addEventListener("DOMContentLoaded", function () {
        generateIconToolbar();
        updateProductivityMetrics();

        // Auto-mostrar tutorial en primera visita
        if (!localStorage.getItem("hce_tutorial_seen")) {
          setTimeout(showTutorial, 2000);
          localStorage.setItem("hce_tutorial_seen", "true");
        }

        startDemoAutomatic();
      });

      // Accessibility improvements
      document.addEventListener("keydown", function (e) {
        // Tab navigation for icon toolbar
        if (
          e.key === "Tab" &&
          document.activeElement.classList.contains("icon-btn")
        ) {
          e.preventDefault();
          const icons = Array.from(document.querySelectorAll(".icon-btn"));
          const currentIndex = icons.indexOf(document.activeElement);
          const nextIndex = e.shiftKey
            ? (currentIndex - 1 + icons.length) % icons.length
            : (currentIndex + 1) % icons.length;
          icons[nextIndex].focus();
        }
      });
    </script>
  </body>
</html>
