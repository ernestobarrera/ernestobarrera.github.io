<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Protocolo Dolor Lumbar AP - Razonamiento Clínico</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --danger-red: #dc2626;
        --warning-orange: #ea580c;
        --caution-yellow: #ca8a04;
        --success-green: #16a34a;
        --info-blue: #0284c7;

        --dark-gray: #1f2937;
        --medium-gray: #6b7280;
        --light-gray: #f3f4f6;
        --white: #ffffff;
        --bg-main: #fafafa;

        --red-bg: #fef2f2;
        --orange-bg: #fff7ed;
        --yellow-bg: #fefce8;
        --green-bg: #f0fdf4;
        --blue-bg: #f0f9ff;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: var(--bg-main);
        color: var(--dark-gray);
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: var(--white);
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .header {
        background: var(--white);
        border-bottom: 3px solid var(--info-blue);
        padding: 20px 30px;
      }
      .header h1 {
        font-size: 1.8rem;
        color: var(--dark-gray);
        font-weight: 600;
      }
      .header p {
        color: var(--medium-gray);
        font-size: 0.95rem;
        margin-top: 5px;
      }

      .nav-flow {
        display: flex;
        background: var(--light-gray);
        border-bottom: 1px solid #e5e7eb;
        overflow-x: auto;
        position: sticky;
        top: 0;
        z-index: 100;
      }
      .nav-step {
        flex: 1;
        min-width: 150px;
        padding: 12px 20px;
        background: transparent;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        color: var(--medium-gray);
        border-right: 1px solid #e5e7eb;
      }
      .nav-step:hover {
        background: var(--white);
      }
      .nav-step.active {
        background: var(--white);
        color: var(--dark-gray);
        font-weight: 600;
      }
      .nav-step.active::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--info-blue);
      }
      .nav-step .step-number {
        display: inline-flex;
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--medium-gray);
        color: var(--white);
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: bold;
      }
      .nav-step.active .step-number {
        background: var(--info-blue);
      }

      .content {
        padding: 30px;
        min-height: 600px;
      }
      .section {
        display: none;
      }
      .section.active {
        display: block;
      }

      .clinical-card {
        background: var(--white);
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        transition: all 0.2s;
      }
      .clinical-card:hover {
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .clinical-card.red {
        border-left: 4px solid var(--danger-red);
        background: var(--red-bg);
      }
      .clinical-card.orange {
        border-left: 4px solid var(--warning-orange);
        background: var(--orange-bg);
      }
      .clinical-card.yellow {
        border-left: 4px solid var(--caution-yellow);
        background: var(--yellow-bg);
      }
      .clinical-card.green {
        border-left: 4px solid var(--success-green);
        background: var(--green-bg);
      }
      .clinical-card.blue {
        border-left: 4px solid var(--info-blue);
        background: var(--blue-bg);
      }

      .triage-wizard {
        background: var(--white);
        border: 2px solid var(--info-blue);
        border-radius: 8px;
        padding: 25px;
        margin: 20px 0;
      }
      .wizard-step {
        display: none;
      }
      .wizard-step.active {
        display: block;
      }
      .wizard-progress {
        display: flex;
        margin-bottom: 30px;
        gap: 10px;
      }
      .progress-item {
        flex: 1;
        height: 4px;
        background: var(--light-gray);
        border-radius: 2px;
        transition: background 0.3s;
      }
      .progress-item.completed {
        background: var(--success-green);
      }
      .progress-item.active {
        background: var(--info-blue);
      }

      .clinical-checkbox {
        display: flex;
        align-items: flex-start;
        margin: 12px 0;
        cursor: pointer;
        padding: 10px;
        border-radius: 6px;
        transition: background 0.2s;
      }
      .clinical-checkbox:hover {
        background: var(--light-gray);
      }
      .clinical-checkbox input {
        width: 20px;
        height: 20px;
        margin-right: 12px;
        margin-top: 2px;
        cursor: pointer;
      }
      .clinical-checkbox label {
        cursor: pointer;
        flex: 1;
      }

      .evidence-alert {
        background: var(--blue-bg);
        border: 1px solid var(--info-blue);
        border-radius: 6px;
        padding: 15px;
        margin: 20px 0;
        position: relative;
        padding-left: 45px;
      }
      .evidence-alert::before {
        content: "💡";
        position: absolute;
        left: 15px;
        top: 15px;
        font-size: 1.2rem;
      }
      .evidence-alert strong {
        color: var(--info-blue);
        display: block;
        margin-bottom: 5px;
      }

      .metacognitive-box {
        background: linear-gradient(135deg, var(--orange-bg), var(--yellow-bg));
        border: 2px solid var(--warning-orange);
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
        position: relative;
      }
      .metacognitive-box::before {
        content: "🧠";
        position: absolute;
        right: 20px;
        top: 20px;
        font-size: 2rem;
        opacity: 0.5;
      }
      .metacognitive-box h4 {
        color: var(--warning-orange);
        margin-bottom: 10px;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .btn-primary {
        background: var(--info-blue);
        color: white;
      }
      .btn-primary:hover {
        background: #0369a1;
      }
      .btn-success {
        background: var(--success-green);
        color: white;
      }
      .btn-danger {
        background: var(--danger-red);
        color: white;
      }
      .btn-warning {
        background: var(--warning-orange);
        color: white;
      }
      .btn-outline {
        background: transparent;
        border: 2px solid var(--info-blue);
        color: var(--info-blue);
      }
      .btn-outline:hover {
        background: var(--info-blue);
        color: white;
      }
      .btn-info {
        background: var(--info-blue);
        color: #fff;
      }

      .mechanism-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
      }
      .mechanism-card {
        background: var(--white);
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
        overflow: hidden;
      }
      .mechanism-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
      }
      .mechanism-card.nociceptive::before {
        background: var(--success-green);
      }
      .mechanism-card.neuropathic::before {
        background: var(--caution-yellow);
      }
      .mechanism-card.nociplastic::before {
        background: var(--danger-red);
      }
      .mechanism-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1);
      }
      .mechanism-card h4 {
        margin-bottom: 10px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .mechanism-card .icon {
        font-size: 1.5rem;
      }

      .pro-calculator {
        background: var(--white);
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 20px;
        margin: 20px 0;
      }
      .pro-calculator h3 {
        color: var(--dark-gray);
        margin-bottom: 20px;
        border-bottom: 2px solid var(--light-gray);
        padding-bottom: 10px;
      }
      .score-display {
        font-size: 2rem;
        font-weight: bold;
        text-align: center;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }
      .score-low {
        background: var(--green-bg);
        color: var(--success-green);
      }
      .score-medium {
        background: var(--yellow-bg);
        color: var(--caution-yellow);
      }
      .score-high {
        background: var(--red-bg);
        color: var(--danger-red);
      }

      .exercise-builder {
        background: var(--green-bg);
        border: 2px solid var(--success-green);
        border-radius: 8px;
        padding: 25px;
        margin: 20px 0;
      }
      .exercise-phase {
        background: var(--white);
        border-radius: 6px;
        padding: 15px;
        margin: 10px 0;
      }

      .tooltip {
        position: relative;
        display: inline-block;
        border-bottom: 1px dotted var(--info-blue);
        cursor: help;
        color: var(--info-blue);
      }
      .tooltip .tooltiptext {
        visibility: hidden;
        width: 250px;
        background-color: var(--dark-gray);
        color: var(--white);
        text-align: left;
        border-radius: 6px;
        padding: 10px;
        position: absolute;
        z-index: 1;
        bottom: 125%;
        left: 50%;
        margin-left: -125px;
        font-size: 0.85rem;
        opacity: 0;
        transition: opacity 0.3s;
      }
      .tooltip:hover .tooltiptext {
        visibility: visible;
        opacity: 1;
      }

      details {
        margin: 15px 0;
        border: 1px solid #e5e7eb;
        border-radius: 6px;
        overflow: hidden;
      }
      summary {
        padding: 12px 15px;
        background: var(--light-gray);
        cursor: pointer;
        font-weight: 500;
      }
      summary:hover {
        background: #e5e7eb;
      }
      details[open] summary {
        background: var(--info-blue);
        color: white;
      }
      details > *:not(summary) {
        padding: 15px;
        background: var(--white);
      }

      .clinical-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }
      .clinical-table th {
        background: var(--light-gray);
        padding: 12px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid var(--info-blue);
      }
      .clinical-table td {
        padding: 10px 12px;
        border-bottom: 1px solid #e5e7eb;
      }
      .clinical-table tr:hover {
        background: var(--light-gray);
      }

      .badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.8rem;
        font-weight: 600;
        margin: 2px;
      }
      .badge-danger {
        background: var(--red-bg);
        color: var(--danger-red);
        border: 1px solid var(--danger-red);
      }
      .badge-warning {
        background: var(--orange-bg);
        color: var(--warning-orange);
        border: 1px solid var(--warning-orange);
      }
      .badge-caution {
        background: var(--yellow-bg);
        color: var(--caution-yellow);
        border: 1px solid var(--caution-yellow);
      }
      .badge-success {
        background: var(--green-bg);
        color: var(--success-green);
        border: 1px solid var(--success-green);
      }
      .badge-info {
        background: var(--blue-bg);
        color: var(--info-blue);
        border: 1px solid var(--info-blue);
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
      }
      .modal.show {
        display: flex;
      }
      .modal-content {
        background: white;
        border-radius: 8px;
        padding: 30px;
        max-width: 700px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }
      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid var(--light-gray);
      }
      .close-modal {
        font-size: 1.5rem;
        cursor: pointer;
        color: var(--medium-gray);
        background: none;
        border: none;
        padding: 0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 4px;
        transition: all 0.2s;
      }
      .close-modal:hover {
        background: var(--light-gray);
        color: var(--dark-gray);
      }

      @media (max-width: 768px) {
        .nav-flow {
          flex-wrap: nowrap;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }
        .nav-step {
          min-width: 140px;
          font-size: 0.85rem;
        }
        .mechanism-grid {
          grid-template-columns: 1fr;
        }
        .content {
          padding: 20px;
        }
      }

      @media print {
        .nav-flow,
        .btn,
        .modal {
          display: none;
        }
        .clinical-card {
          page-break-inside: avoid;
        }
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid var(--light-gray);
        border-top-color: var(--info-blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }
      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .progress-bar {
        height: 8px;
        background: var(--light-gray);
        border-radius: 4px;
        overflow: hidden;
        margin: 20px 0;
      }
      .progress-fill {
        height: 100%;
        background: var(--success-green);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .text-danger {
        color: var(--danger-red);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Protocolo de Evaluación del Dolor Lumbar</h1>
        <p>
          Sistema de Razonamiento Clínico para Atención Primaria • Basado en
          evidencia
        </p>
      </div>

      <nav class="nav-flow">
        <button class="nav-step active" onclick="showSection('safety')">
          <span class="step-number">1</span> Seguridad (Triaje)
        </button>
        <button class="nav-step" onclick="showSection('diagnosis')">
          <span class="step-number">2</span> Diagnóstico (Mecanismos)
        </button>
        <button class="nav-step" onclick="showSection('evaluation')">
          <span class="step-number">3</span> Evaluación (PROs/Examen)
        </button>
        <button class="nav-step" onclick="showSection('management')">
          <span class="step-number">4</span> Manejo (Tratamiento)
        </button>
      </nav>

      <div class="content">
        <!-- SEGURIDAD -->
        <div id="safety" class="section active">
          <h2>Fase 1: Seguridad - Triaje Inicial</h2>

          <div class="evidence-alert">
            <strong>Evidencia clave:</strong>
            La patología seria es infrecuente en AP (~0,9%). El 90–95% es dolor
            lumbar no específico. No solicitar imagen de rutina sin banderas
            rojas o si no cambia la conducta.
          </div>

          <div class="triage-wizard">
            <div class="wizard-progress">
              <div class="progress-item active" id="prog1"></div>
              <div class="progress-item" id="prog2"></div>
              <div class="progress-item" id="prog3"></div>
              <div class="progress-item" id="prog4"></div>
            </div>

            <!-- Cauda equina -->
            <div class="wizard-step active" id="step1">
              <h3>Paso 1: Descartar Síndrome de Cauda Equina</h3>
              <p id="ce-alert" class="text-danger" style="display: none">
                <strong>EMERGENCIA MÉDICA - derivación inmediata</strong>
              </p>

              <div class="clinical-checkbox">
                <input type="checkbox" id="ce1" onchange="updateCEAlert()" />

                <label for="ce1">
                  <strong>Nueva disfunción intestinal/vesical</strong><br />
                  <small>Incontinencia o retención de inicio reciente</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="ce2" onchange="updateCEAlert()" />

                <label for="ce2">
                  <strong>Anestesia en silla de montar</strong><br />
                  <small>Pérdida de sensibilidad perineal/genital</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="ce3" onchange="updateCEAlert()" />

                <label for="ce3">
                  <strong>Debilidad bilateral progresiva MMII</strong><br />
                  <small>Pérdida de fuerza de progresión rápida</small>
                </label>
              </div>

              <div style="margin-top: 25px">
                <button class="btn btn-primary" onclick="nextWizardStep()">
                  Continuar →
                </button>
              </div>
            </div>

            <!-- Malignidad -->
            <div class="wizard-step" id="step2">
              <h3>Paso 2: Descartar Indicadores de Malignidad</h3>

              <div class="clinical-checkbox">
                <input type="checkbox" id="mal1" />
                <label for="mal1">
                  <strong>Antecedente personal de cáncer</strong><br />
                  <small>Predictor más útil de malignidad</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="mal2" />
                <label for="mal2">
                  <strong>Pérdida de peso no explicada</strong><br />
                  <small>>5% en 6–12 meses</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="mal3" />
                <label for="mal3">
                  <strong>Dolor nocturno persistente</strong><br />
                  <small>Despierta por dolor, no alivia con reposo</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="mal4" />
                <label for="mal4">
                  <strong>Edad >50 con otros signos o falta de mejoría</strong
                  ><br />
                  <small
                    >La edad aislada tiene bajo rendimiento diagnóstico</small
                  >
                </label>
              </div>

              <div style="margin-top: 25px">
                <button class="btn btn-outline" onclick="prevWizardStep()">
                  ← Anterior
                </button>
                <button class="btn btn-primary" onclick="nextWizardStep()">
                  Continuar →
                </button>
              </div>
            </div>

            <!-- Fractura/Infección -->
            <div class="wizard-step" id="step3">
              <h3>Paso 3: Descartar Fractura/Infección</h3>

              <div class="clinical-checkbox">
                <input type="checkbox" id="frac1" />
                <label for="frac1">
                  <strong>Uso prolongado de corticosteroides</strong><br />
                  <small>>3 meses de corticoides orales</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="frac2" />
                <label for="frac2">
                  <strong>Traumatismo significativo</strong><br />
                  <small>Caída desde altura, accidente de tráfico, etc.</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="frac3" />
                <label for="frac3">
                  <strong>Osteoporosis o edad avanzada</strong><br />
                  <small>Riesgo incrementado de fractura vertebral</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="inf1" />
                <label for="inf1">
                  <strong>Fiebre + dolor lumbar</strong><br />
                  <small>Temperatura >38°C persistente</small>
                </label>
              </div>

              <div class="clinical-checkbox">
                <input type="checkbox" id="inf2" />
                <label for="inf2">
                  <strong>Inmunosupresión o drogas IV</strong><br />
                  <small
                    >VIH, tratamiento inmunosupresor, diabetes
                    descontrolada</small
                  >
                </label>
              </div>

              <div style="margin-top: 25px">
                <button class="btn btn-outline" onclick="prevWizardStep()">
                  ← Anterior
                </button>
                <button class="btn btn-primary" onclick="nextWizardStep()">
                  Continuar →
                </button>
              </div>
            </div>

            <!-- Resultado -->
            <div class="wizard-step" id="step4">
              <h3>Resultado del Triaje</h3>
              <div id="triageResult"></div>

              <div style="margin-top: 25px">
                <button class="btn btn-outline" onclick="resetWizard()">
                  Reiniciar Triaje
                </button>
                <button
                  class="btn btn-success"
                  onclick="showSection('diagnosis')"
                >
                  Continuar a Diagnóstico →
                </button>
              </div>
            </div>
          </div>

          <h3 style="margin-top: 40px">
            Identificación de Síndromes Radiculares (5–10% casos)
          </h3>

          <div class="clinical-card yellow">
            <h4>Dolor radicular (ciática)</h4>
            <ul>
              <li>Dolor irradiado por debajo de la rodilla</li>
              <li>Distribución dermatomérica</li>
              <li>
                Carácter neuropático (quemazón, electricidad, disestesias)
              </li>
              <li>
                SLR positivo (sensibilidad ≈0,91; especificidad baja). SLR
                cruzado: menos sensible, más específico
              </li>
            </ul>
            <span class="badge badge-info"
              >Reabsorción discal frecuente en semanas/meses</span
            >

            <span class="badge badge-info"
              >Pronóstico: 60–80% mejoría en 6–12 semanas</span
            >
            <span class="badge badge-caution">S-LANSS ≥12</span>
          </div>

          <div class="clinical-card yellow">
            <h4>Radiculopatía</h4>
            <ul>
              <li>Pérdida objetiva de función (signos negativos)</li>
              <li>Debilidad en miotomas específicos</li>
              <li>Alteración o abolición de reflejos</li>
              <li>Déficit sensitivo dermatomérico</li>
              <li>
                Puede cursar con poco dolor (síntomas negativos predominan)
              </li>
            </ul>
            <span class="badge badge-warning"
              >Requiere valoración neurológica</span
            >
          </div>

          <div class="clinical-card yellow">
            <h4>Estenosis de canal lumbar</h4>
            <ul>
              <li>Claudicación neurógena (dolor al caminar)</li>
              <li>Mejora con flexión anterior del tronco</li>
              <li>Empeora con extensión/bipedestación prolongada</li>
              <li>Típicamente bilateral, >65 años</li>
            </ul>
            <span class="badge badge-caution">Manejo conservador inicial</span>
          </div>
        </div>

        <!-- DIAGNÓSTICO -->
        <div id="diagnosis" class="section">
          <h2>Fase 2: Diagnóstico - Mecanismos de Dolor</h2>
          <!-- Notas de evidencia (DLNE y opacidad causal) -->
          <div class="evidence-alert">
            <strong>Evidencia clave:</strong>
            Los hallazgos degenerativos en RM son frecuentes en personas
            asintomáticas y aumentan con la edad; por ello, la imagen no debe
            solicitarse de rutina si no hay banderas rojas. En DLNE priorizamos
            la resolución de problemas y la discapacidad (CIF) por encima de
            señalar una única causa (“opacidad causal”).
          </div>

          <div class="metacognitive-box">
            <h4>Alerta metacognitiva (Sistema 2)</h4>
            <p>
              <strong>Evite sesgos cognitivos:</strong><br />
              •
              <span class="tooltip"
                >Heurístico de disponibilidad<span class="tooltiptext"
                  >Sobreestimar probabilidad por ejemplos
                  recientes/vívidos</span
                ></span
              ><br />
              •
              <span class="tooltip"
                >Falacia post hoc<span class="tooltiptext"
                  >Que B siga a A no implica que A cause B</span
                ></span
              ><br />
              •
              <span class="tooltip"
                >Opacidad causal<span class="tooltiptext"
                  >El DL no específico suele tener múltiples causas
                  posibles</span
                ></span
              >
            </p>
          </div>

          <h3>Mecanismo de dominancia del dolor</h3>
          <p>Identifique el mecanismo dominante para guiar el tratamiento:</p>

          <div class="mechanism-grid">
            <div
              class="mechanism-card nociceptive"
              onclick="showMechanismDetails('nociceptive')"
            >
              <h4><span class="icon">🟢</span> Dolor nociceptivo</h4>
              <p><strong>Prevalencia:</strong> 60–70% casos</p>
              <p><strong>Características:</strong></p>
              <ul>
                <li>Estímulo-dependiente</li>
                <li>Localizado, predecible</li>
                <li>Mejora con reposo</li>
                <li>Responde a AINEs</li>
              </ul>
              <div style="margin-top: 15px">
                <span class="badge badge-success">Buen pronóstico</span>
                <span class="badge badge-info">Centralización +</span>
              </div>
            </div>

            <div
              class="mechanism-card neuropathic"
              onclick="showMechanismDetails('neuropathic')"
            >
              <h4><span class="icon">⚡</span> Dolor neuropático</h4>
              <p><strong>Prevalencia:</strong> 5–10% casos</p>
              <p><strong>Características:</strong></p>
              <ul>
                <li>Quemazón, electricidad</li>
                <li>Espontáneo/paroxístico</li>
                <li>Distribución neural</li>
                <li>S-LANSS ≥12, DN4 ≥4</li>
              </ul>
              <div style="margin-top: 15px">
                <span class="badge badge-info">SLR +</span>
              </div>
            </div>

            <div
              class="mechanism-card nociplastic"
              onclick="showMechanismDetails('nociplastic')"
            >
              <h4><span class="icon">🔴</span> Dolor nociplástico</h4>
              <p><strong>Prevalencia:</strong> 10–20% crónicos</p>
              <p><strong>Características:</strong></p>
              <ul>
                <li>Desproporcionado</li>
                <li>Hiperalgesia/Alodinia</li>
                <li>Difuso, migratorio</li>
                <li>CSI ≥40</li>
              </ul>
              <div style="margin-top: 15px">
                <span class="badge badge-danger">Sensibilización central</span>
                <span class="badge badge-warning">Factores BPS</span>
              </div>
            </div>
          </div>

          <div class="pro-calculator" id="mechanism-calculator">
            <h3>Calculadora de Dominancia de Mecanismo</h3>
            <p>Introduzca hallazgos clínicos:</p>

            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-top: 20px;
              "
            >
              <!-- COLUMNA 1 -->
              <div id="ind-nociceptivo">
                <h4>Indicadores Nociceptivos</h4>
                <label class="clinical-checkbox">
                  <input type="checkbox" onchange="calculateMechanism()" />
                  <span>Dolor localizado y predecible</span>
                </label>
                <label class="clinical-checkbox">
                  <input type="checkbox" onchange="calculateMechanism()" />
                  <span>Mejora con reposo</span>
                </label>
                <label class="clinical-checkbox">
                  <input type="checkbox" onchange="calculateMechanism()" />
                  <span>Centralización presente</span>
                </label>
              </div>

              <!-- COLUMNA 2 -->
              <div id="ind-neuropatico">
                <h4>Indicadores Neuropáticos</h4>
                <label class="clinical-checkbox">
                  <input type="checkbox" onchange="calculateMechanism()" />
                  <span>S-LANSS ≥12</span>
                </label>
                <label class="clinical-checkbox">
                  <input type="checkbox" onchange="calculateMechanism()" />
                  <span>DN4 ≥4</span>
                </label>
                <label class="clinical-checkbox">
                  <input type="checkbox" onchange="calculateMechanism()" />
                  <span>Disestesias (quemazón)</span>
                </label>
              </div>
            </div>

            <div id="mechanismResult" style="margin-top: 20px"></div>
          </div>
        </div>

        <!-- EVALUACIÓN -->
        <div id="evaluation" class="section">
          <h2>Fase 3: Evaluación - PROs y Examen Físico</h2>

          <div class="evidence-alert">
            <strong>Mejores prácticas:</strong>
            Use PROs validados para establecer línea base y monitorizar cambios.
            El examen físico debe confirmar el mecanismo dominante.
          </div>

          <h3>Patient-Reported Outcomes (PROs)</h3>

          <div class="mechanism-grid">
            <div class="pro-calculator">
              <h4>S-LANSS (dolor neuropático)</h4>
              <div id="slanss-items">
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="5"
                    onchange="calculateSLANSS()"
                  /><span>Hormigueo, pinchazos, agujas</span></label
                >
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="3"
                    onchange="calculateSLANSS()"
                  /><span>Cambio de color en la piel</span></label
                >
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="5"
                    onchange="calculateSLANSS()"
                  /><span>Piel sensible al tacto</span></label
                >
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="2"
                    onchange="calculateSLANSS()"
                  /><span>Dolor súbito como descargas</span></label
                >
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="1"
                    onchange="calculateSLANSS()"
                  /><span>Sensación de quemazón</span></label
                >
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="3"
                    onchange="calculateSLANSS()"
                  /><span>Entumecimiento</span></label
                >
                <label class="clinical-checkbox"
                  ><input
                    type="checkbox"
                    value="5"
                    onchange="calculateSLANSS()"
                  /><span>Dolor con presión suave</span></label
                >
              </div>
              <div
                id="slanss-score"
                class="score-display score-low"
                style="display: none"
              >
                0/24
              </div>
              <div id="slanss-interpretation"></div>
            </div>

            <div class="pro-calculator">
              <h4>CSI (sensibilización central)</h4>
              <p>Evalúa 25 síntomas del SNC</p>
              <button class="btn btn-primary" onclick="openCSIModal()">
                Abrir cuestionario CSI
              </button>
              <div class="score-display score-low" style="margin-top: 20px">
                <small>Punto de corte: ≥40</small>
              </div>
            </div>

            <div class="pro-calculator">
              <h4>Índices funcionales</h4>
              <details>
                <summary>SFI - Índice de función de columna</summary>
                <p>Evalúa función y discapacidad específica de columna</p>
                <button class="btn btn-outline">Calcular SFI</button>
              </details>
              <details style="margin-top: 10px">
                <summary>LLFI - Índice función MMII</summary>
                <p>Evalúa función del miembro inferior</p>
                <button class="btn btn-outline">Calcular LLFI</button>
              </details>
              <details style="margin-top: 10px">
                <summary>FACS - Evitación por miedo</summary>
                <p>Identifica kinesiofobia y conductas de evitación</p>
                <button class="btn btn-outline">Calcular FACS</button>
              </details>
            </div>
          </div>

          <h3 style="margin-top: 40px">Examen físico dirigido</h3>

          <div class="clinical-card green">
            <h4>Confirmación nociceptivo - fenómeno de centralización</h4>
            <details>
              <summary>Protocolo McKenzie de movimientos repetidos</summary>
              <ol style="margin: 15px 0">
                <li><strong>Extensión en prono:</strong> 10 repeticiones</li>
                <li>
                  <strong>Flexión en bipedestación:</strong> 10 repeticiones
                  lentas
                </li>
                <li>
                  <strong>Shift lateral:</strong> evaluar lado de preferencia
                </li>
              </ol>
              <div class="evidence-alert">
                <strong>Centralización positiva:</strong>
                El dolor distal se reduce y migra a línea media. Indica dolor
                discogénico con dirección de preferencia. Buen pronóstico.
              </div>
            </details>
          </div>

          <div class="clinical-card yellow">
            <h4>Confirmación neuropático - tests neurodinámicos</h4>
            <table class="clinical-table">
              <thead>
                <tr>
                  <th>Test</th>
                  <th>Técnica</th>
                  <th>Positivo si</th>
                  <th>Raíz</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><strong>SLR</strong></td>
                  <td>Elevación pierna recta</td>
                  <td>Dolor <70°</td>
                  <td>L5-S1</td>
                </tr>
                <tr>
                  <td><strong>Slump</strong></td>
                  <td>Test de desplome</td>
                  <td>Reproduce síntomas</td>
                  <td>L4-S2</td>
                </tr>
                <tr>
                  <td><strong>Femoral stretch</strong></td>
                  <td>Estiramiento femoral</td>
                  <td>Dolor anterior muslo</td>
                  <td>L2-L4</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="clinical-card orange">
            <h4>Factores psicosociales (banderas amarillas)</h4>
            <div class="metacognitive-box">
              <h4>Identificadores clave</h4>
              <ul>
                <li>Catastrofización</li>
                <li>Kinesiofobia (FACS elevado)</li>
                <li>Creencias de daño persistente</li>
                <li>Conductas de evitación</li>
                <li>Expectativas negativas de recuperación</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- MANEJO -->
        <div id="management" class="section">
          <h2>Fase 4: Manejo - Tratamiento basado en mecanismo</h2>

          <div class="evidence-alert">
            <strong>Evidencia de primera línea:</strong>
            Ejercicio terapéutico y educación del paciente son los tratamientos
            con mayor evidencia. La terapia manual es coadyuvante. Evitar imagen
            rutinaria y opioides en dolor crónico.
          </div>

          <div class="exercise-builder">
            <h3>Constructor de Programa de Ejercicio Terapéutico (PET)</h3>

            <div
              style="
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                margin-bottom: 20px;
              "
            >
              <div>
                <label><strong>Mecanismo dominante:</strong></label>
                <select
                  class="form-control"
                  id="petMechanism"
                  onchange="updatePET()"
                >
                  <option value="">Seleccione...</option>
                  <option value="nociceptive">Nociceptivo</option>
                  <option value="neuropathic">Neuropático</option>
                  <option value="nociplastic">Nociplástico</option>
                </select>
              </div>
              <div>
                <label><strong>Dirección de preferencia:</strong></label>
                <select
                  class="form-control"
                  id="petDirection"
                  onchange="updatePET()"
                >
                  <option value="">Seleccione...</option>
                  <option value="flexion">Flexión (Sentadilla)</option>
                  <option value="extension">Extensión (Peso Muerto)</option>
                  <option value="neutral">Neutro</option>
                </select>
              </div>
            </div>

            <div id="petProgram"></div>

            <details style="margin-top: 20px">
              <summary>Principios del PET</summary>
              <ul style="margin: 15px">
                <li>
                  <strong>Mesociclo 1 (Semanas 1–4):</strong> Adaptación
                  anatómica, control motor
                </li>
                <li>
                  <strong>Mesociclo 2 (Semanas 5–8):</strong>
                  Fuerza-resistencia, progresión de carga
                </li>
                <li>
                  <strong>Mesociclo 3 (Semanas 9–12):</strong> Fuerza máxima,
                  integración funcional
                </li>
              </ul>
            </details>
          </div>

          <div class="clinical-card blue">
            <h3>Caja de herramientas de comunicación/educación</h3>

            <details>
              <summary>Historia natural</summary>
              <div style="padding: 15px; background: white; border-radius: 6px">
                <p>
                  <em
                    >"La mayoría de episodios mejoran significativamente en 6–12
                    semanas con manejo conservador. Mantenerse activo dentro de
                    los límites del dolor acelera la recuperación."</em
                  >
                </p>
              </div>
            </details>

            <details style="margin-top: 10px">
              <summary>Evitar el nocebo de la imagen</summary>
              <div style="padding: 15px; background: white; border-radius: 6px">
                <p>
                  <em
                    >"Cambios como protrusiones o artrosis son comunes en
                    personas sin dolor. Tratamos a la persona y sus síntomas, no
                    solo la imagen."</em
                  >
                </p>
              </div>
            </details>

            <details style="margin-top: 10px">
              <summary>Manejo de kinesiofobia</summary>
              <div style="padding: 15px; background: white; border-radius: 6px">
                <p>
                  <em
                    >"El movimiento gradual y controlado es parte del
                    tratamiento. Evitar el movimiento puede empeorar la
                    situación a largo plazo."</em
                  >
                </p>
              </div>
            </details>
            <details style="margin-top: 10px">
              <summary>Coste-efectividad y alianza terapéutica</summary>
              <div style="padding: 15px; background: white; border-radius: 6px">
                <p>
                  <em
                    >La fisioterapia (educación + ejercicio) es clínica y
                    coste-efectiva en DLNE. Una buena alianza terapéutica y el
                    tacto informado pueden potenciar expectativas y
                    resultados.</em
                  >
                </p>
              </div>
            </details>
          </div>

          <h3 style="margin-top: 40px">
            Algoritmos de tratamiento por mecanismo
          </h3>

          <div class="mechanism-grid">
            <div class="clinical-card green">
              <h4>🟢 Nociceptivo</h4>
              <strong>Primera línea:</strong>
              <ul>
                <li>Ejercicio con dirección de preferencia</li>
                <li>Acondicionamiento progresivo</li>
                <li>Educación en dolor</li>
              </ul>
              <strong>Segunda línea:</strong>
              <ul>
                <li>Terapia manual coadyuvante</li>
                <li>AINEs a corto plazo</li>
              </ul>
              <div style="margin-top: 10px">
                <span class="badge badge-success">90% mejora 6 semanas</span>
              </div>
            </div>

            <div class="clinical-card yellow">
              <h4>⚡ Neuropático</h4>
              <strong>Primera línea (según evidencia):</strong>
              <ul>
                <li>Movilización neural + educación</li>
                <li>Ejercicio aeróbico regular</li>
                <li>
                  Epidural con anestésico + corticoide si
                  <em>ciática aguda e intensa</em> (valoración especializada)
                </li>
              </ul>
              <strong>Evitar (ciática):</strong>
              <ul>
                <li>No gabapentinoides ni otros antiepilépticos</li>
                <li>No benzodiacepinas ni corticoides orales</li>
                <li>No opioides en crónica</li>
              </ul>
              <div style="margin-top: 10px">
                <span class="badge badge-caution"
                  >Evolución generalmente favorable</span
                >
              </div>
            </div>

            <div class="clinical-card orange">
              <h4>🔴 Nociplástico</h4>
              <strong>Enfoque multimodal:</strong>
              <ul>
                <li>Educación en neurobiología del dolor</li>
                <li>Exposición graduada</li>
                <li>Terapia cognitivo-conductual</li>
                <li>Ejercicio aeróbico regular</li>
              </ul>
              <strong>Evitar:</strong>
              <ul>
                <li>Reposo prolongado</li>
                <li>Búsqueda exclusiva de causa anatómica</li>
              </ul>
              <div style="margin-top: 10px">
                <span class="badge badge-danger"
                  >Requiere tiempo y paciencia</span
                >
              </div>
            </div>
          </div>

          <div class="clinical-card blue" style="margin-top: 30px">
            <h3>Panel de monitorización del progreso</h3>
            <p>Reevaluar con PROs cada 2–4 semanas:</p>

            <div class="progress-bar">
              <div
                class="progress-fill"
                style="width: 0%"
                id="progressBar"
              ></div>
            </div>

            <div
              style="
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
                margin-top: 20px;
              "
            >
              <div style="text-align: center">
                <strong>Dolor (EVA)</strong><br /><span
                  style="font-size: 1.5rem"
                  >-</span
                >
              </div>
              <div style="text-align: center">
                <strong>Función (SFI)</strong><br /><span
                  style="font-size: 1.5rem"
                  >-</span
                >
              </div>
              <div style="text-align: center">
                <strong>Kinesiofobia (FACS)</strong><br /><span
                  style="font-size: 1.5rem"
                  >-</span
                >
              </div>
              <div style="text-align: center">
                <strong>Satisfacción</strong><br /><span
                  style="font-size: 1.5rem"
                  >-</span
                >
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- CSI -->
      <div id="csiModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Cuestionario CSI - Inventario de Sensibilización Central</h3>
            <button class="close-modal" onclick="closeModal('csiModal')">
              &times;
            </button>
          </div>
          <p>
            Evalúe cada síntoma del 0 (nunca) al 4 (siempre) según su frecuencia
            en el último mes.
          </p>
          <div style="max-height: 400px; overflow-y: auto; padding: 20px">
            <div id="csi-questions"></div>
          </div>
          <div style="text-align: center; margin-top: 20px">
            <div
              id="csi-total-score"
              class="score-display score-low"
              style="display: none"
            >
              0/100
            </div>
            <button class="btn btn-primary" onclick="calculateCSI()">
              Calcular puntuación CSI
            </button>
          </div>
        </div>
      </div>

      <!-- Anatomía -->
      <div id="anatomyModal" class="modal">
        <div class="modal-content" style="max-width: 900px">
          <div class="modal-header">
            <h3>Anatomía interactiva de la columna lumbar</h3>
            <button class="close-modal" onclick="closeModal('anatomyModal')">
              &times;
            </button>
          </div>
          <div style="display: flex; gap: 30px">
            <div style="flex: 1">
              <svg
                viewBox="0 0 400 500"
                xmlns="http://www.w3.org/2000/svg"
                style="width: 100%; max-width: 400px"
              >
                <g id="spine">
                  <g id="vertebrae">
                    <rect
                      x="150"
                      y="50"
                      width="100"
                      height="35"
                      fill="#e5e7eb"
                      stroke="#6b7280"
                      stroke-width="2"
                      rx="5"
                      class="vertebra"
                      data-level="L1"
                      onclick="showVertebralInfo('L1')"
                    />
                    <text
                      x="200"
                      y="70"
                      text-anchor="middle"
                      fill="#1f2937"
                      font-size="14"
                      font-weight="bold"
                    >
                      L1
                    </text>

                    <rect
                      x="150"
                      y="95"
                      width="100"
                      height="35"
                      fill="#e5e7eb"
                      stroke="#6b7280"
                      stroke-width="2"
                      rx="5"
                      class="vertebra"
                      data-level="L2"
                      onclick="showVertebralInfo('L2')"
                    />
                    <text
                      x="200"
                      y="115"
                      text-anchor="middle"
                      fill="#1f2937"
                      font-size="14"
                      font-weight="bold"
                    >
                      L2
                    </text>

                    <rect
                      x="150"
                      y="140"
                      width="100"
                      height="35"
                      fill="#e5e7eb"
                      stroke="#6b7280"
                      stroke-width="2"
                      rx="5"
                      class="vertebra"
                      data-level="L3"
                      onclick="showVertebralInfo('L3')"
                    />
                    <text
                      x="200"
                      y="160"
                      text-anchor="middle"
                      fill="#1f2937"
                      font-size="14"
                      font-weight="bold"
                    >
                      L3
                    </text>

                    <rect
                      x="150"
                      y="185"
                      width="100"
                      height="35"
                      fill="#e5e7eb"
                      stroke="#6b7280"
                      stroke-width="2"
                      rx="5"
                      class="vertebra"
                      data-level="L4"
                      onclick="showVertebralInfo('L4')"
                    />
                    <text
                      x="200"
                      y="205"
                      text-anchor="middle"
                      fill="#1f2937"
                      font-size="14"
                      font-weight="bold"
                    >
                      L4
                    </text>

                    <rect
                      x="150"
                      y="230"
                      width="100"
                      height="35"
                      fill="#e5e7eb"
                      stroke="#6b7280"
                      stroke-width="2"
                      rx="5"
                      class="vertebra"
                      data-level="L5"
                      onclick="showVertebralInfo('L5')"
                    />
                    <text
                      x="200"
                      y="250"
                      text-anchor="middle"
                      fill="#1f2937"
                      font-size="14"
                      font-weight="bold"
                    >
                      L5
                    </text>
                  </g>

                  <path
                    d="M 150 275 L 250 275 L 230 355 L 170 355 Z"
                    fill="#d1d5db"
                    stroke="#6b7280"
                    stroke-width="2"
                    onclick="showVertebralInfo('Sacro')"
                  />
                  <text
                    x="200"
                    y="315"
                    text-anchor="middle"
                    fill="#1f2937"
                    font-size="14"
                    font-weight="bold"
                  >
                    SACRO
                  </text>

                  <g id="discs">
                    <ellipse
                      cx="200"
                      cy="87"
                      rx="45"
                      ry="6"
                      fill="#3b82f6"
                      opacity="0.6"
                      class="disc"
                      onclick="showDiscInfo('L1-L2')"
                    />
                    <ellipse
                      cx="200"
                      cy="132"
                      rx="45"
                      ry="6"
                      fill="#3b82f6"
                      opacity="0.6"
                      class="disc"
                      onclick="showDiscInfo('L2-L3')"
                    />
                    <ellipse
                      cx="200"
                      cy="177"
                      rx="45"
                      ry="6"
                      fill="#3b82f6"
                      opacity="0.6"
                      class="disc"
                      onclick="showDiscInfo('L3-L4')"
                    />
                    <ellipse
                      cx="200"
                      cy="222"
                      rx="45"
                      ry="6"
                      fill="#3b82f6"
                      opacity="0.6"
                      class="disc"
                      onclick="showDiscInfo('L4-L5')"
                    />
                    <ellipse
                      cx="200"
                      cy="267"
                      rx="45"
                      ry="6"
                      fill="#3b82f6"
                      opacity="0.6"
                      class="disc"
                      onclick="showDiscInfo('L5-S1')"
                    />
                  </g>

                  <g
                    id="nerves"
                    stroke="#ef4444"
                    stroke-width="2"
                    fill="none"
                    opacity="0.8"
                  >
                    <path
                      d="M 250 195 Q 280 200 300 230 Q 310 260 320 330"
                      stroke-dasharray="5,3"
                      onclick="showNerveInfo('L4')"
                    />
                    <text x="270" y="190" fill="#ef4444" font-size="12">
                      L4
                    </text>

                    <path
                      d="M 250 240 Q 280 245 300 275 Q 310 305 320 375"
                      stroke-dasharray="5,3"
                      onclick="showNerveInfo('L5')"
                    />
                    <text x="270" y="235" fill="#ef4444" font-size="12">
                      L5
                    </text>

                    <path
                      d="M 230 295 Q 260 305 280 335 Q 290 365 300 425"
                      stroke-dasharray="5,3"
                      onclick="showNerveInfo('S1')"
                    />
                    <text x="250" y="290" fill="#ef4444" font-size="12">
                      S1
                    </text>
                  </g>

                  <g id="facets">
                    <circle
                      cx="135"
                      cy="67"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="265"
                      cy="67"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="135"
                      cy="112"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="265"
                      cy="112"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="135"
                      cy="157"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="265"
                      cy="157"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="135"
                      cy="202"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="265"
                      cy="202"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="135"
                      cy="247"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                    <circle
                      cx="265"
                      cy="247"
                      r="6"
                      fill="#fbbf24"
                      stroke="#f59e0b"
                      stroke-width="2"
                      class="facet"
                      onclick="showFacetInfo()"
                    />
                  </g>

                  <g id="sacroiliac">
                    <ellipse
                      cx="120"
                      cy="315"
                      rx="12"
                      ry="25"
                      fill="#10b981"
                      opacity="0.6"
                      stroke="#059669"
                      stroke-width="2"
                      onclick="showSIInfo()"
                    />
                    <ellipse
                      cx="280"
                      cy="315"
                      rx="12"
                      ry="25"
                      fill="#10b981"
                      opacity="0.6"
                      stroke="#059669"
                      stroke-width="2"
                      onclick="showSIInfo()"
                    />
                    <text
                      x="200"
                      y="370"
                      text-anchor="middle"
                      fill="#059669"
                      font-size="12"
                      font-weight="bold"
                    >
                      ASI
                    </text>
                  </g>

                  <g id="legend" transform="translate(20, 420)">
                    <rect
                      x="0"
                      y="0"
                      width="15"
                      height="15"
                      fill="#3b82f6"
                      opacity="0.6"
                    />
                    <text x="20" y="12" font-size="12">Disco</text>

                    <rect x="80" y="0" width="15" height="15" fill="#fbbf24" />
                    <text x="100" y="12" font-size="12">Faceta</text>

                    <rect
                      x="160"
                      y="0"
                      width="15"
                      height="15"
                      fill="#10b981"
                      opacity="0.6"
                    />
                    <text x="180" y="12" font-size="12">Sacroilíaca</text>

                    <rect
                      x="260"
                      y="0"
                      width="15"
                      height="15"
                      fill="#ef4444"
                      opacity="0.6"
                    />
                    <text x="280" y="12" font-size="12">Nervio</text>
                  </g>
                </g>
              </svg>
            </div>
            <div style="flex: 1">
              <div
                id="anatomyInfo"
                style="
                  padding: 20px;
                  background: var(--light-gray);
                  border-radius: 8px;
                  min-height: 300px;
                "
              >
                <h4>
                  Haga clic en cualquier estructura para ver información
                  detallada
                </h4>
                <p>
                  Vista anatómica interactiva con las principales fuentes de
                  dolor lumbar y sus relaciones.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Neurológico -->
      <div id="neurologicalModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Valoración neurológica completa</h3>
            <button
              class="close-modal"
              onclick="closeModal('neurologicalModal')"
            >
              &times;
            </button>
          </div>

          <table class="clinical-table">
            <thead>
              <tr>
                <th>Nivel</th>
                <th>Miotoma</th>
                <th>Reflejo</th>
                <th>Dermatoma</th>
                <th>Test</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><strong>L2</strong></td>
                <td>Flexión cadera (psoas)</td>
                <td>-</td>
                <td>Cara anterior muslo sup.</td>
                <td>Femoral stretch</td>
              </tr>
              <tr>
                <td><strong>L3</strong></td>
                <td>Extensión rodilla (cuádriceps)</td>
                <td>Rotuliano ↓</td>
                <td>Cara anterior muslo medio</td>
                <td>Femoral stretch</td>
              </tr>
              <tr>
                <td><strong>L4</strong></td>
                <td>Dorsiflexión tobillo</td>
                <td>Rotuliano ↓</td>
                <td>Cara medial pierna</td>
                <td>SLR cruzado</td>
              </tr>
              <tr>
                <td><strong>L5</strong></td>
                <td>Extensión hallux (EHL)</td>
                <td>-</td>
                <td>Dorso pie (1er espacio)</td>
                <td>SLR</td>
              </tr>
              <tr>
                <td><strong>S1</strong></td>
                <td>Flexión plantar</td>
                <td>Aquíleo ↓</td>
                <td>Cara lateral pie</td>
                <td>SLR</td>
              </tr>
              <tr>
                <td><strong>S2</strong></td>
                <td>Flexión rodilla</td>
                <td>-</td>
                <td>Cara posterior muslo</td>
                <td>Slump test</td>
              </tr>
            </tbody>
          </table>

          <div class="evidence-alert" style="margin-top: 20px">
            <strong>Punto clave:</strong> La debilidad de los miotomas es el
            signo diagnóstico más importante de radiculopatía. Pérdida de fuerza
            >3/5 sugiere compromiso neural significativo.
          </div>
        </div>
      </div>

      <!-- Laslett -->
      <div id="laslettModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Cluster de Laslett - Dolor sacroilíaco</h3>
            <button class="close-modal" onclick="closeModal('laslettModal')">
              &times;
            </button>
          </div>

          <p>
            ≥3 tests positivos de 5 = diagnóstico ASI probable (Sens ~91%, Esp
            ~78%).
          </p>

          <div style="margin: 20px 0">
            <div class="clinical-card blue">
              <h4>1. Distracción</h4>
              <p>Supino, presión hacia abajo y lateral sobre EIAS bilateral</p>
              <label class="clinical-checkbox"
                ><input type="checkbox" id="laslett1" /><span
                  >Positivo</span
                ></label
              >
            </div>

            <div class="clinical-card blue">
              <h4>2. Compresión</h4>
              <p>Decúbito lateral, presión hacia abajo sobre cresta ilíaca</p>
              <label class="clinical-checkbox"
                ><input type="checkbox" id="laslett2" /><span
                  >Positivo</span
                ></label
              >
            </div>

            <div class="clinical-card blue">
              <h4>3. Thrust del muslo</h4>
              <p>Supino, cadera 90°, presión axial a través del fémur</p>
              <label class="clinical-checkbox"
                ><input type="checkbox" id="laslett3" /><span
                  >Positivo</span
                ></label
              >
            </div>

            <div class="clinical-card blue">
              <h4>4. Sacral thrust</h4>
              <p>Prono, presión anterior sobre sacro</p>
              <label class="clinical-checkbox"
                ><input type="checkbox" id="laslett4" /><span
                  >Positivo</span
                ></label
              >
            </div>

            <div class="clinical-card blue">
              <h4>5. Test de Gaenslen</h4>
              <p>Al borde de camilla, hiperextensión cadera lado afectado</p>
              <label class="clinical-checkbox"
                ><input type="checkbox" id="laslett5" /><span
                  >Positivo</span
                ></label
              >
            </div>
          </div>

          <button class="btn btn-primary" onclick="evaluateLaslett()">
            Evaluar cluster
          </button>
          <div id="laslettResult" style="margin-top: 20px"></div>
        </div>
      </div>
      <div id="referencesModal" class="modal">
        <div class="modal-content">
          <div class="modal-header">
            <h3>Referencias (formato Vancouver)</h3>
            <button class="close-modal" onclick="closeModal('referencesModal')">
              &times;
            </button>
          </div>
          <ol style="padding-left: 18px; line-height: 1.5">
            <li>
              Bardin LD, King P, Maher CG. Diagnostic triage for low back pain:
              a practical approach for primary care. Med J Aust.
              2017;206(6):268–273.
            </li>
            <li>
              Brinjikji W, Luetmer PH, Comstock B, et al. Systematic Literature
              Review of Imaging Features of Spinal Degeneration in Asymptomatic
              Populations. AJNR Am J Neuroradiol. 2015;36(4):811–6.
            </li>
            <li>
              Waddell G. The Back Pain Revolution. Churchill-Livingstone; 1998.
            </li>
            <li>
              Lin I, Wiles L, Waller R, et al. What represents best practice
              care for musculoskeletal pain? A systematic review of clinical
              practice guidelines. Br J Sports Med. 2020;54(17):1049–1058.
            </li>
            <li>
              Pérez Mariño P, López Míguens V, Paseiro Ares G. Análisis de la
              efectividad clínica e impacto económico de una gestión racional de
              los recursos de fisioterapia en patología de alta prevalencia en
              Atención Primaria. Sociedade Galega de Fisioterapeutas. 2019.
            </li>
            <li>
              Chiu CC, Chuang TY, Chang KH, et al. The probability of
              spontaneous regression of lumbar herniated disc: a systematic
              review. Clin Rehabil. 2015;29(2):184–95.
            </li>
            <li>
              Bogduk N. Clinical anatomy of the lumbar spine and sacrum. 4th ed.
              Elsevier; 2005. p. 183–6.
            </li>
            <li>
              Fondevila-Suárez E. Marco Conceptual y Definición Formal de
              Razonamiento Clínico en Fisioterapia. Fisio Divulg.
              2015;3(3):5–18.
            </li>
            <li>
              Karayannis NV, Jull GA, Hodges PW. Physiotherapy movement based
              classification approaches to low back pain: comparison of
              subgroups through review and developer/expert survey. BMC
              Musculoskelet Disord. 2012;13:24.
            </li>
            <li>
              National Institute for Health and Care Excellence. Low back pain
              and sciatica in over 16s: assessment and management (NG59).
              London: National Institute for Health and Care Excellence; 2016.
            </li>
          </ol>
        </div>
      </div>

      <!-- botones flotantes -->
      <div style="position: fixed; bottom: 20px; right: 20px; z-index: 100">
        <button
          class="btn btn-info"
          onclick="openAnatomyModal()"
          style="margin: 5px"
        >
          🦴 Anatomía
        </button>
        <button
          class="btn btn-warning"
          onclick="openNeurologicalModal()"
          style="margin: 5px"
        >
          ⚡ Neurológico
        </button>
        <button
          class="btn btn-success"
          onclick="openLaslettModal()"
          style="margin: 5px"
        >
          ✓ Laslett
        </button>
        <button
          class="btn btn-outline"
          onclick="openReferencesModal()"
          style="margin: 5px"
        >
          📚 Referencias
        </button>
      </div>
    </div>

    <script>
      let currentStep = 1;
      const totalSteps = 4;

      function showSection(sectionId) {
        const sections = document.querySelectorAll(".section");
        const navSteps = document.querySelectorAll(".nav-step");

        // Oculta todo
        sections.forEach((s) => {
          s.classList.remove("active");
          s.style.display = "none";
        });
        navSteps.forEach((n) => n.classList.remove("active"));

        // Muestra la solicitada
        const target = document.getElementById(sectionId);
        if (target) {
          target.classList.add("active");
          target.style.display = "block";
        }

        const sectionMap = {
          safety: 0,
          diagnosis: 1,
          evaluation: 2,
          management: 3,
        };
        if (sectionMap[sectionId] !== undefined) {
          navSteps[sectionMap[sectionId]].classList.add("active");
        }
      }

      function nextWizardStep() {
        if (currentStep < totalSteps) {
          if (currentStep === 3) evaluateTriageResults();
          document
            .getElementById(`step${currentStep}`)
            .classList.remove("active");
          document
            .getElementById(`prog${currentStep}`)
            .classList.remove("active");
          document
            .getElementById(`prog${currentStep}`)
            .classList.add("completed");
          currentStep++;
          document.getElementById(`step${currentStep}`).classList.add("active");
          if (currentStep <= totalSteps)
            document
              .getElementById(`prog${currentStep}`)
              .classList.add("active");
        }
      }

      function prevWizardStep() {
        if (currentStep > 1) {
          document
            .getElementById(`step${currentStep}`)
            .classList.remove("active");
          document
            .getElementById(`prog${currentStep}`)
            .classList.remove("active");
          currentStep--;
          document.getElementById(`step${currentStep}`).classList.add("active");
          document
            .getElementById(`prog${currentStep}`)
            .classList.remove("completed");
          document.getElementById(`prog${currentStep}`).classList.add("active");
        }
      }

      function resetWizard() {
        currentStep = 1;
        for (let i = 1; i <= totalSteps; i++) {
          document.getElementById(`step${i}`).classList.remove("active");
          document
            .getElementById(`prog${i}`)
            .classList.remove("active", "completed");
        }
        document.getElementById("step1").classList.add("active");
        document.getElementById("prog1").classList.add("active");
        document
          .querySelectorAll('.wizard-step input[type="checkbox"]')
          .forEach((cb) => (cb.checked = false));
        document.getElementById("triageResult").innerHTML = "";
        updateCEAlert();
      }

      function evaluateTriageResults() {
        const resultDiv = document.getElementById("triageResult");
        const caudaEquina =
          document.getElementById("ce1").checked ||
          document.getElementById("ce2").checked ||
          document.getElementById("ce3").checked;
        const malignancy =
          document.getElementById("mal1").checked ||
          document.getElementById("mal2").checked ||
          document.getElementById("mal3").checked ||
          document.getElementById("mal4").checked;
        const fracture =
          document.getElementById("frac1").checked ||
          document.getElementById("frac2").checked ||
          document.getElementById("frac3").checked;
        const infection =
          document.getElementById("inf1").checked ||
          document.getElementById("inf2").checked;

        if (caudaEquina) {
          resultDiv.innerHTML = `
            <div class="clinical-card red">
              <h3 style="color: var(--danger-red);">⚠️ EMERGENCIA MÉDICA</h3>
              <p><strong>Sospecha de síndrome de cauda equina</strong></p>
              <ul>
                <li>Derivación inmediata a urgencias hospitalarias</li>
                <li>Solicitar RM urgente</li>
                <li>Contactar con neurocirugía</li>
              </ul>
              <span class="badge badge-danger">No demorar</span>
            </div>`;
        } else if (malignancy || fracture || infection) {
          let condition = malignancy
            ? "Posible malignidad"
            : fracture
            ? "Posible fractura"
            : "Posible infección";
          resultDiv.innerHTML = `
            <div class="clinical-card orange">
              <h3 style="color: var(--warning-orange);">⚠️ Banderas rojas presentes</h3>
              <p><strong>Sospecha: ${condition}</strong></p>
              <ul>
                <li>Solicitar imagen (RM preferente según sospecha)</li>
                <li>Analítica: VSG, PCR, hemograma</li>
                <li>Derivación preferente según hallazgos</li>
              </ul>
              <span class="badge badge-warning">Evaluación adicional requerida</span>
            </div>`;
        } else {
          resultDiv.innerHTML = `
            <div class="clinical-card green">
              <h3 style="color: var(--success-green);">✓ Sin banderas rojas</h3>
              <p><strong>Dolor lumbar no específico o síndrome radicular</strong></p>
              <ul>
                <li>No requiere imagen de rutina</li>
                <li>Proceder con clasificación por mecanismo</li>
                <li>Iniciar manejo conservador</li>
              </ul>
              <span class="badge badge-success">Pronóstico favorable</span>
            </div>`;
        }
      }
      function updateCEAlert() {
        const show =
          document.getElementById("ce1").checked ||
          document.getElementById("ce2").checked ||
          document.getElementById("ce3").checked;

        const el = document.getElementById("ce-alert");
        if (el) el.style.display = show ? "block" : "none";
      }

      function calculateSLANSS() {
        const checkboxes = document.querySelectorAll(
          '#slanss-items input[type="checkbox"]'
        );
        let total = 0;
        checkboxes.forEach((cb) => {
          if (cb.checked) total += parseInt(cb.value);
        });
        const scoreDiv = document.getElementById("slanss-score");
        const interpDiv = document.getElementById("slanss-interpretation");
        scoreDiv.style.display = "block";
        scoreDiv.textContent = `${total}/24`;
        if (total >= 12) {
          scoreDiv.className = "score-display score-high";
          interpDiv.innerHTML =
            '<span class="badge badge-caution">Sugiere dolor predominantemente neuropático</span>';
        } else {
          scoreDiv.className = "score-display score-low";
          interpDiv.innerHTML =
            '<span class="badge badge-success">Sugiere dolor predominantemente nociceptivo</span>';
        }
      }

      const csiQuestions = [
        "Siento fatiga/cansancio",
        "Mis músculos se sienten rígidos",
        "Siento ansiedad",
        "Aprieto los dientes",
        "Diarrea y/o estreñimiento",
        "Necesito ayuda con actividades diarias",
        "Sensibilidad a luces brillantes",
        "Me canso fácilmente con el esfuerzo",
        "Tengo dolor por todo el cuerpo",
        "Tengo dolores de cabeza",
        "Molestia vesical/micción",
        "No duermo bien",
        "Dificultad para concentrarme",
        "Problemas con la piel",
        "El estrés empeora mis síntomas",
        "Siento tristeza o depresión",
        "Poca energía",
        "Tensión en cuello y hombros",
        "Dolor mandibular",
        "Ciertos olores me molestan",
        "Orino frecuentemente",
        "Piernas inquietas",
        "Mala memoria",
        "Calambres menstruales dolorosos",
        "Dolor pélvico",
      ];

      function initializeCSI() {
        const container = document.getElementById("csi-questions");
        if (!container) return;
        container.innerHTML = csiQuestions
          .map(
            (q, i) => `
          <div style="margin: 10px 0; padding: 10px; background: white; border-radius: 4px;">
            <label style="display: block; margin-bottom: 5px;">${
              i + 1
            }. ${q}</label>
            <div style="display: flex; gap: 10px; justify-content: space-between;">
              ${[0, 1, 2, 3, 4]
                .map(
                  (val) => `
                <label style="cursor: pointer;">
                  <input type="radio" name="csi_${i}" value="${val}"> ${val}
                </label>`
                )
                .join("")}
            </div>
          </div>`
          )
          .join("");
      }

      function calculateCSI() {
        let total = 0;
        for (let i = 0; i < csiQuestions.length; i++) {
          const selected = document.querySelector(
            `input[name="csi_${i}"]:checked`
          );
          if (selected) total += parseInt(selected.value);
        }
        const scoreDiv = document.getElementById("csi-total-score");
        scoreDiv.style.display = "block";
        scoreDiv.textContent = `${total}/100`;
        if (total >= 40) {
          scoreDiv.className = "score-display score-high";
          alert("CSI ≥40: sugiere sensibilización central significativa.");
        } else {
          scoreDiv.className = "score-display score-low";
          alert(
            "CSI <40: sensibilización central poco probable como dominante."
          );
        }
      }

      function calculateMechanism() {
        const nociceptive = document.querySelectorAll(
          '#ind-nociceptivo input[type="checkbox"]:checked'
        ).length;
        const neuropathic = document.querySelectorAll(
          '#ind-neuropatico input[type="checkbox"]:checked'
        ).length;

        const result = document.getElementById("mechanismResult");
        if (!result) return;

        let mechanism = "Mixto/Indeterminado";
        let recommendation =
          "Recoger PROs e integrar hallazgos; revalorar en 1-2 semanas.";
        let cardClass = "blue";

        if (nociceptive >= 2 && neuropathic <= 1) {
          mechanism = "Nociceptivo";
          recommendation =
            "Confirmar con centralización. Iniciar ejercicio terapéutico con dirección de preferencia.";
          cardClass = "green";
        } else if (neuropathic >= 2 && nociceptive <= 1) {
          mechanism = "Neuropático";
          recommendation =
            "Confirmar con S-LANSS/DN4 y tests neurodinámicos; priorizar control del dolor y movilización neural.";
          cardClass = "yellow";
        }

        result.innerHTML = `
    <div class="clinical-card ${cardClass}">
      <p><strong>Mecanismo Dominante Probable:</strong> ${mechanism}</p>
      <p>Recomendación: ${recommendation}</p>
    </div>
  `;
      }

      function updatePET() {
        const mechanism = document.getElementById("petMechanism").value;
        const direction = document.getElementById("petDirection").value;
        const programDiv = document.getElementById("petProgram");
        if (!mechanism || !direction) {
          programDiv.innerHTML =
            "<p>Seleccione mecanismo y dirección para generar programa</p>";
          return;
        }

        let exercises = "";

        if (mechanism === "nociceptive" && direction === "extension") {
          exercises = `
            <div class="exercise-phase">
              <h4>Mesociclo 1: Adaptación (Semanas 1–4)</h4>
              <ul>
                <li>Peso muerto rumano: 3x12–15 (40–50% 1RM)</li>
                <li>Extensiones en prono: 3x10</li>
                <li>Bird dog: 3x8 por lado</li>
                <li>Puente glúteo: 3x15</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Mesociclo 2: Progresión (Semanas 5–8)</h4>
              <ul>
                <li>Peso muerto convencional: 4x8–10 (60–70% 1RM)</li>
                <li>Hip thrust: 3x12</li>
                <li>Plancha: 3x30–45 s</li>
                <li>Good mornings: 3x12</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Mesociclo 3: Fuerza (Semanas 9–12)</h4>
              <ul>
                <li>Peso muerto: 5x5 (75–85% 1RM)</li>
                <li>Rack pulls: 4x6</li>
                <li>Reverse hypers: 3x15</li>
                <li>Loaded carries: 3x40 m</li>
              </ul>
            </div>`;
        } else if (mechanism === "nociceptive" && direction === "flexion") {
          exercises = `
            <div class="exercise-phase">
              <h4>Mesociclo 1: Adaptación (Semanas 1–4)</h4>
              <ul>
                <li>Sentadilla goblet: 3x12–15</li>
                <li>Wall sits: 3x20–30 s</li>
                <li>Step ups: 3x10 por pierna</li>
                <li>Prensa: 3x15 (rango parcial)</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Mesociclo 2: Progresión (Semanas 5–8)</h4>
              <ul>
                <li>Sentadilla frontal: 4x8–10</li>
                <li>Split squats: 3x10 por lado</li>
                <li>Hack squat: 3x12</li>
                <li>Core anti-extensión: 3x30 s</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Mesociclo 3: Fuerza (Semanas 9–12)</h4>
              <ul>
                <li>Sentadilla trasera: 5x5 (75–85% 1RM)</li>
                <li>Sentadilla búlgara: 4x8</li>
                <li>Prensa: 4x10</li>
                <li>Plancha lateral: 3x45 s</li>
              </ul>
            </div>`;
        } else if (mechanism === "neuropathic") {
          exercises = `
            <div class="exercise-phase">
              <h4>Fase 1: Control del dolor (Semanas 1–3)</h4>
              <ul>
                <li>Movilización neural suave: 2x10 (sin provocación)</li>
                <li>Caminata: 10–15 min, 2 veces/día</li>
                <li>Respiración diafragmática: 3x10</li>
                <li>Estiramientos neurodinámicos suaves</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Fase 2: Desensibilización (Semanas 4–8)</h4>
              <ul>
                <li>Ejercicio aeróbico: 20–30 min (60–70% FC máx.)</li>
                <li>Sliders neurales: 3x15</li>
                <li>Isométricos de fuerza: 3x10 s</li>
                <li>Yoga suave o Tai Chi</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Fase 3: Reacondicionamiento (Semanas 9–12)</h4>
              <ul>
                <li>Progresión gradual de fuerza</li>
                <li>Ejercicio aeróbico: 30–40 min</li>
                <li>Integración funcional progresiva</li>
                <li>Técnicas de manejo del dolor</li>
              </ul>
            </div>`;
        } else if (mechanism === "nociplastic") {
          exercises = `
            <div class="exercise-phase">
              <h4>Fase 1: Educación y activación (Semanas 1–4)</h4>
              <ul>
                <li>Educación en neurobiología del dolor: sesiones semanales</li>
                <li>Actividad graduada: comenzar con 5 min</li>
                <li>Mindfulness: 10 min/día</li>
                <li>Registro de actividad y dolor</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Fase 2: Exposición graduada (Semanas 5–8)</h4>
              <ul>
                <li>Incremento de actividad (≈10% semanal)</li>
                <li>Ejercicios temidos con apoyo</li>
                <li>Técnicas cognitivo-conductuales</li>
                <li>Ejercicio aeróbico de baja intensidad</li>
              </ul>
            </div>
            <div class="exercise-phase">
              <h4>Fase 3: Consolidación (Semanas 9–12)</h4>
              <ul>
                <li>Programa de ejercicio regular</li>
                <li>Manejo autónomo del dolor</li>
                <li>Prevención de recaídas</li>
                <li>Actividades significativas para el paciente</li>
              </ul>
            </div>`;
        }

        programDiv.innerHTML =
          exercises ||
          "<p>Seleccione mecanismo y dirección para generar programa</p>";
        const progressBar = document.getElementById("progressBar");
        if (progressBar && exercises) progressBar.style.width = "25%";
      }

      function openCSIModal() {
        initializeCSI();
        document.getElementById("csiModal").classList.add("show");
      }
      function openAnatomyModal() {
        document.getElementById("anatomyModal").classList.add("show");
      }
      function openNeurologicalModal() {
        document.getElementById("neurologicalModal").classList.add("show");
      }
      function openLaslettModal() {
        document.getElementById("laslettModal").classList.add("show");
      }
      function openReferencesModal() {
        document.getElementById("referencesModal").classList.add("show");
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.remove("show");
      }

      function showVertebralInfo(level) {
        const info = {
          L1: {
            title: "Vértebra L1",
            content: "Transición toracolumbar. Punto de referencia clínico.",
          },
          L2: {
            title: "Vértebra L2",
            content:
              "Miotoma: flexión de cadera. Dermatoma: cara anterior muslo superior.",
          },
          L3: {
            title: "Vértebra L3",
            content:
              "Miotoma: extensión de rodilla. Reflejo rotuliano (L3–L4).",
          },
          L4: {
            title: "Vértebra L4",
            content:
              "Miotoma: dorsiflexión de tobillo. Nivel frecuente de estenosis.",
          },
          L5: {
            title: "Vértebra L5",
            content: "Miotoma: extensión del hallux. Hernia L4–L5 común.",
          },
          Sacro: {
            title: "Sacro",
            content:
              "Fusión de 5 vértebras. ASI como fuente de dolor en una proporción relevante.",
          },
        };
        updateAnatomyInfo(info[level]);
      }

      function showDiscInfo(level) {
        const info = {
          title: `Disco ${level}`,
          content: `
            <strong>Anatomía:</strong> Núcleo pulposo (alto contenido en agua) + anillo fibroso en capas.<br><br>
            <strong>Patología:</strong> Fisura anular → inflamación → sensibilización de nociceptores.<br>
            <strong>Hernia:</strong> más frecuente en L4–L5 y L5–S1 (~95% de casos).<br><br>
            <strong>Centralización:</strong> si está presente, sugiere origen discogénico con buen pronóstico.<br>
            <strong>Modic 1/2:</strong> biomarcadores asociados a dolor lumbar, pero <b>no prueban causalidad</b>.
          `,
        };
        updateAnatomyInfo(info);
      }

      function showNerveInfo(nerve) {
        const info = {
          L4: {
            title: "Raíz L4",
            content: `<strong>Miotoma:</strong> dorsiflexión tobillo<br><strong>Reflejo:</strong> rotuliano ↓<br><strong>Dermatoma:</strong> cara medial pierna<br><strong>Test:</strong> SLR cruzado`,
          },
          L5: {
            title: "Raíz L5",
            content: `<strong>Miotoma:</strong> extensión hallux (EHL)<br><strong>Reflejo:</strong> ninguno específico<br><strong>Dermatoma:</strong> dorso de pie (1er espacio)<br><strong>Test:</strong> SLR <70°`,
          },
          S1: {
            title: "Raíz S1",
            content: `<strong>Miotoma:</strong> flexión plantar<br><strong>Reflejo:</strong> aquíleo ↓<br><strong>Dermatoma:</strong> cara lateral pie/talón<br><strong>Test:</strong> SLR muy positivo`,
          },
        };
        updateAnatomyInfo(info[nerve]);
      }

      function showFacetInfo() {
        const info = {
          title: "Articulación facetaria",
          content: `
            <strong>Prevalencia:</strong> 15–30% del dolor lumbar.<br><br>
            <strong>Características:</strong><br>
            • Dolor unilateral, paramedial<br>
            • Rara vez por debajo de rodilla<br>
            • Empeora con extensión/rotación; mejora con flexión<br><br>
            <strong>Diagnóstico:</strong> no hay test clínico específico; confirmación por bloqueo facetario.
          `,
        };
        updateAnatomyInfo(info);
      }

      function showSIInfo() {
        const info = {
          title: "Articulación sacroilíaca (ASI)",
          content: `
            <strong>Prevalencia:</strong>~15–20% del dolor lumbar crónico (varía según población y criterios).<br><br>
            <strong>Características:</strong><br>
            • Dolor en región glútea/tuber isquiático<br>
            • No centraliza<br><br>
            <strong>Diagnóstico clínico:</strong> Cluster de Laslett (≥3/5) – Sens ~91%, Esp ~78%.<br>
            <strong>Advertencia:</strong> tests de palpación/movimiento y “fallos posicionales” presentan baja fiabilidad; el estándar de referencia es el <em>doble bloqueo controlado</em> guiado por imagen.
          `,
        };
        updateAnatomyInfo(info);
      }

      function updateAnatomyInfo(info) {
        const infoDiv = document.getElementById("anatomyInfo");
        if (infoDiv)
          infoDiv.innerHTML = `<h4>${info.title}</h4><p>${info.content}</p>`;
      }

      function evaluateLaslett() {
        let positive = 0;
        for (let i = 1; i <= 5; i++)
          if (document.getElementById(`laslett${i}`).checked) positive++;
        const resultDiv = document.getElementById("laslettResult");
        if (positive >= 3) {
          resultDiv.innerHTML = `
            <div class="clinical-card yellow">
              <h4>Resultado: ${positive}/5 tests positivos</h4>
              <p><strong>Diagnóstico ASI probable</strong></p>
              <p>Sensibilidad: ~91% | Especificidad: ~78%</p>
              <span class="badge badge-caution">Considerar tratamiento específico ASI</span>
            </div>`;
        } else {
          resultDiv.innerHTML = `
            <div class="clinical-card green">
              <h4>Resultado: ${positive}/5 tests positivos</h4>
              <p><strong>ASI improbable como fuente primaria</strong></p>
              <p>Buscar otras fuentes de dolor</p>
              <span class="badge badge-success">Continuar evaluación</span>
            </div>`;
        }
      }

      function showMechanismDetails(type) {
        const details = {
          nociceptive: {
            title: "Dolor nociceptivo - detalles",
            content: `
              <h4>Fisiopatología</h4>
              <p>Activación de nociceptores por daño tisular real o potencial. Inflamación local con mediadores (prostaglandinas, bradiquinina, sustancia P).</p>
              <h4>Subtipos en columna</h4>
              <ul>
                <li><strong>Discogénico:</strong> fisura anular, inflamación, centralización positiva</li>
                <li><strong>Facetario:</strong> dolor con extensión, unilateral</li>
                <li><strong>Sacroilíaco:</strong> Cluster de Laslett, no centraliza</li>
                <li><strong>Muscular:</strong> puntos gatillo, espasmo</li>
              </ul>
              <h4>Tratamiento</h4>
              <p>Ejercicio con dirección de preferencia + educación + actividad graduada</p>
            `,
          },
          neuropathic: {
            title: "Dolor neuropático - detalles",
            content: `
              <h4>Fisiopatología</h4>
              <p>Lesión/irritación del sistema somatosensorial; actividad ectópica; sensibilización secundaria.</p>
              <h4>Presentación</h4>
              <ul>
                <li><strong>Positivos:</strong> disestesias, alodinia, hiperalgesia</li>
                <li><strong>Negativos:</strong> hipoestesia, debilidad, hiporreflexia</li>
              </ul>
              <h4>Herramientas</h4>
              <ul>
                <li>S-LANSS ≥12</li>
                <li>DN4 ≥4/10</li>
                <li>Tests neurodinámicos positivos</li>
              </ul>
              <h4>Tratamiento</h4>
              <p>Movilización neural + ejercicio aeróbico; epidural si agudo e intenso (especializada). Evitar gabapentinoides/benzodiacepinas/corticoides orales.</p>
            `,
          },
          nociplastic: {
            title: "Dolor nociplástico - detalles",
            content: `
              <h4>Sensibilización central</h4>
              <p>Amplificación central sin daño tisular proporcional. Neuroplasticidad maladaptativa.</p>
              <h4>Identificadores</h4>
              <ul>
                <li>CSI ≥40</li>
                <li>Dolor desproporcionado y difuso</li>
                <li>Hipersensibilidad multimodal</li>
                <li>Comorbilidades (fatiga, sueño, ánimo)</li>
              </ul>
              <h4>Tratamiento</h4>
              <p>Educación + exposición graduada + TCC + ejercicio aeróbico regular</p>
            `,
          },
        };

        const modal = document.createElement("div");
        modal.className = "modal show";
        modal.innerHTML = `
          <div class="modal-content">
            <div class="modal-header">
              <h3>${details[type].title}</h3>
              <button class="close-modal" onclick="this.closest('.modal').remove()">&times;</button>
            </div>
            <div style="padding: 20px;">${details[type].content}</div>
          </div>`;
        document.body.appendChild(modal);
      }

      document.addEventListener("DOMContentLoaded", function () {
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
          anchor.addEventListener("click", function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute("href"));
            if (target) target.scrollIntoView({ behavior: "smooth" });
            updateCEAlert();
          });
        });

        document.querySelectorAll(".tooltip").forEach((tooltip) => {
          tooltip.addEventListener("mouseenter", function () {
            this.querySelector(".tooltiptext").style.visibility = "visible";
            this.querySelector(".tooltiptext").style.opacity = "1";
          });
          tooltip.addEventListener("mouseleave", function () {
            this.querySelector(".tooltiptext").style.visibility = "hidden";
            this.querySelector(".tooltiptext").style.opacity = "0";
          });
        });

        document.addEventListener("click", function (event) {
          if (event.target.classList.contains("modal"))
            event.target.classList.remove("show");
        });
      });
    </script>
  </body>
</html>
