<!--
=====================
  plantillas.html
  Macros y plantillas m√©dicas 
=====================
-->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta
      name="description"
      content="Sistema de atajos y plantillas cl√≠nicas editables para la Historia Cl√≠nica Electr√≥nica (HCE), dise√±ado para optimizar el tiempo en consulta."
    />
    <meta name="author" content="Ernesto Barrera" />
    <link rel="icon" href="assets/images/icon.webp" />
    <title>Plantillas Cl√≠nicas | @ernestob</title>

    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Plantillas Cl√≠nicas Editables | @ernestob"
    />
    <meta
      property="og:site_name"
      content="Herramienta de productividad para profesionales sanitarios"
    />
    <meta
      property="og:url"
      content="https://ernestobarrera.github.io/plantillas.html"
    />
    <meta
      property="og:image"
      content="https://ernestobarrera.github.io/assets/images/me.png"
    />
    <meta property="article:author" content="https://twitter.com/ernestob" />

    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/header.css" />
    <link rel="stylesheet" href="assets/css/components.css" />
    <link rel="stylesheet" href="assets/css/footer.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
    />

    <style>
      /* --- ESTILOS DE LA HERRAMIENTA DE PLANTILLAS --- */
      /* Reseteo y cuerpo de la herramienta */
      .tool-body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
          sans-serif;
        background: #f0f4f8;
        line-height: 1.6;
        padding-top: 60px; /* Ajuste para el header fijo del sitio */
      }

      .tool-body * {
        box-sizing: border-box;
      }

      .tool-header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        width: 100%;
        top: 60px; /* Se posiciona debajo del header principal */
        left: 0;
        z-index: 999;
      }

      .tool-header h1,
      .tool-header p {
        margin: 0;
        padding: 0;
      }

      .tool-container {
        display: flex;
        max-width: 1600px;
        margin: 160px auto 20px; /* Mayor margen top para separar del header */
        gap: 20px;
        padding: 20px;
      }
      .sidebar {
        width: 280px;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 150px; /* Mismo nivel que b√∫squeda */
        height: calc(100vh - 180px);
        overflow-y: auto;
        flex-shrink: 0; /* Evita que se comprima */
      }

      .sidebar h2 {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.3em;
      }

      .category-item {
        padding: 12px 16px;
        margin: 5px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #555;
      }

      .category-item:hover {
        background: #f0f4f8;
        transform: translateX(5px);
      }

      .category-item.active {
        background: #3498db;
        color: white;
      }

      .tool-main-content {
        flex: 1;
        min-width: 0; /* Permite que se ajuste correctamente */
      }

      #templates-container {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .search-container {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 140px; /* Mismo valor que sidebar */
        z-index: 99;
      }

      .search-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-box {
        width: 100%;
        padding: 15px 45px 15px 15px;
        font-size: 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        transition: all 0.3s;
      }

      .clear-search {
        position: absolute;
        right: 10px;
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 5px 10px;
        display: none;
        transition: color 0.3s;
      }

      .clear-search:hover {
        color: #3498db;
      }

      .search-box:not(:placeholder-shown) + .clear-search {
        display: block;
      }

      .search-box:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .category-section {
        margin-bottom: 40px;
        scroll-margin-top: 180px; /* Offset for sticky headers */
      }

      .category-header {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #3498db;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5em;
      }

      .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
      }

      .template-card {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        background: #f8f9fa;
        transition: all 0.3s;
        position: relative;
      }

      .template-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border-color: #3498db;
      }

      .template-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .template-title {
        font-size: 1.1em;
        color: #2c3e50;
        font-weight: 600;
        flex: 1;
      }

      .shortcut-badge {
        background: #3498db;
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85em;
        font-family: monospace;
        margin-left: 10px;
      }

      .template-content {
        background: white;
        padding: 15px;
        border-radius: 8px;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.8;
        white-space: pre-wrap;
        height: 250px;
        overflow-y: auto;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        position: relative;
        color: #2c3e50; /* <-- ESTA ES LA L√çNEA A√ëADIDA */
      }

      .template-content:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .template-content.edited {
        background-color: #fffef0;
        border-color: #f39c12;
      }

      .editable-field {
        background: #fff9e6;
        padding: 2px 8px;
        border-radius: 4px;
        border: 2px dashed #f39c12;
        color: #856404;
        cursor: text;
        display: inline;
        min-width: 60px;
        line-height: inherit;
        vertical-align: baseline;
        transition: all 0.2s;
        font-weight: 500;
        margin: 0 2px;
        font-family: inherit;
        font-size: inherit;
        position: relative;
        white-space: nowrap;
      }

      .editable-field:empty {
        display: inline-block;
        min-width: 80px;
      }

      .editable-field:empty:before {
        content: "___";
        color: #ccc;
      }

      .editable-field:hover {
        background: #ffeaa7;
        border-style: solid;
      }

      .editable-field:focus {
        background: white;
        border-color: #3498db;
        color: #2c3e50;
        outline: none;
      }
      .record-label {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-weight: bold;
        font-size: 12px;
        margin-right: 5px;
        vertical-align: middle;
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
      }

      .btn:hover {
        background: #2980b9;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #95a5a6;
      }

      .btn-secondary:hover {
        background: #7f8c8d;
      }

      .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
      }

      .edit-indicator {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #f39c12;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .template-card.has-changes .edit-indicator {
        opacity: 1;
      }

      .notification {
        position: fixed;
        top: 180px; /* Debajo de los dos headers */
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .notification.success {
        background: #27ae60;
        color: white;
      }
      .notification.info {
        background: #3498db;
        color: white;
      }

      .tooltip {
        position: relative;
      }
      .tooltip::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background: #2c3e50;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        white-space: nowrap;
        font-size: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }

      .tooltip:hover::after {
        opacity: 1;
      }

      .empty-state {
        text-align: center;
        padding: 60px;
        color: #7f8c8d;
      }

      .empty-state h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
      }

      .sidebar::-webkit-scrollbar,
      .template-content::-webkit-scrollbar {
        width: 8px;
      }
      .sidebar::-webkit-scrollbar-track,
      .template-content::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .sidebar::-webkit-scrollbar-thumb,
      .template-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }
      .sidebar::-webkit-scrollbar-thumb:hover,
      .template-content::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      /* Estilos para secci√≥n Acerca de */
      .info-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border: none;
        cursor: default;
      }

      .info-card:hover {
        transform: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-color: transparent;
      }

      .info-content {
        background: white;
        cursor: default;
        height: auto;
        max-height: 400px;
        line-height: 1.8;
        color: #2c3e50;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 15px;
      }

      .info-content:focus {
        outline: none;
        border-color: #e0e0e0;
        box-shadow: none;
      }

      .info-content h3 {
        color: #2c3e50;
        margin: 20px 0 10px 0;
        font-size: 1.1em;
      }

      .info-content ul {
        margin: 10px 0;
        padding-left: 25px;
      }

      .info-content ul li {
        margin: 8px 0;
        line-height: 1.6;
      }

      .info-content a {
        color: #3498db;
        text-decoration: none;
      }

      .info-content a:hover {
        text-decoration: underline;
      }

      .info-card .template-header {
        background: rgba(255, 255, 255, 0.9);
        padding: 10px 15px;
        border-radius: 8px 8px 0 0;
        margin: -20px -20px 15px -20px;
      }
      /* Layout especial para secci√≥n "Acerca de" */
      .about-section-wrapper {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 40px;
      }

      .about-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        text-align: center;
      }

      .about-header h1 {
        margin: 0;
        font-size: 2em;
        font-weight: 600;
      }

      .about-container {
        padding: 40px;
        max-width: 900px;
        margin: 0 auto;
      }

      .about-content-block {
        margin-bottom: 40px;
      }

      .about-content-block h2 {
        color: #2c3e50;
        font-size: 1.5em;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3498db;
      }

      .about-text {
        color: #444;
        line-height: 1.8;
        font-size: 16px;
      }

      .about-text h3 {
        color: #2c3e50;
        margin: 25px 0 15px 0;
        font-size: 1.2em;
      }

      .about-text p {
        margin: 15px 0;
      }

      .about-text ul {
        margin: 15px 0;
        padding-left: 30px;
      }

      .about-text ul li {
        margin: 10px 0;
        line-height: 1.6;
      }

      .about-text strong {
        color: #2c3e50;
        font-weight: 600;
      }

      .about-text em {
        color: #666;
        font-style: italic;
      }

      .about-text a {
        color: #3498db;
        text-decoration: none;
        border-bottom: 1px solid transparent;
        transition: border-color 0.3s;
      }

      .about-text a:hover {
        border-bottom-color: #3498db;
      }

      .about-separator {
        border: none;
        border-top: 1px solid #e0e0e0;
        margin: 40px 0;
      }

      /* Mejorar altura de tarjetas con contenido extenso */
      .template-content {
        background: white;
        padding: 15px;
        border-radius: 8px;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.8;
        white-space: pre-wrap;
        min-height: 150px;
        max-height: 250px;
        overflow: hidden;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        position: relative;
        color: #2c3e50;
      }

      /* Expandir tarjetas al hover */
      .template-card:hover .template-content {
        max-height: 600px;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }

      /* Indicador de m√°s contenido */
      .template-content::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(to bottom, transparent, white);
        pointer-events: none;
        opacity: 1;
        transition: opacity 0.3s;
      }

      .template-card:hover .template-content::after {
        opacity: 0;
      }
      /* Responsive */
      @media (max-width: 1200px) {
        .tool-container {
          flex-direction: column;
          margin-top: 160px;
        }

        .search-container {
          position: static;
          margin-bottom: 20px;
        }
        .sidebar {
          width: 280px;
          background: white;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          position: sticky;
          top: 140px; /* Fijo respecto al header */
          height: calc(100vh - 160px);
          overflow-y: auto;
          flex-shrink: 0;
        }
        .templates-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 768px) {
        .tool-header {
          background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          color: white;
          padding: 20px;
          text-align: center;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          position: fixed;
          width: 100%;
          top: 60px;
          left: 0;
          z-index: 999;
          height: 80px; /* Altura fija */
        }
        .tool-container {
          margin-top: 120px;
        }
        .sidebar {
          top: 130px;
        }
        .category-section {
          margin-bottom: 40px;
          scroll-margin-top: 150px; /* Ajustado para headers fijos */
        }
        .templates-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body class="tool-body">
    <script src="./assets/js/include.js"></script>
    <include src="header.html"></include>

    <main>
      <div class="tool-header">
        <h1>üè• Plantillas M√©dicas - Atenci√≥n Primaria</h1>
        <p>
          Sistema con 126 plantillas editables y atajos r√°pidos ‚Ä¢ Incluye
          Prompts IA
        </p>
      </div>

      <div class="tool-container">
        <aside class="sidebar">
          <h2>üìë Categor√≠as</h2>
          <div id="category-list"></div>
        </aside>

        <div class="tool-main-content">
          <div class="search-container">
            <div class="search-wrapper">
              <input
                type="text"
                class="search-box"
                id="searchBox"
                placeholder="üîç Buscar por t√≠tulo, atajo (.an, .ef, .iadd, .phq9) o contenido..."
                autocomplete="off"
              />
              <button
                class="clear-search"
                id="clearSearch"
                onclick="clearSearch()"
                title="Limpiar b√∫squeda"
              >
                ‚úï
              </button>
            </div>
          </div>

          <div id="templates-container"></div>
          <div class="empty-state" id="empty-state" style="display: none">
            <h3>No se encontraron resultados</h3>
            <p>Intenta con otros t√©rminos de b√∫squeda</p>
          </div>
        </div>
      </div>

      <div class="notification" id="notification"></div>
    </main>
    <include src="footer.html"></include>
    <script src="./assets/js/utils.js"></script>

    <script>
      // --- BASE DE DATOS COMPLETA DE ATAJOS CL√çNICOS ---
      const templates = [
        // Anamnesis y Exploraci√≥n
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "anamnesis-asintomatico",
          title: "Anamnesis Asintom√°tico",
          shortcut: ".an",
          content:
            "Anamnesis: Paciente asintom√°tico, sin quejas relevantes. Refiere bienestar general. No informa fiebre, tos, disnea u otros s√≠ntomas.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-general",
          title: "Exploraci√≥n General",
          shortcut: ".ef",
          content:
            "Exploraci√≥n general: Constantes dentro de la normalidad. Aspecto general normohidratado y normocoloreado, sin signos de distress agudo.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "auscultacion-cp",
          title: "Auscultaci√≥n Cardiopulmonar",
          shortcut: ".cp",
          content:
            "Auscultaci√≥n cardiopulmonar: Eupneico y normoventila, sin roncus ni crepitantes. Tonos cardiacos r√≠tmicos, sin soplos ni extratonos.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-abdominal",
          title: "Exploraci√≥n Abdominal",
          shortcut: ".ab",
          content:
            "Exploraci√≥n abdominal: Blando y depresible, sin dolor a la palpaci√≥n superficial ni profunda. Sin masas ni megalias. Ruidos hidroa√©reos normales.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-neurologica",
          title: "Exploraci√≥n Neurol√≥gica",
          shortcut: ".en",
          content:
            "Exploraci√≥n neurol√≥gica: Pupilas isoc√≥ricas y normorreactivas. Pares craneales sin alteraciones. Fuerza y sensibilidad conservadas.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-orl",
          title: "Exploraci√≥n ORL",
          shortcut: ".or",
          content:
            "Exploraci√≥n ORL: Faringe hiper√©mica sin exudados, sin adenopat√≠as cervicales palpables. Auscultaci√≥n y voz sin alteraciones destacables.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-musculoesqueletica",
          title: "Exploraci√≥n Musculoesquel√©tica",
          shortcut: ".ms",
          content:
            "Exploraci√≥n musculoesquel√©tica: Movilidad conservada en extremidades, sin dolor a la movilizaci√≥n activa o pasiva. Sin signos inflamatorios ni deformidades.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-genitourinaria",
          title: "Exploraci√≥n Genitourinaria",
          shortcut: ".gu",
          content:
            "Exploraci√≥n genitourinaria: Micci√≥n normal, sin disuria ni polaquiuria. Pu√±o-percusi√≥n renal negativa. No se evidencian masas ni dolor suprap√∫bico.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-dermatologica",
          title: "Exploraci√≥n Dermatol√≥gica",
          shortcut: ".dm",
          content:
            "Exploraci√≥n dermatol√≥gica: Piel √≠ntegra, sin eritemas, lesiones exudativas o cambios pigmentarios. Faneras sin alteraciones significativas.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "ecg-normal",
          title: "ECG Normal",
          shortcut: ".ec",
          content:
            "ECG: Ritmo sinusal, frecuencia card√≠aca estable y sin alteraciones de la conducci√≥n. Sin signos de isquemia aguda.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "analitica-normal",
          title: "Anal√≠tica Normal",
          shortcut: ".la",
          content:
            "Anal√≠tica: Hemograma y bioqu√≠mica sin alteraciones relevantes. Funci√≥n renal y hep√°tica en valores normales.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "radiografia-normal",
          title: "Radiograf√≠a Normal",
          shortcut: ".rx",
          content:
            "RX: Sin signos de consolidaci√≥n ni lesiones focales. No alteraciones osteoarticulares relevantes.",
        },

        // Patolog√≠as Frecuentes
        {
          category: "Patolog√≠as Frecuentes",
          id: "ira",
          title: "Infecci√≥n Respiratoria Alta (IRA)",
          shortcut: ".ira",
          content:
            "Infecci√≥n respiratoria alta:\n- S√≠ntomas: Rinorrea, odinofagia, tos irritativa\n- Exploraci√≥n: Faringe hiper√©mica sin exudados. ACP normal\n- Plan: Hidrataci√≥n, analgesia si precisa, lavados nasales\n- Signos alarma explicados. Control seg√∫n evoluci√≥n",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "gea",
          title: "Gastroenteritis Aguda (GEA)",
          shortcut: ".gea",
          content:
            "Gastroenteritis aguda:\n- Cl√≠nica: Deposiciones l√≠quidas sin productos patol√≥gicos\n- Exploraci√≥n: No deshidrataci√≥n. Abdomen blando, no doloroso\n- Plan: Dieta progresiva, hidrataci√≥n, probi√≥ticos\n- Signos alarma explicados. Control si no mejor√≠a",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "lumbalgia",
          title: "Lumbalgia Mec√°nica",
          shortcut: ".lum",
          content:
            "Lumbalgia mec√°nica:\n- Dolor lumbar mec√°nico sin irradiaci√≥n\n- No signos de alarma. No d√©ficit neurol√≥gico\n- Las√®gue y Bragard negativos\n- Plan: calor local, analgesia pautada, ejercicios espec√≠ficos",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "ansiedad",
          title: "Ansiedad Situacional",
          shortcut: ".ans",
          content:
            "Ansiedad situacional:\n- Desencadenante: []\n- Cl√≠nica: Ansiedad ps√≠quica y som√°tica. No depresi√≥n\n- Plan: T√©cnicas relajaci√≥n, higiene sue√±o, apoyo psicol√≥gico\n- Control en 2 semanas o seg√∫n evoluci√≥n",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "sintomas-inespecificos",
          title: "S√≠ntomas Inespec√≠ficos",
          shortcut: ".sine",
          content:
            "Evaluaci√≥n inicial por s√≠ntomas inespec√≠ficos:\n- Motivo de consulta: []\n- Anamnesis:\n  ‚Ä¢ Inicio: []\n  ‚Ä¢ Evoluci√≥n: []\n  ‚Ä¢ S√≠ntomas asociados: []\n  ‚Ä¢ Factores agravantes/aliviantes: []\n  ‚Ä¢ Impacto funcional: []\n- Exploraci√≥n f√≠sica:\n  ‚Ä¢ Estado general: []\n  ‚Ä¢ Constantes: TA: []/[] mmHg, FC: [] lpm, T¬™: []¬∫C, SatO2: []%\n  ‚Ä¢ Hallazgos relevantes: []\n- Pruebas complementarias:\n  ‚Ä¢ Hemograma completo y plaquetas\n  ‚Ä¢ PCR, VSG\n  ‚Ä¢ Alb√∫mina y perfil hep√°tico\n- Plan:\n  ‚Ä¢ Seguimiento: revisi√≥n 4-6 semanas\n  ‚Ä¢ Medidas generales: []\n  ‚Ä¢ Signos de alarma explicados: []\n- Impresi√≥n diagn√≥stica: []",
        },

        // Prescripciones y ATB
        {
          category: "Prescripciones y ATB",
          id: "pauta-analgesica",
          title: "Pauta Analg√©sica",
          shortcut: ".anal",
          content:
            "Pauta analg√©sica:\n1) Paracetamol 1g/8h\n2) A√±adir si precisa: Ibuprofeno 600mg/8h\n3) Si dolor no controlado: Intercalar Metamizol 575mg\nUsar la m√≠nima dosis efectiva. Ajustar seg√∫n respuesta",
        },
        {
          category: "Prescripciones y ATB",
          id: "criterios-atb",
          title: "Criterios Generales Uso ATB",
          shortcut: "..crit-ab",
          content:
            "CRITERIOS GENERALES USO ATB:\nANTES DE PRESCRIBIR:\n1. Diagn√≥stico probable/seguro\n2. Beneficio supera riesgos\n3. No alternativas efectivas\n4. Considerar resistencias locales\n\nFACTORES PACIENTE:\n‚ñ° Edad y comorbilidades\n‚ñ° Alergias medicamentosas\n‚ñ° ATB recientes (3 meses)\n‚ñ° Hospitalizaciones previas\n‚ñ° Factores riesgo resistencia\n\nAL PRESCRIBIR:\n1. Elegir espectro m√°s estrecho\n2. Dosis y duraci√≥n adecuadas\n3. V√≠a administraci√≥n √≥ptima\n4. Coste-efectividad\n5. Disponibilidad local",
        },
        {
          category: "Prescripciones y ATB",
          id: "prescripcion-diferida",
          title: "Prescripci√≥n Diferida de ATB",
          shortcut: "..pd-ab",
          content:
            "PRESCRIPCI√ìN DIFERIDA DE ANTIBI√ìTICO:\nDebido a que su cuadro cl√≠nico actual:\n- Podr√≠a resolverse sin antibi√≥ticos\n- No presenta criterios de gravedad\n- Tiene bajo riesgo de complicaciones\nSe recomienda inicialmente manejo sintom√°tico y observaci√≥n.\n\nRECOGER ANTIBI√ìTICO DE FARMACIA SI EN 72H:\n- No hay mejor√≠a o empeoramiento claro\n- Fiebre persistente > 38¬∫C\n- Aparici√≥n de nuevos s√≠ntomas\n\nMEDIDAS MIENTRAS TANTO:\n- Analgesia/antit√©rmicos si precisa\n- Hidrataci√≥n adecuada\n- Reposo relativo\nRECONSULTAR SI:\n- Aparici√≥n signos alarma explicados\n- Dudas sobre evoluci√≥n",
        },
        {
          category: "Prescripciones y ATB",
          id: "faringoamigdalitis",
          title: "Faringoamigdalitis (Centor)",
          shortcut: "..far-ab",
          content:
            "FARINGOAMIGDALITIS - VALORACI√ìN ATB:\nCriterios Centor modificados (1 punto cada uno):\n‚ñ° Ausencia de tos\n‚ñ° Adenopat√≠as cervicales dolorosas\n‚ñ° Fiebre >38¬∫C\n‚ñ° Exudado amigdalar\n‚ñ° Edad 3-14 a√±os (+1) o 15-44 (0) o >45 (-1)\nPuntuaci√≥n total: []/5\n\nDECISI√ìN SEG√öN SCORE:\n0-1: No precisa ATB ni test\n2-3: Considerar test r√°pido\n4-5: ATB emp√≠rico o test\n\nSi prescripci√≥n ATB:\n- 1¬™ elecci√≥n: Penicilina V o Amoxicilina\n- Duraci√≥n: 10 d√≠as completos\n- Alergia: Valorar macr√≥lido",
        },
        {
          category: "Prescripciones y ATB",
          id: "otitis-media",
          title: "Otitis Media Aguda (OMA)",
          shortcut: "..oma-ab",
          content:
            "OTITIS MEDIA AGUDA - VALORACI√ìN ATB:\nCriterios diagn√≥sticos:\n‚ñ° Inicio agudo\n‚ñ° Signos inflamaci√≥n timp√°nica\n‚ñ° Presencia exudado\n‚ñ° Signos/s√≠ntomas infecci√≥n aguda\n\nCriterios prescripci√≥n inmediata:\n‚ñ° Edad <6 meses\n‚ñ° <2 a√±os bilateral\n‚ñ° Otorrea\n‚ñ° S√≠ntomas graves\n‚ñ° Factores riesgo\n\nDECISI√ìN:\n‚ñ° ATB inmediato\n‚ñ° Prescripci√≥n diferida\n‚ñ° Observaci√≥n\n\nSi ATB:\n- 1¬™ elecci√≥n: Amoxicilina dosis alta\n- Duraci√≥n: 5-7d (>2a), 7-10d (<2a)\nControl en 48-72h si no mejor√≠a",
        },
        {
          category: "Prescripciones y ATB",
          id: "sinusitis",
          title: "Sinusitis Aguda",
          shortcut: "..sin-ab",
          content:
            "SINUSITIS AGUDA - VALORACI√ìN ATB:\nCriterios diagn√≥sticos (‚â•1 criterio mayor o ‚â•2 menores):\nMayores:\n‚ñ° Rinorrea purulenta con predominio unilateral\n‚ñ° Dolor facial unilateral\n‚ñ° Ocupaci√≥n radiol√≥gica\n\nMenores:\n‚ñ° Cefalea\n‚ñ° Fiebre\n‚ñ° Tos\n‚ñ° Halitosis\n‚ñ° Dolor dental\n‚ñ° O√≠do taponado\n\nCriterios ATB inmediato:\n‚ñ° S√≠ntomas graves o T>39¬∫C\n‚ñ° Curso bif√°sico\n‚ñ° No mejor√≠a tras 10d\n‚ñ° Inmunodepresi√≥n\n\nPLAN:\n‚ñ° ATB inmediato\n‚ñ° Tratamiento sintom√°tico\n‚ñ° Lavados nasales\nControl evoluci√≥n 72h",
        },
        {
          category: "Prescripciones y ATB",
          id: "bronquitis",
          title: "Bronquitis Aguda",
          shortcut: "..bron-ab",
          content:
            "BRONQUITIS AGUDA - VALORACI√ìN ATB:\nRecordar: Generalmente viral, ATB no indicado rutinariamente\n\nCriterios valoraci√≥n:\n‚ñ° Duraci√≥n tos <3 semanas\n‚ñ° No neumon√≠a (exploraci√≥n/Rx)\n‚ñ° No EPOC/bronquiectasias\n‚ñ° No signos gravedad\n\nPLAN:\n- Manejo sintom√°tico\n- Explicar curso natural (2-3 sem)\n- Antitusivos si precisa\n- Broncodilatadores: valorar test terap√©utico\n\nReconsultar si:\n- Fiebre >38¬∫C persistente\n- Disnea progresiva\n- Expectoraci√≥n purulenta + fiebre >3d",
        },
        {
          category: "Prescripciones y ATB",
          id: "itu-no-complicada",
          title: "ITU no Complicada",
          shortcut: "..iu-ab",
          content:
            "ITU NO COMPLICADA - VALORACI√ìN ATB:\nCriterios diagn√≥sticos:\n‚ñ° Disuria, polaquiuria, urgencia\n‚ñ° No fiebre ni dolor lumbar\n‚ñ° No embarazo/inmunosupresi√≥n\n‚ñ° No alteraci√≥n estructural\n\nFactores a valorar:\n‚ñ° ATB previos 3 meses\n‚ñ° Resistencias locales\n‚ñ° Alergias\n‚ñ° Recurrencias previas\n\nDECISI√ìN ATB seg√∫n resistencias locales:\n- 1¬™ elecci√≥n: Fosfomicina/Nitrofuranto√≠na\n- Alternativas seg√∫n antibiograma\n- Duraci√≥n: 3-5d (excepto Fosfomicina)\n\nMedidas adicionales:\n- Hidrataci√≥n adecuada\n- Completar tratamiento\n- Medidas prevenci√≥n recurrencias",
        },

        // Situaciones Urgentes
        {
          category: "Situaciones Urgentes",
          id: "dolor-toracico",
          title: "Dolor Tor√°cico",
          shortcut: ".dt",
          content:
            "DOLOR TOR√ÅCICO:\n- Caracter√≠sticas: []. Irradiaci√≥n: []\n- Factores modificantes: []\n- Constantes: TA []/[] FC []\n- ECG: []\nActuaci√≥n: AAS, NTG si procede, valorar derivaci√≥n urgente.",
        },
        {
          category: "Situaciones Urgentes",
          id: "disnea-aguda",
          title: "Disnea Aguda",
          shortcut: ".sd",
          content:
            "DISNEA AGUDA:\n- FR: []/min. SatO2 basal: []%. Con O2: []%\n- Trabajo respiratorio: []. Uso musculatura accesoria: []\n- Constantes: TA []/[] FC []\n- Auscultaci√≥n: []\nActuaci√≥n: O2, broncodilatadores, corticoide seg√∫n proceda.",
        },

        // Seguimiento Cr√≥nicos
        {
          category: "Seguimiento Cr√≥nicos",
          id: "control-hta",
          title: "Control HTA",
          shortcut: ".hta",
          content:
            "Control HTA:\nTA actual: []/[]\nTA previas revisadas\nAdherencia terap√©utica correcta\nEfectos secundarios descartados\nFRCV controlados\nPr√≥ximo control 3m",
        },
        {
          category: "Seguimiento Cr√≥nicos",
          id: "control-dm2",
          title: "Control DM2",
          shortcut: ".2dm",
          content:
            "Control DM2:\n- HbA1c actual: []% (previa: []%)\n- Glucemias domiciliarias revisadas\n- Hipoglucemias: No referidas\n- Adherencia: Dieta / Ejercicio / F√°rmacos\n- Plan: Ajuste seg√∫n valores. Pr√≥ximo control 3m",
        },

        // Gesti√≥n y Certificados
        {
          category: "Gesti√≥n y Certificados",
          id: "tramitacion-it",
          title: "Tramitaci√≥n IT",
          shortcut: ".it",
          content:
            "Se tramita incapacidad temporal por proceso actual, reevaluar seg√∫n evoluci√≥n.",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "alta-it",
          title: "Alta de IT",
          shortcut: ".altait",
          content:
            "Paciente que acude para alta de Incapacidad Temporal. Se encuentra asintom√°tico y apto para reincorporarse a su actividad laboral. Se tramita alta con fecha de hoy.",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-asistencia",
          title: "Certificado de Asistencia",
          shortcut: ".acert",
          content:
            "CERTIFICADO DE ASISTENCIA A CONSULTA\n\nD./D√±a. [], m√©dico/a de atenci√≥n primaria, \n\nCERTIFICA:\n\nQue D./D√±a. [] ha acudido a consulta m√©dica el d√≠a de hoy en horario de [] a [] horas.\n\nY para que conste donde proceda, firmo el presente certificado.",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-basico",
          title: "Certificado M√©dico B√°sico",
          shortcut: ".cert",
          content:
            "CERTIFICADO M√âDICO\n\nD./D√±a. [], m√©dico/a colegiado/a n¬∫ [], \n\nCERTIFICA:\n\nQue D./D√±a. [], con DNI [], ha sido atendido/a en consulta en el d√≠a de hoy por [] precisando []\n\nY para que conste a los efectos oportunos, firmo el presente certificado en [Lugar] a [Fecha].",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-aptitud",
          title: "Certificado de Aptitud F√≠sica",
          shortcut: ".apcert",
          content:
            "CERTIFICADO DE APTITUD F√çSICA\n\nD./D√±a. [], m√©dico/a colegiado/a n¬∫ [], \n\nCERTIFICA:\n\nQue tras el examen m√©dico realizado a D./D√±a. [], con DNI [], no se encuentra en el momento actual contraindicaci√≥n m√©dica que le impida la realizaci√≥n de []\n\nEste certificado tiene validez de [] y se expide a petici√≥n del interesado/a en [Lugar] a [Fecha].",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-seguimiento",
          title: "Certificado de Seguimiento",
          shortcut: ".scert",
          content:
            "CERTIFICADO DE SEGUIMIENTO M√âDICO\n\nD./D√±a. [], m√©dico/a de atenci√≥n primaria, \n\nCERTIFICA:\n\nQue D./D√±a. [] se encuentra en seguimiento en esta consulta por [] desde []. \nRequiere controles peri√≥dicos cada []. \nPr√≥xima revisi√≥n prevista: []\n\nY para que conste, firmo el presente certificado en [Lugar] a [Fecha].",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-detallado",
          title: "Certificado M√©dico Detallado",
          shortcut: ".dcert",
          content:
            "CERTIFICADO M√âDICO DETALLADO\n\nD./D√±a. [], m√©dico/a especialista en [], colegiado/a n¬∫ [], \n\nCERTIFICA:\n\nQue seg√∫n los datos que constan en la historia cl√≠nica, D./D√±a. [], con DNI [], \n\nANTECEDENTES RELEVANTES:\n- []\n\nSITUACI√ìN ACTUAL:\n- []\n\nTRATAMIENTO ACTUAL:\n- []\n\nCONCLUSIONES:\n- []\n\nY para que conste a los efectos oportunos, firmo el presente certificado en [Lugar] a [Fecha].",
        },

        // Atajos Adicionales
        {
          category: "Atajos Adicionales",
          id: "constantes-vitales",
          title: "Constantes Vitales",
          shortcut: ".ta",
          content: "TA: []/[] mmHg, FC: [] lpm, SatO2: []%",
        },
        {
          category: "Atajos Adicionales",
          id: "escala-eva",
          title: "Escala EVA",
          shortcut: ".eva",
          content: "Dolor seg√∫n EVA: []/10",
        },
        {
          category: "Atajos Adicionales",
          id: "solicitud-interconsulta",
          title: "Solicitud Interconsulta",
          shortcut: ".sic",
          content:
            "Se solicita interconsulta con el servicio de [] para valoraci√≥n de [].",
        },
        {
          category: "Atajos Adicionales",
          id: "justificacion-solicitud",
          title: "Justificaci√≥n Solicitud",
          shortcut: ".jussol",
          content:
            "Justifico la solicitud de [] por sospecha diagn√≥stica de [].",
        },
        {
          category: "Atajos Adicionales",
          id: "dieta-astringente",
          title: "Dieta Astringente",
          shortcut: ".dieta",
          content:
            "Recomendaciones de dieta astringente:\n- Iniciar con l√≠quidos (agua, suero oral, infusiones, caldo de arroz).\n- Progresar seg√∫n tolerancia a: arroz cocido, zanahoria cocida, patata cocida, manzana (rallada y oxidada) o pl√°tano maduro.\n- Posteriormente introducir pollo o pescado blanco a la plancha/hervido.\n- Evitar: fritos, grasas, l√°cteos, dulces, bebidas gaseosas y verduras crudas.",
        },
        // === NUEVAS PLANTILLAS AGREGADAS ===

        // Prompts IA Cl√≠nicos
        {
          category: "Prompts IA Cl√≠nicos",
          id: "prompt-diagnostico-diferencial",
          title: "Diagn√≥stico Diferencial (RECORD)",
          shortcut: ".iadd",
          content: `PROMPT DIAGN√ìSTICO DIFERENCIAL - M√©todo RECORD:

[R] ROL: Act√∫a como m√©dico internista experto en diagn√≥stico diferencial
[E] ESENCIA: Analiza s√≠ntomas y genera diagn√≥sticos diferenciales estructurados
[C] CONTEXTO: Paciente de [] a√±os, sexo [], con antecedentes de []
[O] OBJETIVO: Listar 5 diagn√≥sticos m√°s probables con criterios diagn√≥sticos
[R] REQUISITOS: Incluir red flags, pruebas confirmatorias y prevalencia
[D] DISE√ëO: Tabla con probabilidad, criterios a favor/contra, next steps

S√çNTOMAS PRINCIPALES:
- []
- []
EXPLORACI√ìN:
- []
ANAL√çTICA DISPONIBLE:
- []`,
        },
        {
          category: "Prompts IA Cl√≠nicos",
          id: "prompt-plan-terapeutico",
          title: "Plan Terap√©utico Personalizado",
          shortcut: ".iapt",
          content: `PROMPT PLAN TERAP√âUTICO:

T√âCNICA: Chain-of-Thought + Few-Shot
ESTRUCTURA:
1. AN√ÅLISIS DEL CASO
   Diagn√≥stico: []
   Comorbilidades: []
   Alergias: []
   Interacciones: []

2. RAZONAMIENTO PASO A PASO
   ‚ñ° Objetivos terap√©uticos
   ‚ñ° Primera l√≠nea seg√∫n gu√≠as
   ‚ñ° Alternativas si contraindicaci√≥n
   ‚ñ° Ajuste por funci√≥n renal/hep√°tica

3. OUTPUT ESPERADO
   F√°rmaco | Dosis | Pauta | Duraci√≥n | Monitorizaci√≥n | Efectos adversos`,
        },
        {
          category: "Prompts IA Cl√≠nicos",
          id: "prompt-interpretacion-pruebas",
          title: "Interpretaci√≥n de Pruebas",
          shortcut: ".iaip",
          content: `PROMPT INTERPRETACI√ìN ANAL√çTICA/IMAGEN:

T√âCNICA: Zero-Shot Chain-of-Thought
"Interpreta sistem√°ticamente estos resultados siguiendo el m√©todo SOAP"

DATOS DEL PACIENTE:
Edad: [] Sexo: [] 
Motivo solicitud: []

RESULTADOS:
[]

SOLICITO:
1. Hallazgos significativos (S)
2. Interpretaci√≥n cl√≠nica (O)
3. Correlaci√≥n con sospecha (A)
4. Recomendaciones (P)

Considera valores cr√≠ticos, tendencias y contexto cl√≠nico.`,
        },
        // Fin de Prompts IA Cl√≠nicos - contin√∫an m√°s plantillas...

        // POCUS (Ecograf√≠a)
        {
          category: "POCUS (Ecograf√≠a)",
          id: "pocus-general",
          title: "Informe General",
          shortcut: ".pocusgen",
          content:
            "En general:\nTama√±o: []\nEcogenicidad: []\nMorfolog√≠a: []\nVascularizaci√≥n: []",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "doppler-mmii",
          title: "Doppler MMII",
          shortcut: ".dopmmii",
          content:
            "ECO DOPPLER DE AMBOS MIEMBROS INFERIORES\nSE EXPLORAN AMBOS MIEMBROS INFERIORES\n\nEJE PROFUNDO\nVena femoral com√∫n: normal\nVena femoral superficial: normal\nVena popl√≠tea: normal\n\nEJE SUPERFICIAL\nSafena mayor: normal\nSafena menor: normal",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "doppler-mmss",
          title: "Doppler MMSS",
          shortcut: ".dopmmss",
          content:
            "ECO DOPPLER DE MIEMBROS SUPERIORES\n- Vena yugular interna: Permeable.\n\nSistema Venoso PROFUNDO\n- Vena Subclavia: Permeable.\n- Vena Axilar: Permeable.\n- Vena Braquial: Permeable.\n- Vena Radial y Ulnar: Permeable.\n\nSistema Venoso SUPERFICIAL\n- Vena Bas√≠lica: Permeable.\n- Vena Cef√°lica: Permeable.\n- Vena mediana del antebrazo: Permeable.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-urologica",
          title: "Eco Urol√≥gica",
          shortcut: ".ecouro",
          content:
            "ECO UROL√ìGICA\n- Ri√±ones:\n  Quistes: []\n  Angiomiolipomas: []\n  Tama√±o: Normal.\n  Diferenciaci√≥n corticomedular: Normal.\n  Litiasis: No.\n  Dilataci√≥n de v√≠a: No.\n\n- Vejiga Urinaria:\n  Grado de repleci√≥n: Adecuado.\n  Paredes: Normales\n  Pr√≥stata: [] cc.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "doppler-mmii-detallado",
          title: "Doppler MMII (Detallado)",
          shortcut: ".dopmii2",
          content:
            "DOPPLER MMII\n\n*EJE PROFUNDO*\nVena femoral com√∫n: Normal.\nVena femoral: Normal.\nVena popl√≠tea: Normal.\nTroncos distales (gemelares, s√≥leas y tibioperonea): Normales.\n\n*EJE SUPERFICIAL*\nSafena mayor: Normal.\nSafena menor: Normal.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-abdominal",
          title: "Eco Abdominal",
          shortcut: ".ecoabd",
          content:
            "ECO ABDOMEN\n- H√≠gado:\n  Morfolog√≠a: Normal.\n  Ecogenicidad: Normal.\n  Lesiones focales: No.\n  V√≠a biliar: Normal.\n\n- Ves√≠cula biliar: Normal.\n- Eje esplenoportal: Normal.\n- √Årea pancre√°tica: Normal.\n- Bazo: Normal.\n\n- Ri√±ones:\n  Quistes: []\n  Angiomiolipomas: []\n  Tama√±o: Normal.\n  Dif corticomedular: Buena.\n  Dilataci√≥n pielocalicial: No.\n  Litiasis: No.\n\n- Retroperitoneo: Sin alteraciones.\n- Vejiga urinaria: Normal.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-cuello-completo",
          title: "Eco de Cuello (Completo)",
          shortcut: ".ecocuello",
          content:
            "ECO CUELLO COMPLETO\nTama√±o: []\nEcogenicidad: []\nVascularizaci√≥n: []\nN√≥dulos: []\nGanglios: []\nGl√°nd. submaxilares: []\nPar√≥tidas: []\nOtros: []",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-cuello-patologico",
          title: "Eco de Cuello (Patol√≥gico)",
          shortcut: ".ecocuello2",
          content:
            "ECO CUELLO DISMINUIDO-HETEROG√âNEO\nTama√±o: Disminuido\nEcogenicidad: Heterog√©neo\nVascularizaci√≥n: Normal\nN√≥dulos: No\nGanglios: No sospechosos\nGl√°nd. submaxilares: []\nPar√≥tidas: []\nOtros: []",
        },
        // Plantillas cr√≠ticas corregidas
        {
          category: "Patolog√≠as Frecuentes",
          id: "covid-persistente",
          title: "COVID Persistente/Long COVID",
          shortcut: ".longcov",
          content: `EVALUACI√ìN COVID PERSISTENTE (>12 semanas):

CRITERIOS DIAGN√ìSTICOS:
‚ñ° Infecci√≥n SARS-CoV-2 confirmada previa
‚ñ° S√≠ntomas >12 semanas post-infecci√≥n
‚ñ° No explicados por diagn√≥stico alternativo
‚ñ° Impacto funcional significativo

S√çNTOMAS CARDINALES:
‚ñ° Fatiga post-esfuerzo (PEM)
‚ñ° Disnea persistente
‚ñ° Niebla mental/cognitiva
‚ñ° Disautonom√≠a (POTS)

EVALUACI√ìN SISTEM√ÅTICA:
Respiratorio: []
Cardiovascular: []
Neurol√≥gico: []
Psiqui√°trico: []
Digestivo: []
Musculoesquel√©tico: []

PRUEBAS B√ÅSICAS:
‚ñ° Hemograma, PCR, ferritina
‚ñ° TSH, vitamina D, B12
‚ñ° ECG si s√≠ntomas CV
‚ñ° Espirometr√≠a si disnea

PLAN:
‚ñ° Rehabilitaci√≥n gradual
‚ñ° Pacing de actividades
‚ñ° Sintom√°tico espec√≠fico
‚ñ° Apoyo psicol√≥gico`,
        },
        {
          category: "Prescripciones y ATB",
          id: "reconciliacion-medicamentos",
          title: "Reconciliaci√≥n Medicaci√≥n",
          shortcut: ".recon",
          content: `RECONCILIACI√ìN DE MEDICACI√ìN:

MEDICACI√ìN DOMICILIARIA PREVIA:
1. [] - [] mg - [] - Desde: []
2. [] - [] mg - [] - Desde: []
3. [] - [] mg - [] - Desde: []

CAMBIOS DURANTE INGRESO/URGENCIAS:
‚ñ° Suspendidos: []
‚ñ° A√±adidos: []
‚ñ° Modificados: []

MEDICACI√ìN ACTUAL RECONCILIADA:
1. [] - [] mg - [] - Indicaci√≥n: []
2. [] - [] mg - [] - Indicaci√≥n: []

VERIFICACI√ìN:
‚ñ° Alergias revisadas
‚ñ° Interacciones comprobadas
‚ñ° Duplicidades eliminadas
‚ñ° Dosis ajustadas (renal/hep√°tica)
‚ñ° Adherencia evaluada

EDUCACI√ìN AL PACIENTE:
‚ñ° Cambios explicados
‚ñ° Horarios clarificados
‚ñ° Efectos adversos informados
‚ñ° Pr√≥xima revisi√≥n: []`,
        },
        // --- INICIA EL C√ìDIGO FINAL Y CORRECTO A PEGAR ---

        // Plantillas de 'Sick Day Rules' (versi√≥n texto plano)
        {
          category: "Prescripciones y ATB",
          id: "sick-day-rules-clinico",
          title: "Recomendaciones 'Sick Day' (Cl√≠nico)",
          shortcut: ".sdr",
          content: `RECOMENDACIONES PARA D√çAS DE ENFERMEDAD (PAUSA DE F√ÅRMACOS):\nSe educa al paciente sobre la necesidad de pausar temporalmente ciertos medicamentos en caso de enfermedad aguda con riesgo de deshidrataci√≥n (v√≥mitos, diarrea, fiebre que impida una correcta ingesta de l√≠quidos).\n\nCondiciones para la pausa:\n- Incapacidad para mantener una ingesta de l√≠quidos adecuada.\n- V√≥mitos o diarrea significativos.\n\nMedicaci√≥n a pausar (Regla SAD MANS):\n- S: Sulfonilureas (ej. Gliclazida, Glimepirida)\n- A: ARA-II (ej. Losart√°n, Candesart√°n)\n- D: Diur√©ticos (ej. Furosemida, HCTZ)\n- M: Metformina\n- A: IECAs (ej. Ramipril, Enalapril)\n- N: AINEs (ej. Ibuprofeno, Naproxeno)\n- S: iSGLT2 (ej. Empagliflozina, Dapagliflozina)\n\nInstrucciones dadas:\n- Reanudar la medicaci√≥n 24-48h despu√©s de resolver el cuadro y tolerar dieta y l√≠quidos con normalidad.\n- Aumentar la frecuencia de controles de glucemia capilar.\n- Se explican signos de alarma (confusi√≥n, mareo intenso, no orinar) para buscar atenci√≥n m√©dica urgente.\n- Paciente comprende y verbaliza acuerdo: []`,
        },
        {
          category: "Prescripciones y ATB",
          id: "sick-day-rules-paciente",
          title: "Instrucciones 'Sick Day' (Paciente)",
          shortcut: ".sdi",
          content: `INSTRUCCIONES PARA D√çAS DE ENFERMEDAD (V√ìMITOS, DIARREA, FIEBRE)\n\nSi tiene una enfermedad aguda y corre riesgo de deshidrataci√≥n (no puede beber l√≠quidos con normalidad), siga estos dos pasos:\n\nPASO 1: SUSPENDA TEMPORALMENTE los siguientes medicamentos para prevenir complicaciones renales:\n- []\n\nPASO 2: REANUDE SU MEDICACI√ìN cuando se cumplan estas dos condiciones:\n1. Sus s√≠ntomas (v√≥mitos, diarrea, etc.) hayan desaparecido.\n2. Lleve entre 24 y 48 horas comiendo y bebiendo con normalidad.\n\nIMPORTANTE:\n- Mientras est√© enfermo/a, beba peque√±os sorbos de l√≠quidos (agua, suero) con frecuencia.\n- Si es diab√©tico/a, mida su az√∫car m√°s a menudo.\n- NO TOME antiinflamatorios (como Ibuprofeno) por su cuenta.\n\n¬øCU√ÅNDO BUSCAR AYUDA M√âDICA?\n- Si los s√≠ntomas duran m√°s de 72 horas (3 d√≠as).\n- Si se siente muy mareado/a, confundido/a o deja de orinar.\n- Si tiene cualquier duda, consulte con su m√©dico, enfermera o farmac√©utico.`,
        },
        {
          category: "Prescripciones y ATB",
          id: "sick-day-rules-breve",
          title: "Aviso 'Sick Day' (Breve)",
          shortcut: ".sdt",
          content:
            "Suspender temporalmente si por enfermedad tiene v√≥mitos, diarrea, fiebre alta o no puede beber.",
        },

        // --- FINALIZA EL C√ìDIGO FINAL Y CORRECTO A PEGAR ---
        // Categor√≠a Acerca de
        {
          category: "‚ÑπÔ∏è Acerca de",
          id: "sobre-proyecto",
          title: "Sobre este Proyecto",
          shortcut: ".info",
          content: `<h3>Plantillas Cl√≠nicas para Atenci√≥n Primaria</h3>

<p><strong>Valor educativo y asistencial</strong></p>
<p>Esta herramienta representa un avance significativo en la optimizaci√≥n del tiempo cl√≠nico en Atenci√≥n Primaria. Estudios demuestran que los m√©dicos de AP dedican hasta un 50% de su tiempo a tareas administrativas y documentaci√≥n.</p>

<p><strong>Beneficios documentados</strong></p>
<ul>
  <li>Reducci√≥n del 40-60% en tiempo de documentaci√≥n</li>
  <li>Mejora en la completitud de historias cl√≠nicas</li>
  <li>Estandarizaci√≥n de la pr√°ctica basada en evidencia</li>
  <li>Disminuci√≥n del burnout profesional</li>
  <li>Mayor tiempo para atenci√≥n directa al paciente</li>
</ul>

<p><strong>Integraci√≥n con HCE</strong></p>
<p>Las plantillas est√°n dise√±adas para ser compatibles con cualquier sistema de Historia Cl√≠nica Electr√≥nica que permita entrada de texto. Los atajos r√°pidos agilizan la documentaci√≥n sin comprometer la calidad.</p>

<p><strong>Basado en evidencia</strong></p>
<p>Gu√≠as SEMFYC/SEMERGEN 2024-2025, protocolos actualizados seg√∫n √∫ltimas publicaciones, criterios diagn√≥sticos internacionales vigentes y recomendaciones de sociedades cient√≠ficas.</p>

<p><em>Desarrollado por profesionales para profesionales. Uso libre para fines educativos y asistenciales.</em></p>`,
        },
        {
          category: "‚ÑπÔ∏è Acerca de",
          id: "privacidad-datos",
          title: "Privacidad y Almacenamiento",
          shortcut: ".priv",
          content: `<h3>Pol√≠tica de Privacidad y Datos</h3>

<p><strong>Almacenamiento local</strong></p>
<p>Esta aplicaci√≥n funciona completamente en tu navegador:</p>
<ul>
  <li>No se env√≠an datos a ning√∫n servidor</li>
  <li>No se requiere registro ni identificaci√≥n</li>
  <li>No se recopilan datos personales o cl√≠nicos</li>
  <li>No hay cookies de tracking o an√°lisis</li>
</ul>

<p><strong>Seguridad</strong></p>
<p>Sin conexi√≥n a bases de datos externas. Sin transmisi√≥n de informaci√≥n sensible. Funcionamiento 100% offline una vez cargada. Compatible con navegaci√≥n privada/inc√≥gnito.</p>

<p><strong>Recomendaciones importantes</strong></p>
<ul>
  <li>No introduzcas datos reales de pacientes</li>
  <li>Usa solo como plantilla base para tu pr√°ctica</li>
  <li>Adapta el contenido a cada caso espec√≠fico</li>
  <li>Verifica siempre la informaci√≥n cl√≠nica</li>
</ul>

<p><strong>Cumplimiento normativo</strong></p>
<p>Esta herramienta cumple con RGPD (Reglamento General de Protecci√≥n de Datos) y LOPD-GDD (Ley Org√°nica de Protecci√≥n de Datos).</p>

<p><em>Para eliminar todos los datos locales: Configuraci√≥n navegador > Privacidad > Borrar datos de navegaci√≥n</em></p>`,
        },
        {
          category: "‚ÑπÔ∏è Acerca de",
          id: "instrucciones-uso",
          title: "Instrucciones de Uso",
          shortcut: ".ayuda",
          content: `üìñ GU√çA R√ÅPIDA DE USO

NAVEGACI√ìN:
- Click en categor√≠as laterales para filtrar
- Usa la b√∫squeda para encontrar plantillas espec√≠ficas
- Los atajos (.an, .ef, etc.) facilitan el acceso r√°pido

EDICI√ìN DE PLANTILLAS:
- Los campos en [corchetes] son editables
- Click en el campo amarillo para modificar
- El contenido se puede editar directamente
- Bot√≥n "Deshacer" restaura el original

SISTEMA DE FAVORITOS:
- Click en ‚≠ê para marcar favoritos
- Accede a tus favoritos desde la categor√≠a superior
- Los favoritos se mantienen entre sesiones

COPIAR PLANTILLAS:
- Click en "üìã Copiar" para copiar al portapapeles
- Pega directamente en tu HCE (Ctrl+V)
- Compatible con cualquier sistema que acepte texto

ATAJOS DE TECLADO:
- Ctrl+F: Activar b√∫squeda
- ESC: Limpiar b√∫squeda
- Tab: Navegar entre campos editables

M√âTODO RECORD (Prompts IA):
Basado en el framework publicado en Zenodo
DOI: 10.5281/zenodo.11080812
Los prompts siguen estructura validada para IA cl√≠nica

USO EN HCE:
1. Busca la plantilla necesaria
2. Edita los campos seg√∫n el caso
3. Copia al portapapeles
4. Pega en tu Historia Cl√≠nica Electr√≥nica

üí° TIP: Guarda esta p√°gina en favoritos del navegador para acceso r√°pido durante la consulta`,
        },
        {
          category: "‚ÑπÔ∏è Acerca de",
          id: "metodo-record-info",
          title: "M√©todo RECORD para Prompts IA",
          shortcut: ".record",
          content: `ü§ñ M√âTODO RECORD - PROMPTS ESTRUCTURADOS PARA IA

PUBLICACI√ìN CIENT√çFICA:
Barrera-Linares, E (2024). M√©todo RECORD para escribir Prompts en ChatGPT.
üìÑ DOI: <a href="https://zenodo.org/records/11080812" target="_blank" style="color: #3498db;">10.5281/zenodo.11080812</a>

¬øQU√â ES RECORD?
Estructura mnemot√©cnica validada para optimizar la interacci√≥n con IA en el √°mbito sanitario:

R - ROL O PERSONALIDAD
Define el experto que necesitas que sea la IA
Ejemplo: "Act√∫a como m√©dico internista experto"

E - ESENCIA O MISI√ìN  
Establece el prop√≥sito principal del prompt
Ejemplo: "Analiza estos s√≠ntomas para diagn√≥stico diferencial"

C - CONTEXTO
Proporciona informaci√≥n relevante del caso
Ejemplo: "Paciente de 65 a√±os, diab√©tico, con HTA"

O - OBJETIVO
Especifica el resultado deseado
Ejemplo: "Lista los 5 diagn√≥sticos m√°s probables"

R - REQUISITOS O DETALLES
Incluye especificaciones adicionales
Ejemplo: "Ordena por probabilidad, incluye red flags"

D - DISE√ëO O FORMATO
Define c√≥mo presentar la respuesta
Ejemplo: "Tabla con diagn√≥stico, criterios y pruebas"

VENTAJAS DEL M√âTODO:
‚úÖ Respuestas m√°s precisas y relevantes
‚úÖ Reducci√≥n de ambig√ºedad en las consultas
‚úÖ Estructura reproducible y ense√±able
‚úÖ Validado en entorno cl√≠nico real
‚úÖ Mejora la calidad de la informaci√≥n obtenida

APLICACIONES EN MEDICINA:
- Diagn√≥stico diferencial
- Planes terap√©uticos
- Interpretaci√≥n de pruebas
- Educaci√≥n al paciente
- Revisi√≥n farmacol√≥gica
- B√∫squeda bibliogr√°fica`,
        },
      ];

      // --- L√ìGICA DE LA APLICACI√ìN ---
      let currentCategory = "";
      let originalContents = new Map();

      const categoryIcons = {
        "Anamnesis y Exploraci√≥n": "üîç",
        "Patolog√≠as Frecuentes": "üè•",
        "Prescripciones y ATB": "üíä",
        "Situaciones Urgentes": "üö®",
        "Seguimiento Cr√≥nicos": "üìä",
        "Gesti√≥n y Certificados": "üìã",
        "Atajos Adicionales": "‚ö°",
        "POCUS (Ecograf√≠a)": "üì°",
        "Prompts IA Cl√≠nicos": "ü§ñ",
        "Prevenci√≥n y Cribados": "üõ°Ô∏è",
        "Salud Mental": "üß†",
        "Pediatr√≠a en AP": "üë∂",
        "T√©cnicas y Procedimientos": "üíâ",
        Geriatr√≠a: "üë¥",
        "‚ÑπÔ∏è Acerca de": "‚ÑπÔ∏è",
      };

      function init() {
        renderCategories();
        renderTemplates();
        setupEventListeners();

        // Cargar favoritos del localStorage
        favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
        updateFavoriteCount();
        updateFavoriteStars();

        // Mostrar primera categor√≠a por defecto
        const categories = [...new Set(templates.map((t) => t.category))];
        if (categories.length > 0) {
          showCategory(categories[0]);
        }
      }

      function renderCategories() {
        const categoryList = document.getElementById("category-list");
        let categories = [...new Set(templates.map((t) => t.category))];

        // Mover "Acerca de" al final
        const aboutIndex = categories.indexOf("‚ÑπÔ∏è Acerca de");
        if (aboutIndex > -1) {
          categories.splice(aboutIndex, 1);
          categories.push("‚ÑπÔ∏è Acerca de");
        }

        // A√±adir categor√≠a de favoritos al principio
        let categoriesHTML = `
    <div class="category-item" data-category="favoritos" onclick="showFavorites()">
      <span>‚≠ê</span>
      <span>Favoritos (<span id="fav-count">0</span>)</span>
    </div>
    <hr style="margin: 10px 0; border: none; border-top: 1px solid #e0e0e0;">
  `;

        // A√±adir todas las categor√≠as excepto "Acerca de"
        const clinicalCategories = categories.filter(
          (cat) => cat !== "‚ÑπÔ∏è Acerca de"
        );
        categoriesHTML += clinicalCategories
          .map(
            (category) => `
        <div class="category-item" data-category="${category}" onclick="showCategory('${category}')">
          <span>${categoryIcons[category] || "üìÅ"}</span>
          <span>${category}</span>
        </div>
      `
          )
          .join("");

        // A√±adir separador y "Acerca de" al final
        categoriesHTML += `
    <hr style="margin: 10px 0; border: none; border-top: 1px solid #e0e0e0;">
    <div class="category-item" data-category="‚ÑπÔ∏è Acerca de" onclick="showCategory('‚ÑπÔ∏è Acerca de')">
      <span>‚ÑπÔ∏è</span>
      <span>Acerca de</span>
    </div>
  `;

        categoryList.innerHTML = categoriesHTML;
        updateFavoriteCount();
      }

      function renderTemplates(searchTerm = "") {
        const container = document.getElementById("templates-container");
        const categories = [...new Set(templates.map((t) => t.category))];
        container.innerHTML = "";

        categories.forEach((category) => {
          const categoryTemplates = templates.filter((t) => {
            if (t.category !== category) return false;
            if (searchTerm) {
              const search = searchTerm.toLowerCase();
              return (
                t.title.toLowerCase().includes(search) ||
                t.shortcut.toLowerCase().includes(search) ||
                t.content.toLowerCase().includes(search)
              );
            }
            return true;
          });

          if (categoryTemplates.length === 0) return;

          // Si es "Acerca de", crear layout especial
          if (category === "‚ÑπÔ∏è Acerca de") {
            const section = document.createElement("div");
            section.className = "about-section-wrapper";
            section.id = `category-${category
              .replace(/[\s&]+/g, "-")
              .toLowerCase()}`;

            let aboutContent = `
        <div class="about-header">
          <h1>‚ÑπÔ∏è Acerca de Plantillas Cl√≠nicas AP</h1>
        </div>
        <div class="about-container">
      `;

            categoryTemplates.forEach((template, index) => {
              aboutContent += `
          <section class="about-content-block">
            <h2>${template.title}</h2>
            <div class="about-text">${template.content}</div>
          </section>
          ${
            index < categoryTemplates.length - 1
              ? '<hr class="about-separator">'
              : ""
          }
        `;
            });

            aboutContent += `</div>`;
            section.innerHTML = aboutContent;
            container.appendChild(section);
          } else {
            // Para el resto de categor√≠as, usar tarjetas normales
            const section = document.createElement("div");
            section.className = "category-section";
            section.id = `category-${category
              .replace(/[\s&]+/g, "-")
              .toLowerCase()}`;
            section.innerHTML = `
        <h2 class="category-header">
          ${categoryIcons[category] || "üìÅ"} ${category}
        </h2>
        <div class="templates-grid">
          ${categoryTemplates
            .map((template) => createTemplateCard(template))
            .join("")}
        </div>
      `;
            container.appendChild(section);
          }
        });

        const emptyState = document.getElementById("empty-state");
        emptyState.style.display =
          container.children.length === 0 ? "block" : "none";
        processAllEditableFields();
      }

      function createTemplateCard(template) {
        let content = template.content;
        if (template.category === "Gesti√≥n y Certificados") {
          const today = new Date().toLocaleDateString("es-ES", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          });
          content = content.replace(/\[Fecha\]/g, `[${today}]`);
        }

        return `
    <div class="template-card" id="card-${template.id}">
      <div class="edit-indicator">Editado</div>
      <div class="template-header">
        <h3 class="template-title">${template.title}</h3>
        <span class="shortcut-badge">${template.shortcut}</span>
      </div>
      <div class="template-content" 
           contenteditable="true" 
           data-template-id="${template.id}"
           oninput="handleContentEdit(this)">${content}</div>
      <button class="btn-favorite" 
          onclick="toggleFavorite('${template.id}')"
          style="position: absolute; top: 5px; left: 5px; background: none; border: none; font-size: 18px; cursor: pointer; z-index: 10; color: #f39c12;">
        <span id="fav-${template.id}">‚òÜ</span>
      </button>
      <div class="button-group">
        <button class="btn tooltip" 
                onclick="copyTemplate('${template.id}')"
                data-tooltip="Copiar al portapapeles">
          üìã Copiar
        </button>
        <button class="btn btn-secondary tooltip" 
                onclick="resetTemplate('${template.id}')"
                data-tooltip="Restaurar original"
                id="reset-${template.id}"
                disabled>
          ‚Ü©Ô∏è Deshacer
        </button>
      </div>
    </div>
  `;
      }

      function processEditableFields(contentElement) {
        // Verificar si es contenido informativo
        const templateId = contentElement.dataset.templateId;
        const template = templates.find((t) => t.id === templateId);

        if (template && template.category === "‚ÑπÔ∏è Acerca de") {
          // No procesar campos editables en contenido informativo
          return;
        }

        if (!originalContents.has(contentElement.dataset.templateId)) {
          originalContents.set(
            contentElement.dataset.templateId,
            contentElement.innerHTML
          );
        }
        const text = contentElement.innerHTML;

        // Procesar campos editables pero excluir acr√≥sticos RECORD
        const processed = text.replace(/\[(.*?)\]/g, (match, p1) => {
          // Si es un acr√≥stico de una sola letra seguido de ], es parte del m√©todo RECORD
          if (p1.length === 1 && /[RECODE]/.test(p1)) {
            return `<span class="record-label">[${p1}]</span>`;
          }
          // Si no, es un campo editable normal
          return `<span class="editable-field" contenteditable="true" onclick="event.stopPropagation()">${p1}</span>`;
        });

        if (contentElement.innerHTML !== processed) {
          contentElement.innerHTML = processed;
        }
      }

      function processAllEditableFields() {
        document.querySelectorAll(".template-content").forEach((content) => {
          processEditableFields(content);
        });
      }

      function handleContentEdit(element) {
        const templateId = element.dataset.templateId;
        const card = document.getElementById(`card-${templateId}`);
        const resetBtn = document.getElementById(`reset-${templateId}`);
        const originalContent = originalContents.get(templateId);
        if (element.innerHTML.trim() !== originalContent.trim()) {
          element.classList.add("edited");
          card.classList.add("has-changes");
          resetBtn.disabled = false;
        } else {
          element.classList.remove("edited");
          card.classList.remove("has-changes");
          resetBtn.disabled = true;
        }
      }

      function copyTemplate(templateId) {
        const contentEl = document.querySelector(
          `[data-template-id="${templateId}"]`
        );
        const cleanedText = contentEl.innerText.replace(/‚ñ°/g, "");
        navigator.clipboard
          .writeText(cleanedText)
          .then(() => {
            showNotification("‚úÖ Plantilla copiada al portapapeles", "success");
          })
          .catch((err) => {
            const textarea = document.createElement("textarea");
            textarea.value = cleanedText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
            showNotification("‚úÖ Plantilla copiada", "success");
          });
      }

      function resetTemplate(templateId) {
        const content = document.querySelector(
          `[data-template-id="${templateId}"]`
        );
        const card = document.getElementById(`card-${templateId}`);
        const resetBtn = document.getElementById(`reset-${templateId}`);
        const originalContent = originalContents.get(templateId);
        if (originalContent) {
          content.innerHTML = originalContent;
          content.classList.remove("edited");
          card.classList.remove("has-changes");
          resetBtn.disabled = true;
          processEditableFields(content);
          showNotification("‚Ü©Ô∏è Plantilla restaurada", "info");
        }
      }

      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = "block";
        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }
      function showFavorites() {
        // Marcar favoritos como activo en sidebar
        document.querySelectorAll(".category-item").forEach((item) => {
          item.classList.toggle(
            "active",
            item.dataset.category === "favoritos"
          );
        });

        // Renderizar solo plantillas favoritas
        const container = document.getElementById("templates-container");
        const favoriteTemplates = templates.filter((t) =>
          favorites.includes(t.id)
        );

        if (favoriteTemplates.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>‚≠ê No tienes plantillas favoritas</h3>
              <p>Marca plantillas como favoritas haciendo clic en la estrella</p>
            </div>
          `;
          return;
        }

        container.innerHTML = `
          <div class="category-section">
            <h2 class="category-header">
              ‚≠ê Plantillas Favoritas
            </h2>
            <div class="templates-grid">
              ${favoriteTemplates
                .map((template) => createTemplateCard(template))
                .join("")}
            </div>
          </div>
        `;

        processAllEditableFields();
        updateFavoriteStars();
      }

      function updateFavoriteCount() {
        const countElement = document.getElementById("fav-count");
        if (countElement) {
          countElement.textContent = favorites.length;
        }
      }

      function updateFavoriteStars() {
        favorites.forEach((id) => {
          const star = document.getElementById(`fav-${id}`);
          if (star) star.textContent = "‚òÖ";
        });
      }
      function showCategory(category) {
        currentCategory = category;
        document.querySelectorAll(".category-item").forEach((item) => {
          item.classList.toggle("active", item.dataset.category === category);
        });
        const categoryElement = document.getElementById(
          `category-${category.replace(/[\s&]+/g, "-").toLowerCase()}`
        );
        if (categoryElement) {
          categoryElement.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function setupEventListeners() {
        const searchBox = document.getElementById("searchBox");
        let searchTimeout;
        searchBox.addEventListener("input", (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            renderTemplates(e.target.value);
          }, 300);
        });
        document.addEventListener("keydown", (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === "f") {
            e.preventDefault();
            searchBox.focus();
          }
          if (e.key === "Escape" && document.activeElement === searchBox) {
            searchBox.value = "";
            renderTemplates();
          }
        });
        window.addEventListener("beforeunload", (e) => {
          if (document.querySelector(".template-card.has-changes")) {
            e.preventDefault();
            e.returnValue =
              "¬øEst√°s seguro? Hay cambios sin guardar en las plantillas.";
          }
        });
        // Sincronizar categor√≠a activa con scroll
        let scrollTimeout;
        window.addEventListener("scroll", () => {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => {
            const sections = document.querySelectorAll(".category-section");
            const scrollPosition = window.scrollY + 200;

            sections.forEach((section) => {
              const top = section.offsetTop;
              const height = section.offsetHeight;

              if (scrollPosition >= top && scrollPosition < top + height) {
                const categoryName = section
                  .querySelector(".category-header")
                  .textContent.trim();
                // Eliminar emoji y espacios
                const cleanCategory = categoryName.substring(2).trim();

                document.querySelectorAll(".category-item").forEach((item) => {
                  item.classList.toggle(
                    "active",
                    item.dataset.category === cleanCategory
                  );
                });
              }
            });
          }, 100);
        });
      }

      document.addEventListener("DOMContentLoaded", init);
      // Sistema de favoritos
      let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      function clearSearch() {
        const searchBox = document.getElementById("searchBox");
        searchBox.value = "";
        searchBox.focus();
        renderTemplates();
      }
      function toggleFavorite(templateId) {
        event.stopPropagation(); // Prevenir que se active el click de la tarjeta
        const index = favorites.indexOf(templateId);
        if (index > -1) {
          favorites.splice(index, 1);
          document.getElementById(`fav-${templateId}`).textContent = "‚òÜ";
        } else {
          favorites.push(templateId);
          document.getElementById(`fav-${templateId}`).textContent = "‚òÖ";
        }
        localStorage.setItem("favorites", JSON.stringify(favorites));
        updateFavoriteCount();
      }

      // Actualizar estrellas al cargar
      setTimeout(() => {
        favorites.forEach((id) => {
          const star = document.getElementById(`fav-${id}`);
          if (star) star.textContent = "‚òÖ";
        });
      }, 100);
    </script>
  </body>
</html>
