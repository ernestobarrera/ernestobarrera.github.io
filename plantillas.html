<!--
=====================
  plantillas.html
  Macros y plantillas médicas 
=====================
-->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta
      name="description"
      content="Sistema de atajos y plantillas clínicas editables para la Historia Clínica Electrónica (HCE), diseñado para optimizar el tiempo en consulta."
    />
    <meta name="author" content="Ernesto Barrera" />
    <link rel="icon" href="assets/images/icon.webp" />
    <title>Plantillas Clínicas | @ernestob</title>

    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Plantillas Clínicas Editables | @ernestob"
    />
    <meta
      property="og:site_name"
      content="Herramienta de productividad para profesionales sanitarios"
    />
    <meta
      property="og:url"
      content="https://ernestobarrera.github.io/plantillas.html"
    />
    <meta
      property="og:image"
      content="https://ernestobarrera.github.io/assets/images/me.png"
    />
    <meta property="article:author" content="https://twitter.com/ernestob" />

    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/header.css" />
    <link rel="stylesheet" href="assets/css/components.css" />
    <link rel="stylesheet" href="assets/css/footer.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
    />

    <style>
      /* --- ESTILOS DE LA HERRAMIENTA DE PLANTILLAS --- */
      /* Reseteo y cuerpo de la herramienta */
      .tool-body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
          sans-serif;
        background: #f0f4f8;
        line-height: 1.6;
        padding-top: 60px; /* Ajuste para el header fijo del sitio */
      }

      .tool-body * {
        box-sizing: border-box;
      }

      .tool-header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        width: 100%;
        top: 60px; /* Se posiciona debajo del header principal */
        left: 0;
        z-index: 999;
      }

      .tool-header h1,
      .tool-header p {
        margin: 0;
        padding: 0;
      }

      .tool-container {
        display: flex;
        max-width: 1600px;
        margin: 160px auto 20px; /* Mayor margen top para separar del header */
        gap: 20px;
        padding: 20px;
      }
      .sidebar {
        width: 280px;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 150px; /* Mismo nivel que búsqueda */
        height: calc(100vh - 180px);
        overflow-y: auto;
        flex-shrink: 0; /* Evita que se comprima */
      }

      .sidebar h2 {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.3em;
      }

      .category-item {
        padding: 12px 16px;
        margin: 5px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #555;
      }

      .category-item:hover {
        background: #f0f4f8;
        transform: translateX(5px);
      }

      .category-item.active {
        background: #3498db;
        color: white;
      }

      .tool-main-content {
        flex: 1;
        min-width: 0; /* Permite que se ajuste correctamente */
      }

      #templates-container {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .search-container {
        background: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 140px; /* Mismo valor que sidebar */
        z-index: 99;
      }

      .search-wrapper {
        position: relative;
        display: flex;
        align-items: center;
      }

      .search-box {
        width: 100%;
        padding: 15px 45px 15px 15px;
        font-size: 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        transition: all 0.3s;
      }

      .clear-search {
        position: absolute;
        right: 10px;
        background: none;
        border: none;
        font-size: 20px;
        color: #999;
        cursor: pointer;
        padding: 5px 10px;
        display: none;
        transition: color 0.3s;
      }

      .clear-search:hover {
        color: #3498db;
      }

      .search-box:not(:placeholder-shown) + .clear-search {
        display: block;
      }

      .search-box:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .category-section {
        margin-bottom: 40px;
        scroll-margin-top: 180px; /* Offset for sticky headers */
      }

      .category-header {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #3498db;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5em;
      }

      .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
      }

      .template-card {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        background: #f8f9fa;
        transition: all 0.3s;
        position: relative;
      }

      .template-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border-color: #3498db;
      }

      .template-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .template-title {
        font-size: 1.1em;
        color: #2c3e50;
        font-weight: 600;
        flex: 1;
      }

      .shortcut-badge {
        background: #3498db;
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85em;
        font-family: monospace;
        margin-left: 10px;
      }

      .template-content {
        background: white;
        padding: 15px;
        border-radius: 8px;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.8;
        white-space: pre-wrap;
        height: 250px;
        overflow-y: auto;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        position: relative;
        color: #2c3e50; /* <-- ESTA ES LA LÍNEA AÑADIDA */
      }

      .template-content:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .template-content.edited {
        background-color: #fffef0;
        border-color: #f39c12;
      }

      .editable-field {
        background: #fff9e6;
        padding: 2px 8px;
        border-radius: 4px;
        border: 2px dashed #f39c12;
        color: #856404;
        cursor: text;
        display: inline;
        min-width: 60px;
        line-height: inherit;
        vertical-align: baseline;
        transition: all 0.2s;
        font-weight: 500;
        margin: 0 2px;
        font-family: inherit;
        font-size: inherit;
        position: relative;
        white-space: nowrap;
      }

      .editable-field:empty {
        display: inline-block;
        min-width: 80px;
      }

      .editable-field:empty:before {
        content: "___";
        color: #ccc;
      }

      .editable-field:hover {
        background: #ffeaa7;
        border-style: solid;
      }

      .editable-field:focus {
        background: white;
        border-color: #3498db;
        color: #2c3e50;
        outline: none;
      }
      .record-label {
        display: inline-block;
        background: #3498db;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-weight: bold;
        font-size: 12px;
        margin-right: 5px;
        vertical-align: middle;
      }
      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
      }

      .btn:hover {
        background: #2980b9;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #95a5a6;
      }

      .btn-secondary:hover {
        background: #7f8c8d;
      }

      .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
      }

      .edit-indicator {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #f39c12;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .template-card.has-changes .edit-indicator {
        opacity: 1;
      }

      .notification {
        position: fixed;
        top: 180px; /* Debajo de los dos headers */
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .notification.success {
        background: #27ae60;
        color: white;
      }
      .notification.info {
        background: #3498db;
        color: white;
      }

      .tooltip {
        position: relative;
      }
      .tooltip::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background: #2c3e50;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        white-space: nowrap;
        font-size: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }

      .tooltip:hover::after {
        opacity: 1;
      }

      .empty-state {
        text-align: center;
        padding: 60px;
        color: #7f8c8d;
      }

      .empty-state h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
      }

      .sidebar::-webkit-scrollbar,
      .template-content::-webkit-scrollbar {
        width: 8px;
      }
      .sidebar::-webkit-scrollbar-track,
      .template-content::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .sidebar::-webkit-scrollbar-thumb,
      .template-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }
      .sidebar::-webkit-scrollbar-thumb:hover,
      .template-content::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
      /* Estilos para sección Acerca de */
      .info-card {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        border: none;
        cursor: default;
      }

      .info-card:hover {
        transform: none;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        border-color: transparent;
      }

      .info-content {
        background: white;
        cursor: default;
        height: auto;
        max-height: 400px;
        line-height: 1.8;
        color: #2c3e50;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 15px;
      }

      .info-content:focus {
        outline: none;
        border-color: #e0e0e0;
        box-shadow: none;
      }

      .info-content h3 {
        color: #2c3e50;
        margin: 20px 0 10px 0;
        font-size: 1.1em;
      }

      .info-content ul {
        margin: 10px 0;
        padding-left: 25px;
      }

      .info-content ul li {
        margin: 8px 0;
        line-height: 1.6;
      }

      .info-content a {
        color: #3498db;
        text-decoration: none;
      }

      .info-content a:hover {
        text-decoration: underline;
      }

      .info-card .template-header {
        background: rgba(255, 255, 255, 0.9);
        padding: 10px 15px;
        border-radius: 8px 8px 0 0;
        margin: -20px -20px 15px -20px;
      }
      /* Layout especial para sección "Acerca de" */
      .about-section-wrapper {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-bottom: 40px;
      }

      .about-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px;
        text-align: center;
      }

      .about-header h1 {
        margin: 0;
        font-size: 2em;
        font-weight: 600;
      }

      .about-container {
        padding: 40px;
        max-width: 900px;
        margin: 0 auto;
      }

      .about-content-block {
        margin-bottom: 40px;
      }

      .about-content-block h2 {
        color: #2c3e50;
        font-size: 1.5em;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #3498db;
      }

      .about-text {
        color: #444;
        line-height: 1.8;
        font-size: 16px;
      }

      .about-text h3 {
        color: #2c3e50;
        margin: 25px 0 15px 0;
        font-size: 1.2em;
      }

      .about-text p {
        margin: 15px 0;
      }

      .about-text ul {
        margin: 15px 0;
        padding-left: 30px;
      }

      .about-text ul li {
        margin: 10px 0;
        line-height: 1.6;
      }

      .about-text strong {
        color: #2c3e50;
        font-weight: 600;
      }

      .about-text em {
        color: #666;
        font-style: italic;
      }

      .about-text a {
        color: #3498db;
        text-decoration: none;
        border-bottom: 1px solid transparent;
        transition: border-color 0.3s;
      }

      .about-text a:hover {
        border-bottom-color: #3498db;
      }

      .about-separator {
        border: none;
        border-top: 1px solid #e0e0e0;
        margin: 40px 0;
      }

      /* Mejorar altura de tarjetas con contenido extenso */
      .template-content {
        background: white;
        padding: 15px;
        border-radius: 8px;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.8;
        white-space: pre-wrap;
        min-height: 150px;
        max-height: 250px;
        overflow: hidden;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        position: relative;
        color: #2c3e50;
      }

      /* Expandir tarjetas al hover */
      .template-card:hover .template-content {
        max-height: 600px;
        overflow-y: auto;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        z-index: 10;
      }

      /* Indicador de más contenido */
      .template-content::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 40px;
        background: linear-gradient(to bottom, transparent, white);
        pointer-events: none;
        opacity: 1;
        transition: opacity 0.3s;
      }

      .template-card:hover .template-content::after {
        opacity: 0;
      }
      /* Responsive */
      @media (max-width: 1200px) {
        .tool-container {
          flex-direction: column;
          margin-top: 160px;
        }

        .search-container {
          position: static;
          margin-bottom: 20px;
        }
        .sidebar {
          width: 280px;
          background: white;
          border-radius: 10px;
          padding: 20px;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          position: sticky;
          top: 140px; /* Fijo respecto al header */
          height: calc(100vh - 160px);
          overflow-y: auto;
          flex-shrink: 0;
        }
        .templates-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 768px) {
        .tool-header {
          background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
          color: white;
          padding: 20px;
          text-align: center;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
          position: fixed;
          width: 100%;
          top: 60px;
          left: 0;
          z-index: 999;
          height: 80px; /* Altura fija */
        }
        .tool-container {
          margin-top: 120px;
        }
        .sidebar {
          top: 130px;
        }
        .category-section {
          margin-bottom: 40px;
          scroll-margin-top: 150px; /* Ajustado para headers fijos */
        }
        .templates-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body class="tool-body">
    <script src="./assets/js/include.js"></script>
    <include src="header.html"></include>

    <main>
      <div class="tool-header">
        <h1>🏥 Plantillas Médicas - Atención Primaria</h1>
        <p>
          Sistema con 126 plantillas editables y atajos rápidos • Incluye
          Prompts IA
        </p>
      </div>

      <div class="tool-container">
        <aside class="sidebar">
          <h2>📑 Categorías</h2>
          <div id="category-list"></div>
        </aside>

        <div class="tool-main-content">
          <div class="search-container">
            <div class="search-wrapper">
              <input
                type="text"
                class="search-box"
                id="searchBox"
                placeholder="🔍 Buscar por título, atajo (.an, .ef, .iadd, .phq9) o contenido..."
                autocomplete="off"
              />
              <button
                class="clear-search"
                id="clearSearch"
                onclick="clearSearch()"
                title="Limpiar búsqueda"
              >
                ✕
              </button>
            </div>
          </div>

          <div id="templates-container"></div>
          <div class="empty-state" id="empty-state" style="display: none">
            <h3>No se encontraron resultados</h3>
            <p>Intenta con otros términos de búsqueda</p>
          </div>
        </div>
      </div>

      <div class="notification" id="notification"></div>
    </main>
    <include src="footer.html"></include>
    <script src="./assets/js/utils.js"></script>

    <script>
      // --- BASE DE DATOS COMPLETA DE ATAJOS CLÍNICOS ---
      const templates = [
        // Anamnesis y Exploración
        {
          category: "Anamnesis y Exploración",
          id: "anamnesis-asintomatico",
          title: "Anamnesis Asintomático",
          shortcut: ".an",
          content:
            "Anamnesis: Paciente asintomático, sin quejas relevantes. Refiere bienestar general. No informa fiebre, tos, disnea u otros síntomas.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-general",
          title: "Exploración General",
          shortcut: ".ef",
          content:
            "Exploración general: Constantes dentro de la normalidad. Aspecto general normohidratado y normocoloreado, sin signos de distress agudo.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "auscultacion-cp",
          title: "Auscultación Cardiopulmonar",
          shortcut: ".cp",
          content:
            "Auscultación cardiopulmonar: Eupneico y normoventila, sin roncus ni crepitantes. Tonos cardiacos rítmicos, sin soplos ni extratonos.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-abdominal",
          title: "Exploración Abdominal",
          shortcut: ".ab",
          content:
            "Exploración abdominal: Blando y depresible, sin dolor a la palpación superficial ni profunda. Sin masas ni megalias. Ruidos hidroaéreos normales.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-neurologica",
          title: "Exploración Neurológica",
          shortcut: ".en",
          content:
            "Exploración neurológica: Pupilas isocóricas y normorreactivas. Pares craneales sin alteraciones. Fuerza y sensibilidad conservadas.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-orl",
          title: "Exploración ORL",
          shortcut: ".or",
          content:
            "Exploración ORL: Faringe hiperémica sin exudados, sin adenopatías cervicales palpables. Auscultación y voz sin alteraciones destacables.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-musculoesqueletica",
          title: "Exploración Musculoesquelética",
          shortcut: ".ms",
          content:
            "Exploración musculoesquelética: Movilidad conservada en extremidades, sin dolor a la movilización activa o pasiva. Sin signos inflamatorios ni deformidades.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-genitourinaria",
          title: "Exploración Genitourinaria",
          shortcut: ".gu",
          content:
            "Exploración genitourinaria: Micción normal, sin disuria ni polaquiuria. Puño-percusión renal negativa. No se evidencian masas ni dolor suprapúbico.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "exploracion-dermatologica",
          title: "Exploración Dermatológica",
          shortcut: ".dm",
          content:
            "Exploración dermatológica: Piel íntegra, sin eritemas, lesiones exudativas o cambios pigmentarios. Faneras sin alteraciones significativas.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "ecg-normal",
          title: "ECG Normal",
          shortcut: ".ec",
          content:
            "ECG: Ritmo sinusal, frecuencia cardíaca estable y sin alteraciones de la conducción. Sin signos de isquemia aguda.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "analitica-normal",
          title: "Analítica Normal",
          shortcut: ".la",
          content:
            "Analítica: Hemograma y bioquímica sin alteraciones relevantes. Función renal y hepática en valores normales.",
        },
        {
          category: "Anamnesis y Exploración",
          id: "radiografia-normal",
          title: "Radiografía Normal",
          shortcut: ".rx",
          content:
            "RX: Sin signos de consolidación ni lesiones focales. No alteraciones osteoarticulares relevantes.",
        },

        // Patologías Frecuentes
        {
          category: "Patologías Frecuentes",
          id: "ira",
          title: "Infección Respiratoria Alta (IRA)",
          shortcut: ".ira",
          content:
            "Infección respiratoria alta:\n- Síntomas: Rinorrea, odinofagia, tos irritativa\n- Exploración: Faringe hiperémica sin exudados. ACP normal\n- Plan: Hidratación, analgesia si precisa, lavados nasales\n- Signos alarma explicados. Control según evolución",
        },
        {
          category: "Patologías Frecuentes",
          id: "gea",
          title: "Gastroenteritis Aguda (GEA)",
          shortcut: ".gea",
          content:
            "Gastroenteritis aguda:\n- Clínica: Deposiciones líquidas sin productos patológicos\n- Exploración: No deshidratación. Abdomen blando, no doloroso\n- Plan: Dieta progresiva, hidratación, probióticos\n- Signos alarma explicados. Control si no mejoría",
        },
        {
          category: "Patologías Frecuentes",
          id: "lumbalgia",
          title: "Lumbalgia Mecánica",
          shortcut: ".lum",
          content:
            "Lumbalgia mecánica:\n- Dolor lumbar mecánico sin irradiación\n- No signos de alarma. No déficit neurológico\n- Lasègue y Bragard negativos\n- Plan: calor local, analgesia pautada, ejercicios específicos",
        },
        {
          category: "Patologías Frecuentes",
          id: "ansiedad",
          title: "Ansiedad Situacional",
          shortcut: ".ans",
          content:
            "Ansiedad situacional:\n- Desencadenante: []\n- Clínica: Ansiedad psíquica y somática. No depresión\n- Plan: Técnicas relajación, higiene sueño, apoyo psicológico\n- Control en 2 semanas o según evolución",
        },
        {
          category: "Patologías Frecuentes",
          id: "sintomas-inespecificos",
          title: "Síntomas Inespecíficos",
          shortcut: ".sine",
          content:
            "Evaluación inicial por síntomas inespecíficos:\n- Motivo de consulta: []\n- Anamnesis:\n  • Inicio: []\n  • Evolución: []\n  • Síntomas asociados: []\n  • Factores agravantes/aliviantes: []\n  • Impacto funcional: []\n- Exploración física:\n  • Estado general: []\n  • Constantes: TA: []/[] mmHg, FC: [] lpm, Tª: []ºC, SatO2: []%\n  • Hallazgos relevantes: []\n- Pruebas complementarias:\n  • Hemograma completo y plaquetas\n  • PCR, VSG\n  • Albúmina y perfil hepático\n- Plan:\n  • Seguimiento: revisión 4-6 semanas\n  • Medidas generales: []\n  • Signos de alarma explicados: []\n- Impresión diagnóstica: []",
        },

        // Prescripciones y ATB
        {
          category: "Prescripciones y ATB",
          id: "pauta-analgesica",
          title: "Pauta Analgésica",
          shortcut: ".anal",
          content:
            "Pauta analgésica:\n1) Paracetamol 1g/8h\n2) Añadir si precisa: Ibuprofeno 600mg/8h\n3) Si dolor no controlado: Intercalar Metamizol 575mg\nUsar la mínima dosis efectiva. Ajustar según respuesta",
        },
        {
          category: "Prescripciones y ATB",
          id: "criterios-atb",
          title: "Criterios Generales Uso ATB",
          shortcut: "..crit-ab",
          content:
            "CRITERIOS GENERALES USO ATB:\nANTES DE PRESCRIBIR:\n1. Diagnóstico probable/seguro\n2. Beneficio supera riesgos\n3. No alternativas efectivas\n4. Considerar resistencias locales\n\nFACTORES PACIENTE:\n□ Edad y comorbilidades\n□ Alergias medicamentosas\n□ ATB recientes (3 meses)\n□ Hospitalizaciones previas\n□ Factores riesgo resistencia\n\nAL PRESCRIBIR:\n1. Elegir espectro más estrecho\n2. Dosis y duración adecuadas\n3. Vía administración óptima\n4. Coste-efectividad\n5. Disponibilidad local",
        },
        {
          category: "Prescripciones y ATB",
          id: "prescripcion-diferida",
          title: "Prescripción Diferida de ATB",
          shortcut: "..pd-ab",
          content:
            "PRESCRIPCIÓN DIFERIDA DE ANTIBIÓTICO:\nDebido a que su cuadro clínico actual:\n- Podría resolverse sin antibióticos\n- No presenta criterios de gravedad\n- Tiene bajo riesgo de complicaciones\nSe recomienda inicialmente manejo sintomático y observación.\n\nRECOGER ANTIBIÓTICO DE FARMACIA SI EN 72H:\n- No hay mejoría o empeoramiento claro\n- Fiebre persistente > 38ºC\n- Aparición de nuevos síntomas\n\nMEDIDAS MIENTRAS TANTO:\n- Analgesia/antitérmicos si precisa\n- Hidratación adecuada\n- Reposo relativo\nRECONSULTAR SI:\n- Aparición signos alarma explicados\n- Dudas sobre evolución",
        },
        {
          category: "Prescripciones y ATB",
          id: "faringoamigdalitis",
          title: "Faringoamigdalitis (Centor)",
          shortcut: "..far-ab",
          content:
            "FARINGOAMIGDALITIS - VALORACIÓN ATB:\nCriterios Centor modificados (1 punto cada uno):\n□ Ausencia de tos\n□ Adenopatías cervicales dolorosas\n□ Fiebre >38ºC\n□ Exudado amigdalar\n□ Edad 3-14 años (+1) o 15-44 (0) o >45 (-1)\nPuntuación total: []/5\n\nDECISIÓN SEGÚN SCORE:\n0-1: No precisa ATB ni test\n2-3: Considerar test rápido\n4-5: ATB empírico o test\n\nSi prescripción ATB:\n- 1ª elección: Penicilina V o Amoxicilina\n- Duración: 10 días completos\n- Alergia: Valorar macrólido",
        },
        {
          category: "Prescripciones y ATB",
          id: "otitis-media",
          title: "Otitis Media Aguda (OMA)",
          shortcut: "..oma-ab",
          content:
            "OTITIS MEDIA AGUDA - VALORACIÓN ATB:\nCriterios diagnósticos:\n□ Inicio agudo\n□ Signos inflamación timpánica\n□ Presencia exudado\n□ Signos/síntomas infección aguda\n\nCriterios prescripción inmediata:\n□ Edad <6 meses\n□ <2 años bilateral\n□ Otorrea\n□ Síntomas graves\n□ Factores riesgo\n\nDECISIÓN:\n□ ATB inmediato\n□ Prescripción diferida\n□ Observación\n\nSi ATB:\n- 1ª elección: Amoxicilina dosis alta\n- Duración: 5-7d (>2a), 7-10d (<2a)\nControl en 48-72h si no mejoría",
        },
        {
          category: "Prescripciones y ATB",
          id: "sinusitis",
          title: "Sinusitis Aguda",
          shortcut: "..sin-ab",
          content:
            "SINUSITIS AGUDA - VALORACIÓN ATB:\nCriterios diagnósticos (≥1 criterio mayor o ≥2 menores):\nMayores:\n□ Rinorrea purulenta con predominio unilateral\n□ Dolor facial unilateral\n□ Ocupación radiológica\n\nMenores:\n□ Cefalea\n□ Fiebre\n□ Tos\n□ Halitosis\n□ Dolor dental\n□ Oído taponado\n\nCriterios ATB inmediato:\n□ Síntomas graves o T>39ºC\n□ Curso bifásico\n□ No mejoría tras 10d\n□ Inmunodepresión\n\nPLAN:\n□ ATB inmediato\n□ Tratamiento sintomático\n□ Lavados nasales\nControl evolución 72h",
        },
        {
          category: "Prescripciones y ATB",
          id: "bronquitis",
          title: "Bronquitis Aguda",
          shortcut: "..bron-ab",
          content:
            "BRONQUITIS AGUDA - VALORACIÓN ATB:\nRecordar: Generalmente viral, ATB no indicado rutinariamente\n\nCriterios valoración:\n□ Duración tos <3 semanas\n□ No neumonía (exploración/Rx)\n□ No EPOC/bronquiectasias\n□ No signos gravedad\n\nPLAN:\n- Manejo sintomático\n- Explicar curso natural (2-3 sem)\n- Antitusivos si precisa\n- Broncodilatadores: valorar test terapéutico\n\nReconsultar si:\n- Fiebre >38ºC persistente\n- Disnea progresiva\n- Expectoración purulenta + fiebre >3d",
        },
        {
          category: "Prescripciones y ATB",
          id: "itu-no-complicada",
          title: "ITU no Complicada",
          shortcut: "..iu-ab",
          content:
            "ITU NO COMPLICADA - VALORACIÓN ATB:\nCriterios diagnósticos:\n□ Disuria, polaquiuria, urgencia\n□ No fiebre ni dolor lumbar\n□ No embarazo/inmunosupresión\n□ No alteración estructural\n\nFactores a valorar:\n□ ATB previos 3 meses\n□ Resistencias locales\n□ Alergias\n□ Recurrencias previas\n\nDECISIÓN ATB según resistencias locales:\n- 1ª elección: Fosfomicina/Nitrofurantoína\n- Alternativas según antibiograma\n- Duración: 3-5d (excepto Fosfomicina)\n\nMedidas adicionales:\n- Hidratación adecuada\n- Completar tratamiento\n- Medidas prevención recurrencias",
        },

        // Situaciones Urgentes
        {
          category: "Situaciones Urgentes",
          id: "dolor-toracico",
          title: "Dolor Torácico",
          shortcut: ".dt",
          content:
            "DOLOR TORÁCICO:\n- Características: []. Irradiación: []\n- Factores modificantes: []\n- Constantes: TA []/[] FC []\n- ECG: []\nActuación: AAS, NTG si procede, valorar derivación urgente.",
        },
        {
          category: "Situaciones Urgentes",
          id: "disnea-aguda",
          title: "Disnea Aguda",
          shortcut: ".sd",
          content:
            "DISNEA AGUDA:\n- FR: []/min. SatO2 basal: []%. Con O2: []%\n- Trabajo respiratorio: []. Uso musculatura accesoria: []\n- Constantes: TA []/[] FC []\n- Auscultación: []\nActuación: O2, broncodilatadores, corticoide según proceda.",
        },

        // Seguimiento Crónicos
        {
          category: "Seguimiento Crónicos",
          id: "control-hta",
          title: "Control HTA",
          shortcut: ".hta",
          content:
            "Control HTA:\nTA actual: []/[]\nTA previas revisadas\nAdherencia terapéutica correcta\nEfectos secundarios descartados\nFRCV controlados\nPróximo control 3m",
        },
        {
          category: "Seguimiento Crónicos",
          id: "control-dm2",
          title: "Control DM2",
          shortcut: ".2dm",
          content:
            "Control DM2:\n- HbA1c actual: []% (previa: []%)\n- Glucemias domiciliarias revisadas\n- Hipoglucemias: No referidas\n- Adherencia: Dieta / Ejercicio / Fármacos\n- Plan: Ajuste según valores. Próximo control 3m",
        },

        // Gestión y Certificados
        {
          category: "Gestión y Certificados",
          id: "tramitacion-it",
          title: "Tramitación IT",
          shortcut: ".it",
          content:
            "Se tramita incapacidad temporal por proceso actual, reevaluar según evolución.",
        },
        {
          category: "Gestión y Certificados",
          id: "alta-it",
          title: "Alta de IT",
          shortcut: ".altait",
          content:
            "Paciente que acude para alta de Incapacidad Temporal. Se encuentra asintomático y apto para reincorporarse a su actividad laboral. Se tramita alta con fecha de hoy.",
        },
        {
          category: "Gestión y Certificados",
          id: "cert-asistencia",
          title: "Certificado de Asistencia",
          shortcut: ".acert",
          content:
            "CERTIFICADO DE ASISTENCIA A CONSULTA\n\nD./Dña. [], médico/a de atención primaria, \n\nCERTIFICA:\n\nQue D./Dña. [] ha acudido a consulta médica el día de hoy en horario de [] a [] horas.\n\nY para que conste donde proceda, firmo el presente certificado.",
        },
        {
          category: "Gestión y Certificados",
          id: "cert-basico",
          title: "Certificado Médico Básico",
          shortcut: ".cert",
          content:
            "CERTIFICADO MÉDICO\n\nD./Dña. [], médico/a colegiado/a nº [], \n\nCERTIFICA:\n\nQue D./Dña. [], con DNI [], ha sido atendido/a en consulta en el día de hoy por [] precisando []\n\nY para que conste a los efectos oportunos, firmo el presente certificado en [Lugar] a [Fecha].",
        },
        {
          category: "Gestión y Certificados",
          id: "cert-aptitud",
          title: "Certificado de Aptitud Física",
          shortcut: ".apcert",
          content:
            "CERTIFICADO DE APTITUD FÍSICA\n\nD./Dña. [], médico/a colegiado/a nº [], \n\nCERTIFICA:\n\nQue tras el examen médico realizado a D./Dña. [], con DNI [], no se encuentra en el momento actual contraindicación médica que le impida la realización de []\n\nEste certificado tiene validez de [] y se expide a petición del interesado/a en [Lugar] a [Fecha].",
        },
        {
          category: "Gestión y Certificados",
          id: "cert-seguimiento",
          title: "Certificado de Seguimiento",
          shortcut: ".scert",
          content:
            "CERTIFICADO DE SEGUIMIENTO MÉDICO\n\nD./Dña. [], médico/a de atención primaria, \n\nCERTIFICA:\n\nQue D./Dña. [] se encuentra en seguimiento en esta consulta por [] desde []. \nRequiere controles periódicos cada []. \nPróxima revisión prevista: []\n\nY para que conste, firmo el presente certificado en [Lugar] a [Fecha].",
        },
        {
          category: "Gestión y Certificados",
          id: "cert-detallado",
          title: "Certificado Médico Detallado",
          shortcut: ".dcert",
          content:
            "CERTIFICADO MÉDICO DETALLADO\n\nD./Dña. [], médico/a especialista en [], colegiado/a nº [], \n\nCERTIFICA:\n\nQue según los datos que constan en la historia clínica, D./Dña. [], con DNI [], \n\nANTECEDENTES RELEVANTES:\n- []\n\nSITUACIÓN ACTUAL:\n- []\n\nTRATAMIENTO ACTUAL:\n- []\n\nCONCLUSIONES:\n- []\n\nY para que conste a los efectos oportunos, firmo el presente certificado en [Lugar] a [Fecha].",
        },

        // Atajos Adicionales
        {
          category: "Atajos Adicionales",
          id: "constantes-vitales",
          title: "Constantes Vitales",
          shortcut: ".ta",
          content: "TA: []/[] mmHg, FC: [] lpm, SatO2: []%",
        },
        {
          category: "Atajos Adicionales",
          id: "escala-eva",
          title: "Escala EVA",
          shortcut: ".eva",
          content: "Dolor según EVA: []/10",
        },
        {
          category: "Atajos Adicionales",
          id: "solicitud-interconsulta",
          title: "Solicitud Interconsulta",
          shortcut: ".sic",
          content:
            "Se solicita interconsulta con el servicio de [] para valoración de [].",
        },
        {
          category: "Atajos Adicionales",
          id: "justificacion-solicitud",
          title: "Justificación Solicitud",
          shortcut: ".jussol",
          content:
            "Justifico la solicitud de [] por sospecha diagnóstica de [].",
        },
        {
          category: "Atajos Adicionales",
          id: "dieta-astringente",
          title: "Dieta Astringente",
          shortcut: ".dieta",
          content:
            "Recomendaciones de dieta astringente:\n- Iniciar con líquidos (agua, suero oral, infusiones, caldo de arroz).\n- Progresar según tolerancia a: arroz cocido, zanahoria cocida, patata cocida, manzana (rallada y oxidada) o plátano maduro.\n- Posteriormente introducir pollo o pescado blanco a la plancha/hervido.\n- Evitar: fritos, grasas, lácteos, dulces, bebidas gaseosas y verduras crudas.",
        },
        // === NUEVAS PLANTILLAS AGREGADAS ===

        // Prompts IA Clínicos
        {
          category: "Prompts IA Clínicos",
          id: "prompt-diagnostico-diferencial",
          title: "Diagnóstico Diferencial (RECORD)",
          shortcut: ".iadd",
          content: `PROMPT DIAGNÓSTICO DIFERENCIAL - Método RECORD:

[R] ROL: Actúa como médico internista experto en diagnóstico diferencial
[E] ESENCIA: Analiza síntomas y genera diagnósticos diferenciales estructurados
[C] CONTEXTO: Paciente de [] años, sexo [], con antecedentes de []
[O] OBJETIVO: Listar 5 diagnósticos más probables con criterios diagnósticos
[R] REQUISITOS: Incluir red flags, pruebas confirmatorias y prevalencia
[D] DISEÑO: Tabla con probabilidad, criterios a favor/contra, next steps

SÍNTOMAS PRINCIPALES:
- []
- []
EXPLORACIÓN:
- []
ANALÍTICA DISPONIBLE:
- []`,
        },
        {
          category: "Prompts IA Clínicos",
          id: "prompt-plan-terapeutico",
          title: "Plan Terapéutico Personalizado",
          shortcut: ".iapt",
          content: `PROMPT PLAN TERAPÉUTICO:

TÉCNICA: Chain-of-Thought + Few-Shot
ESTRUCTURA:
1. ANÁLISIS DEL CASO
   Diagnóstico: []
   Comorbilidades: []
   Alergias: []
   Interacciones: []

2. RAZONAMIENTO PASO A PASO
   □ Objetivos terapéuticos
   □ Primera línea según guías
   □ Alternativas si contraindicación
   □ Ajuste por función renal/hepática

3. OUTPUT ESPERADO
   Fármaco | Dosis | Pauta | Duración | Monitorización | Efectos adversos`,
        },
        {
          category: "Prompts IA Clínicos",
          id: "prompt-interpretacion-pruebas",
          title: "Interpretación de Pruebas",
          shortcut: ".iaip",
          content: `PROMPT INTERPRETACIÓN ANALÍTICA/IMAGEN:

TÉCNICA: Zero-Shot Chain-of-Thought
"Interpreta sistemáticamente estos resultados siguiendo el método SOAP"

DATOS DEL PACIENTE:
Edad: [] Sexo: [] 
Motivo solicitud: []

RESULTADOS:
[]

SOLICITO:
1. Hallazgos significativos (S)
2. Interpretación clínica (O)
3. Correlación con sospecha (A)
4. Recomendaciones (P)

Considera valores críticos, tendencias y contexto clínico.`,
        },
        // Fin de Prompts IA Clínicos - continúan más plantillas...

        // POCUS (Ecografía)
        {
          category: "POCUS (Ecografía)",
          id: "pocus-general",
          title: "Informe General",
          shortcut: ".pocusgen",
          content:
            "En general:\nTamaño: []\nEcogenicidad: []\nMorfología: []\nVascularización: []",
        },
        {
          category: "POCUS (Ecografía)",
          id: "doppler-mmii",
          title: "Doppler MMII",
          shortcut: ".dopmmii",
          content:
            "ECO DOPPLER DE AMBOS MIEMBROS INFERIORES\nSE EXPLORAN AMBOS MIEMBROS INFERIORES\n\nEJE PROFUNDO\nVena femoral común: normal\nVena femoral superficial: normal\nVena poplítea: normal\n\nEJE SUPERFICIAL\nSafena mayor: normal\nSafena menor: normal",
        },
        {
          category: "POCUS (Ecografía)",
          id: "doppler-mmss",
          title: "Doppler MMSS",
          shortcut: ".dopmmss",
          content:
            "ECO DOPPLER DE MIEMBROS SUPERIORES\n- Vena yugular interna: Permeable.\n\nSistema Venoso PROFUNDO\n- Vena Subclavia: Permeable.\n- Vena Axilar: Permeable.\n- Vena Braquial: Permeable.\n- Vena Radial y Ulnar: Permeable.\n\nSistema Venoso SUPERFICIAL\n- Vena Basílica: Permeable.\n- Vena Cefálica: Permeable.\n- Vena mediana del antebrazo: Permeable.",
        },
        {
          category: "POCUS (Ecografía)",
          id: "eco-urologica",
          title: "Eco Urológica",
          shortcut: ".ecouro",
          content:
            "ECO UROLÓGICA\n- Riñones:\n  Quistes: []\n  Angiomiolipomas: []\n  Tamaño: Normal.\n  Diferenciación corticomedular: Normal.\n  Litiasis: No.\n  Dilatación de vía: No.\n\n- Vejiga Urinaria:\n  Grado de repleción: Adecuado.\n  Paredes: Normales\n  Próstata: [] cc.",
        },
        {
          category: "POCUS (Ecografía)",
          id: "doppler-mmii-detallado",
          title: "Doppler MMII (Detallado)",
          shortcut: ".dopmii2",
          content:
            "DOPPLER MMII\n\n*EJE PROFUNDO*\nVena femoral común: Normal.\nVena femoral: Normal.\nVena poplítea: Normal.\nTroncos distales (gemelares, sóleas y tibioperonea): Normales.\n\n*EJE SUPERFICIAL*\nSafena mayor: Normal.\nSafena menor: Normal.",
        },
        {
          category: "POCUS (Ecografía)",
          id: "eco-abdominal",
          title: "Eco Abdominal",
          shortcut: ".ecoabd",
          content:
            "ECO ABDOMEN\n- Hígado:\n  Morfología: Normal.\n  Ecogenicidad: Normal.\n  Lesiones focales: No.\n  Vía biliar: Normal.\n\n- Vesícula biliar: Normal.\n- Eje esplenoportal: Normal.\n- Área pancreática: Normal.\n- Bazo: Normal.\n\n- Riñones:\n  Quistes: []\n  Angiomiolipomas: []\n  Tamaño: Normal.\n  Dif corticomedular: Buena.\n  Dilatación pielocalicial: No.\n  Litiasis: No.\n\n- Retroperitoneo: Sin alteraciones.\n- Vejiga urinaria: Normal.",
        },
        {
          category: "POCUS (Ecografía)",
          id: "eco-cuello-completo",
          title: "Eco de Cuello (Completo)",
          shortcut: ".ecocuello",
          content:
            "ECO CUELLO COMPLETO\nTamaño: []\nEcogenicidad: []\nVascularización: []\nNódulos: []\nGanglios: []\nGlánd. submaxilares: []\nParótidas: []\nOtros: []",
        },
        {
          category: "POCUS (Ecografía)",
          id: "eco-cuello-patologico",
          title: "Eco de Cuello (Patológico)",
          shortcut: ".ecocuello2",
          content:
            "ECO CUELLO DISMINUIDO-HETEROGÉNEO\nTamaño: Disminuido\nEcogenicidad: Heterogéneo\nVascularización: Normal\nNódulos: No\nGanglios: No sospechosos\nGlánd. submaxilares: []\nParótidas: []\nOtros: []",
        },
        // Plantillas críticas corregidas
        {
          category: "Patologías Frecuentes",
          id: "covid-persistente",
          title: "COVID Persistente/Long COVID",
          shortcut: ".longcov",
          content: `EVALUACIÓN COVID PERSISTENTE (>12 semanas):

CRITERIOS DIAGNÓSTICOS:
□ Infección SARS-CoV-2 confirmada previa
□ Síntomas >12 semanas post-infección
□ No explicados por diagnóstico alternativo
□ Impacto funcional significativo

SÍNTOMAS CARDINALES:
□ Fatiga post-esfuerzo (PEM)
□ Disnea persistente
□ Niebla mental/cognitiva
□ Disautonomía (POTS)

EVALUACIÓN SISTEMÁTICA:
Respiratorio: []
Cardiovascular: []
Neurológico: []
Psiquiátrico: []
Digestivo: []
Musculoesquelético: []

PRUEBAS BÁSICAS:
□ Hemograma, PCR, ferritina
□ TSH, vitamina D, B12
□ ECG si síntomas CV
□ Espirometría si disnea

PLAN:
□ Rehabilitación gradual
□ Pacing de actividades
□ Sintomático específico
□ Apoyo psicológico`,
        },
        {
          category: "Prescripciones y ATB",
          id: "reconciliacion-medicamentos",
          title: "Reconciliación Medicación",
          shortcut: ".recon",
          content: `RECONCILIACIÓN DE MEDICACIÓN:

MEDICACIÓN DOMICILIARIA PREVIA:
1. [] - [] mg - [] - Desde: []
2. [] - [] mg - [] - Desde: []
3. [] - [] mg - [] - Desde: []

CAMBIOS DURANTE INGRESO/URGENCIAS:
□ Suspendidos: []
□ Añadidos: []
□ Modificados: []

MEDICACIÓN ACTUAL RECONCILIADA:
1. [] - [] mg - [] - Indicación: []
2. [] - [] mg - [] - Indicación: []

VERIFICACIÓN:
□ Alergias revisadas
□ Interacciones comprobadas
□ Duplicidades eliminadas
□ Dosis ajustadas (renal/hepática)
□ Adherencia evaluada

EDUCACIÓN AL PACIENTE:
□ Cambios explicados
□ Horarios clarificados
□ Efectos adversos informados
□ Próxima revisión: []`,
        },
        // --- INICIA EL CÓDIGO FINAL Y CORRECTO A PEGAR ---

        // Plantillas de 'Sick Day Rules' (versión texto plano)
        {
          category: "Prescripciones y ATB",
          id: "sick-day-rules-clinico",
          title: "Recomendaciones 'Sick Day' (Clínico)",
          shortcut: ".sdr",
          content: `RECOMENDACIONES PARA DÍAS DE ENFERMEDAD (PAUSA DE FÁRMACOS):\nSe educa al paciente sobre la necesidad de pausar temporalmente ciertos medicamentos en caso de enfermedad aguda con riesgo de deshidratación (vómitos, diarrea, fiebre que impida una correcta ingesta de líquidos).\n\nCondiciones para la pausa:\n- Incapacidad para mantener una ingesta de líquidos adecuada.\n- Vómitos o diarrea significativos.\n\nMedicación a pausar (Regla SAD MANS):\n- S: Sulfonilureas (ej. Gliclazida, Glimepirida)\n- A: ARA-II (ej. Losartán, Candesartán)\n- D: Diuréticos (ej. Furosemida, HCTZ)\n- M: Metformina\n- A: IECAs (ej. Ramipril, Enalapril)\n- N: AINEs (ej. Ibuprofeno, Naproxeno)\n- S: iSGLT2 (ej. Empagliflozina, Dapagliflozina)\n\nInstrucciones dadas:\n- Reanudar la medicación 24-48h después de resolver el cuadro y tolerar dieta y líquidos con normalidad.\n- Aumentar la frecuencia de controles de glucemia capilar.\n- Se explican signos de alarma (confusión, mareo intenso, no orinar) para buscar atención médica urgente.\n- Paciente comprende y verbaliza acuerdo: []`,
        },
        {
          category: "Prescripciones y ATB",
          id: "sick-day-rules-paciente",
          title: "Instrucciones 'Sick Day' (Paciente)",
          shortcut: ".sdi",
          content: `INSTRUCCIONES PARA DÍAS DE ENFERMEDAD (VÓMITOS, DIARREA, FIEBRE)\n\nSi tiene una enfermedad aguda y corre riesgo de deshidratación (no puede beber líquidos con normalidad), siga estos dos pasos:\n\nPASO 1: SUSPENDA TEMPORALMENTE los siguientes medicamentos para prevenir complicaciones renales:\n- []\n\nPASO 2: REANUDE SU MEDICACIÓN cuando se cumplan estas dos condiciones:\n1. Sus síntomas (vómitos, diarrea, etc.) hayan desaparecido.\n2. Lleve entre 24 y 48 horas comiendo y bebiendo con normalidad.\n\nIMPORTANTE:\n- Mientras esté enfermo/a, beba pequeños sorbos de líquidos (agua, suero) con frecuencia.\n- Si es diabético/a, mida su azúcar más a menudo.\n- NO TOME antiinflamatorios (como Ibuprofeno) por su cuenta.\n\n¿CUÁNDO BUSCAR AYUDA MÉDICA?\n- Si los síntomas duran más de 72 horas (3 días).\n- Si se siente muy mareado/a, confundido/a o deja de orinar.\n- Si tiene cualquier duda, consulte con su médico, enfermera o farmacéutico.`,
        },
        {
          category: "Prescripciones y ATB",
          id: "sick-day-rules-breve",
          title: "Aviso 'Sick Day' (Breve)",
          shortcut: ".sdt",
          content:
            "Suspender temporalmente si por enfermedad tiene vómitos, diarrea, fiebre alta o no puede beber.",
        },

        // --- FINALIZA EL CÓDIGO FINAL Y CORRECTO A PEGAR ---
        // Categoría Acerca de
        {
          category: "ℹ️ Acerca de",
          id: "sobre-proyecto",
          title: "Sobre este Proyecto",
          shortcut: ".info",
          content: `<h3>Plantillas Clínicas para Atención Primaria</h3>

<p><strong>Valor educativo y asistencial</strong></p>
<p>Esta herramienta representa un avance significativo en la optimización del tiempo clínico en Atención Primaria. Estudios demuestran que los médicos de AP dedican hasta un 50% de su tiempo a tareas administrativas y documentación.</p>

<p><strong>Beneficios documentados</strong></p>
<ul>
  <li>Reducción del 40-60% en tiempo de documentación</li>
  <li>Mejora en la completitud de historias clínicas</li>
  <li>Estandarización de la práctica basada en evidencia</li>
  <li>Disminución del burnout profesional</li>
  <li>Mayor tiempo para atención directa al paciente</li>
</ul>

<p><strong>Integración con HCE</strong></p>
<p>Las plantillas están diseñadas para ser compatibles con cualquier sistema de Historia Clínica Electrónica que permita entrada de texto. Los atajos rápidos agilizan la documentación sin comprometer la calidad.</p>

<p><strong>Basado en evidencia</strong></p>
<p>Guías SEMFYC/SEMERGEN 2024-2025, protocolos actualizados según últimas publicaciones, criterios diagnósticos internacionales vigentes y recomendaciones de sociedades científicas.</p>

<p><em>Desarrollado por profesionales para profesionales. Uso libre para fines educativos y asistenciales.</em></p>`,
        },
        {
          category: "ℹ️ Acerca de",
          id: "privacidad-datos",
          title: "Privacidad y Almacenamiento",
          shortcut: ".priv",
          content: `<h3>Política de Privacidad y Datos</h3>

<p><strong>Almacenamiento local</strong></p>
<p>Esta aplicación funciona completamente en tu navegador:</p>
<ul>
  <li>No se envían datos a ningún servidor</li>
  <li>No se requiere registro ni identificación</li>
  <li>No se recopilan datos personales o clínicos</li>
  <li>No hay cookies de tracking o análisis</li>
</ul>

<p><strong>Seguridad</strong></p>
<p>Sin conexión a bases de datos externas. Sin transmisión de información sensible. Funcionamiento 100% offline una vez cargada. Compatible con navegación privada/incógnito.</p>

<p><strong>Recomendaciones importantes</strong></p>
<ul>
  <li>No introduzcas datos reales de pacientes</li>
  <li>Usa solo como plantilla base para tu práctica</li>
  <li>Adapta el contenido a cada caso específico</li>
  <li>Verifica siempre la información clínica</li>
</ul>

<p><strong>Cumplimiento normativo</strong></p>
<p>Esta herramienta cumple con RGPD (Reglamento General de Protección de Datos) y LOPD-GDD (Ley Orgánica de Protección de Datos).</p>

<p><em>Para eliminar todos los datos locales: Configuración navegador > Privacidad > Borrar datos de navegación</em></p>`,
        },
        {
          category: "ℹ️ Acerca de",
          id: "instrucciones-uso",
          title: "Instrucciones de Uso",
          shortcut: ".ayuda",
          content: `📖 GUÍA RÁPIDA DE USO

NAVEGACIÓN:
- Click en categorías laterales para filtrar
- Usa la búsqueda para encontrar plantillas específicas
- Los atajos (.an, .ef, etc.) facilitan el acceso rápido

EDICIÓN DE PLANTILLAS:
- Los campos en [corchetes] son editables
- Click en el campo amarillo para modificar
- El contenido se puede editar directamente
- Botón "Deshacer" restaura el original

SISTEMA DE FAVORITOS:
- Click en ⭐ para marcar favoritos
- Accede a tus favoritos desde la categoría superior
- Los favoritos se mantienen entre sesiones

COPIAR PLANTILLAS:
- Click en "📋 Copiar" para copiar al portapapeles
- Pega directamente en tu HCE (Ctrl+V)
- Compatible con cualquier sistema que acepte texto

ATAJOS DE TECLADO:
- Ctrl+F: Activar búsqueda
- ESC: Limpiar búsqueda
- Tab: Navegar entre campos editables

MÉTODO RECORD (Prompts IA):
Basado en el framework publicado en Zenodo
DOI: 10.5281/zenodo.11080812
Los prompts siguen estructura validada para IA clínica

USO EN HCE:
1. Busca la plantilla necesaria
2. Edita los campos según el caso
3. Copia al portapapeles
4. Pega en tu Historia Clínica Electrónica

💡 TIP: Guarda esta página en favoritos del navegador para acceso rápido durante la consulta`,
        },
        {
          category: "ℹ️ Acerca de",
          id: "metodo-record-info",
          title: "Método RECORD para Prompts IA",
          shortcut: ".record",
          content: `🤖 MÉTODO RECORD - PROMPTS ESTRUCTURADOS PARA IA

PUBLICACIÓN CIENTÍFICA:
Barrera-Linares, E (2024). Método RECORD para escribir Prompts en ChatGPT.
📄 DOI: <a href="https://zenodo.org/records/11080812" target="_blank" style="color: #3498db;">10.5281/zenodo.11080812</a>

¿QUÉ ES RECORD?
Estructura mnemotécnica validada para optimizar la interacción con IA en el ámbito sanitario:

R - ROL O PERSONALIDAD
Define el experto que necesitas que sea la IA
Ejemplo: "Actúa como médico internista experto"

E - ESENCIA O MISIÓN  
Establece el propósito principal del prompt
Ejemplo: "Analiza estos síntomas para diagnóstico diferencial"

C - CONTEXTO
Proporciona información relevante del caso
Ejemplo: "Paciente de 65 años, diabético, con HTA"

O - OBJETIVO
Especifica el resultado deseado
Ejemplo: "Lista los 5 diagnósticos más probables"

R - REQUISITOS O DETALLES
Incluye especificaciones adicionales
Ejemplo: "Ordena por probabilidad, incluye red flags"

D - DISEÑO O FORMATO
Define cómo presentar la respuesta
Ejemplo: "Tabla con diagnóstico, criterios y pruebas"

VENTAJAS DEL MÉTODO:
✅ Respuestas más precisas y relevantes
✅ Reducción de ambigüedad en las consultas
✅ Estructura reproducible y enseñable
✅ Validado en entorno clínico real
✅ Mejora la calidad de la información obtenida

APLICACIONES EN MEDICINA:
- Diagnóstico diferencial
- Planes terapéuticos
- Interpretación de pruebas
- Educación al paciente
- Revisión farmacológica
- Búsqueda bibliográfica`,
        },
      ];

      // --- LÓGICA DE LA APLICACIÓN ---
      let currentCategory = "";
      let originalContents = new Map();

      const categoryIcons = {
        "Anamnesis y Exploración": "🔍",
        "Patologías Frecuentes": "🏥",
        "Prescripciones y ATB": "💊",
        "Situaciones Urgentes": "🚨",
        "Seguimiento Crónicos": "📊",
        "Gestión y Certificados": "📋",
        "Atajos Adicionales": "⚡",
        "POCUS (Ecografía)": "📡",
        "Prompts IA Clínicos": "🤖",
        "Prevención y Cribados": "🛡️",
        "Salud Mental": "🧠",
        "Pediatría en AP": "👶",
        "Técnicas y Procedimientos": "💉",
        Geriatría: "👴",
        "ℹ️ Acerca de": "ℹ️",
      };

      function init() {
        renderCategories();
        renderTemplates();
        setupEventListeners();

        // Cargar favoritos del localStorage
        favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
        updateFavoriteCount();
        updateFavoriteStars();

        // Mostrar primera categoría por defecto
        const categories = [...new Set(templates.map((t) => t.category))];
        if (categories.length > 0) {
          showCategory(categories[0]);
        }
      }

      function renderCategories() {
        const categoryList = document.getElementById("category-list");
        let categories = [...new Set(templates.map((t) => t.category))];

        // Mover "Acerca de" al final
        const aboutIndex = categories.indexOf("ℹ️ Acerca de");
        if (aboutIndex > -1) {
          categories.splice(aboutIndex, 1);
          categories.push("ℹ️ Acerca de");
        }

        // Añadir categoría de favoritos al principio
        let categoriesHTML = `
    <div class="category-item" data-category="favoritos" onclick="showFavorites()">
      <span>⭐</span>
      <span>Favoritos (<span id="fav-count">0</span>)</span>
    </div>
    <hr style="margin: 10px 0; border: none; border-top: 1px solid #e0e0e0;">
  `;

        // Añadir todas las categorías excepto "Acerca de"
        const clinicalCategories = categories.filter(
          (cat) => cat !== "ℹ️ Acerca de"
        );
        categoriesHTML += clinicalCategories
          .map(
            (category) => `
        <div class="category-item" data-category="${category}" onclick="showCategory('${category}')">
          <span>${categoryIcons[category] || "📁"}</span>
          <span>${category}</span>
        </div>
      `
          )
          .join("");

        // Añadir separador y "Acerca de" al final
        categoriesHTML += `
    <hr style="margin: 10px 0; border: none; border-top: 1px solid #e0e0e0;">
    <div class="category-item" data-category="ℹ️ Acerca de" onclick="showCategory('ℹ️ Acerca de')">
      <span>ℹ️</span>
      <span>Acerca de</span>
    </div>
  `;

        categoryList.innerHTML = categoriesHTML;
        updateFavoriteCount();
      }

      function renderTemplates(searchTerm = "") {
        const container = document.getElementById("templates-container");
        const categories = [...new Set(templates.map((t) => t.category))];
        container.innerHTML = "";

        categories.forEach((category) => {
          const categoryTemplates = templates.filter((t) => {
            if (t.category !== category) return false;
            if (searchTerm) {
              const search = searchTerm.toLowerCase();
              return (
                t.title.toLowerCase().includes(search) ||
                t.shortcut.toLowerCase().includes(search) ||
                t.content.toLowerCase().includes(search)
              );
            }
            return true;
          });

          if (categoryTemplates.length === 0) return;

          // Si es "Acerca de", crear layout especial
          if (category === "ℹ️ Acerca de") {
            const section = document.createElement("div");
            section.className = "about-section-wrapper";
            section.id = `category-${category
              .replace(/[\s&]+/g, "-")
              .toLowerCase()}`;

            let aboutContent = `
        <div class="about-header">
          <h1>ℹ️ Acerca de Plantillas Clínicas AP</h1>
        </div>
        <div class="about-container">
      `;

            categoryTemplates.forEach((template, index) => {
              aboutContent += `
          <section class="about-content-block">
            <h2>${template.title}</h2>
            <div class="about-text">${template.content}</div>
          </section>
          ${
            index < categoryTemplates.length - 1
              ? '<hr class="about-separator">'
              : ""
          }
        `;
            });

            aboutContent += `</div>`;
            section.innerHTML = aboutContent;
            container.appendChild(section);
          } else {
            // Para el resto de categorías, usar tarjetas normales
            const section = document.createElement("div");
            section.className = "category-section";
            section.id = `category-${category
              .replace(/[\s&]+/g, "-")
              .toLowerCase()}`;
            section.innerHTML = `
        <h2 class="category-header">
          ${categoryIcons[category] || "📁"} ${category}
        </h2>
        <div class="templates-grid">
          ${categoryTemplates
            .map((template) => createTemplateCard(template))
            .join("")}
        </div>
      `;
            container.appendChild(section);
          }
        });

        const emptyState = document.getElementById("empty-state");
        emptyState.style.display =
          container.children.length === 0 ? "block" : "none";
        processAllEditableFields();
      }

      function createTemplateCard(template) {
        let content = template.content;
        if (template.category === "Gestión y Certificados") {
          const today = new Date().toLocaleDateString("es-ES", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          });
          content = content.replace(/\[Fecha\]/g, `[${today}]`);
        }

        return `
    <div class="template-card" id="card-${template.id}">
      <div class="edit-indicator">Editado</div>
      <div class="template-header">
        <h3 class="template-title">${template.title}</h3>
        <span class="shortcut-badge">${template.shortcut}</span>
      </div>
      <div class="template-content" 
           contenteditable="true" 
           data-template-id="${template.id}"
           oninput="handleContentEdit(this)">${content}</div>
      <button class="btn-favorite" 
          onclick="toggleFavorite('${template.id}')"
          style="position: absolute; top: 5px; left: 5px; background: none; border: none; font-size: 18px; cursor: pointer; z-index: 10; color: #f39c12;">
        <span id="fav-${template.id}">☆</span>
      </button>
      <div class="button-group">
        <button class="btn tooltip" 
                onclick="copyTemplate('${template.id}')"
                data-tooltip="Copiar al portapapeles">
          📋 Copiar
        </button>
        <button class="btn btn-secondary tooltip" 
                onclick="resetTemplate('${template.id}')"
                data-tooltip="Restaurar original"
                id="reset-${template.id}"
                disabled>
          ↩️ Deshacer
        </button>
      </div>
    </div>
  `;
      }

      function processEditableFields(contentElement) {
        // Verificar si es contenido informativo
        const templateId = contentElement.dataset.templateId;
        const template = templates.find((t) => t.id === templateId);

        if (template && template.category === "ℹ️ Acerca de") {
          // No procesar campos editables en contenido informativo
          return;
        }

        if (!originalContents.has(contentElement.dataset.templateId)) {
          originalContents.set(
            contentElement.dataset.templateId,
            contentElement.innerHTML
          );
        }
        const text = contentElement.innerHTML;

        // Procesar campos editables pero excluir acrósticos RECORD
        const processed = text.replace(/\[(.*?)\]/g, (match, p1) => {
          // Si es un acróstico de una sola letra seguido de ], es parte del método RECORD
          if (p1.length === 1 && /[RECODE]/.test(p1)) {
            return `<span class="record-label">[${p1}]</span>`;
          }
          // Si no, es un campo editable normal
          return `<span class="editable-field" contenteditable="true" onclick="event.stopPropagation()">${p1}</span>`;
        });

        if (contentElement.innerHTML !== processed) {
          contentElement.innerHTML = processed;
        }
      }

      function processAllEditableFields() {
        document.querySelectorAll(".template-content").forEach((content) => {
          processEditableFields(content);
        });
      }

      function handleContentEdit(element) {
        const templateId = element.dataset.templateId;
        const card = document.getElementById(`card-${templateId}`);
        const resetBtn = document.getElementById(`reset-${templateId}`);
        const originalContent = originalContents.get(templateId);
        if (element.innerHTML.trim() !== originalContent.trim()) {
          element.classList.add("edited");
          card.classList.add("has-changes");
          resetBtn.disabled = false;
        } else {
          element.classList.remove("edited");
          card.classList.remove("has-changes");
          resetBtn.disabled = true;
        }
      }

      function copyTemplate(templateId) {
        const contentEl = document.querySelector(
          `[data-template-id="${templateId}"]`
        );
        const cleanedText = contentEl.innerText.replace(/□/g, "");
        navigator.clipboard
          .writeText(cleanedText)
          .then(() => {
            showNotification("✅ Plantilla copiada al portapapeles", "success");
          })
          .catch((err) => {
            const textarea = document.createElement("textarea");
            textarea.value = cleanedText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
            showNotification("✅ Plantilla copiada", "success");
          });
      }

      function resetTemplate(templateId) {
        const content = document.querySelector(
          `[data-template-id="${templateId}"]`
        );
        const card = document.getElementById(`card-${templateId}`);
        const resetBtn = document.getElementById(`reset-${templateId}`);
        const originalContent = originalContents.get(templateId);
        if (originalContent) {
          content.innerHTML = originalContent;
          content.classList.remove("edited");
          card.classList.remove("has-changes");
          resetBtn.disabled = true;
          processEditableFields(content);
          showNotification("↩️ Plantilla restaurada", "info");
        }
      }

      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = "block";
        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }
      function showFavorites() {
        // Marcar favoritos como activo en sidebar
        document.querySelectorAll(".category-item").forEach((item) => {
          item.classList.toggle(
            "active",
            item.dataset.category === "favoritos"
          );
        });

        // Renderizar solo plantillas favoritas
        const container = document.getElementById("templates-container");
        const favoriteTemplates = templates.filter((t) =>
          favorites.includes(t.id)
        );

        if (favoriteTemplates.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <h3>⭐ No tienes plantillas favoritas</h3>
              <p>Marca plantillas como favoritas haciendo clic en la estrella</p>
            </div>
          `;
          return;
        }

        container.innerHTML = `
          <div class="category-section">
            <h2 class="category-header">
              ⭐ Plantillas Favoritas
            </h2>
            <div class="templates-grid">
              ${favoriteTemplates
                .map((template) => createTemplateCard(template))
                .join("")}
            </div>
          </div>
        `;

        processAllEditableFields();
        updateFavoriteStars();
      }

      function updateFavoriteCount() {
        const countElement = document.getElementById("fav-count");
        if (countElement) {
          countElement.textContent = favorites.length;
        }
      }

      function updateFavoriteStars() {
        favorites.forEach((id) => {
          const star = document.getElementById(`fav-${id}`);
          if (star) star.textContent = "★";
        });
      }
      function showCategory(category) {
        currentCategory = category;
        document.querySelectorAll(".category-item").forEach((item) => {
          item.classList.toggle("active", item.dataset.category === category);
        });
        const categoryElement = document.getElementById(
          `category-${category.replace(/[\s&]+/g, "-").toLowerCase()}`
        );
        if (categoryElement) {
          categoryElement.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function setupEventListeners() {
        const searchBox = document.getElementById("searchBox");
        let searchTimeout;
        searchBox.addEventListener("input", (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            renderTemplates(e.target.value);
          }, 300);
        });
        document.addEventListener("keydown", (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === "f") {
            e.preventDefault();
            searchBox.focus();
          }
          if (e.key === "Escape" && document.activeElement === searchBox) {
            searchBox.value = "";
            renderTemplates();
          }
        });
        window.addEventListener("beforeunload", (e) => {
          if (document.querySelector(".template-card.has-changes")) {
            e.preventDefault();
            e.returnValue =
              "¿Estás seguro? Hay cambios sin guardar en las plantillas.";
          }
        });
        // Sincronizar categoría activa con scroll
        let scrollTimeout;
        window.addEventListener("scroll", () => {
          clearTimeout(scrollTimeout);
          scrollTimeout = setTimeout(() => {
            const sections = document.querySelectorAll(".category-section");
            const scrollPosition = window.scrollY + 200;

            sections.forEach((section) => {
              const top = section.offsetTop;
              const height = section.offsetHeight;

              if (scrollPosition >= top && scrollPosition < top + height) {
                const categoryName = section
                  .querySelector(".category-header")
                  .textContent.trim();
                // Eliminar emoji y espacios
                const cleanCategory = categoryName.substring(2).trim();

                document.querySelectorAll(".category-item").forEach((item) => {
                  item.classList.toggle(
                    "active",
                    item.dataset.category === cleanCategory
                  );
                });
              }
            });
          }, 100);
        });
      }

      document.addEventListener("DOMContentLoaded", init);
      // Sistema de favoritos
      let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      function clearSearch() {
        const searchBox = document.getElementById("searchBox");
        searchBox.value = "";
        searchBox.focus();
        renderTemplates();
      }
      function toggleFavorite(templateId) {
        event.stopPropagation(); // Prevenir que se active el click de la tarjeta
        const index = favorites.indexOf(templateId);
        if (index > -1) {
          favorites.splice(index, 1);
          document.getElementById(`fav-${templateId}`).textContent = "☆";
        } else {
          favorites.push(templateId);
          document.getElementById(`fav-${templateId}`).textContent = "★";
        }
        localStorage.setItem("favorites", JSON.stringify(favorites));
        updateFavoriteCount();
      }

      // Actualizar estrellas al cargar
      setTimeout(() => {
        favorites.forEach((id) => {
          const star = document.getElementById(`fav-${id}`);
          if (star) star.textContent = "★";
        });
      }, 100);
    </script>
  </body>
</html>
