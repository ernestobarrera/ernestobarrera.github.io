<!--
=====================
  plantillas.html
  Macros y plantillas m√©dicas 
=====================
-->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta
      name="description"
      content="Sistema de atajos y plantillas cl√≠nicas editables para la Historia Cl√≠nica Electr√≥nica (HCE), dise√±ado para optimizar el tiempo en consulta."
    />
    <meta name="author" content="Ernesto Barrera" />
    <link rel="icon" href="assets/images/icon.webp" />
    <title>Plantillas Cl√≠nicas | @ernestob</title>

    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Plantillas Cl√≠nicas Editables | @ernestob"
    />
    <meta
      property="og:site_name"
      content="Herramienta de productividad para profesionales sanitarios"
    />
    <meta
      property="og:url"
      content="https://ernestobarrera.github.io/plantillas.html"
    />
    <meta
      property="og:image"
      content="https://ernestobarrera.github.io/assets/images/me.png"
    />
    <meta property="article:author" content="https://twitter.com/ernestob" />

    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/header.css" />
    <link rel="stylesheet" href="assets/css/components.css" />
    <link rel="stylesheet" href="assets/css/footer.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
    />

    <style>
      /* --- ESTILOS DE LA HERRAMIENTA DE PLANTILLAS --- */
      /* Reseteo y cuerpo de la herramienta */
      .tool-body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial,
          sans-serif;
        background: #f0f4f8;
        line-height: 1.6;
        padding-top: 60px; /* Ajuste para el header fijo del sitio */
      }

      .tool-body * {
        box-sizing: border-box;
      }

      .tool-header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 20px;
        text-align: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        width: 100%;
        top: 60px; /* Se posiciona debajo del header principal */
        left: 0;
        z-index: 999;
      }

      .tool-header h1,
      .tool-header p {
        margin: 0;
        padding: 0;
      }

      .tool-container {
        display: flex;
        max-width: 1600px;
        margin: 140px auto 20px; /* Espacio para el header fijo del sitio Y el header de la herramienta */
        gap: 20px;
        padding: 20px;
      }

      .sidebar {
        width: 280px;
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 180px; /* Ajuste para ambos headers fijos */
        height: calc(100vh - 200px);
        overflow-y: auto;
      }

      .sidebar h2 {
        color: #2c3e50;
        margin-top: 0;
        margin-bottom: 20px;
        font-size: 1.3em;
      }

      .category-item {
        padding: 12px 16px;
        margin: 5px 0;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #555;
      }

      .category-item:hover {
        background: #f0f4f8;
        transform: translateX(5px);
      }

      .category-item.active {
        background: #3498db;
        color: white;
      }

      .tool-main-content {
        flex: 1;
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .search-box {
        width: 100%;
        padding: 15px;
        font-size: 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        margin-bottom: 30px;
        transition: all 0.3s;
      }

      .search-box:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .category-section {
        margin-bottom: 40px;
        scroll-margin-top: 180px; /* Offset for sticky headers */
      }

      .category-header {
        color: #2c3e50;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #3498db;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.5em;
      }

      .templates-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
        gap: 20px;
      }

      .template-card {
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        background: #f8f9fa;
        transition: all 0.3s;
        position: relative;
      }

      .template-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
        border-color: #3498db;
      }

      .template-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
      }

      .template-title {
        font-size: 1.1em;
        color: #2c3e50;
        font-weight: 600;
        flex: 1;
      }

      .shortcut-badge {
        background: #3498db;
        color: white;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.85em;
        font-family: monospace;
        margin-left: 10px;
      }

      .template-content {
        background: white;
        padding: 15px;
        border-radius: 8px;
        font-family: "Consolas", "Monaco", monospace;
        font-size: 14px;
        line-height: 1.6;
        white-space: pre-wrap;
        min-height: 100px;
        max-height: 400px;
        overflow-y: auto;
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        position: relative;
        color: #2c3e50; /* <-- ESTA ES LA L√çNEA A√ëADIDA */
      }

      .template-content:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .template-content.edited {
        background-color: #fffef0;
        border-color: #f39c12;
      }

      .editable-field {
        background: #fff3cd;
        padding: 2px 6px;
        border-radius: 4px;
        border: 1px dashed #856404;
        color: #856404;
        cursor: text;
        display: inline-block;
        min-width: 40px;
        transition: all 0.2s;
      }

      .editable-field:hover {
        background: #ffeaa7;
        border-style: solid;
      }

      .editable-field:focus {
        background: white;
        border-color: #3498db;
        color: #2c3e50;
        outline: none;
      }

      .button-group {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 5px;
        font-weight: 500;
      }

      .btn:hover {
        background: #2980b9;
        transform: translateY(-1px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn-secondary {
        background: #95a5a6;
      }

      .btn-secondary:hover {
        background: #7f8c8d;
      }

      .btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none;
      }

      .edit-indicator {
        position: absolute;
        top: 5px;
        right: 5px;
        background: #f39c12;
        color: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        opacity: 0;
        transition: opacity 0.3s;
      }

      .template-card.has-changes .edit-indicator {
        opacity: 1;
      }

      .notification {
        position: fixed;
        top: 180px; /* Debajo de los dos headers */
        right: 20px;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        display: none;
        z-index: 1000;
        animation: slideIn 0.3s ease-out;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      .notification.success {
        background: #27ae60;
        color: white;
      }
      .notification.info {
        background: #3498db;
        color: white;
      }

      .tooltip {
        position: relative;
      }
      .tooltip::after {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 125%;
        left: 50%;
        transform: translateX(-50%);
        background: #2c3e50;
        color: white;
        padding: 5px 10px;
        border-radius: 4px;
        white-space: nowrap;
        font-size: 12px;
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s;
      }

      .tooltip:hover::after {
        opacity: 1;
      }

      .empty-state {
        text-align: center;
        padding: 60px;
        color: #7f8c8d;
      }

      .empty-state h3 {
        font-size: 1.5em;
        margin-bottom: 10px;
      }

      .sidebar::-webkit-scrollbar,
      .template-content::-webkit-scrollbar {
        width: 8px;
      }
      .sidebar::-webkit-scrollbar-track,
      .template-content::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .sidebar::-webkit-scrollbar-thumb,
      .template-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 4px;
      }
      .sidebar::-webkit-scrollbar-thumb:hover,
      .template-content::-webkit-scrollbar-thumb:hover {
        background: #555;
      }

      /* Responsive */
      @media (max-width: 1200px) {
        .tool-container {
          flex-direction: column;
          margin-top: 140px;
        }
        .sidebar {
          width: 100%;
          height: auto;
          position: static;
        }
        .templates-grid {
          grid-template-columns: 1fr;
        }
      }
      @media (max-width: 768px) {
        .tool-header {
          top: 50px; /* Ajuste para header m√≥vil */
        }
        .tool-container {
          margin-top: 120px;
        }
        .sidebar {
          top: 130px;
        }
        .category-section {
          scroll-margin-top: 130px;
        }
        .templates-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body class="tool-body">
    <script src="./assets/js/include.js"></script>
    <include src="header.html"></include>

    <main>
      <div class="tool-header">
        <h1>üè• Plantillas M√©dicas - Atenci√≥n Primaria</h1>
        <p>Sistema de plantillas editables con atajos r√°pidos</p>
      </div>

      <div class="tool-container">
        <aside class="sidebar">
          <h2>üìë Categor√≠as</h2>
          <div id="category-list"></div>
        </aside>

        <div class="tool-main-content">
          <input
            type="text"
            class="search-box"
            id="searchBox"
            placeholder="üîç Buscar por t√≠tulo, atajo (.an, .ef) o contenido..."
            autocomplete="off"
          />

          <div id="templates-container"></div>

          <div class="empty-state" id="empty-state" style="display: none">
            <h3>No se encontraron resultados</h3>
            <p>Intenta con otros t√©rminos de b√∫squeda</p>
          </div>
        </div>
      </div>

      <div class="notification" id="notification"></div>
    </main>
    <include src="footer.html"></include>
    <script src="./assets/js/utils.js"></script>

    <script>
      // --- BASE DE DATOS COMPLETA DE ATAJOS CL√çNICOS ---
      const templates = [
        // Anamnesis y Exploraci√≥n
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "anamnesis-asintomatico",
          title: "Anamnesis Asintom√°tico",
          shortcut: ".an",
          content:
            "Anamnesis: Paciente asintom√°tico, sin quejas relevantes. Refiere bienestar general. No informa fiebre, tos, disnea u otros s√≠ntomas.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-general",
          title: "Exploraci√≥n General",
          shortcut: ".ef",
          content:
            "Exploraci√≥n general: Constantes dentro de la normalidad. Aspecto general normohidratado y normocoloreado, sin signos de distress agudo.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "auscultacion-cp",
          title: "Auscultaci√≥n Cardiopulmonar",
          shortcut: ".cp",
          content:
            "Auscultaci√≥n cardiopulmonar: Eupneico y normoventila, sin roncus ni crepitantes. Tonos cardiacos r√≠tmicos, sin soplos ni extratonos.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-abdominal",
          title: "Exploraci√≥n Abdominal",
          shortcut: ".ab",
          content:
            "Exploraci√≥n abdominal: Blando y depresible, sin dolor a la palpaci√≥n superficial ni profunda. Sin masas ni megalias. Ruidos hidroa√©reos normales.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-neurologica",
          title: "Exploraci√≥n Neurol√≥gica",
          shortcut: ".en",
          content:
            "Exploraci√≥n neurol√≥gica: Pupilas isoc√≥ricas y normorreactivas. Pares craneales sin alteraciones. Fuerza y sensibilidad conservadas.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-orl",
          title: "Exploraci√≥n ORL",
          shortcut: ".or",
          content:
            "Exploraci√≥n ORL: Faringe hiper√©mica sin exudados, sin adenopat√≠as cervicales palpables. Auscultaci√≥n y voz sin alteraciones destacables.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-musculoesqueletica",
          title: "Exploraci√≥n Musculoesquel√©tica",
          shortcut: ".ms",
          content:
            "Exploraci√≥n musculoesquel√©tica: Movilidad conservada en extremidades, sin dolor a la movilizaci√≥n activa o pasiva. Sin signos inflamatorios ni deformidades.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-genitourinaria",
          title: "Exploraci√≥n Genitourinaria",
          shortcut: ".gu",
          content:
            "Exploraci√≥n genitourinaria: Micci√≥n normal, sin disuria ni polaquiuria. Pu√±o-percusi√≥n renal negativa. No se evidencian masas ni dolor suprap√∫bico.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "exploracion-dermatologica",
          title: "Exploraci√≥n Dermatol√≥gica",
          shortcut: ".dm",
          content:
            "Exploraci√≥n dermatol√≥gica: Piel √≠ntegra, sin eritemas, lesiones exudativas o cambios pigmentarios. Faneras sin alteraciones significativas.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "ecg-normal",
          title: "ECG Normal",
          shortcut: ".ec",
          content:
            "ECG: Ritmo sinusal, frecuencia card√≠aca estable y sin alteraciones de la conducci√≥n. Sin signos de isquemia aguda.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "analitica-normal",
          title: "Anal√≠tica Normal",
          shortcut: ".la",
          content:
            "Anal√≠tica: Hemograma y bioqu√≠mica sin alteraciones relevantes. Funci√≥n renal y hep√°tica en valores normales.",
        },
        {
          category: "Anamnesis y Exploraci√≥n",
          id: "radiografia-normal",
          title: "Radiograf√≠a Normal",
          shortcut: ".rx",
          content:
            "RX: Sin signos de consolidaci√≥n ni lesiones focales. No alteraciones osteoarticulares relevantes.",
        },

        // Patolog√≠as Frecuentes
        {
          category: "Patolog√≠as Frecuentes",
          id: "ira",
          title: "Infecci√≥n Respiratoria Alta (IRA)",
          shortcut: ".ira",
          content:
            "Infecci√≥n respiratoria alta:\n- S√≠ntomas: Rinorrea, odinofagia, tos irritativa\n- Exploraci√≥n: Faringe hiper√©mica sin exudados. ACP normal\n- Plan: Hidrataci√≥n, analgesia si precisa, lavados nasales\n- Signos alarma explicados. Control seg√∫n evoluci√≥n",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "gea",
          title: "Gastroenteritis Aguda (GEA)",
          shortcut: ".gea",
          content:
            "Gastroenteritis aguda:\n- Cl√≠nica: Deposiciones l√≠quidas sin productos patol√≥gicos\n- Exploraci√≥n: No deshidrataci√≥n. Abdomen blando, no doloroso\n- Plan: Dieta progresiva, hidrataci√≥n, probi√≥ticos\n- Signos alarma explicados. Control si no mejor√≠a",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "lumbalgia",
          title: "Lumbalgia Mec√°nica",
          shortcut: ".lum",
          content:
            "Lumbalgia mec√°nica:\n- Dolor lumbar mec√°nico sin irradiaci√≥n\n- No signos de alarma. No d√©ficit neurol√≥gico\n- Las√®gue y Bragard negativos\n- Plan: calor local, analgesia pautada, ejercicios espec√≠ficos",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "ansiedad",
          title: "Ansiedad Situacional",
          shortcut: "..ans",
          content:
            "Ansiedad situacional:\n- Desencadenante: []\n- Cl√≠nica: Ansiedad ps√≠quica y som√°tica. No depresi√≥n\n- Plan: T√©cnicas relajaci√≥n, higiene sue√±o, apoyo psicol√≥gico\n- Control en 2 semanas o seg√∫n evoluci√≥n",
        },
        {
          category: "Patolog√≠as Frecuentes",
          id: "sintomas-inespecificos",
          title: "S√≠ntomas Inespec√≠ficos",
          shortcut: ".sine",
          content:
            "Evaluaci√≥n inicial por s√≠ntomas inespec√≠ficos:\n- Motivo de consulta: []\n- Anamnesis:\n  ‚Ä¢ Inicio: []\n  ‚Ä¢ Evoluci√≥n: []\n  ‚Ä¢ S√≠ntomas asociados: []\n  ‚Ä¢ Factores agravantes/aliviantes: []\n  ‚Ä¢ Impacto funcional: []\n- Exploraci√≥n f√≠sica:\n  ‚Ä¢ Estado general: []\n  ‚Ä¢ Constantes: TA: []/[] mmHg, FC: [] lpm, T¬™: []¬∫C, SatO2: []%\n  ‚Ä¢ Hallazgos relevantes: []\n- Pruebas complementarias:\n  ‚Ä¢ Hemograma completo y plaquetas\n  ‚Ä¢ PCR, VSG\n  ‚Ä¢ Alb√∫mina y perfil hep√°tico\n- Plan:\n  ‚Ä¢ Seguimiento: revisi√≥n 4-6 semanas\n  ‚Ä¢ Medidas generales: []\n  ‚Ä¢ Signos de alarma explicados: []\n- Impresi√≥n diagn√≥stica: []",
        },

        // Prescripciones y ATB
        {
          category: "Prescripciones y ATB",
          id: "pauta-analgesica",
          title: "Pauta Analg√©sica",
          shortcut: "..anal",
          content:
            "Pauta analg√©sica:\n1) Paracetamol 1g/8h\n2) A√±adir si precisa: Ibuprofeno 600mg/8h\n3) Si dolor no controlado: Intercalar Metamizol 575mg\nUsar la m√≠nima dosis efectiva. Ajustar seg√∫n respuesta",
        },
        {
          category: "Prescripciones y ATB",
          id: "criterios-atb",
          title: "Criterios Generales Uso ATB",
          shortcut: "..crit-ab",
          content:
            "CRITERIOS GENERALES USO ATB:\nANTES DE PRESCRIBIR:\n1. Diagn√≥stico probable/seguro\n2. Beneficio supera riesgos\n3. No alternativas efectivas\n4. Considerar resistencias locales\n\nFACTORES PACIENTE:\n‚ñ° Edad y comorbilidades\n‚ñ° Alergias medicamentosas\n‚ñ° ATB recientes (3 meses)\n‚ñ° Hospitalizaciones previas\n‚ñ° Factores riesgo resistencia\n\nAL PRESCRIBIR:\n1. Elegir espectro m√°s estrecho\n2. Dosis y duraci√≥n adecuadas\n3. V√≠a administraci√≥n √≥ptima\n4. Coste-efectividad\n5. Disponibilidad local",
        },
        {
          category: "Prescripciones y ATB",
          id: "prescripcion-diferida",
          title: "Prescripci√≥n Diferida de ATB",
          shortcut: "..pd-ab",
          content:
            "PRESCRIPCI√ìN DIFERIDA DE ANTIBI√ìTICO:\nDebido a que su cuadro cl√≠nico actual:\n- Podr√≠a resolverse sin antibi√≥ticos\n- No presenta criterios de gravedad\n- Tiene bajo riesgo de complicaciones\nSe recomienda inicialmente manejo sintom√°tico y observaci√≥n.\n\nRECOGER ANTIBI√ìTICO DE FARMACIA SI EN 72H:\n- No hay mejor√≠a o empeoramiento claro\n- Fiebre persistente > 38¬∫C\n- Aparici√≥n de nuevos s√≠ntomas\n\nMEDIDAS MIENTRAS TANTO:\n- Analgesia/antit√©rmicos si precisa\n- Hidrataci√≥n adecuada\n- Reposo relativo\nRECONSULTAR SI:\n- Aparici√≥n signos alarma explicados\n- Dudas sobre evoluci√≥n",
        },
        {
          category: "Prescripciones y ATB",
          id: "faringoamigdalitis",
          title: "Faringoamigdalitis (Centor)",
          shortcut: "..far-ab",
          content:
            "FARINGOAMIGDALITIS - VALORACI√ìN ATB:\nCriterios Centor modificados (1 punto cada uno):\n‚ñ° Ausencia de tos\n‚ñ° Adenopat√≠as cervicales dolorosas\n‚ñ° Fiebre >38¬∫C\n‚ñ° Exudado amigdalar\n‚ñ° Edad 3-14 a√±os (+1) o 15-44 (0) o >45 (-1)\nPuntuaci√≥n total: []/5\n\nDECISI√ìN SEG√öN SCORE:\n0-1: No precisa ATB ni test\n2-3: Considerar test r√°pido\n4-5: ATB emp√≠rico o test\n\nSi prescripci√≥n ATB:\n- 1¬™ elecci√≥n: Penicilina V o Amoxicilina\n- Duraci√≥n: 10 d√≠as completos\n- Alergia: Valorar macr√≥lido",
        },
        {
          category: "Prescripciones y ATB",
          id: "otitis-media",
          title: "Otitis Media Aguda (OMA)",
          shortcut: "..oma-ab",
          content:
            "OTITIS MEDIA AGUDA - VALORACI√ìN ATB:\nCriterios diagn√≥sticos:\n‚ñ° Inicio agudo\n‚ñ° Signos inflamaci√≥n timp√°nica\n‚ñ° Presencia exudado\n‚ñ° Signos/s√≠ntomas infecci√≥n aguda\n\nCriterios prescripci√≥n inmediata:\n‚ñ° Edad <6 meses\n‚ñ° <2 a√±os bilateral\n‚ñ° Otorrea\n‚ñ° S√≠ntomas graves\n‚ñ° Factores riesgo\n\nDECISI√ìN:\n‚ñ° ATB inmediato\n‚ñ° Prescripci√≥n diferida\n‚ñ° Observaci√≥n\n\nSi ATB:\n- 1¬™ elecci√≥n: Amoxicilina dosis alta\n- Duraci√≥n: 5-7d (>2a), 7-10d (<2a)\nControl en 48-72h si no mejor√≠a",
        },
        {
          category: "Prescripciones y ATB",
          id: "sinusitis",
          title: "Sinusitis Aguda",
          shortcut: "..sin-ab",
          content:
            "SINUSITIS AGUDA - VALORACI√ìN ATB:\nCriterios diagn√≥sticos (‚â•1 criterio mayor o ‚â•2 menores):\nMayores:\n‚ñ° Rinorrea purulenta con predominio unilateral\n‚ñ° Dolor facial unilateral\n‚ñ° Ocupaci√≥n radiol√≥gica\n\nMenores:\n‚ñ° Cefalea\n‚ñ° Fiebre\n‚ñ° Tos\n‚ñ° Halitosis\n‚ñ° Dolor dental\n‚ñ° O√≠do taponado\n\nCriterios ATB inmediato:\n‚ñ° S√≠ntomas graves o T>39¬∫C\n‚ñ° Curso bif√°sico\n‚ñ° No mejor√≠a tras 10d\n‚ñ° Inmunodepresi√≥n\n\nPLAN:\n‚ñ° ATB inmediato\n‚ñ° Tratamiento sintom√°tico\n‚ñ° Lavados nasales\nControl evoluci√≥n 72h",
        },
        {
          category: "Prescripciones y ATB",
          id: "bronquitis",
          title: "Bronquitis Aguda",
          shortcut: "..bron-ab",
          content:
            "BRONQUITIS AGUDA - VALORACI√ìN ATB:\nRecordar: Generalmente viral, ATB no indicado rutinariamente\n\nCriterios valoraci√≥n:\n‚ñ° Duraci√≥n tos <3 semanas\n‚ñ° No neumon√≠a (exploraci√≥n/Rx)\n‚ñ° No EPOC/bronquiectasias\n‚ñ° No signos gravedad\n\nPLAN:\n- Manejo sintom√°tico\n- Explicar curso natural (2-3 sem)\n- Antitusivos si precisa\n- Broncodilatadores: valorar test terap√©utico\n\nReconsultar si:\n- Fiebre >38¬∫C persistente\n- Disnea progresiva\n- Expectoraci√≥n purulenta + fiebre >3d",
        },
        {
          category: "Prescripciones y ATB",
          id: "itu-no-complicada",
          title: "ITU no Complicada",
          shortcut: "..iu-ab",
          content:
            "ITU NO COMPLICADA - VALORACI√ìN ATB:\nCriterios diagn√≥sticos:\n‚ñ° Disuria, polaquiuria, urgencia\n‚ñ° No fiebre ni dolor lumbar\n‚ñ° No embarazo/inmunosupresi√≥n\n‚ñ° No alteraci√≥n estructural\n\nFactores a valorar:\n‚ñ° ATB previos 3 meses\n‚ñ° Resistencias locales\n‚ñ° Alergias\n‚ñ° Recurrencias previas\n\nDECISI√ìN ATB seg√∫n resistencias locales:\n- 1¬™ elecci√≥n: Fosfomicina/Nitrofuranto√≠na\n- Alternativas seg√∫n antibiograma\n- Duraci√≥n: 3-5d (excepto Fosfomicina)\n\nMedidas adicionales:\n- Hidrataci√≥n adecuada\n- Completar tratamiento\n- Medidas prevenci√≥n recurrencias",
        },

        // Situaciones Urgentes
        {
          category: "Situaciones Urgentes",
          id: "dolor-toracico",
          title: "Dolor Tor√°cico",
          shortcut: ".dt",
          content:
            "DOLOR TOR√ÅCICO:\n- Caracter√≠sticas: []. Irradiaci√≥n: []\n- Factores modificantes: []\n- Constantes: TA []/[] FC []\n- ECG: []\nActuaci√≥n: AAS, NTG si procede, valorar derivaci√≥n urgente.",
        },
        {
          category: "Situaciones Urgentes",
          id: "disnea-aguda",
          title: "Disnea Aguda",
          shortcut: ".sd",
          content:
            "DISNEA AGUDA:\n- FR: []/min. SatO2 basal: []%. Con O2: []%\n- Trabajo respiratorio: []. Uso musculatura accesoria: []\n- Constantes: TA []/[] FC []\n- Auscultaci√≥n: []\nActuaci√≥n: O2, broncodilatadores, corticoide seg√∫n proceda.",
        },

        // Seguimiento Cr√≥nicos
        {
          category: "Seguimiento Cr√≥nicos",
          id: "control-hta",
          title: "Control HTA",
          shortcut: ".hta",
          content:
            "Control HTA:\nTA actual: []/[]\nTA previas revisadas\nAdherencia terap√©utica correcta\nEfectos secundarios descartados\nFRCV controlados\nPr√≥ximo control 3m",
        },
        {
          category: "Seguimiento Cr√≥nicos",
          id: "control-dm2",
          title: "Control DM2",
          shortcut: ".2dm",
          content:
            "Control DM2:\n- HbA1c actual: []% (previa: []%)\n- Glucemias domiciliarias revisadas\n- Hipoglucemias: No referidas\n- Adherencia: Dieta / Ejercicio / F√°rmacos\n- Plan: Ajuste seg√∫n valores. Pr√≥ximo control 3m",
        },

        // Gesti√≥n y Certificados
        {
          category: "Gesti√≥n y Certificados",
          id: "tramitacion-it",
          title: "Tramitaci√≥n IT",
          shortcut: ".it",
          content:
            "Se tramita incapacidad temporal por proceso actual, reevaluar seg√∫n evoluci√≥n.",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "alta-it",
          title: "Alta de IT",
          shortcut: ".altait",
          content:
            "Paciente que acude para alta de Incapacidad Temporal. Se encuentra asintom√°tico y apto para reincorporarse a su actividad laboral. Se tramita alta con fecha de hoy.",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-asistencia",
          title: "Certificado de Asistencia",
          shortcut: ".acert",
          content:
            "CERTIFICADO DE ASISTENCIA A CONSULTA\n\nD./D√±a. [], m√©dico/a de atenci√≥n primaria, \n\nCERTIFICA:\n\nQue D./D√±a. [] ha acudido a consulta m√©dica el d√≠a de hoy en horario de [] a [] horas.\n\nY para que conste donde proceda, firmo el presente certificado.",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-basico",
          title: "Certificado M√©dico B√°sico",
          shortcut: ".cert",
          content:
            "CERTIFICADO M√âDICO\n\nD./D√±a. [], m√©dico/a colegiado/a n¬∫ [], \n\nCERTIFICA:\n\nQue D./D√±a. [], con DNI [], ha sido atendido/a en consulta en el d√≠a de hoy por [] precisando []\n\nY para que conste a los efectos oportunos, firmo el presente certificado en [Lugar] a [Fecha].",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-aptitud",
          title: "Certificado de Aptitud F√≠sica",
          shortcut: ".apcert",
          content:
            "CERTIFICADO DE APTITUD F√çSICA\n\nD./D√±a. [], m√©dico/a colegiado/a n¬∫ [], \n\nCERTIFICA:\n\nQue tras el examen m√©dico realizado a D./D√±a. [], con DNI [], no se encuentra en el momento actual contraindicaci√≥n m√©dica que le impida la realizaci√≥n de []\n\nEste certificado tiene validez de [] y se expide a petici√≥n del interesado/a en [Lugar] a [Fecha].",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-seguimiento",
          title: "Certificado de Seguimiento",
          shortcut: ".scert",
          content:
            "CERTIFICADO DE SEGUIMIENTO M√âDICO\n\nD./D√±a. [], m√©dico/a de atenci√≥n primaria, \n\nCERTIFICA:\n\nQue D./D√±a. [] se encuentra en seguimiento en esta consulta por [] desde []. \nRequiere controles peri√≥dicos cada []. \nPr√≥xima revisi√≥n prevista: []\n\nY para que conste, firmo el presente certificado en [Lugar] a [Fecha].",
        },
        {
          category: "Gesti√≥n y Certificados",
          id: "cert-detallado",
          title: "Certificado M√©dico Detallado",
          shortcut: ".dcert",
          content:
            "CERTIFICADO M√âDICO DETALLADO\n\nD./D√±a. [], m√©dico/a especialista en [], colegiado/a n¬∫ [], \n\nCERTIFICA:\n\nQue seg√∫n los datos que constan en la historia cl√≠nica, D./D√±a. [], con DNI [], \n\nANTECEDENTES RELEVANTES:\n- []\n\nSITUACI√ìN ACTUAL:\n- []\n\nTRATAMIENTO ACTUAL:\n- []\n\nCONCLUSIONES:\n- []\n\nY para que conste a los efectos oportunos, firmo el presente certificado en [Lugar] a [Fecha].",
        },

        // Atajos Adicionales
        {
          category: "Atajos Adicionales",
          id: "constantes-vitales",
          title: "Constantes Vitales",
          shortcut: ".ta",
          content: "TA: []/[] mmHg, FC: [] lpm, SatO2: []%",
        },
        {
          category: "Atajos Adicionales",
          id: "escala-eva",
          title: "Escala EVA",
          shortcut: ".eva",
          content: "Dolor seg√∫n EVA: []/10",
        },
        {
          category: "Atajos Adicionales",
          id: "solicitud-interconsulta",
          title: "Solicitud Interconsulta",
          shortcut: ".sic",
          content:
            "Se solicita interconsulta con el servicio de [] para valoraci√≥n de [].",
        },
        {
          category: "Atajos Adicionales",
          id: "justificacion-solicitud",
          title: "Justificaci√≥n Solicitud",
          shortcut: ".jussol",
          content:
            "Justifico la solicitud de [] por sospecha diagn√≥stica de [].",
        },
        {
          category: "Atajos Adicionales",
          id: "dieta-astringente",
          title: "Dieta Astringente",
          shortcut: ".dieta",
          content:
            "Recomendaciones de dieta astringente:\n- Iniciar con l√≠quidos (agua, suero oral, infusiones, caldo de arroz).\n- Progresar seg√∫n tolerancia a: arroz cocido, zanahoria cocida, patata cocida, manzana (rallada y oxidada) o pl√°tano maduro.\n- Posteriormente introducir pollo o pescado blanco a la plancha/hervido.\n- Evitar: fritos, grasas, l√°cteos, dulces, bebidas gaseosas y verduras crudas.",
        },

        // POCUS (Ecograf√≠a)
        {
          category: "POCUS (Ecograf√≠a)",
          id: "pocus-general",
          title: "Informe General",
          shortcut: ".pocusgen",
          content:
            "En general:\nTama√±o: []\nEcogenicidad: []\nMorfolog√≠a: []\nVascularizaci√≥n: []",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "doppler-mmii",
          title: "Doppler MMII",
          shortcut: ".dopmmii",
          content:
            "ECO DOPPLER DE AMBOS MIEMBROS INFERIORES\nSE EXPLORAN AMBOS MIEMBROS INFERIORES\n\nEJE PROFUNDO\nVena femoral com√∫n: normal\nVena femoral superficial: normal\nVena popl√≠tea: normal\n\nEJE SUPERFICIAL\nSafena mayor: normal\nSafena menor: normal",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "doppler-mmss",
          title: "Doppler MMSS",
          shortcut: ".dopmmss",
          content:
            "ECO DOPPLER DE MIEMBROS SUPERIORES\n- Vena yugular interna: Permeable.\n\nSistema Venoso PROFUNDO\n- Vena Subclavia: Permeable.\n- Vena Axilar: Permeable.\n- Vena Braquial: Permeable.\n- Vena Radial y Ulnar: Permeable.\n\nSistema Venoso SUPERFICIAL\n- Vena Bas√≠lica: Permeable.\n- Vena Cef√°lica: Permeable.\n- Vena mediana del antebrazo: Permeable.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-urologica",
          title: "Eco Urol√≥gica",
          shortcut: ".ecouro",
          content:
            "ECO UROL√ìGICA\n- Ri√±ones:\n  Quistes: []\n  Angiomiolipomas: []\n  Tama√±o: Normal.\n  Diferenciaci√≥n corticomedular: Normal.\n  Litiasis: No.\n  Dilataci√≥n de v√≠a: No.\n\n- Vejiga Urinaria:\n  Grado de repleci√≥n: Adecuado.\n  Paredes: Normales\n  Pr√≥stata: [] cc.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "doppler-mmii-detallado",
          title: "Doppler MMII (Detallado)",
          shortcut: ".dopmii2",
          content:
            "DOPPLER MMII\n\n*EJE PROFUNDO*\nVena femoral com√∫n: Normal.\nVena femoral: Normal.\nVena popl√≠tea: Normal.\nTroncos distales (gemelares, s√≥leas y tibioperonea): Normales.\n\n*EJE SUPERFICIAL*\nSafena mayor: Normal.\nSafena menor: Normal.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-abdominal",
          title: "Eco Abdominal",
          shortcut: ".ecoabd",
          content:
            "ECO ABDOMEN\n- H√≠gado:\n  Morfolog√≠a: Normal.\n  Ecogenicidad: Normal.\n  Lesiones focales: No.\n  V√≠a biliar: Normal.\n\n- Ves√≠cula biliar: Normal.\n- Eje esplenoportal: Normal.\n- √Årea pancre√°tica: Normal.\n- Bazo: Normal.\n\n- Ri√±ones:\n  Quistes: []\n  Angiomiolipomas: []\n  Tama√±o: Normal.\n  Dif corticomedular: Buena.\n  Dilataci√≥n pielocalicial: No.\n  Litiasis: No.\n\n- Retroperitoneo: Sin alteraciones.\n- Vejiga urinaria: Normal.",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-cuello-completo",
          title: "Eco de Cuello (Completo)",
          shortcut: ".ecocuello",
          content:
            "ECO CUELLO COMPLETO\nTama√±o: []\nEcogenicidad: []\nVascularizaci√≥n: []\nN√≥dulos: []\nGanglios: []\nGl√°nd. submaxilares: []\nPar√≥tidas: []\nOtros: []",
        },
        {
          category: "POCUS (Ecograf√≠a)",
          id: "eco-cuello-patologico",
          title: "Eco de Cuello (Patol√≥gico)",
          shortcut: ".ecocuello2",
          content:
            "ECO CUELLO DISMINUIDO-HETEROG√âNEO\nTama√±o: Disminuido\nEcogenicidad: Heterog√©neo\nVascularizaci√≥n: Normal\nN√≥dulos: No\nGanglios: No sospechosos\nGl√°nd. submaxilares: []\nPar√≥tidas: []\nOtros: []",
        },
      ];

      // --- L√ìGICA DE LA APLICACI√ìN ---
      let currentCategory = "";
      let originalContents = new Map();

      const categoryIcons = {
        "Anamnesis y Exploraci√≥n": "üîç",
        "Patolog√≠as Frecuentes": "üè•",
        "Prescripciones y ATB": "üíä",
        "Situaciones Urgentes": "üö®",
        "Seguimiento Cr√≥nicos": "üìä",
        "Gesti√≥n y Certificados": "üìã",
        "Atajos Adicionales": "‚ö°",
        "POCUS (Ecograf√≠a)": "üì°",
      };

      function init() {
        renderCategories();
        renderTemplates();
        setupEventListeners();
        const categories = [...new Set(templates.map((t) => t.category))];
        if (categories.length > 0) {
          showCategory(categories[0]);
        }
      }

      function renderCategories() {
        const categoryList = document.getElementById("category-list");
        const categories = [...new Set(templates.map((t) => t.category))];
        categoryList.innerHTML = categories
          .map(
            (category) => `
                <div class="category-item" data-category="${category}" onclick="showCategory('${category}')">
                    <span>${categoryIcons[category] || "üìÅ"}</span>
                    <span>${category}</span>
                </div>
            `
          )
          .join("");
      }

      function renderTemplates(searchTerm = "") {
        const container = document.getElementById("templates-container");
        const categories = [...new Set(templates.map((t) => t.category))];
        container.innerHTML = "";
        categories.forEach((category) => {
          const categoryTemplates = templates.filter((t) => {
            if (t.category !== category) return false;
            if (searchTerm) {
              const search = searchTerm.toLowerCase();
              return (
                t.title.toLowerCase().includes(search) ||
                t.shortcut.toLowerCase().includes(search) ||
                t.content.toLowerCase().includes(search)
              );
            }
            return true;
          });
          if (categoryTemplates.length === 0) return;
          const section = document.createElement("div");
          section.className = "category-section";
          section.id = `category-${category
            .replace(/[\s&]+/g, "-")
            .toLowerCase()}`;
          section.innerHTML = `
                    <h2 class="category-header">
                        ${categoryIcons[category] || "üìÅ"} ${category}
                    </h2>
                    <div class="templates-grid">
                        ${categoryTemplates
                          .map((template) => createTemplateCard(template))
                          .join("")}
                    </div>
                `;
          container.appendChild(section);
        });
        const emptyState = document.getElementById("empty-state");
        emptyState.style.display =
          container.children.length === 0 ? "block" : "none";
        processAllEditableFields();
      }

      function createTemplateCard(template) {
        let content = template.content;
        if (template.category === "Gesti√≥n y Certificados") {
          const today = new Date().toLocaleDateString("es-ES", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
          });
          content = content.replace(/\[Fecha\]/g, `[${today}]`);
        }
        return `
                <div class="template-card" id="card-${template.id}">
                    <div class="edit-indicator">Editado</div>
                    <div class="template-header">
                        <h3 class="template-title">${template.title}</h3>
                        <span class="shortcut-badge">${template.shortcut}</span>
                    </div>
                    <div class="template-content" 
                         contenteditable="true" 
                         data-template-id="${template.id}"
                         oninput="handleContentEdit(this)">${content}</div>
                    <div class="button-group">
                        <button class="btn tooltip" 
                                onclick="copyTemplate('${template.id}')"
                                data-tooltip="Copiar al portapapeles">
                            üìã Copiar
                        </button>
                        <button class="btn btn-secondary tooltip" 
                                onclick="resetTemplate('${template.id}')"
                                data-tooltip="Restaurar original"
                                id="reset-${template.id}"
                                disabled>
                            ‚Ü©Ô∏è Deshacer
                        </button>
                    </div>
                </div>
            `;
      }

      function processEditableFields(contentElement) {
        if (!originalContents.has(contentElement.dataset.templateId)) {
          originalContents.set(
            contentElement.dataset.templateId,
            contentElement.innerHTML
          );
        }
        const text = contentElement.innerHTML;
        const processed = text.replace(/\[(.*?)\]/g, (match, p1) => {
          return `<span class="editable-field" contenteditable="true" onclick="event.stopPropagation()">${p1}</span>`;
        });
        if (contentElement.innerHTML !== processed) {
          contentElement.innerHTML = processed;
        }
      }

      function processAllEditableFields() {
        document.querySelectorAll(".template-content").forEach((content) => {
          processEditableFields(content);
        });
      }

      function handleContentEdit(element) {
        const templateId = element.dataset.templateId;
        const card = document.getElementById(`card-${templateId}`);
        const resetBtn = document.getElementById(`reset-${templateId}`);
        const originalContent = originalContents.get(templateId);
        if (element.innerHTML.trim() !== originalContent.trim()) {
          element.classList.add("edited");
          card.classList.add("has-changes");
          resetBtn.disabled = false;
        } else {
          element.classList.remove("edited");
          card.classList.remove("has-changes");
          resetBtn.disabled = true;
        }
      }

      function copyTemplate(templateId) {
        const contentEl = document.querySelector(
          `[data-template-id="${templateId}"]`
        );
        const cleanedText = contentEl.innerText.replace(/‚ñ°/g, "");
        navigator.clipboard
          .writeText(cleanedText)
          .then(() => {
            showNotification("‚úÖ Plantilla copiada al portapapeles", "success");
          })
          .catch((err) => {
            const textarea = document.createElement("textarea");
            textarea.value = cleanedText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
            showNotification("‚úÖ Plantilla copiada", "success");
          });
      }

      function resetTemplate(templateId) {
        const content = document.querySelector(
          `[data-template-id="${templateId}"]`
        );
        const card = document.getElementById(`card-${templateId}`);
        const resetBtn = document.getElementById(`reset-${templateId}`);
        const originalContent = originalContents.get(templateId);
        if (originalContent) {
          content.innerHTML = originalContent;
          content.classList.remove("edited");
          card.classList.remove("has-changes");
          resetBtn.disabled = true;
          processEditableFields(content);
          showNotification("‚Ü©Ô∏è Plantilla restaurada", "info");
        }
      }

      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type}`;
        notification.style.display = "block";
        setTimeout(() => {
          notification.style.display = "none";
        }, 3000);
      }

      function showCategory(category) {
        currentCategory = category;
        document.querySelectorAll(".category-item").forEach((item) => {
          item.classList.toggle("active", item.dataset.category === category);
        });
        const categoryElement = document.getElementById(
          `category-${category.replace(/[\s&]+/g, "-").toLowerCase()}`
        );
        if (categoryElement) {
          categoryElement.scrollIntoView({
            behavior: "smooth",
            block: "start",
          });
        }
      }

      function setupEventListeners() {
        const searchBox = document.getElementById("searchBox");
        let searchTimeout;
        searchBox.addEventListener("input", (e) => {
          clearTimeout(searchTimeout);
          searchTimeout = setTimeout(() => {
            renderTemplates(e.target.value);
          }, 300);
        });
        document.addEventListener("keydown", (e) => {
          if ((e.ctrlKey || e.metaKey) && e.key === "f") {
            e.preventDefault();
            searchBox.focus();
          }
          if (e.key === "Escape" && document.activeElement === searchBox) {
            searchBox.value = "";
            renderTemplates();
          }
        });
        window.addEventListener("beforeunload", (e) => {
          if (document.querySelector(".template-card.has-changes")) {
            e.preventDefault();
            e.returnValue =
              "¬øEst√°s seguro? Hay cambios sin guardar en las plantillas.";
          }
        });
      }

      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
