<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualizaci√≥n de LLM | @ernestob</title>
    <link rel="icon" href="/assets/images/icon.webp" />
    <link rel="stylesheet" href="/assets/css/main.css" />
    <link rel="stylesheet" href="/assets/css/header.css" />
    <link rel="stylesheet" href="/assets/css/components.css" />
    <link rel="stylesheet" href="/assets/css/footer.css" />
    <link rel="stylesheet" href="/assets/css/demo-llm.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
    />

    <meta property="og:type" content="article" />
    <meta
      property="og:title"
      content="Visualizaci√≥n de Modelos de Lenguaje (LLM) | ‚Äãüë®‚Äç‚öïÔ∏è ‚Äã@ernestob"
    />
    <meta
      property="og:site_name"
      content="Recursos para la gesti√≥n de informaci√≥n sanitaria üîéü©∫‚öï"
    />
    <meta
      property="og:url"
      content="https://ernestobarrera.github.io/demo-llm.html/"
    />
    <meta
      property="og:image"
      content="https://ernestobarrera.github.io/assets/images/me.png"
    />

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              blue: {
                100: "#3a506e",
                200: "#2f4563",
                300: "#25395a",
                400: "#1d2e4d",
                500: "#152442",
                600: "#0f1a36",
                700: "#0a152d",
                800: "#060e23",
                900: "#03071a",
              },
              gray: {
                50: "var(--primary-bg)",
                100: "var(--secondary-bg)",
                200: "#374151",
                300: "#3a4b5c",
                400: "#64748b",
                700: "var(--text-primary)",
                600: "var(--text-secondary)",
              },
              green: {
                400: "#2c855a",
                600: "#15603c",
              },
              red: {
                400: "#b84a4a",
                600: "#962323",
              },
              yellow: {
                50: "rgba(255, 215, 0, 0.1)",
                200: "var(--accent-color)",
              },
            },
          },
        },
      };
    </script>
  </head>
  <body class="ia-salud">
    <include src="header.html"></include>

    <main class="main-container">
      <section class="hero-section">
        <h1 class="main-title">
          <i class="fas fa-brain"></i>
          <span>Visualizaci√≥n de Modelos de Lenguaje (LLM)</span>
        </h1>
        <p class="intro-text">
          Esta herramienta interactiva te permite visualizar c√≥mo funciona un
          Modelo de Lenguaje Grande (LLM) a trav√©s de sus principales etapas de
          procesamiento: tokenizaci√≥n, embedding, mecanismo de atenci√≥n y
          generaci√≥n de texto. Utiliza el ejemplo "El gato est√° sentado sobre la
          alfombra" para mostrar c√≥mo el modelo representa y procesa la
          informaci√≥n contextual para generar respuestas coherentes.
        </p>
      </section>

      <div id="root" class="mt-4"></div>
    </main>

    <script src="./assets/js/utils.js"></script>
    <include src="footer.html"></include>
    <script src="/assets/js/include.js"></script>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-YFKR6RB1ZC"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-YFKR6RB1ZC");
    </script>

    <!-- Nuevo componente de la aplicaci√≥n mejorada -->
    <script type="text/babel">
      const EnhancedLLMDemo = () => {
        // Estados base
        const [step, setStep] = React.useState(0);
        const [activeToken, setActiveToken] = React.useState(null);
        const [showVectors, setShowVectors] = React.useState(true);
        const [selectedLayer, setSelectedLayer] = React.useState(0);
        const [outputText, setOutputText] = React.useState("");
        const [isGenerating, setIsGenerating] = React.useState(false);
        // Estados adicionales para funcionalidades ampliadas
        const [showAdvancedInfo, setShowAdvancedInfo] = React.useState(false);
        const [selectedExample, setSelectedExample] = React.useState(0);
        const [showAnimations, setShowAnimations] = React.useState(true);
        const [activeDimension, setActiveDimension] = React.useState(null);
        const [showConnectionsView, setShowConnectionsView] =
          React.useState(false);
        const [selectedModel, setSelectedModel] = React.useState("base");
        const [activeTab, setActiveTab] = React.useState("visualizacion");
        const [generationCompleted, setGenerationCompleted] =
          React.useState(false);
        const models = {
          base: {
            name: "LLM Base (3 capas)",
            description: "Modelo b√°sico con tres capas de Transformer.",
          },
          advanced: {
            name: "LLM Avanzado (6 capas)",
            description:
              "Modelo intermedio con seis capas de Transformer para mayor capacidad.",
          },
          expert: {
            name: "LLM Experto (12 capas)",
            description:
              "Modelo avanzado con doce capas para tareas complejas.",
          },
        };

        // Ejemplos predefinidos
        // Ejemplos predefinidos
        const examples = [
          {
            id: 0,
            text: "El paciente presenta fiebre de 38.5¬∞C, tos seca y dificultad respiratoria desde hace 3 d√≠as",
            tokens: [
              "El",
              "paciente",
              "presenta",
              "fiebre",
              "de",
              "38.5¬∞C",
              "tos",
              "seca",
              "y",
              "dificultad",
              "respiratoria",
              "desde",
              "hace",
              "3",
              "d√≠as",
            ],
            response:
              "El cuadro cl√≠nico sugiere una infecci√≥n respiratoria aguda, posiblemente neumon√≠a o bronquitis. Se recomienda valoraci√≥n f√≠sica completa, oximetr√≠a, radiograf√≠a de t√≥rax y an√°lisis sangu√≠neos para confirmar diagn√≥stico y establecer gravedad.",
          },
          {
            id: 1,
            text: "Paciente con tratamiento de warfarina que inicia amiodarona por fibrilaci√≥n auricular",
            tokens: [
              "Paciente",
              "con",
              "tratamiento",
              "de",
              "warfarina",
              "que",
              "inicia",
              "amiodarona",
              "por",
              "fibrilaci√≥n",
              "auricular",
            ],
            response:
              "La amiodarona inhibe el metabolismo de la warfarina, potenciando su efecto anticoagulante y aumentando el riesgo de sangrado. Se recomienda reducir la dosis de warfarina en aproximadamente un 30-50% y monitorizar el INR estrechamente durante las primeras semanas. Vigilar signos de sangrado.",
          },
          {
            id: 2,
            text: "Evidencia actual sobre el uso de SGLT2 en pacientes con insuficiencia card√≠aca",
            tokens: [
              "Evidencia",
              "actual",
              "sobre",
              "el",
              "uso",
              "de",
              "SGLT2",
              "en",
              "pacientes",
              "con",
              "insuficiencia",
              "card√≠aca",
            ],
            response:
              "Los inhibidores SGLT2 han demostrado reducir significativamente las hospitalizaciones por insuficiencia card√≠aca y la mortalidad cardiovascular en pacientes con y sin diabetes. Ensayos como DAPA-HF y EMPEROR-Reduced muestran beneficios en IC con fracci√≥n de eyecci√≥n reducida, mientras que EMPEROR-Preserved evidencia beneficios en IC con fracci√≥n preservada.",
          },
          {
            id: 3,
            text: "Codificaci√≥n CIE-10 para paciente con infarto agudo de miocardio anterior con elevaci√≥n del ST",
            tokens: [
              "Codificaci√≥n",
              "CIE-10",
              "para",
              "paciente",
              "con",
              "infarto",
              "agudo",
              "de",
              "miocardio",
              "anterior",
              "con",
              "elevaci√≥n",
              "del",
              "ST",
            ],
            response:
              "El c√≥digo CIE-10 principal ser√≠a I21.0 'Infarto transmural agudo de miocardio de la pared anterior'. Se deben considerar c√≥digos adicionales para procedimientos realizados (como intervenci√≥n coronaria percut√°nea), complicaciones espec√≠ficas y factores de riesgo relevantes como hipertensi√≥n (I10) o diabetes (E11.-).",
          },
        ];

        // Obtener el ejemplo actual
        const currentExample = examples[selectedExample];
        const sentence = currentExample.text;
        const tokens = currentExample.tokens;

        // Vectores simplificados 2D
        const getVectors2D = () => {
          const seed = selectedExample + 1;
          return tokens.map((token, idx) => {
            const x = Math.sin(idx * 0.5 * seed) * 0.8;
            const y = Math.cos(idx * 0.7 * seed) * 0.7;
            return [x, y];
          });
        };
        const vectors2D = getVectors2D();

        // Vectores completos (embeddings)
        // Vectores completos (embeddings)
        const getVectors = () => {
          const seed = selectedExample + 1;
          return tokens.map((token, idx) => {
            const isNoun =
              /^[A-Z][a-z]+$/.test(token) ||
              [
                "paciente",
                "fiebre",
                "tos",
                "dificultad",
                "d√≠as",
                "warfarina",
                "amiodarona",
                "fibrilaci√≥n",
                "SGLT2",
                "insuficiencia",
                "card√≠aca",
                "infarto",
                "miocardio",
                "elevaci√≥n",
              ].includes(token);
            const isVerb = [
              "presenta",
              "inicia",
              "inhibibe",
              "potenciando",
              "aumentando",
              "reducir",
              "monitorizar",
              "es",
              "recomienda",
              "han",
              "demostrado",
              "reducir",
            ].includes(token);
            const isDet = [
              "El",
              "La",
              "el",
              "la",
              "un",
              "una",
              "los",
              "las",
              "del",
            ].includes(token);
            const isPrep = [
              "sobre",
              "en",
              "de",
              "por",
              "para",
              "con",
              "sin",
              "durante",
            ].includes(token);
            const isMedical = [
              "paciente",
              "fiebre",
              "tos",
              "respiratoria",
              "warfarina",
              "amiodarona",
              "fibrilaci√≥n",
              "auricular",
              "SGLT2",
              "insuficiencia",
              "card√≠aca",
              "CIE-10",
              "infarto",
              "miocardio",
              "ST",
              "diabetes",
              "neumon√≠a",
            ].includes(token);
            const isSeverity = [
              "agudo",
              "cr√≥nico",
              "grave",
              "leve",
              "38.5¬∞C",
              "seca",
              "dificultad",
            ].includes(token);
            const isTreatment = [
              "tratamiento",
              "warfarina",
              "amiodarona",
              "SGLT2",
              "inhibidores",
            ].includes(token);

            return [
              isNoun
                ? 0.7 + Math.sin(idx * seed * 0.3) * 0.2
                : -0.3 + Math.sin(idx * seed * 0.3) * 0.3,
              isVerb
                ? 0.8 + Math.cos(idx * seed * 0.4) * 0.1
                : -0.2 + Math.cos(idx * seed * 0.3) * 0.2,
              isDet
                ? 0.9 + Math.sin(idx * seed * 0.2) * 0.1
                : -0.3 + Math.sin(idx * seed * 0.2) * 0.2,
              isPrep
                ? 0.8 + Math.cos(idx * seed * 0.5) * 0.2
                : -0.2 + Math.cos(idx * seed * 0.6) * 0.2,
              isMedical ? 0.9 : Math.sin(idx * seed * 0.7) * 0.4,
              isSeverity
                ? 0.7 + Math.sin(idx * seed) * 0.3
                : Math.cos(idx * seed * 0.8) * 0.4,
              isTreatment
                ? 0.8 + Math.cos(idx * seed * 0.9) * 0.2
                : Math.sin(idx * seed * 0.5) * 0.4,
            ];
          });
        };
        const vectors = getVectors();

        // Dimensiones sem√°nticas
        const dimensions = [
          "Sustantivo",
          "Verbo",
          "Determinante",
          "Preposici√≥n",
          "Medicina/Salud",
          "Gravedad/Intensidad",
          "Tratamiento/Intervenci√≥n",
        ];

        // Matrices de atenci√≥n generadas din√°micamente
        // Matrices de atenci√≥n generadas din√°micamente
        // Matrices de atenci√≥n generadas din√°micamente
        const getAttentionLayers = () => {
          const tokenCount = tokens.length;
          const normalizeAttention = (weights) => {
            const sum = weights.reduce((a, b) => a + b, 0);
            return weights.map((w) => w / sum);
          };

          // Capa 1: Atenci√≥n local - Relaciones gramaticales
          const layer1 = Array(tokenCount)
            .fill(0)
            .map((_, i) => {
              const weights = Array(tokenCount)
                .fill(0)
                .map((_, j) => {
                  const distance = Math.abs(i - j);

                  // Establecer relaciones gramaticales espec√≠ficas
                  if (
                    (tokens[i] === "El" && tokens[j] === "paciente") ||
                    (tokens[i] === "la" && tokens[j] === "dosis") ||
                    (tokens[i] === "con" && tokens[j] === "tratamiento") ||
                    (tokens[i] === "de" && tokens[j] === "warfarina") ||
                    (tokens[i] === "auricular" &&
                      tokens[j] === "fibrilaci√≥n") ||
                    (tokens[i] === "agudo" && tokens[j] === "infarto") ||
                    (tokens[i] === "anterior" && tokens[j] === "miocardio") ||
                    (tokens[i] === "por" && j > i && distance <= 2) // Preposiciones atienden a lo que les sigue
                  ) {
                    return 0.8;
                  } else if (i === j) {
                    return 0.1; // Poca auto-atenci√≥n
                  } else if (distance === 1) {
                    return 0.4; // Atenci√≥n moderada a palabras adyacentes
                  } else {
                    return Math.max(0.05, 0.3 - distance * 0.05);
                  }
                });
              return normalizeAttention(weights);
            });

          // Capa 2: Atenci√≥n sem√°ntica - Relaciones de significado
          const layer2 = Array(tokenCount)
            .fill(0)
            .map((_, i) => {
              const weights = Array(tokenCount)
                .fill(0)
                .map((_, j) => {
                  let weight = 0.1;

                  // Relaciones sem√°nticas m√©dicas espec√≠ficas
                  if (
                    (tokens[i] === "paciente" &&
                      ["presenta", "con", "fiebre", "tos"].includes(
                        tokens[j]
                      )) ||
                    (tokens[i] === "fiebre" &&
                      ["38.5¬∞C", "tos", "dificultad"].includes(tokens[j])) ||
                    (tokens[i] === "tos" &&
                      ["seca", "respiratoria", "dificultad"].includes(
                        tokens[j]
                      )) ||
                    (tokens[i] === "warfarina" &&
                      ["tratamiento", "con", "paciente", "amiodarona"].includes(
                        tokens[j]
                      )) ||
                    (tokens[i] === "amiodarona" &&
                      ["inicia", "fibrilaci√≥n", "auricular"].includes(
                        tokens[j]
                      )) ||
                    (tokens[i] === "fibrilaci√≥n" &&
                      ["auricular", "amiodarona"].includes(tokens[j])) ||
                    (tokens[i] === "SGLT2" &&
                      [
                        "uso",
                        "insuficiencia",
                        "card√≠aca",
                        "evidencia",
                      ].includes(tokens[j])) ||
                    (tokens[i] === "infarto" &&
                      ["miocardio", "agudo", "ST", "elevaci√≥n"].includes(
                        tokens[j]
                      )) ||
                    (tokens[i] === "CIE-10" &&
                      ["codificaci√≥n", "infarto"].includes(tokens[j]))
                  ) {
                    weight = 0.8;
                  } else if (i === j) {
                    weight = 0.2; // Algo de auto-atenci√≥n, pero no demasiada
                  }

                  return weight;
                });
              return normalizeAttention(weights);
            });

          // Capa 3: Atenci√≥n global - Contexto completo
          const layer3 = Array(tokenCount)
            .fill(0)
            .map((_, i) => {
              const weights = Array(tokenCount)
                .fill(0)
                .map((_, j) => {
                  let weight = 0.1 + Math.sin(i * j * 0.1) * 0.05;

                  // Enfatizar palabras clave seg√∫n el tema m√©dico del ejemplo
                  const keyWordsMap = {
                    0: [
                      "fiebre",
                      "tos",
                      "dificultad",
                      "respiratoria",
                      "paciente",
                    ], // Ejemplo de condici√≥n respiratoria
                    1: ["warfarina", "amiodarona", "fibrilaci√≥n", "auricular"], // Ejemplo de interacciones medicamentosas
                    2: ["SGLT2", "insuficiencia", "card√≠aca", "pacientes"], // Ejemplo de evidencia m√©dica
                    3: ["CIE-10", "infarto", "miocardio", "codificaci√≥n"], // Ejemplo de codificaci√≥n
                  };

                  if (keyWordsMap[selectedExample].includes(tokens[j])) {
                    weight += 0.2;
                  }

                  return Math.max(0.05, weight);
                });
              return normalizeAttention(weights);
            });

          return [layer1, layer2, layer3];
        };
        const attentionLayers = getAttentionLayers();

        // Nombres de capas
        const layerNames = [
          "Capa 1: Atenci√≥n local - Relaciones gramaticales",
          "Capa 2: Atenci√≥n sem√°ntica - Relaciones de significado",
          "Capa 3: Atenci√≥n global - Contexto completo",
        ];

        // Descripciones de procesos y analog√≠as
        // Descripciones de procesos y analog√≠as
        const processDescriptions = {
          tokenization: {
            basic:
              "El texto se divide en unidades b√°sicas (tokens) que el modelo procesa.",
            advanced:
              "En modelos reales se usan subpalabras para mayor flexibilidad y manejo de vocabulario.",
          },
          embedding: {
            basic:
              "Cada token se convierte en un vector num√©rico multidimensional.",
            advanced:
              "Los embeddings son representaciones densas que capturan el significado y relaciones contextuales.",
          },
          attention: {
            basic:
              "El modelo determina qu√© tokens son relevantes en el contexto.",
            advanced:
              "La atenci√≥n permite que cada token 'mire' a los dem√°s para capturar dependencias a distancia.",
            layers:
              "Los modelos utilizan m√∫ltiples capas: la local captura relaciones gramaticales cercanas, la sem√°ntica identifica conexiones de significado entre palabras relacionadas, y la global integra informaci√≥n de toda la oraci√≥n.",
          },
          generation: {
            basic: "El modelo predice token a token para generar la respuesta.",
            advanced:
              "La generaci√≥n se basa en distribuciones de probabilidad y t√©cnicas como beam search o sampling.",
          },
        };
        const analogies = {
          tokenization:
            "Como dividir un libro en palabras o s√≠labas para procesarlo.",
          embedding:
            "Como ubicar cada palabra en un mapa multidimensional donde palabras similares se agrupan.",
          attention:
            "Como cuando ciertas palabras te hacen recordar otras para entender el sentido completo.",
          generation:
            "Como completar una frase bas√°ndose en todas las posibles continuaciones.",
        };

        // Iniciar la demo
        const startDemo = () => {
          if (!showAnimations) {
            setStep(4);
            setOutputText(currentExample.response);
            setIsGenerating(false);
            setGenerationCompleted(true); // Marca como completado inmediatamente si no hay animaciones
            return;
          }
          setStep(0);
          setOutputText("");
          setActiveToken(null);
          setIsGenerating(false);
          setGenerationCompleted(false); // Reinicia el estado al comenzar
          setTimeout(() => setStep(1), 1000);
          setTimeout(() => setStep(2), 2500);
          setTimeout(() => setStep(3), 4000);
          setTimeout(() => {
            setStep(4);
            generateText();
          }, 5500);
        };

        // Generar texto gradualmente
        const generateText = () => {
          setIsGenerating(true);
          setGenerationCompleted(false); // Reinicia el estado al comenzar
          const response = currentExample.response;
          const words = response.split(" ");
          let currentText = "";
          let wordIndex = 0;
          const interval = setInterval(() => {
            if (wordIndex < words.length) {
              currentText += (wordIndex > 0 ? " " : "") + words[wordIndex];
              setOutputText(currentText);
              wordIndex++;
            } else {
              clearInterval(interval);
              setIsGenerating(false);
              setGenerationCompleted(true); // Marca como completado
            }
          }, 500);
        };

        // Manejar cambio de ejemplo
        const handleExampleChange = (exampleId) => {
          setSelectedExample(exampleId);
          setActiveToken(null);
          startDemo();
        };

        // Interpretaci√≥n de embeddings para un token
        const getEmbeddingInterpretation = (tokenIdx) => {
          if (tokenIdx === null) return "";
          const token = tokens[tokenIdx];
          const vec = vectors[tokenIdx];
          const highDims = vec
            .map((val, idx) => ({ val, dim: dimensions[idx] }))
            .filter((item) => item.val > 0.5)
            .sort((a, b) => b.val - a.val)
            .map((item) => item.dim);
          const lowDims = vec
            .map((val, idx) => ({ val, dim: dimensions[idx] }))
            .filter((item) => item.val < -0.5)
            .sort((a, b) => a.val - b.val)
            .map((item) => item.dim);
          let interpretation = `"${token}" tiene valores altos en`;
          interpretation +=
            highDims.length > 0
              ? ` ${highDims.map((d) => `"${d}"`).join(", ")}`
              : " ninguna dimensi√≥n particular";
          if (lowDims.length > 0) {
            interpretation += ` y bajos en ${lowDims
              .map((d) => `"${d}"`)
              .join(", ")}`;
          }
          return interpretation + ".";
        };

        // Colores para barras y celdas
        const getEmbeddingColor = (value) => {
          if (value > 0.5) return "bg-green-600";
          if (value > 0.2) return "bg-green-400";
          if (value > -0.2) return "bg-gray-300";
          if (value > -0.5) return "bg-red-400";
          return "bg-red-600";
        };

        // Renderizar conexiones de atenci√≥n (opcional)
        const renderAttentionConnections = () => {
          if (!showConnectionsView || activeToken === null) return null;
          const connections = [];
          const threshold = 0.15;
          tokens.forEach((token, idx) => {
            const weight = attentionLayers[selectedLayer][activeToken][idx];
            if (weight > threshold && idx !== activeToken) {
              connections.push({ from: activeToken, to: idx, weight });
            }
          });
          return (
            <div className="mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg">
              <h4 className="text-md font-medium mb-2">
                Conexiones de atenci√≥n:
              </h4>
              <div className="flex flex-wrap gap-2 justify-center">
                {tokens.map((token, idx) => (
                  <div
                    key={idx}
                    className={`relative px-3 py-1 rounded-lg ${
                      idx === activeToken
                        ? "bg-blue-500 text-white"
                        : "bg-blue-100"
                    }`}
                    style={{ minWidth: "60px", textAlign: "center" }}
                  >
                    {token}
                  </div>
                ))}
              </div>
              <div className="mt-3 text-sm text-gray-600">
                {connections.length > 0 ? (
                  <span>
                    El token "{tokens[activeToken]}" presta mayor atenci√≥n a:{" "}
                    {connections
                      .sort((a, b) => b.weight - a.weight)
                      .map(
                        (c) =>
                          `"${tokens[c.to]}" (${(c.weight * 100).toFixed(0)}%)`
                      )
                      .join(", ")}
                  </span>
                ) : (
                  <span>
                    No hay conexiones de atenci√≥n fuertes con el umbral actual.
                  </span>
                )}
              </div>
            </div>
          );
        };

        // Renderizado de la arquitectura del modelo
        const renderModelArchitecture = () => {
          const layers =
            selectedModel === "base"
              ? 3
              : selectedModel === "advanced"
              ? 6
              : 12;

          return (
            <div className="architecture-container">
              <h3 className="architecture-title">Arquitectura del Modelo</h3>

              <div className="model-selector">
                <div className="model-info">
                  <div className="model-name">{models[selectedModel].name}</div>
                  <div className="model-description">
                    {models[selectedModel].description}
                  </div>
                </div>

                <div className="model-select-controls">
                  <label htmlFor="model-select">Seleccionar modelo:</label>
                  <select
                    id="model-select"
                    value={selectedModel}
                    onChange={(e) => setSelectedModel(e.target.value)}
                    className="model-select"
                  >
                    <option value="base">LLM Base (3 capas)</option>
                    <option value="advanced">LLM Avanzado (6 capas)</option>
                    <option value="expert">LLM Experto (12 capas)</option>
                  </select>
                </div>
              </div>

              <div className="architecture-diagram">
                <div className="arch-layer input-layer">
                  <div className="layer-content">
                    <span className="layer-label">Entrada:</span>
                    <span className="layer-data">"{sentence}"</span>
                  </div>
                </div>

                <div className="arch-connector"></div>

                <div className="arch-layer embedding-layer">
                  <div className="layer-content">
                    <span className="layer-label">Capa de Embedding</span>
                  </div>
                </div>

                <div className="arch-connector"></div>

                {Array(layers)
                  .fill(0)
                  .map((_, i) => (
                    <React.Fragment key={i}>
                      <div
                        className={`arch-layer transformer-layer ${
                          i === selectedLayer ? "active" : ""
                        }`}
                      >
                        <div className="layer-content">
                          <span className="layer-label">
                            Capa de Transformer {i + 1}
                          </span>
                          <div className="layer-components">
                            <span className="component">
                              Atenci√≥n Multi-Cabeza
                            </span>
                            <span className="component">Feed-Forward</span>
                          </div>
                        </div>
                      </div>
                      <div className="arch-connector"></div>
                    </React.Fragment>
                  ))}

                <div className="arch-layer output-layer">
                  <div className="layer-content">
                    <span className="layer-label">
                      Capa de Salida / Predicci√≥n
                    </span>
                  </div>
                </div>

                <div className="arch-connector"></div>

                <div className="arch-layer response-layer">
                  <div className="layer-content">
                    <span className="layer-label">Respuesta:</span>
                    <span className="layer-data">"{outputText || "..."}"</span>
                  </div>
                </div>
              </div>

              <div className="architecture-explainer">
                <h4>¬øC√≥mo funciona la arquitectura?</h4>
                <ol>
                  <li>El texto se tokeniza y convierte en embeddings.</li>
                  <li>
                    Cada capa Transformer procesa los embeddings mediante:
                    <ul>
                      <li>
                        <strong>Atenci√≥n Multi-Cabeza:</strong> se enfoca en
                        distintas partes del input.
                      </li>
                      <li>
                        <strong>Red Feed-Forward:</strong> transforma los
                        vectores.
                      </li>
                    </ul>
                  </li>
                  <li>
                    Las conexiones residuales facilitan el flujo de informaci√≥n.
                  </li>
                  <li>La capa final predice el siguiente token.</li>
                </ol>
                <p className="note">
                  <strong>Nota:</strong> Los modelos m√°s grandes tienen m√°s
                  capas y par√°metros, mejorando su capacidad de comprensi√≥n y
                  generaci√≥n.
                </p>
              </div>
            </div>
          );
        };

        return (
          <div className="bg-white p-4">
            {/* Tabs de navegaci√≥n */}
            <div className="nav-tabs-container mb-4">
              <div className="nav-tabs">
                <button
                  className={`nav-tab ${
                    activeTab === "visualizacion" ? "active" : ""
                  }`}
                  onClick={() => setActiveTab("visualizacion")}
                >
                  Visualizaci√≥n
                </button>
                <button
                  className={`nav-tab ${
                    activeTab === "arquitectura" ? "active" : ""
                  }`}
                  onClick={() => setActiveTab("arquitectura")}
                >
                  Arquitectura
                </button>
                <button
                  className={`nav-tab ${
                    activeTab === "conceptos" ? "active" : ""
                  }`}
                  onClick={() => setActiveTab("conceptos")}
                >
                  Conceptos Avanzados
                </button>
              </div>
            </div>

            {activeTab === "visualizacion" && (
              <>
                <div className="bg-white p-4 rounded-lg shadow mb-4">
                  <div className="flex flex-wrap gap-4 mb-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Selecciona un ejemplo:
                      </label>
                      <div className="flex flex-wrap gap-2">
                        {examples.map((example) => (
                          <button
                            key={example.id}
                            className={`px-3 py-1 rounded text-sm ${
                              selectedExample === example.id
                                ? "bg-accent text-dark"
                                : "bg-dark hover:bg-secondary text-accent"
                            }`}
                            onClick={() => handleExampleChange(example.id)}
                          >
                            {`Caso ${example.id + 1}`}
                          </button>
                        ))}
                      </div>
                    </div>
                  </div>
                  <div className="mb-4">
                    <div className="flex justify-between mb-2">
                      <span
                        className={
                          step >= 1
                            ? "text-blue-600 font-medium"
                            : "text-gray-400"
                        }
                      >
                        1. Tokenizaci√≥n
                      </span>
                      <span
                        className={
                          step >= 2
                            ? "text-blue-600 font-medium"
                            : "text-gray-400"
                        }
                      >
                        2. Embedding
                      </span>
                      <span
                        className={
                          step >= 3
                            ? "text-blue-600 font-medium"
                            : "text-gray-400"
                        }
                      >
                        3. Atenci√≥n
                      </span>
                      <span
                        className={
                          step >= 4
                            ? "text-blue-600 font-medium"
                            : "text-gray-400"
                        }
                      >
                        4. Generaci√≥n
                      </span>
                    </div>
                    <div className="w-full bg-gray-200 rounded-full h-2 mb-4">
                      <div
                        className="bg-blue-600 h-2 rounded-full transition-all duration-500"
                        style={{ width: `${Math.min(100, step * 25)}%` }}
                      ></div>
                    </div>
                  </div>
                  <div className="flex flex-wrap gap-4 justify-between">
                    <div className="flex gap-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          Capa de atenci√≥n:
                        </label>
                        <select
                          value={selectedLayer}
                          onChange={(e) =>
                            setSelectedLayer(Number(e.target.value))
                          }
                          className="px-3 py-2 border border-gray-300 rounded-md"
                          disabled={step < 3}
                        >
                          <option value={0}>Capa 1 - Local</option>
                          <option value={1}>Capa 2 - Sem√°ntica</option>
                          <option value={2}>Capa 3 - Global</option>
                        </select>
                      </div>
                      <div className="flex items-end gap-3">
                        <label className="flex items-center">
                          <input
                            type="checkbox"
                            checked={showVectors}
                            onChange={() => setShowVectors(!showVectors)}
                            className="h-4 w-4 text-blue-600 mr-2"
                          />
                          <span className="text-sm font-medium text-gray-700">
                            Mostrar vectores
                          </span>
                        </label>
                        <label className="flex items-center">
                          <input
                            type="checkbox"
                            checked={showConnectionsView}
                            onChange={() =>
                              setShowConnectionsView(!showConnectionsView)
                            }
                            className="h-4 w-4 text-blue-600 mr-2"
                          />
                          <span className="text-sm font-medium text-gray-700">
                            Visualizar conexiones
                          </span>
                        </label>
                        <label className="flex items-center">
                          <input
                            type="checkbox"
                            checked={showAnimations}
                            onChange={() => setShowAnimations(!showAnimations)}
                            className="h-4 w-4 text-blue-600 mr-2"
                          />
                          <span className="text-sm font-medium text-gray-700">
                            Animaciones
                          </span>
                        </label>
                      </div>
                    </div>
                    <button
                      onClick={startDemo}
                      disabled={isGenerating}
                      className="px-4 py-2 bg-accent text-dark rounded-md hover:brightness-110 disabled:opacity-50"
                    >
                      {isGenerating
                        ? "Generando..."
                        : "Reiniciar Visualizaci√≥n"}
                    </button>
                  </div>
                  <div className="mt-3 pt-3 border-t border-gray-200">
                    <details>
                      <summary className="text-sm font-medium text-blue-600 cursor-pointer">
                        ¬øQu√© estoy viendo? (Explicaci√≥n r√°pida)
                      </summary>
                      <div className="mt-2 text-sm text-gray-600 bg-blue-50 p-3 rounded">
                        <p className="mb-2">
                          Esta visualizaci√≥n muestra los cuatro pasos
                          principales:
                        </p>
                        <ol className="list-decimal pl-5 space-y-1">
                          <li>
                            <strong>Tokenizaci√≥n:</strong>{" "}
                            {processDescriptions.tokenization.basic}
                          </li>
                          <li>
                            <strong>Embedding:</strong>{" "}
                            {processDescriptions.embedding.basic}
                          </li>
                          <li>
                            <strong>Atenci√≥n:</strong>{" "}
                            {processDescriptions.attention.basic}
                          </li>
                          <li>
                            <strong>Generaci√≥n:</strong>{" "}
                            {processDescriptions.generation.basic}
                          </li>
                        </ol>
                        <p className="mt-2">
                          Explora cada etapa haciendo clic en los tokens.
                        </p>
                      </div>
                    </details>
                  </div>
                </div>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                  <div className="bg-white p-4 rounded-lg shadow">
                    <h3 className="text-lg font-medium mb-4">
                      1. Tokenizaci√≥n y 2. Embedding
                    </h3>
                    {step >= 1 && (
                      <div className="mb-4">
                        <div className="flex flex-wrap gap-2 mb-3">
                          {tokens.map((token, idx) => (
                            <div
                              key={idx}
                              className={`px-3 py-1 rounded cursor-pointer transition-all ${
                                activeToken === idx
                                  ? "bg-blue-500 text-white"
                                  : "bg-blue-100 hover:bg-blue-200"
                              }`}
                              onClick={() =>
                                setActiveToken(activeToken === idx ? null : idx)
                              }
                            >
                              {token}
                            </div>
                          ))}
                        </div>
                        <p className="text-sm text-gray-600 mb-4">
                          El texto se divide en tokens. Haz clic en uno para ver
                          su representaci√≥n.
                        </p>
                      </div>
                    )}
                    {step >= 2 && activeToken !== null && (
                      <div className="embedding-details mb-4">
                        <div className="embedding-title mb-2">
                          Embedding para "{tokens[activeToken]}":
                        </div>
                        <div className="space-y-2 mb-4">
                          {vectors[activeToken].map((value, dim) => (
                            <div
                              key={dim}
                              className={`embedding-dimension flex items-center mb-1 ${
                                activeDimension === dim
                                  ? "active-dimension"
                                  : ""
                              }`}
                              onMouseEnter={() => setActiveDimension(dim)}
                              onMouseLeave={() => setActiveDimension(null)}
                            >
                              <div className="dimension-name w-28 text-sm truncate">
                                {dimensions[dim]}:
                              </div>
                              <div className="dimension-bar flex-grow h-6 rounded-full overflow-hidden">
                                <div
                                  className={`dimension-value h-full ${
                                    value > 0.5
                                      ? "high-value"
                                      : value > 0.2
                                      ? "medium-high-value"
                                      : value > -0.2
                                      ? "neutral-value"
                                      : value > -0.5
                                      ? "medium-low-value"
                                      : "low-value"
                                  }`}
                                  style={{ width: `${Math.abs(value * 100)}%` }}
                                ></div>
                              </div>
                              <div className="dimension-number ml-2 text-sm w-12 text-right">
                                {value.toFixed(1)}
                              </div>
                            </div>
                          ))}
                        </div>
                        {showVectors && (
                          <div className="vector-representation p-2 rounded border mb-3 font-mono text-sm">
                            <span className="token-name">
                              {tokens[activeToken]}
                            </span>{" "}
                            = [
                            {vectors[activeToken].map((val, i) => (
                              <span
                                key={i}
                                className={
                                  val > 0.5
                                    ? "vector-high"
                                    : val < -0.5
                                    ? "vector-low"
                                    : "vector-neutral"
                                }
                              >
                                {val.toFixed(1)}
                                {i < vectors[activeToken].length - 1
                                  ? ", "
                                  : ""}
                              </span>
                            ))}
                            ]
                          </div>
                        )}
                        <p className="vector-interpretation text-sm">
                          <strong>Interpretaci√≥n:</strong>{" "}
                          {getEmbeddingInterpretation(activeToken)}
                        </p>
                      </div>
                    )}
                    {step >= 2 && showVectors && (
                      <div className="mt-4">
                        <h4 className="text-md font-medium mb-2">
                          Espacio Vectorial 2D (simplificado):
                        </h4>
                        <div className="vector-space-diagram">
                          <div className="axis x-axis"></div>
                          <div className="axis y-axis"></div>
                          <div className="axis-label x-label">+X</div>
                          <div className="axis-label y-label">+Y</div>
                          {vectors2D.map((coords, idx) => {
                            // mant√©n exactamente el mismo c√≥digo para renderizar los tokens
                            const x = 50 + coords[0] * 40;
                            const y = 50 - coords[1] * 40;
                            const isActive = activeToken === idx;
                            return (
                              <div
                                key={idx}
                                className={`vector-token absolute rounded-full border-2 transform -translate-x-1/2 -translate-y-1/2 flex items-center justify-center cursor-pointer transition-all ${
                                  isActive
                                    ? "active-token z-10 shadow-lg"
                                    : "inactive-token hover:bg-blue-50"
                                }`}
                                style={{
                                  left: `${x}%`,
                                  top: `${y}%`,
                                }}
                                onClick={() =>
                                  setActiveToken(isActive ? null : idx)
                                }
                              >
                                <span className="token-text">
                                  {tokens[idx]}
                                </span>
                              </div>
                            );
                          })}
                        </div>
                        <div className="mt-2 flex justify-between items-start">
                          <p className="text-xs text-gray-600 flex-grow">
                            <strong>Nota:</strong> Esta representaci√≥n es
                            simplificada. Los embeddings reales tienen muchas
                            m√°s dimensiones.
                          </p>
                          <div className="text-xs text-gray-500 bg-gray-50 p-1 rounded ml-2 border border-gray-200">
                            <div className="flex items-center">
                              <div className="w-3 h-3 rounded-full border-2 border-accent bg-yellow-50 mr-1"></div>
                              <span>Token seleccionado</span>
                            </div>
                            <div className="flex items-center mt-1">
                              <div className="w-3 h-3 rounded-full bg-secondary border border-gray-300 mr-1"></div>
                              <span>Otros tokens</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    )}
                  </div>
                  <div className="bg-white p-4 rounded-lg shadow">
                    <h3 className="text-lg font-medium mb-4">3. Atenci√≥n</h3>
                    <div className="mb-4 text-sm text-gray-600 bg-gray-50 p-3 rounded border-l-4 border-blue-400">
                      <p>
                        <strong>Contexto:</strong>{" "}
                        {processDescriptions.attention.basic}
                      </p>
                      <p className="mt-1">
                        <strong>Analog√≠a:</strong> {analogies.attention}
                      </p>
                      <p className="mt-1">
                        <strong>Capas de atenci√≥n:</strong>{" "}
                        {processDescriptions.attention.layers}
                      </p>
                      {showAdvancedInfo && (
                        <div className="mt-2 p-2 bg-white rounded shadow-inner">
                          <p>{processDescriptions.attention.advanced}</p>
                        </div>
                      )}
                    </div>
                    {step >= 3 && (
                      <div className="mb-6">
                        <div className="text-sm font-medium mb-2">
                          {layerNames[selectedLayer]}
                        </div>
                        {activeToken !== null ? (
                          <div className="token-focus-view">
                            <div className="mb-2 font-medium">
                              <strong>
                                Atenci√≥n desde "{tokens[activeToken]}" hacia
                                otros tokens:
                              </strong>
                            </div>
                            <div className="space-y-2 mb-3">
                              {tokens.map((token, idx) => {
                                const weight =
                                  attentionLayers[selectedLayer][activeToken][
                                    idx
                                  ];
                                const level = Math.min(
                                  9,
                                  Math.floor(weight * 10)
                                );
                                return (
                                  <div key={idx} className="flex items-center">
                                    <div className="w-20 text-sm truncate">
                                      {token}
                                    </div>
                                    <div className="flex-grow h-6 bg-gray-200 rounded-full overflow-hidden">
                                      <div
                                        className={`h-full attention-level-${level}`}
                                        style={{ width: `${weight * 100}%` }}
                                      ></div>
                                    </div>
                                    <div className="ml-2 text-sm w-16 text-right">
                                      {(weight * 100).toFixed(0)}%
                                    </div>
                                  </div>
                                );
                              })}
                            </div>
                            <p className="text-sm text-gray-600 mb-3">
                              <strong>Interpretaci√≥n:</strong> "
                              {tokens[activeToken]}" presta m√°s atenci√≥n a "
                              {
                                tokens[
                                  attentionLayers[selectedLayer][
                                    activeToken
                                  ].indexOf(
                                    Math.max(
                                      ...attentionLayers[selectedLayer][
                                        activeToken
                                      ]
                                    )
                                  )
                                ]
                              }
                              " en esta capa.
                              {selectedLayer === 0
                                ? " Esto refleja relaciones gramaticales locales."
                                : selectedLayer === 1
                                ? " Esto refleja conexiones sem√°nticas entre palabras."
                                : " Esto refleja el contexto global de la oraci√≥n."}
                            </p>
                            {renderAttentionConnections()}
                          </div>
                        ) : (
                          <div>
                            <div className="attention-wrapper">
                              <div className="overflow-x-auto">
                                <table className="attention-table">
                                  <thead>
                                    <tr>
                                      <th className="corner-header">De \ A</th>
                                      {tokens.map((token, idx) => (
                                        <th key={idx}>{token}</th>
                                      ))}
                                    </tr>
                                  </thead>
                                  <tbody>
                                    {tokens.map((fromToken, i) => (
                                      <tr key={i}>
                                        <td
                                          className="row-header"
                                          onClick={() => setActiveToken(i)}
                                        >
                                          {fromToken}
                                        </td>
                                        {tokens.map((toToken, j) => {
                                          const weight =
                                            attentionLayers[selectedLayer][i][
                                              j
                                            ];
                                          const level = Math.min(
                                            9,
                                            Math.floor(weight * 10)
                                          );
                                          return (
                                            <td
                                              key={j}
                                              className={`table-attention-cell attention-level-${level}`}
                                              title={`${fromToken} ‚Üí ${toToken}: ${(
                                                weight * 100
                                              ).toFixed(0)}%`}
                                            >
                                              {weight > 0.25
                                                ? `${(weight * 100).toFixed(
                                                    0
                                                  )}%`
                                                : ""}
                                            </td>
                                          );
                                        })}
                                      </tr>
                                    ))}
                                  </tbody>
                                </table>
                              </div>

                              <div className="attention-legend">
                                <div className="legend-item">
                                  <div className="legend-color low-attention"></div>
                                  <span className="legend-label">
                                    Baja atenci√≥n
                                  </span>
                                </div>
                                <div className="legend-item">
                                  <div className="legend-color high-attention"></div>
                                  <span className="legend-label">
                                    Alta atenci√≥n
                                  </span>
                                </div>
                              </div>
                            </div>

                            <p className="text-sm text-gray-600 mb-3">
                              El mecanismo de atenci√≥n determina qu√© tokens son
                              relevantes.
                              <strong>
                                {" "}
                                Haz clic en un token a la izquierda para ver sus
                                pesos.
                              </strong>
                            </p>
                            <div className="mt-3 bg-yellow-50 p-2 rounded border border-yellow-200 text-xs text-gray-700">
                              <strong>Cambios entre capas:</strong>
                              <ul className="pl-4 mt-1 space-y-1 list-disc">
                                <li>
                                  <strong>Capa 1 (Local):</strong> Relaciones
                                  gramaticales cercanas.
                                </li>
                                <li>
                                  <strong>Capa 2 (Sem√°ntica):</strong>{" "}
                                  Conexiones basadas en significado.
                                </li>
                                <li>
                                  <strong>Capa 3 (Global):</strong> Contexto
                                  completo.
                                </li>
                              </ul>
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                </div>
                {step >= 4 && (
                  <div>
                    <h4 className="text-md font-medium mb-2">
                      4. Generaci√≥n de respuesta:
                    </h4>
                    <div className="bg-yellow-50 p-3 rounded-lg mb-3 min-h-16 border border-yellow-200">
                      <p className="text-lg">{outputText}</p>
                      {isGenerating && (
                        <span className="inline-block w-2 h-4 bg-black ml-1 animate-pulse"></span>
                      )}
                    </div>

                    {/* Muestra tokens candidatos SIEMPRE en step 4, no solo durante la generaci√≥n */}
                    <div className="token-probability-container mt-2 p-2 bg-gray-800 rounded mb-3">
                      <div className="text-xs text-white mb-1">
                        Tokens candidatos:
                      </div>
                      <div className="grid grid-cols-3 gap-1">
                        {[
                          selectedExample === 0
                            ? "neumon√≠a"
                            : selectedExample === 1
                            ? "warfarina"
                            : selectedExample === 2
                            ? "insuficiencia"
                            : "I21.0",
                          selectedExample === 0
                            ? "bronquitis"
                            : selectedExample === 1
                            ? "dosis"
                            : selectedExample === 2
                            ? "mortalidad"
                            : "agudo",
                          selectedExample === 0
                            ? "infecci√≥n"
                            : selectedExample === 1
                            ? "anticoagulante"
                            : selectedExample === 2
                            ? "diabetes"
                            : "miocardio",
                        ].map((token, idx) => (
                          <div key={idx} className="flex items-center">
                            <div className="w-24 text-white text-xs truncate">
                              {token}
                            </div>
                            <div className="flex-grow h-4 bg-gray-700 rounded-full overflow-hidden">
                              <div
                                className="h-full"
                                style={{
                                  width: `${
                                    idx === 0 ? 75 : idx === 1 ? 20 : 5
                                  }%`,
                                  backgroundColor:
                                    idx === 0
                                      ? "rgb(16, 185, 129)"
                                      : idx === 1
                                      ? "rgb(251, 191, 36)"
                                      : "rgb(239, 68, 68)",
                                }}
                              ></div>
                            </div>
                            <div className="ml-1 text-xs text-white w-8 text-right">
                              {idx === 0 ? "75%" : idx === 1 ? "20%" : "5%"}
                            </div>
                          </div>
                        ))}
                      </div>
                    </div>

                    <div className="flex bg-gray-50 p-3 rounded-lg text-sm text-gray-600 gap-4">
                      <div className="flex-grow">
                        <p className="mb-2">
                          <strong>
                            ¬øC√≥mo funciona la generaci√≥n de texto?
                          </strong>
                        </p>
                        <ol className="list-decimal pl-4 space-y-1">
                          <li>
                            El modelo procesa la entrada a trav√©s de sus capas.
                          </li>
                          <li>
                            Calcula probabilidades para cada posible token.
                          </li>
                          <li>
                            Selecciona el token m√°s probable o realiza muestreo.
                          </li>
                          <li>A√±ade el token y repite el proceso.</li>
                        </ol>
                      </div>
                      <div className="w-32 flex flex-col items-center justify-center text-center">
                        <div className="w-full h-4 bg-gradient-to-r from-red-500 via-yellow-500 to-green-500 rounded mb-1 relative">
                          {[0, 25, 50, 75, 100].map((val) => (
                            <div
                              key={val}
                              className="absolute top-full mt-1"
                              style={{
                                left: `${val}%`,
                                transform: "translateX(-50%)",
                              }}
                            >
                              <span className="text-xs">{val}%</span>
                              <div className="h-1 w-px bg-gray-400 mx-auto mt-1"></div>
                            </div>
                          ))}
                        </div>
                        <span className="text-xs mt-6">
                          Probabilidad de selecci√≥n
                        </span>
                      </div>
                    </div>
                    {/* Secci√≥n de razonamiento cl√≠nico - visible despu√©s de completar la generaci√≥n */}
                    {step >= 4 && !isGenerating && (
                      <div className="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                        <h4 className="font-medium mb-2 text-blue-800">
                          Razonamiento cl√≠nico:
                        </h4>

                        {selectedExample === 0 && (
                          <div className="space-y-2">
                            <div className="flex items-center">
                              <div className="w-36 text-sm font-medium">
                                S√≠ntomas:
                              </div>
                              <div className="flex-grow flex flex-wrap gap-1">
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  fiebre 38.5¬∞C
                                </span>
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  tos seca
                                </span>
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  dificultad respiratoria
                                </span>
                              </div>
                            </div>

                            <div className="flex items-center">
                              <div className="w-36 text-sm font-medium">
                                Diagn√≥sticos:
                              </div>
                              <div className="flex-grow">
                                <div className="mb-2">
                                  <div className="flex justify-between mb-1">
                                    <span className="text-xs">Neumon√≠a</span>
                                    <span className="text-xs">75%</span>
                                  </div>
                                  <div className="h-2 bg-gray-200 rounded-full">
                                    <div
                                      className="h-2 bg-green-500 rounded-full"
                                      style={{ width: "75%" }}
                                    ></div>
                                  </div>
                                </div>
                                <div className="mb-2">
                                  <div className="flex justify-between mb-1">
                                    <span className="text-xs">Bronquitis</span>
                                    <span className="text-xs">60%</span>
                                  </div>
                                  <div className="h-2 bg-gray-200 rounded-full">
                                    <div
                                      className="h-2 bg-green-500 rounded-full"
                                      style={{ width: "60%" }}
                                    ></div>
                                  </div>
                                </div>
                                <div className="mb-2">
                                  <div className="flex justify-between mb-1">
                                    <span className="text-xs">
                                      Infecci√≥n viral
                                    </span>
                                    <span className="text-xs">45%</span>
                                  </div>
                                  <div className="h-2 bg-gray-200 rounded-full">
                                    <div
                                      className="h-2 bg-yellow-500 rounded-full"
                                      style={{ width: "45%" }}
                                    ></div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div className="flex items-center">
                              <div className="w-36 text-sm font-medium">
                                Recomendaciones:
                              </div>
                              <div className="flex-grow flex flex-wrap gap-1">
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  radiograf√≠a (92%)
                                </span>
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  an√°lisis (88%)
                                </span>
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  oximetr√≠a (85%)
                                </span>
                              </div>
                            </div>
                          </div>
                        )}

                        {selectedExample === 1 && (
                          <div className="space-y-2">
                            <div className="flex items-center">
                              <div className="w-36 text-sm font-medium">
                                Interacci√≥n:
                              </div>
                              <div className="flex-grow flex flex-wrap gap-1">
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  warfarina + amiodarona
                                </span>
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  potenciaci√≥n efecto
                                </span>
                              </div>
                            </div>

                            <div className="flex items-center">
                              <div className="w-36 text-sm font-medium">
                                Riesgos:
                              </div>
                              <div className="flex-grow">
                                <div className="mb-2">
                                  <div className="flex justify-between mb-1">
                                    <span className="text-xs">Sangrado</span>
                                    <span className="text-xs">85%</span>
                                  </div>
                                  <div className="h-2 bg-gray-200 rounded-full">
                                    <div
                                      className="h-2 bg-red-500 rounded-full"
                                      style={{ width: "85%" }}
                                    ></div>
                                  </div>
                                </div>
                                <div className="mb-2">
                                  <div className="flex justify-between mb-1">
                                    <span className="text-xs">
                                      Elevaci√≥n INR
                                    </span>
                                    <span className="text-xs">80%</span>
                                  </div>
                                  <div className="h-2 bg-gray-200 rounded-full">
                                    <div
                                      className="h-2 bg-red-500 rounded-full"
                                      style={{ width: "80%" }}
                                    ></div>
                                  </div>
                                </div>
                              </div>
                            </div>

                            <div className="flex items-center">
                              <div className="w-36 text-sm font-medium">
                                Recomendaciones:
                              </div>
                              <div className="flex-grow flex flex-wrap gap-1">
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  reducir dosis (95%)
                                </span>
                                <span className="px-2 py-1 bg-white rounded-full text-xs border border-blue-200">
                                  monitorizar INR (90%)
                                </span>
                              </div>
                            </div>
                          </div>
                        )}

                        <p className="mt-3 text-xs text-gray-600">
                          El modelo establece asociaciones probabil√≠sticas entre
                          hallazgos cl√≠nicos, diagn√≥sticos y recomendaciones
                          bas√°ndose en su entrenamiento con literatura m√©dica.
                        </p>
                      </div>
                    )}
                  </div>
                )}
                <div className="bg-white p-4 rounded-lg shadow">
                  <h3 className="text-lg font-medium mb-3">
                    ¬øC√≥mo funciona un LLM en contexto sanitario?
                  </h3>

                  <div className="grid grid-cols-1 md:grid-cols-4 gap-4 text-sm mb-4">
                    <div className="bg-blue-50 p-3 rounded-lg border-l-4 border-blue-500">
                      <div className="flex items-center mb-2">
                        <div className="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold mr-2">
                          1
                        </div>
                        <strong className="text-blue-800">Tokenizaci√≥n</strong>
                      </div>
                      <p className="text-gray-700">
                        El texto cl√≠nico se divide en tokens para su
                        procesamiento.
                      </p>
                      <div className="mt-2 bg-white p-2 rounded text-xs">
                        <span className="px-1 mx-1 bg-green-100 rounded">
                          fiebre
                        </span>
                        <span className="px-1 mx-1 bg-green-100 rounded">
                          38.5
                        </span>
                        <span className="px-1 mx-1 bg-green-100 rounded">
                          ¬∞C
                        </span>
                        <span className="px-1 mx-1 bg-green-100 rounded">
                          tos
                        </span>
                        <span className="px-1 mx-1 bg-green-100 rounded">
                          seca
                        </span>
                      </div>
                    </div>

                    <div className="bg-purple-50 p-3 rounded-lg border-l-4 border-purple-500">
                      <div className="flex items-center mb-2">
                        <div className="w-8 h-8 rounded-full bg-purple-500 flex items-center justify-center text-white font-bold mr-2">
                          2
                        </div>
                        <strong className="text-purple-800">Embedding</strong>
                      </div>
                      <p className="text-gray-700">
                        Cada t√©rmino m√©dico se convierte en un vector de
                        caracter√≠sticas.
                      </p>
                      <div className="mt-2 bg-white p-2 rounded text-xs font-mono">
                        <span className="text-green-600">fiebre</span> = [0.8,
                        0.2, 0.9, 0.1...]
                      </div>
                    </div>

                    <div className="bg-amber-50 p-3 rounded-lg border-l-4 border-amber-500">
                      <div className="flex items-center mb-2">
                        <div className="w-8 h-8 rounded-full bg-amber-500 flex items-center justify-center text-white font-bold mr-2">
                          3
                        </div>
                        <strong className="text-amber-800">Atenci√≥n</strong>
                      </div>
                      <p className="text-gray-700">
                        Se determinan relaciones entre s√≠ntomas, valores y
                        par√°metros.
                      </p>
                      <div className="mt-2 bg-white p-2 rounded flex justify-between text-xs">
                        <span className="px-1 opacity-50">fiebre</span>
                        <span className="px-1 font-bold text-amber-600">
                          38.5¬∞C
                        </span>
                        <span className="px-1 opacity-50">tos</span>
                        <span className="px-1 font-bold text-amber-600">
                          seca
                        </span>
                      </div>
                    </div>

                    <div className="bg-emerald-50 p-3 rounded-lg border-l-4 border-emerald-500">
                      <div className="flex items-center mb-2">
                        <div className="w-8 h-8 rounded-full bg-emerald-500 flex items-center justify-center text-white font-bold mr-2">
                          4
                        </div>
                        <strong className="text-emerald-800">Generaci√≥n</strong>
                      </div>
                      <p className="text-gray-700">
                        Genera respuestas cl√≠nicas basadas en conocimiento
                        m√©dico.
                      </p>
                      <div className="mt-2 bg-white p-2 rounded text-xs">
                        <span className="font-bold text-emerald-600">
                          neumon√≠a (70%)
                        </span>
                        <span className="ml-2 opacity-50">
                          bronquitis (20%)
                        </span>
                      </div>
                    </div>
                  </div>
                  <div className="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                    <h4 className="font-medium mb-2">
                      ¬øQu√© son los par√°metros en un LLM?
                    </h4>
                    <p className="text-sm mb-2">
                      Los par√°metros son los valores num√©ricos que definen el
                      comportamiento del modelo. Son el resultado del
                      entrenamiento y determinan:
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-3 text-sm">
                      <div className="bg-gray-50 p-2 rounded border border-gray-200">
                        <strong>Pesos de la red neuronal:</strong> Determinan
                        c√≥mo se procesan y transforman los embeddings en cada
                        capa.
                      </div>
                      <div className="bg-gray-50 p-2 rounded border border-gray-200">
                        <strong>Matrices de atenci√≥n:</strong> Controlan qu√©
                        partes del texto recibir√°n mayor foco seg√∫n el contexto.
                      </div>
                      <div className="bg-gray-50 p-2 rounded border border-gray-200">
                        <strong>Capas de transformaci√≥n:</strong> Cada capa del
                        modelo contiene millones de par√°metros que procesan la
                        informaci√≥n.
                      </div>
                    </div>
                    <p className="text-sm mt-2">
                      Los LLM modernos contienen entre miles de millones y
                      billones de par√°metros, lo que les permite capturar
                      patrones complejos del lenguaje.
                    </p>
                  </div>
                  <div className="mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
                    <h4 className="font-medium mb-2">
                      ¬øC√≥mo es esto diferente en los LLM reales?
                    </h4>
                    <ul className="list-disc pl-5 space-y-1 text-sm">
                      <li>
                        <strong>Tama√±o:</strong> Miles de millones de
                        par√°metros.
                      </li>
                      <li>
                        <strong>Complejidad:</strong> Muchas capas y cabezas de
                        atenci√≥n.
                      </li>
                      <li>
                        <strong>Datos:</strong> Entrenados con billones de
                        tokens.
                      </li>
                      <li>
                        <strong>Tokenizaci√≥n avanzada:</strong> Uso de
                        subpalabras para mayor eficiencia.
                      </li>
                    </ul>
                  </div>
                </div>
              </>
            )}

            {activeTab === "arquitectura" && renderModelArchitecture()}

            {activeTab === "conceptos" && (
              <div className="bg-white p-4 rounded-lg shadow">
                <h3 className="text-xl font-medium mb-4">
                  Conceptos Avanzados en LLM
                </h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h4 className="text-lg font-medium mb-2">
                      Arquitectura Transformer
                    </h4>
                    <p className="text-sm text-gray-600 mb-3">
                      Introducida en 2017, la arquitectura Transformer
                      revolucion√≥ el NLP al permitir procesar secuencias en
                      paralelo mediante mecanismos de atenci√≥n.
                    </p>
                    <h5 className="font-medium mb-1">
                      Componentes principales:
                    </h5>
                    <ul className="list-disc pl-5 space-y-1 text-sm text-gray-600">
                      <li>
                        <strong>Multi-Head Attention:</strong> Permite enfocarse
                        en distintas partes del input simult√°neamente.
                      </li>
                      <li>
                        <strong>Feed-Forward Networks:</strong> Redes neuronales
                        para transformar los vectores.
                      </li>
                      <li>
                        <strong>Layer Normalization:</strong> Estabiliza el
                        entrenamiento.
                      </li>
                      <li>
                        <strong>Residual Connections:</strong> Facilitan el
                        flujo de informaci√≥n en capas profundas.
                      </li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="text-lg font-medium mb-2">
                      Auto-regresividad
                    </h4>
                    <p className="text-sm text-gray-600 mb-3">
                      Los LLM generan texto token a token, utilizando cada token
                      generado como parte del contexto para predecir el
                      siguiente.
                    </p>
                    <h5 className="font-medium mb-1">
                      Implicaciones pr√°cticas:
                    </h5>
                    <ul className="list-disc pl-5 space-y-1 text-sm text-gray-600">
                      <li>
                        <strong>Causa-efecto:</strong> Cada token influye en los
                        siguientes.
                      </li>
                      <li>
                        <strong>Memoria limitada:</strong> Solo se considera el
                        contexto previo.
                      </li>
                      <li>
                        <strong>Estrategias de muestreo:</strong> T√©cnicas como
                        temperature y top‚Äëk controlan la creatividad.
                      </li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="text-lg font-medium mb-2">
                      Entrenamiento de LLM
                    </h4>
                    <p className="text-sm text-gray-600 mb-3">
                      El entrenamiento es un proceso intensivo en m√∫ltiples
                      fases.
                    </p>
                    <h5 className="font-medium mb-1">Fases principales:</h5>
                    <ul className="list-disc pl-5 space-y-1 text-sm text-gray-600">
                      <li>
                        <strong>Pre-entrenamiento:</strong> Aprendizaje de
                        patrones generales del lenguaje.
                      </li>
                      <li>
                        <strong>Fine-tuning supervisado:</strong> Ajuste
                        mediante ejemplos etiquetados.
                      </li>
                      <li>
                        <strong>RLHF:</strong> Refinamiento basado en feedback
                        humano.
                      </li>
                    </ul>
                  </div>
                  <div>
                    <h4 className="text-lg font-medium mb-2">
                      Tipos de Embeddings
                    </h4>
                    <p className="text-sm text-gray-600 mb-3">
                      Los embeddings representan no solo palabras, sino tambi√©n
                      su posici√≥n y rol en la secuencia.
                    </p>
                    <h5 className="font-medium mb-1">Tipos principales:</h5>
                    <ul className="list-disc pl-5 space-y-1 text-sm text-gray-600">
                      <li>
                        <strong>Token Embeddings:</strong> Significado
                        intr√≠nseco del token.
                      </li>
                      <li>
                        <strong>Positional Embeddings:</strong> Informaci√≥n
                        posicional.
                      </li>
                      <li>
                        <strong>Segment Embeddings:</strong> Diferencian partes
                        del input.
                      </li>
                      <li>
                        <strong>Contextual Embeddings:</strong> Var√≠an seg√∫n el
                        contexto.
                      </li>
                    </ul>
                  </div>
                </div>
                <div className="mt-6">
                  <h4 className="text-lg font-medium mb-3">
                    Limitaciones y Desaf√≠os
                  </h4>
                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div className="bg-gray-50 p-3 rounded border border-gray-200">
                      <h5 className="font-medium mb-2">Contexto Limitado</h5>
                      <p className="text-sm text-gray-600">
                        La ventana de contexto es limitada, afectando la
                        coherencia en textos extensos.
                      </p>
                    </div>
                    <div className="bg-gray-50 p-3 rounded border border-gray-200">
                      <h5 className="font-medium mb-2">Alucinaciones</h5>
                      <p className="text-sm text-gray-600">
                        El modelo puede generar informaci√≥n incorrecta aunque
                        plausible.
                      </p>
                    </div>
                    <div className="bg-gray-50 p-3 rounded border border-gray-200">
                      <h5 className="font-medium mb-2">Razonamiento</h5>
                      <p className="text-sm text-gray-600">
                        A pesar de sus capacidades, a√∫n enfrenta desaf√≠os en
                        razonamientos complejos.
                      </p>
                    </div>
                  </div>
                  <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 className="font-medium mb-2">El Futuro de los LLM</h4>
                    <p className="text-sm">
                      La evoluci√≥n sigue con tendencias en modelos multimodales,
                      mejor razonamiento, eficiencia y alineaci√≥n con valores
                      humanos.
                    </p>
                    <ul className="list-disc pl-5 mt-2 space-y-1 text-sm">
                      <li>
                        <strong>Modelos multimodales</strong> que integran
                        texto, im√°genes, audio y video
                      </li>
                      <li>
                        <strong>Razonamiento mejorado</strong> con t√©cnicas como
                        chain‚Äëof‚Äëthought
                      </li>
                      <li>
                        <strong>Eficiencia computacional</strong> para reducir
                        costos y huella de carbono
                      </li>
                      <li>
                        <strong>Alineamiento profundo</strong> con valores y
                        requisitos √©ticos
                      </li>
                      <li>
                        <strong>Integraci√≥n con herramientas externas</strong>{" "}
                        para expandir capacidades
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            )}
          </div>
        );
      };

      const rootElement = document.getElementById("root");
      const root = ReactDOM.createRoot(rootElement);
      root.render(<EnhancedLLMDemo />);
    </script>
  </body>
</html>
