<!--
=====================
  pocus.html
  Versión educativa sobre ecografía clínica - REFACTORIZADA
=====================
-->
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>POCUS-Clínic: Atlas Anatómico Interactivo Avanzado</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
      }

      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            circle at 20% 80%,
            rgba(120, 119, 198, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 119, 198, 0.1) 0%,
            transparent 50%
          );
        pointer-events: none;
        z-index: 1;
      }

      .glass-morphism {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      }

      .header-gradient {
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.95) 0%,
          rgba(255, 255, 255, 0.85) 100%
        );
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(255, 255, 255, 0.3);
      }

      #anatomical-svg {
        filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.2));
        transition: transform 0.3s ease;
      }

      #anatomical-svg:hover {
        transform: scale(1.02);
      }

      .anatomy-segment {
        fill: rgba(147, 197, 253, 0.2);
        stroke: #3b82f6;
        stroke-width: 1;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
      }

      .anatomy-segment:hover {
        fill: rgba(59, 130, 246, 0.4);
        stroke: #1d4ed8;
        stroke-width: 2;
        filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3));
        transform: translateY(-1px);
      }

      .anatomy-segment.active {
        fill: url(#activeGradient);
        stroke: #1e40af;
        stroke-width: 2.5;
        filter: drop-shadow(0 6px 12px rgba(59, 130, 246, 0.4));
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.03);
        }
      }

      .tooltip-advanced {
        position: absolute;
        background: rgba(17, 24, 39, 0.95);
        backdrop-filter: blur(10px);
        color: white;
        padding: 12px 18px;
        border-radius: 12px;
        font-size: 0.875rem;
        font-weight: 500;
        pointer-events: none;
        z-index: 1000;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease;
      }

      .tooltip-advanced.show {
        opacity: 1;
        transform: translateY(0);
      }

      /* Estilos originales para las fichas de contenido */
      .content-card {
        display: none;
        animation: fadeIn 0.5s ease-in-out;
        background: white;
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .tab-button {
        transition: all 0.3s ease;
      }

      .tab-button.active {
        background-color: #1e3a8a;
        color: white;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
        animation: fadeIn 0.4s;
      }

      .prose strong {
        color: #1e40af;
      }

      .prose .evidence {
        background-color: #eef2ff;
        border-left: 4px solid #4f46e5;
        padding: 1rem;
        margin-top: 1rem;
        border-radius: 0.375rem;
      }

      .prose ul {
        list-style-position: inside;
      }

      .prose li::marker {
        color: #3b82f6;
      }

      .findings-description {
        background-color: #f3f4f6;
        border: 1px solid #e5e7eb;
        border-radius: 0.5rem;
        padding: 1rem;
      }

      .reference-link {
        font-size: 0.75rem;
        font-weight: 500;
        color: #4f46e5;
        text-decoration: underline;
        cursor: pointer;
      }

      .pearls-section h5 {
        font-size: 1.05em;
        font-weight: 700;
        color: #1d4ed8;
        margin-top: 0.75rem;
        margin-bottom: 0.25rem;
      }

      .zoom-controls {
        position: absolute;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .zoom-button {
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.9);
        border: 1px solid rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .zoom-button:hover {
        background: white;
        transform: scale(1.1);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .anatomy-label {
        font-size: 10px;
        font-weight: 600;
        fill: #1f2937;
        text-anchor: middle;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .show-labels .anatomy-label {
        opacity: 1;
      }

      .welcome-card {
        background: white;
        border-radius: 16px;
        padding: 32px;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      }

      .feature-icon {
        width: 64px;
        height: 64px;
        background: var(--primary-gradient);
        border-radius: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px;
        box-shadow: 0 8px 16px rgba(102, 126, 234, 0.2);
      }

      @media (max-width: 1024px) {
        .grid-layout {
          grid-template-columns: 1fr !important;
        }

        .anatomy-container {
          position: relative !important;
          top: auto !important;
        }
      }
      .responsive-iframe-container {
        position: relative;
        overflow: hidden;
        width: 100%;
        padding-top: 56.25%; /* Proporción 16:9 */
      }

      .responsive-iframe-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 0.5rem; /* Opcional: para que tenga bordes redondeados */
      }
    </style>
  </head>
  <body>
    <header
      class="header-gradient sticky top-0 z-50 transition-all duration-300"
    >
      <div class="container mx-auto px-4 sm:px-6 py-4">
        <div class="flex justify-between items-center">
          <div class="flex items-center space-x-4">
            <div
              class="w-12 h-12 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full flex items-center justify-center"
            >
              <svg
                class="w-6 h-6 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 18.75a6 6 0 006-6v-1.5m-6 7.5a6 6 0 01-6-6v-1.5m6 7.5v3.75m-3.75 0h7.5M12 15.75a3 3 0 01-3-3V4.5a3 3 0 116 0v8.25a3 3 0 01-3 3z"
                />
              </svg>
            </div>
            <div>
              <h1
                class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent"
              >
                POCUS-Clínic Atlas
              </h1>
              <p class="text-sm text-gray-600">
                Sistema Interactivo de Ultrasonido Point-of-Care
              </p>
            </div>
          </div>
        </div>
      </div>
    </header>

    <main class="container mx-auto p-4 md:p-8 relative z-10">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 grid-layout">
        <!-- Panel Izquierdo: Anatomía Interactiva Mejorada -->
        <div class="lg:col-span-1 anatomy-container lg:sticky lg:top-24">
          <div class="glass-morphism rounded-2xl p-6 relative">
            <div class="flex justify-between items-center mb-6">
              <h2 class="text-xl font-bold text-white">
                Exploración Anatómica
              </h2>
              <button
                id="toggle-labels"
                class="px-3 py-1 bg-white/20 text-white rounded-lg text-sm hover:bg-white/30 transition-colors"
              >
                Mostrar Etiquetas
              </button>
            </div>

            <div id="tooltip" class="tooltip-advanced"></div>

            <div class="relative">
              <svg
                id="anatomical-svg"
                viewBox="0 0 300 600"
                class="w-full max-w-md mx-auto"
              >
                <defs>
                  <linearGradient
                    id="activeGradient"
                    x1="0%"
                    y1="0%"
                    x2="100%"
                    y2="100%"
                  >
                    <stop
                      offset="0%"
                      style="stop-color: #3b82f6; stop-opacity: 0.8"
                    />
                    <stop
                      offset="100%"
                      style="stop-color: #8b5cf6; stop-opacity: 0.8"
                    />
                  </linearGradient>

                  <linearGradient
                    id="bodyGradient"
                    x1="0%"
                    y1="0%"
                    x2="0%"
                    y2="100%"
                  >
                    <stop
                      offset="0%"
                      style="stop-color: #fef3c7; stop-opacity: 0.3"
                    />
                    <stop
                      offset="100%"
                      style="stop-color: #fde68a; stop-opacity: 0.3"
                    />
                  </linearGradient>
                </defs>

                <!-- Cuerpo Base Mejorado -->
                <g id="body-base">
                  <!-- Cabeza -->
                  <ellipse
                    cx="150"
                    cy="60"
                    rx="40"
                    ry="45"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />

                  <!-- Cuello -->
                  <rect
                    x="130"
                    y="95"
                    width="40"
                    height="30"
                    rx="8"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />

                  <!-- Torso -->
                  <path
                    d="M 100 125 Q 100 120 110 120 L 190 120 Q 200 120 200 125 L 200 280 Q 200 290 190 290 L 110 290 Q 100 290 100 280 Z"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />

                  <!-- Brazos -->
                  <path
                    d="M 100 140 Q 80 145 70 165 L 65 230 Q 65 240 70 245 L 75 240 Q 80 235 80 225 L 85 165 Q 90 150 100 145"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />
                  <path
                    d="M 200 140 Q 220 145 230 165 L 235 230 Q 235 240 230 245 L 225 240 Q 220 235 220 225 L 215 165 Q 210 150 200 145"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />

                  <!-- Piernas -->
                  <path
                    d="M 120 290 L 115 450 Q 115 460 120 465 L 125 460 Q 130 455 130 445 L 135 290"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />
                  <path
                    d="M 165 290 L 170 450 Q 170 460 165 465 L 160 460 Q 155 455 155 445 L 150 290"
                    fill="url(#bodyGradient)"
                    stroke="#fed7aa"
                    stroke-width="2"
                  />
                </g>

                <!-- Zonas Interactivas Mejoradas -->
                <g id="interactive-zones">
                  <circle
                    cx="150"
                    cy="45"
                    r="20"
                    class="anatomy-segment"
                    data-segment="ocular"
                    data-tooltip="Ocular"
                  />
                  <text x="150" y="48" class="anatomy-label">Ocular</text>

                  <rect
                    x="125"
                    y="95"
                    width="50"
                    height="25"
                    rx="8"
                    class="anatomy-segment"
                    data-segment="neck"
                    data-tooltip="Cuello (Tiroides/Linfático)"
                  />
                  <text x="150" y="110" class="anatomy-label">Tiroides</text>
                  <circle
                    cx="185"
                    cy="110"
                    r="14"
                    class="anatomy-segment"
                    data-segment="neck_lateral"
                    data-tooltip="Cuello Lateral"
                  />
                  <text x="185" y="106" class="anatomy-label">
                    <tspan x="185" dy="0">Cuello</tspan>
                    <tspan x="185" dy="11">Lateral</tspan>
                  </text>

                  <ellipse
                    cx="150"
                    cy="155"
                    rx="25"
                    ry="20"
                    class="anatomy-segment"
                    data-segment="cardiac"
                    data-tooltip="Cardíaco"
                  />
                  <text x="150" y="170" class="anatomy-label">Corazón</text>

                  <path
                    d="M 110 130 L 140 130 L 140 180 L 110 180 Z"
                    class="anatomy-segment"
                    data-segment="lung"
                    data-tooltip="Pulmonar"
                  />
                  <text x="120" y="145" class="anatomy-label">Pulmón Izq</text>

                  <path
                    d="M 160 130 L 190 130 L 190 180 L 160 180 Z"
                    class="anatomy-segment"
                    data-segment="lung"
                    data-tooltip="Pulmonar"
                  />
                  <text x="180" y="145" class="anatomy-label">Pulmón Der</text>

                  <rect
                    x="110"
                    y="205"
                    width="40"
                    height="40"
                    rx="5"
                    class="anatomy-segment"
                    data-segment="ruq"
                    data-tooltip="Hígado y Vía Biliar (CSD)"
                  />
                  <text x="130" y="228" class="anatomy-label">Hígado</text>

                  <rect
                    x="150"
                    y="205"
                    width="40"
                    height="40"
                    rx="5"
                    class="anatomy-segment"
                    data-segment="luq"
                    data-tooltip="Bazo (CSI)"
                  />
                  <text x="170" y="228" class="anatomy-label">Bazo</text>

                  <rect
                    x="120"
                    y="245"
                    width="60"
                    height="20"
                    rx="5"
                    class="anatomy-segment"
                    data-segment="epigastric"
                    data-tooltip="Aorta / Epigastrio"
                  />
                  <text x="150" y="258" class="anatomy-label">Aorta</text>

                  <rect
                    x="110"
                    y="265"
                    width="35"
                    height="25"
                    rx="5"
                    class="anatomy-segment"
                    data-segment="rlq"
                    data-tooltip="Fosa Ilíaca Derecha (Apendicitis)"
                  />
                  <text x="127" y="280" class="anatomy-label">FID</text>

                  <rect
                    x="155"
                    y="265"
                    width="35"
                    height="25"
                    rx="5"
                    class="anatomy-segment"
                    data-segment="llq"
                    data-tooltip="Fosa Ilíaca Izquierda"
                  />
                  <text x="172" y="280" class="anatomy-label">FII</text>

                  <ellipse
                    cx="150"
                    cy="305"
                    rx="35"
                    ry="15"
                    class="anatomy-segment"
                    data-segment="suprapubic"
                    data-tooltip="Vejiga / Ginecológico"
                  />
                  <text x="150" y="302" class="anatomy-label">Vejiga</text>

                  <ellipse
                    cx="150"
                    cy="325"
                    rx="20"
                    ry="10"
                    class="anatomy-segment"
                    data-segment="scrotal"
                    data-tooltip="Testicular"
                  />
                  <text x="150" y="333" class="anatomy-label">Testicular</text>

                  <ellipse
                    cx="85"
                    cy="155"
                    rx="12"
                    ry="18"
                    class="anatomy-segment"
                    data-segment="shoulder"
                    data-tooltip="Hombro"
                  />
                  <text x="85" y="158" class="anatomy-label">Hombro</text>
                  <ellipse
                    cx="215"
                    cy="155"
                    rx="12"
                    ry="18"
                    class="anatomy-segment"
                    data-segment="shoulder"
                    data-tooltip="Hombro"
                  />
                  <text x="215" y="158" class="anatomy-label">Hombro</text>

                  <rect
                    x="118"
                    y="350"
                    width="12"
                    height="60"
                    rx="6"
                    class="anatomy-segment"
                    data-segment="dvt"
                    data-tooltip="TVP (Femoral/Poplítea)"
                  />
                  <text x="124" y="385" class="anatomy-label">TVP</text>
                  <rect
                    x="170"
                    y="350"
                    width="12"
                    height="60"
                    rx="6"
                    class="anatomy-segment"
                    data-segment="dvt"
                    data-tooltip="TVP (Femoral/Poplítea)"
                  />
                  <text x="176" y="385" class="anatomy-label">TVP</text>
                </g>
              </svg>

              <div class="zoom-controls">
                <button class="zoom-button" id="zoom-in-btn">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M12 6v12m6-6H6"
                    />
                  </svg>
                </button>
                <button class="zoom-button" id="zoom-out-btn">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M18 12H6"
                    />
                  </svg>
                </button>
                <button class="zoom-button" id="reset-zoom-btn">
                  <svg
                    class="w-5 h-5"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Panel Derecho: Contenido -->
        <div id="content-area" class="lg:col-span-2">
          <div id="welcome-message" class="welcome-card">
            <div class="feature-icon">
              <svg
                class="w-8 h-8 text-white"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M13 10V3L4 14h7v7l9-11h-7z"
                />
              </svg>
            </div>
            <h3
              class="text-3xl font-bold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent mb-4"
            >
              Atlas POCUS Interactivo
              <span class="text-sm align-top">(versión docente)</span>
            </h3>

            <p class="text-gray-600 text-lg mb-6">
              Seleccione una región anatómica para acceder a protocolos
              ecográficos paso a paso, clips comentados y bibliografía , para el
              autoaprendizaje de POCUS (Point-of-Care ultrasonography o
              Ecografía Clínica).
            </p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8">
              <div
                class="p-4 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl"
              >
                <h4 class="font-semibold text-indigo-700 mb-2">
                  🔍 Protocolos introductorios
                </h4>
                <p class="text-sm text-gray-600">
                  Secuencias de exploración explicadas paso a paso
                </p>
              </div>
              <div
                class="p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl"
              >
                <h4 class="font-semibold text-purple-700 mb-2">
                  🎥 Vídeos ilustrativos
                </h4>
                <p class="text-sm text-gray-600">
                  Selección de videos POCUS con subtítulos en español
                </p>
              </div>
              <div
                class="p-4 bg-gradient-to-br from-green-50 to-teal-50 rounded-xl"
              >
                <h4 class="font-semibold text-green-700 mb-2">
                  📖 Contenido estructurado
                </h4>
                <p class="text-sm text-gray-600">
                  Guías básicas y secuencias para empezar en POCUS
                </p>
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-8">
              Autor: Ernesto Barrera Linares. Médico de Familia · 2025
            </p>
          </div>
        </div>
      </div>

      <!-- Referencias -->
      <div id="references-section" class="mt-12"></div>
    </main>

    <script>
      // Estado global de la aplicación
      window.POCUSApp = {
        videoPlayers: {},
        zoomLevel: 1,
        showLabels: false,
        apiReady: false,
        pendingVideos: [],
      };

      // Base de datos de referencias
      const references = {
        pneumonia_long_2017: {
          id: "pneumonia_long_2017",
          citation:
            "Long L, et al. Lung ultrasound for the diagnosis of pneumonia in adults: A meta-analysis. Medicine (Baltimore). 2017;96(3):e5713.",
          url: "https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5279090/",
        },
        pleural_adhikari_2015: {
          id: "pleural_adhikari_2015",
          citation:
            "Adhikari S, et al. Accuracy of point-of-care ultrasound for diagnosis of pleural effusion in undifferentiated dyspnea. Am J Emerg Med. 2015;33(11):1667-70.",
          url: "https://pubmed.ncbi.nlm.nih.gov/26343366/",
        },
        pneumothorax_lichtenstein_2008: {
          id: "pneumothorax_lichtenstein_2008",
          citation:
            "Lichtenstein DA, Mezière GA. Relevance of lung ultrasound in the diagnosis of acute respiratory failure: the BLUE protocol. Chest. 2008;134(1):117-25.",
          url: "https://pubmed.ncbi.nlm.nih.gov/18403664/",
        },
        aaa_rubano_2013: {
          id: "aaa_rubano_2013",
          citation:
            "Rubano E, et al. Systematic review: emergency department bedside ultrasonography for diagnosing suspected abdominal aortic aneurysm. Acad Emerg Med. 2013;20(2):128-38.",
          url: "https://pubmed.ncbi.nlm.nih.gov/23406071/",
        },
        biliary_summers_2010: {
          id: "biliary_summers_2010",
          citation:
            "Summers SM, et al. A prospective evaluation of emergency department bedside ultrasonography for the detection of cholelithiasis. Ann Emerg Med. 2010;56(2):129-35.",
          url: "https://pubmed.ncbi.nlm.nih.gov/20138423/",
        },
        appendicitis_bernardi_2022: {
          id: "appendicitis_bernardi_2022",
          citation:
            "Bernardi K, et al. Point-of-care ultrasound for the diagnosis of acute appendicitis in the emergency department: a systematic review and meta-analysis. CJEM. 2022;24(7):736-745.",
          url: "https://pubmed.ncbi.nlm.nih.gov/35943679/",
        },
        dvt_pomero_2022: {
          id: "dvt_pomero_2022",
          citation:
            "Pomero F, et al. Point-of-care ultrasound for diagnosis of deep vein thrombosis in the emergency department: a systematic review and meta-analysis. Ann Emerg Med. 2022;S0196-0644(22)00216-9.",
          url: "https://pubmed.ncbi.nlm.nih.gov/35659850/",
        },
        abscess_subramaniam_2016: {
          id: "abscess_subramaniam_2016",
          citation:
            "Subramaniam S, Bober J, Chao J, Zehtabchi S. Point-of-care ultrasound for diagnosis of abscess in skin and soft tissue infections. Acad Emerg Med. 2016;23(11):1298-1306.",
          url: "https://pubmed.ncbi.nlm.nih.gov/27535722/",
        },
        testicular_torsion_bandarkar_2019: {
          id: "testicular_torsion_bandarkar_2019",
          citation:
            "Bandarkar AN, Blask AR. Testicular torsion with preserved flow: key sonographic features and value-added approach. Pediatr Radiol. 2019;49(9):1147-1154.",
          url: "https://pubmed.ncbi.nlm.nih.gov/31087031/",
        },

        ocular_pocus101_guide: {
          id: "ocular_pocus101_guide",
          citation:
            "POCUS 101. Ocular Ultrasound Made Easy: Step-by-Step Guide. POCUS 101. Consultado el 7 de julio de 2025.",
          url: "https://www.pocus101.com/ocular-ultrasound-made-easy-step-by-step-guide/",
        },
      };

      // Base de datos POCUS
      const pocusData = [
        {
          segment: "ocular",
          system: "Ocular",
          color: "cyan",
          title: "POCUS Ocular",
          refId: "ocular_pocus101_guide",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal (alta frecuencia, >7.5 MHz).</li><li><strong>Técnica:</strong> Aplicar una capa gruesa de gel sobre el párpado cerrado del paciente para crear un "colchón" acústico. Apoyar la sonda suavemente, sin ejercer presión sobre el globo ocular. Evaluar en planos sagital y transversal, pidiendo al paciente que mueva el ojo para evaluar la dinámica de las estructuras.</li></ul>`,
            findings: `Se busca: 1) <strong>Desprendimiento de Retina:</strong> Membrana hiperecogénica gruesa, ondulante, que parece una "cuerda" flotando en el vítreo, anclada posteriormente al disco óptico. Muestra un movimiento característico de "flotación" con los movimientos oculares. 2) <strong>Aumento de PIC:</strong> Medir el diámetro de la vaina del nervio óptico (DVNO) 3 mm por detrás del globo. Un DVNO > 5 mm en adultos sugiere fuertemente hipertensión intracraneal. 3) <strong>Hemorragia Vítrea:</strong> Ecos de baja amplitud, móviles y difusos en la cavidad vítrea, que se arremolinan con el movimiento ocular como una "lavadora".`,
            evidence: `<p>El POCUS ocular es altamente sensible y específico para el desprendimiento de retina (>97% y >92% respectivamente). La medición del DVNO es una herramienta prometedora y no invasiva para estimar la PIC.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Presionar demasiado fuerte sobre el ojo, lo que puede ser peligroso si hay una rotura ocular. Use siempre una gran cantidad de gel.</p><h5>Impacto Clínico</h5><p>En un paciente con pérdida de visión aguda, diferenciar un desprendimiento de retina (emergencia oftalmológica) de una hemorragia vítrea cambia radicalmente el manejo urgente.</p></div>`,
            videos: [
              {
                id: "a5UkjfQEtgk",
                intro: "PoCUS en patología ocular",
                desc: "Revisión de las principales aplicaciones del ultrasonido a la cabecera del paciente en patología ocular.",
              },
              {
                id: "dI05sd7TQsY",
                intro: "Evaluación ecográfica del globo ocular",
                desc: "Guía detallada sobre la técnica y anatomía para la evaluación ecográfica del ojo.",
              },
            ],
          },
        },
        {
          segment: "neck",
          system: "Endocrino",
          color: "teal",
          title: "Nódulo Tiroideo",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Examen sistemático de ambos lóbulos tiroideos y el istmo en planos transversal y longitudinal. Paciente en supino con una almohada bajo los hombros para hiperextender el cuello.</li></ul>`,
            findings: `Se evalúan las características del nódulo para estratificar el riesgo (ej. sistema TI-RADS). <strong>Hallazgos sospechosos:</strong> Hipoecogenicidad marcada (más oscuro que el músculo adyacente), forma "más alta que ancha" (taller-than-wide), márgenes irregulares, microlobulados o espiculados, y presencia de microcalcificaciones (puntos hiperecogénicos puntiformes sin sombra). <strong>Hallazgos de bajo riesgo:</strong> Nódulos puramente quísticos, espongiformes, o iso/hiperecogénicos con márgenes regulares y halo fino.`,
            evidence: `<p>El POCUS es la principal modalidad de imagen para evaluar nódulos tiroideos y guiar la necesidad de una biopsia por aspiración con aguja fina (BAAF).</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Confundir vasos sanguíneos con nódulos. Use Doppler color para confirmar la ausencia de flujo en un nódulo verdadero.</p><h5>Impacto Clínico</h5><p>El objetivo en AP es identificar nódulos de alto riesgo (>1 cm con características sospechosas) que requieran derivación para una evaluación especializada y posible BAAF, evitando estudios innecesarios en nódulos de bajo riesgo.</p></div>`,
            videos: [
              {
                id: "bwuUR_Z8kb4",
                intro: "Curso de Ecografía de Tiroides",
                desc: "Anatomía, técnicas de exploración y evaluación de nódulos, para el screening y procedimientos guiados",
              },
              {
                id: "XR4nOMp_bGA",
                intro: "Evaluación Ecográfica de la Enfermedad Tiroidea Difusa",
                desc: "Evaluación ecográfica de patologías tiroideas difusas como Graves y Hashimoto, y la diferenciación de pseudonódulos",
              },
            ],
          },
        },
        {
          segment: "neck_lateral",
          system: "Linfático",
          color: "lime",
          title: "Adenopatías Cervicales",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal&nbsp;10–18&nbsp;MHz (curvo 5–9 MHz si cuello grueso).</li><li><strong>Posición:</strong> Supino, cuello extendido y girado contralateral.</li><li><strong>Técnica:</strong> Mapeo sistemático de niveles I–VI con Doppler color.</li></ul>`,
            findings: `<strong>Benignos:</strong> Ovalados (corto/largo < 0.5), diámetro corto < 10 mm (hasta 11 mm en jugulodigástricos), corteza < 3 mm, hilio graso visible y vascularidad hiliar.<br>
<strong>Sospechosos:</strong> Redondos (c/l > 0.5) o corteza > 3 mm, hipoecoicos, sin hilio, márgenes irregulares/lobulados, micro-calcificaciones o necrosis quística, “matting” (conglomerado de ganglios adheridos sin planos grasos) de ganglios, vascularidad periférica/caótica.
`,
            evidence: `<p>El POCUS puede diferenciar con buena precisión entre adenopatías reactivas y sospechosas, guiando la necesidad de seguimiento o biopsia.</p>`,
            pearls: `<div class="pearls-section"><h5>Clave Diferencial</h5><p>La morfología es más importante que el tamaño. Un ganglio pequeño y redondo es más sospechoso que uno grande y ovalado.</p><h5>Impacto Clínico</h5><p>Permite tomar decisiones informadas sobre si una adenopatía requiere una actitud expectante (probable origen reactivo) o una investigación más profunda (sospecha de malignidad o infección específica como tuberculosis).</p></div>`,
            videos: [
              {
                id: "fAMZ2M8PSok",
                intro:
                  "Utilidad de la ecografía en la evaluación de los nódulos cervicales",
                desc: "descripción de la anatomía cervical, exploración ecográfica y evaluación de nódulos",
              },
            ],
          },
        },
        {
          segment: "cardiac",
          system: "Cardiovascular",
          color: "red",
          title: "Ecografía Cardíaca Focalizada (FoCUS)",
          content: {
            technique: `<p>Adquisición de vistas PSLA, PSSA, Apical 4C y Subcostal 4C para evaluar la "bomba".</p>`,
            findings: `Se busca: 1) <strong>Función VI:</strong> Evaluación cualitativa (hiperdinámico, normal, hipocontráctil). 2) <strong>Derrame Pericárdico:</strong> Espacio anecoico alrededor del corazón. Buscar colapso de cavidades derechas (taponamiento). 3) <strong>Tamaño VD:</strong> Comparar con VI en la vista A4C. Un VD > VI sugiere sobrecarga de presión aguda (ej. TEP masivo).`,
            evidence: `<p>Identifica rápidamente causas de shock y parada cardíaca. Guía la fluidoterapia y el uso de inotrópicos.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Confundir un derrame pleural izquierdo con un derrame pericárdico. El pericardio se ve anterior a la aorta descendente en la vista PSLA, mientras que el derrame pleural es posterior.</p><h5>Impacto Clínico</h5><p>La vista subcostal suele ser la más fácil de obtener en pacientes críticos o con EPOC. Es la vista de elección para detectar derrame pericárdico.</p></div>`,
            videos: [{ id: "vr8KteyhVkI", intro: "FoCUS" }],
          },
        },
        {
          segment: "lung",
          system: "Pulmonar",
          color: "blue",
          title: "Exploración Pulmonar (Protocolo BLUE)",
          refId: "pneumothorax_lichtenstein_2008",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa (para una visión general y profunda) o lineal (para un mejor detalle de la pleura, como en la búsqueda de neumotórax).</li><li><strong>Técnica (Protocolo BLUE):</strong> Se examinan 3 puntos en cada hemitórax. <strong>Punto 1 y 2 (Anteriores):</strong> En línea medioclavicular, uno superior y otro inferior. <strong>Punto 3 (PLAPS):</strong> En línea axilar posterior, a nivel del diafragma. El examen debe ser bilateral y comparativo.</li></ul>`,
            findings: `Se evalúa la presencia o ausencia de artefactos clave: <br>1) <strong>Deslizamiento pleural (Lung Sliding):</strong> Movimiento brillante de la pleura visceral contra la parietal. Su ausencia es el primer signo de <strong>neumotórax</strong>. <br>2) <strong>Líneas B:</strong> Artefactos verticales, similares a "colas de cometa", que nacen de la pleura y borran las líneas A. Múltiples y difusas sugieren <strong>edema pulmonar</strong>. Focales pueden indicar <strong>neumonía</strong>. <br>3) <strong>Consolidación:</strong> El pulmón adquiere una apariencia similar al hígado ("hepatización"), a menudo con broncograma aéreo (líneas hiperecogénicas). Típico de <strong>neumonía</strong>. <br>4) <strong>Derrame Pleural:</strong> Espacio anecoico (negro) entre las pleuras, mejor visualizado en el punto PLAPS.`,
            evidence: `<p>La ecografía pulmonar, utilizando protocolos como el BLUE, ha demostrado una alta precisión diagnóstica para las principales causas de insuficiencia respiratoria aguda, superando en muchos casos a la radiografía de tórax portátil.</p>`,
            pearls: `<div class="pearls-section"><h5>Clave de la Exploración</h5><p>El punto PLAPS (PosteroLateral Alveolar and/or Pleural Syndrome) es el área más sensible para detectar derrames pleurales y consolidaciones basales, que son las más comunes.</p><h5>Errores Comunes</h5><p>Confundir una línea B con una línea Z (más corta, no borra las líneas A). En un neumotórax, asegúrate de buscar el "punto pulmonar" (donde el deslizamiento reaparece), que es patognomónico.</p></div>`,
            videos: [
              {
                id: "nWyF1SoIeBQ",
                intro: "Introducción al Protocolo BLUE",
                desc: "Revisión completa de la sistemática de exploración y los patrones ecográficos clave en la insuficiencia respiratoria aguda.",
              },
            ],
          },
        },
        {
          segment: "ruq",
          system: "Abdominal",
          color: "green",
          title: "Colelitiasis y Colecistitis",
          refId: "biliary_summers_2010",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa.</li><li><strong>Técnica:</strong> Exploración del cuadrante superior derecho, usando el hígado como ventana acústica.</li></ul>`,
            findings: `<strong>Colelitiasis:</strong> Se ven focos hiperecogénicos (blancos, brillantes), móviles, que proyectan una <strong>sombra acústica posterior</strong> bien definida. <strong>Colecistitis:</strong> Se buscan signos secundarios: 1) Engrosamiento de la pared vesicular (>3mm). 2) Líquido pericolecístico (fina lámina anecoica). 3) <strong>Signo de Murphy ecográfico positivo</strong> (dolor máximo al presionar con la sonda sobre la vesícula). 4) Cálculo impactado en el cuello.`,
            evidence: `<p>Precisión global del ~89% para colecistitis. La combinación de hallazgos tiene una especificidad muy alta.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Confundir el duodeno con la vesícula. El duodeno tiene gas y peristaltismo. La sombra acústica de un cálculo puede ser sutil; mover al paciente ayuda a confirmar la movilidad del cálculo.</p><h5>Impacto Clínico</h5><p>El signo de Murphy ecográfico es más específico que el clínico. Un POCUS positivo puede acelerar la consulta quirúrgica y el tratamiento.</p></div>`,
          },
        },
        {
          segment: "ruq",
          system: "Abdominal",
          color: "green",
          title: "Hepatomegalia y Esteatosis",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa.</li><li><strong>Técnica:</strong> Medir la longitud craneocaudal del hígado en la línea medioclavicular. Comparar la ecogenicidad del hígado con la del riñón derecho.</li></ul>`,
            findings: `<strong>Hepatomegalia:</strong> Una longitud > 15-16 cm en la línea medioclavicular. <strong>Esteatosis (hígado graso):</strong> Se manifiesta como un <strong>aumento de la ecogenicidad del parénquima hepático</strong>. El hígado aparece más "brillante" que la corteza renal adyacente (comparación hepatorrenal). En casos severos, hay una pobre visualización de las estructuras portales y del diafragma debido a la atenuación del sonido.`,
            evidence: `<p>El POCUS es una excelente herramienta de cribado para la esteatosis hepática, con buena sensibilidad y especificidad, especialmente para la esteatosis moderada a severa.</p>`,
            pearls: `<p>La comparación hepatorrenal es clave. Un hígado normal es isoecoico o ligeramente hiperecogénico respecto al riñón. Un hígado marcadamente más brillante es patológico.</p>`,
          },
        },
        {
          segment: "luq",
          system: "Abdominal",
          color: "green",
          title: "Esplenomegalia",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa.</li><li><strong>Técnica:</strong> Colocar la sonda en el espacio intercostal posterior izquierdo (línea axilar posterior), usando una vista coronal.</li></ul>`,
            findings: `El bazo se visualiza craneal y posterior al riñón izquierdo. La esplenomegalia se define generalmente como una <strong>longitud máxima > 12-13 cm</strong>. También se puede comparar su ecogenicidad con la del riñón izquierdo; normalmente es isoecoico.`,
            evidence: `<p>El POCUS es más preciso que la palpación para detectar esplenomegalia, especialmente en pacientes obesos.</p>`,
            pearls: `<p>Pida al paciente que inspire profundamente para desplazar el bazo hacia abajo y mejorar la visualización. El bazo puede ser una ventana acústica difícil de obtener.</p>`,
          },
        },
        {
          segment: "epigastric",
          system: "Abdominal",
          color: "green",
          title: "Aneurisma de Aorta Abdominal (AAA)",
          refId: "aaa_rubano_2013",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa.</li><li><strong>Técnica:</strong> Medir diámetro anteroposterior máximo de pared externa a externa, desde epigastrio a bifurcación.</li></ul>`,
            findings: `Se busca una dilatación focal de la aorta. Un diámetro <strong>> 3.0 cm</strong> se considera aneurismático. Es importante medir el diámetro máximo y evaluar la presencia de trombo mural, que aparece como material ecogénico adherido a la pared que reduce la luz permeable.`,
            evidence: `<p>Excelente para cribado. Sensibilidad: <strong>99%</strong>, Especificidad: <strong>98%</strong>. Sigue las guías de cribado de la USPSTF.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Confundir la VCI con la aorta. La aorta tiene paredes más gruesas e hiperecogénicas, es pulsátil y no se comprime. La VCI tiene paredes finas, varía con la respiración y se comprime.</p><h5>Impacto Clínico</h5><p>El gas intestinal es el enemigo. Use compresión graduada para desplazarlo. Si la aorta no se ve bien, coloque al paciente en decúbito lateral izquierdo.</p></div>`,
          },
        },
        {
          segment: "rlq",
          system: "Abdominal",
          color: "green",
          title: "Apendicitis Aguda",
          refId: "appendicitis_bernardi_2022",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Compresión graduada sobre el punto de máximo dolor en fosa ilíaca derecha.</li></ul>`,
            findings: `Se busca una estructura tubular, aperistáltica, <strong>no compresible</strong>, de extremo ciego. Un diámetro transverso <strong>> 6 mm</strong> es el criterio principal. En corte transversal, muestra el <strong>signo de la diana (Target sign)</strong>. Se pueden ver hallazgos secundarios como un apendicolito (foco hiperecogénico con sombra), líquido libre localizado, o aumento de la ecogenicidad de la grasa periapendicular.`,
            evidence: `<p>Excelente para <strong>confirmar (rule-in)</strong> si se visualiza el apéndice (LR+ de 9.24). Malo para <strong>descartar (rule-out)</strong>, ya que un apéndice normal o retrocecal puede no visualizarse.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Confundir un asa intestinal o un vaso con el apéndice. El apéndice es de extremo ciego y no tiene peristaltismo. La clave es la no compresibilidad.</p><h5>Impacto Clínico</h5><p>Un POCUS positivo es diagnóstico; uno negativo o no concluyente requiere más estudios o valoración clínica.</p></div>`,
          },
        },
        {
          segment: "suprapubic",
          system: "Urogenital",
          color: "yellow",
          title: "Retención Urinaria (Globo Vesical)",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa.</li><li><strong>Técnica:</strong> Colocar la sonda en la línea media suprapúbica. Obtener vistas transversales y sagitales de la vejiga.</li></ul>`,
            findings: `Se visualiza la vejiga como una estructura anecoica (negra) de forma aproximadamente rectangular o elíptica. Se miden las 3 dimensiones: altura (H), anchura (W) y profundidad (L). El volumen se estima con la fórmula: <strong>Volumen (ml) ≈ 0.52 x H (cm) x W (cm) x L (cm)</strong>. Un volumen postmiccional > 100-150 ml se considera patológico.`,
            evidence: `<p>El POCUS es mucho más preciso que la palpación o la percusión para diagnosticar la retención urinaria y evita cateterismos innecesarios.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Subestimar el volumen por no obtener el diámetro máximo en cada uno de los 3 planos. Diferenciar la vejiga de otras estructuras quísticas (ej. quiste ovárico grande) por su localización y forma.</p><h5>Impacto Clínico</h5><p>Permite una confirmación inmediata de la retención y la necesidad de sondaje, mejorando el confort del paciente.</p></div>`,
          },
        },
        {
          segment: "suprapubic",
          system: "Gineco-Obstétrico",
          color: "pink",
          title: "Embarazo Intrauterino",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa (transabdominal) o endocavitaria.</li><li><strong>Técnica:</strong> Con la vejiga llena como ventana acústica, buscar el útero en la pelvis. Identificar el endometrio y buscar un saco gestacional.</li></ul>`,
            findings: `El primer signo es un <strong>saco gestacional intrauterino</strong>, una colección de líquido anecoica rodeada por un anillo ecogénico. Posteriormente, se identifica el <strong>saco vitelino</strong> (un pequeño anillo brillante dentro del saco gestacional). Finalmente, se visualiza el <strong>polo fetal</strong> con actividad cardíaca. La identificación de un saco gestacional intrauterino con saco vitelino o polo fetal confirma un embarazo intrauterino y prácticamente descarta un embarazo ectópico (excepto en raros casos de embarazo heterotópico).`,
            evidence: `<p>El POCUS es fundamental en la evaluación del sangrado del primer trimestre y el dolor abdominal en mujeres en edad fértil para confirmar la localización del embarazo.</p>`,
            pearls: `<div class="pearls-section"><h5>Clave Diferencial</h5><p>Un "pseudo-saco gestacional" (líquido en la cavidad endometrial) puede simular un saco temprano en un embarazo ectópico. Un verdadero saco gestacional es excéntrico, no central, y tiene un anillo ecogénico grueso.</p><h5>Impacto Clínico</h5><p>El objetivo principal es responder a la pregunta: ¿hay un embarazo intrauterino? Si no se encuentra, la sospecha de ectópico aumenta significativamente.</p></div>`,
          },
        },
        {
          segment: "suprapubic",
          system: "Gineco-Obstétrico",
          color: "pink",
          title: "Localización de DIU",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Convexa o endocavitaria.</li><li><strong>Técnica:</strong> Visualizar el útero en su eje largo. Buscar una estructura lineal hiperecogénica dentro de la cavidad endometrial.</li></ul>`,
            findings: `Un DIU correctamente colocado se ve como una <strong>línea o una "T" hiperecogénica brillante</strong>, con sombra acústica posterior, localizada en el fondo de la cavidad endometrial. Si los hilos no son visibles en la exploración ginecológica, el POCUS puede confirmar rápidamente si el DIU está en su sitio, si ha sido expulsado o si ha perforado el miometrio.`,
            evidence: `<p>El POCUS es el método de primera línea, rápido y no invasivo para confirmar la posición de un DIU cuando los hilos no son visibles.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>El aire en la cavidad endometrial puede simular un DIU. Mueva la sonda para confirmar que la estructura es lineal y consistente con la forma del DIU.</p><h5>Impacto Clínico</h5><p>Evita la necesidad de radiografías y proporciona una respuesta inmediata a la paciente, permitiendo tomar decisiones sobre anticoncepción en la misma consulta.</p></div>`,
            video: "9IG__pg1pQ8",
          },
        },
        {
          segment: "scrotal",
          system: "Urogenital",
          color: "yellow",
          title: "Torsión Testicular",
          refId: "testicular_torsion_bandarkar_2019",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Colocar al paciente en supino. Comparar siempre ambos testículos. Evaluar la ecogenicidad, tamaño y, crucialmente, el flujo sanguíneo con Doppler color.</li></ul>`,
            findings: `El hallazgo más importante y diagnóstico es la <strong>ausencia de flujo sanguíneo intratesticular en el testículo afectado</strong> al compararlo con el contralateral, que mostrará flujo normal. El testículo puede aparecer agrandado e hipoecoico en fases tardías. El "signo del remolino" (whirlpool sign) del cordón espermático es un hallazgo directo pero difícil de obtener.`,
            evidence: `<p>El Doppler color tiene una sensibilidad y especificidad muy altas (cercanas al 100%) para la torsión testicular completa. Sin embargo, en torsiones intermitentes o parciales, puede haber flujo preservado.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>Una ganancia de Doppler demasiado baja puede simular ausencia de flujo. Optimice los ajustes en el testículo sano primero. El flujo periférico en la pared escrotal puede estar aumentado y no debe confundirse con flujo intratesticular.</p><h5>Impacto Clínico</h5><p>Es una emergencia quirúrgica. Un diagnóstico rápido con POCUS es crucial para salvar el testículo.</p></div>`,
          },
        },
        {
          segment: "scrotal",
          system: "Urogenital",
          color: "yellow",
          title: "Epididimitis y Orquitis",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Evaluación comparativa de ambos testículos y epidídimos. Usar Doppler color para evaluar la vascularización.</li></ul>`,
            findings: `La <strong>epididimitis</strong> se manifiesta como un epidídimo engrosado (>1.5 cm) e hipoecoico, con un <strong>marcado aumento del flujo sanguíneo (hiperemia)</strong> al Doppler color. A menudo se asocia con un hidrocele reactivo. La <strong>orquitis</strong> (inflamación del testículo) muestra un testículo hipoecoico y difusamente hiperémico.`,
            evidence: `<p>El Doppler color es clave para diferenciar la epididimitis (hiperemia) de la torsión (ausencia de flujo).</p>`,
            pearls: `<div class="pearls-section"><h5>Clave Diferencial</h5><p>La principal entidad a descartar es la torsión testicular. El dolor puede ser similar, pero el flujo Doppler es la clave: aumentado en la inflamación, ausente en la torsión.</p><h5>Impacto Clínico</h5><p>Confirma un diagnóstico inflamatorio, guiando el tratamiento antibiótico y evitando una exploración quirúrgica innecesaria.</p></div>`,
          },
        },
        {
          segment: "dvt",
          system: "Vascular",
          color: "pink",
          title: "Trombosis Venosa Profunda (TVP)",
          refId: "dvt_pomero_2022",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Ecografía de compresión (CUS) en 3 puntos: 1) Vena femoral común (VFC) en la ingle, 2) Bifurcación en femoral y femoral profunda, 3) Vena poplítea en la fosa poplítea.</li></ul>`,
            findings: `El signo diagnóstico es la <strong>no compresibilidad</strong> total o parcial de una vena. Al aplicar presión con la sonda, la vena normal se colapsa por completo, mientras que una vena trombosada permanece abierta. La arteria adyacente, que no colapsa, sirve de control. A veces, el trombo puede visualizarse como material ecogénico dentro de la luz venosa.`,
            evidence: `<p>Sensibilidad global: <strong>~90%</strong>, Especificidad: <strong>~95%</strong>. El protocolo de 3 puntos es más sensible que el de 2 puntos.</p>`,
            pearls: `<p>Una técnica simple y rápida que puede evitar la necesidad de dímero-D o ecografía formal en muchos pacientes de baja probabilidad.</p>`,
          },
        },
        {
          segment: "shoulder",
          system: "Musculoesquelético",
          color: "indigo",
          title: "Manguito Rotador (Hombro)",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Examen dinámico. Para el supraespinoso, colocar al paciente con la mano en el bolsillo trasero (posición de Crass). Explorar el tendón en ejes largo y corto.</li></ul>`,
            findings: `<strong>Tendinopatía:</strong> Engrosamiento hipoecoico del tendón, a veces con calcificaciones. <strong>Rotura de espesor parcial:</strong> Defecto hipoecoico o anecoico en la superficie bursal o articular del tendón. <strong>Rotura de espesor completo:</strong> Ausencia de tejido tendinoso, con el líquido de la bursa contactando directamente con la cabeza humeral.`,
            evidence: `<p>En manos experimentadas, el POCUS tiene una sensibilidad y especificidad comparables a la resonancia magnética para las roturas de espesor completo del manguito rotador.</p>`,
            pearls: `<div class="pearls-section"><h5>Errores Comunes</h5><p>La anisotropía es el principal artefacto a evitar: el tendón puede parecer hipoecoico si el haz de ultrasonido no incide perpendicularmente. Mover la sonda ("heel-toe") ayuda a corregirlo.</p></div>`,
          },
        },
        {
          segment: "dvt",
          system: "Tejidos Blandos",
          color: "orange",
          title: "Celulitis vs. Absceso",
          refId: "abscess_subramaniam_2016",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Explorar la zona de máximo eritema o fluctuación.</li></ul>`,
            findings: `<strong>Celulitis:</strong> Se observa un engrosamiento y aumento de la ecogenicidad del tejido subcutáneo, con hebras de líquido anecoico que separan los lóbulos de grasa, dando un aspecto característico de <strong>"adoquín" (cobblestone)</strong>. <strong>Absceso:</strong> Se identifica una <strong>colección de líquido organizada</strong>, típicamente hipoecoica o anecoica, con bordes mal definidos, detritos ecogénicos en su interior y refuerzo acústico posterior. No hay flujo en su interior con el Doppler color.`,
            evidence: `<p>El POCUS tiene una alta precisión para esta distinción (Sensibilidad ~96%, Especificidad ~87%), cambiando el manejo clínico (antibióticos vs. incisión y drenaje) en un número significativo de casos.</p>`,
            pearls: `<div class="pearls-section"><h5>Impacto Clínico</h5><p>Aplicar una ligera presión con la sonda sobre un absceso puede provocar el movimiento arremolinado de los detritos ("signo del remolino"), confirmando su naturaleza líquida.</p></div>`,
          },
        },
        {
          segment: "dvt",
          system: "Musculoesquelético",
          color: "indigo",
          title: "Quiste de Baker",
          content: {
            technique: `<ul><li><strong>Sonda:</strong> Lineal.</li><li><strong>Técnica:</strong> Colocar la sonda en la fosa poplítea, en el espacio entre el tendón del semimembranoso y la cabeza medial del gastrocnemio.</li></ul>`,
            findings: `Se visualiza una <strong>colección de líquido anecoica o hipoecoica bien definida</strong>, a menudo con un "cuello" o "tallo" que se comunica con la articulación de la rodilla. Puede tener septos o detritos en su interior.`,
            evidence: `<p>El POCUS es la modalidad de elección para confirmar un quiste de Baker y diferenciarlo de otras masas de la fosa poplítea, como un aneurisma de la arteria poplítea (que mostrará flujo con Doppler) o una TVP.</p>`,
            pearls: `<div class="pearls-section"><h5>Clave Diferencial</h5><p>Siempre use Doppler color para asegurarse de que la estructura quística no es un vaso sanguíneo antes de considerar cualquier aspiración.</p></div>`,
          },
        },
      ];
      // Fuerza subtítulos automáticos en español cuando el player esté listo
      function activarSubtitulosEs(event) {
        try {
          event.target.setOption("captions", "track", {
            languageCode: "es",
            kind: "asr", // usa traducción automática si solo hay ASR
          });
        } catch (e) {
          console.log("Subtítulos ES no disponibles");
        }
      }

      // Función llamada cuando la API de YouTube está lista
      function onYouTubeIframeAPIReady() {
        window.POCUSApp.apiReady = true;

        // Procesar cualquier video pendiente
        window.POCUSApp.pendingVideos.forEach(({ playerId, videoId }) => {
          const container = document.getElementById(playerId);
          if (container) {
            window.POCUSApp.videoPlayers[playerId] = new YT.Player(playerId, {
              videoId: videoId,
              playerVars: {
                playsinline: 1,
                cc_lang_pref: "es",
                cc_load_policy: 1,
                hl: "es",
              },
              events: { onReady: activarSubtitulosEs },
            });
          }
        });

        window.POCUSApp.pendingVideos = [];
      }

      // Función para cambiar pestañas
      window.switchTab = function (cardId, tabName, buttonElement) {
        const card = document.getElementById(cardId);
        if (!card) return;

        // Pausar video si existe
        if (window.POCUSApp.videoPlayers[cardId]) {
          try {
            window.POCUSApp.videoPlayers[cardId].pauseVideo();
          } catch (e) {
            console.log("No se pudo pausar el video");
          }
        }

        // Actualizar pestañas activas
        card
          .querySelectorAll(".tab-button")
          .forEach((btn) => btn.classList.remove("active"));
        buttonElement.classList.add("active");

        card
          .querySelectorAll(".tab-content")
          .forEach((content) => content.classList.remove("active"));
        const activeContent = card.querySelector(`#${tabName}-${cardId}`);
        if (activeContent) {
          activeContent.classList.add("active");
        }

        // Si estamos en la pestaña de vídeo
        if (tabName === "video") {
          const list = card.querySelector(`#video-${cardId}`);
          if (!list) return;

          const vids = JSON.parse(list.dataset.videos || "[]");

          vids.forEach((v, idx) => {
            const playerId = `player-${cardId}-${idx}`;
            if (window.POCUSApp.videoPlayers[playerId]) return; // ya existe

            const build = () => {
              window.POCUSApp.videoPlayers[playerId] = new YT.Player(playerId, {
                videoId: v.id,
                playerVars: {
                  playsinline: 1,
                  cc_lang_pref: "es",
                  cc_load_policy: 1,
                  hl: "es",
                },
                events: { onReady: activarSubtitulosEs },
              });
            };

            if (window.POCUSApp.apiReady) {
              build();
            } else {
              window.POCUSApp.pendingVideos.push({ playerId, videoId: v.id });
            }
          });
        }
      };

      // Funciones de zoom
      window.updateZoom = function () {
        const svg = document.getElementById("anatomical-svg");
        if (svg) {
          svg.style.transform = `scale(${window.POCUSApp.zoomLevel})`;
        }
      };

      window.zoomIn = function () {
        if (window.POCUSApp.zoomLevel < 2) {
          window.POCUSApp.zoomLevel += 0.1;
          updateZoom();
        }
      };

      window.zoomOut = function () {
        if (window.POCUSApp.zoomLevel > 0.5) {
          window.POCUSApp.zoomLevel -= 0.1;
          updateZoom();
        }
      };

      window.resetZoom = function () {
        window.POCUSApp.zoomLevel = 1;
        updateZoom();
      };

      // Inicialización cuando el DOM esté listo
      document.addEventListener("DOMContentLoaded", function () {
        const contentArea = document.getElementById("content-area");
        const welcomeMessage = document.getElementById("welcome-message");
        const tooltip = document.getElementById("tooltip");
        const segments = document.querySelectorAll(".anatomy-segment");

        // Event listeners para segmentos anatómicos
        segments.forEach((segment) => {
          segment.addEventListener("click", function (e) {
            const segmentId = e.currentTarget.dataset.segment;
            segments.forEach((s) => s.classList.remove("active"));

            // Activar todos los segmentos con el mismo data-segment
            document
              .querySelectorAll(`.anatomy-segment[data-segment="${segmentId}"]`)
              .forEach((s) => s.classList.add("active"));

            welcomeMessage.style.display = "none";
            renderSegmentContent(segmentId);
          });

          segment.addEventListener("mouseenter", function (e) {
            const tooltipText = e.currentTarget.dataset.tooltip;
            tooltip.textContent = tooltipText;
            tooltip.classList.add("show");

            const rect = e.target.getBoundingClientRect();
            tooltip.style.left = rect.left + rect.width / 2 + "px";
            tooltip.style.top = rect.top - 10 + "px";
          });

          segment.addEventListener("mouseleave", function () {
            tooltip.classList.remove("show");
          });
        });

        // Toggle etiquetas
        document
          .getElementById("toggle-labels")
          .addEventListener("click", function () {
            window.POCUSApp.showLabels = !window.POCUSApp.showLabels;
            document
              .getElementById("anatomical-svg")
              .classList.toggle("show-labels");
            this.textContent = window.POCUSApp.showLabels
              ? "Ocultar Etiquetas"
              : "Mostrar Etiquetas";
          });

        // Event listeners para zoom
        document
          .getElementById("zoom-in-btn")
          .addEventListener("click", zoomIn);
        document
          .getElementById("zoom-out-btn")
          .addEventListener("click", zoomOut);
        document
          .getElementById("reset-zoom-btn")
          .addEventListener("click", resetZoom);

        // Zoom con rueda del ratón
        document
          .getElementById("anatomical-svg")
          .addEventListener("wheel", function (e) {
            e.preventDefault();
            if (e.deltaY < 0) {
              zoomIn();
            } else {
              zoomOut();
            }
          });

        // Función para renderizar contenido del segmento
        function renderSegmentContent(segmentId) {
          contentArea.innerHTML = "";

          // Pausar todos los videos
          Object.values(window.POCUSApp.videoPlayers).forEach((player) => {
            try {
              player.pauseVideo();
            } catch (e) {}
          });

          window.POCUSApp.videoPlayers = {};

          const data = pocusData.filter((app) => app.segment === segmentId);
          if (!data || data.length === 0) {
            contentArea.innerHTML = `<div class="bg-white rounded-xl shadow-lg p-8 text-center"><p class="text-gray-600">No hay aplicaciones definidas para esta zona todavía.</p></div>`;
            return;
          }

          const usedRefs = new Set();
          data.forEach((app, index) => {
            if (app.refId) usedRefs.add(app.refId);
            const card = createContentCard(app, index, segmentId);
            contentArea.appendChild(card);
          });

          renderReferences(usedRefs);

          // Hacer visibles todas las tarjetas
          contentArea.querySelectorAll(".content-card").forEach((card) => {
            card.style.display = "block";
          });
        }

        // Función para crear tarjetas de contenido
        function createContentCard(app, index, segmentId) {
          const cardId = `card-${segmentId}-${index}`;
          const card = document.createElement("div");
          card.className = "content-card bg-white rounded-xl shadow-lg mb-6";
          card.id = cardId;

          let videoTabButton = "";
          let videoTabContent = "";

          if (app.content.videos && app.content.videos.length) {
            videoTabButton = `<button class="tab-button py-2 px-4 -mb-px bg-gray-200 text-gray-700 font-semibold rounded-t-md"
                        onclick="switchTab('${cardId}', 'video', this)">Vídeo</button>`;

            const figures = app.content.videos
              .map(
                (v, idx) => `
      <figure class="mb-6">
        <figcaption class="mb-1 text-gray-800 font-semibold">
          ${v.intro || ""}
        </figcaption>
        <p class="text-sm text-gray-600 mb-2">${v.desc || ""}</p>
        <div class="responsive-iframe-container">
          <div id="player-${cardId}-${idx}"></div>
        </div>
      </figure>`
              )
              .join("");

            videoTabContent = `
                      <div id="video-${cardId}" class="tab-content" data-videos='${JSON.stringify(
              app.content.videos
            ).replace(/"/g, "&quot;")}'>
                        ${figures}
                      </div>`;
          }

          let evidenceHtml = app.content.evidence || "";
          if (app.refId && references[app.refId]) {
            evidenceHtml += `<a href="#ref-${app.refId}" class="reference-link block mt-2">Ver referencia</a>`;
          }

          card.innerHTML = `
                                  <div class="p-5 border-b-2 border-gray-100">
                                      <h3 class="text-2xl font-extrabold text-gray-800">${app.title}</h3>
                                      <p class="text-md font-semibold text-${app.color}-600">${app.system}</p>
                                  </div>
                                  <div class="p-5">
                                      <div class="flex border-b border-gray-200 mb-4 flex-wrap">
                                          <button class="tab-button active py-2 px-4 -mb-px bg-gray-200 text-gray-700 font-semibold rounded-t-md" onclick="switchTab('${cardId}', 'findings', this)">Hallazgos Clave</button>
                                          <button class="tab-button py-2 px-4 -mb-px bg-gray-200 text-gray-700 font-semibold rounded-t-md" onclick="switchTab('${cardId}', 'technique', this)">Técnica</button>
                                          <button class="tab-button py-2 px-4 -mb-px bg-gray-200 text-gray-700 font-semibold rounded-t-md" onclick="switchTab('${cardId}', 'evidence', this)">Evidencia</button>
                                          <button class="tab-button py-2 px-4 -mb-px bg-gray-200 text-gray-700 font-semibold rounded-t-md" onclick="switchTab('${cardId}', 'pearls', this)">Perlas Clínicas</button>
                                          ${videoTabButton}
                                      </div>
                                      <div>
                                          <div id="technique-${cardId}" class="tab-content prose prose-sm max-w-none">${app.content.technique}</div>
                                          <div id="findings-${cardId}" class="tab-content active prose prose-sm max-w-none"><div class="findings-description">${app.content.findings}</div></div>
                                          <div id="evidence-${cardId}" class="tab-content prose prose-sm max-w-none"><div class="evidence">${evidenceHtml}</div></div>
                                          <div id="pearls-${cardId}" class="tab-content prose prose-sm max-w-none"><div class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 rounded-r-lg">${app.content.pearls}</div></div>
                                          ${videoTabContent}
                                      </div>
                                  </div>`;
          return card;
        }

        // Función para renderizar referencias
        function renderReferences(refIds) {
          const refContainer = document.getElementById("references-section");
          if (refIds.size === 0) {
            refContainer.innerHTML = "";
            return;
          }

          let refsHtml = `<div class="bg-white p-6 rounded-xl shadow-lg">
                                                  <h3 class="text-2xl font-bold text-gray-800 mb-4">Fuentes de Evidencia</h3>
                                                  <ul class="space-y-4 text-sm">`;

          refIds.forEach((id) => {
            const ref = references[id];
            if (ref) {
              refsHtml += `<li id="ref-${id}" class="leading-relaxed scroll-mt-24">
                                                  <p class="font-semibold text-gray-700">${ref.citation}</p>
                                                  <a href="${ref.url}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 underline">Acceder al artículo</a>
                                               </li>`;
            }
          });

          refsHtml += `</ul></div>`;
          refContainer.innerHTML = refsHtml;
        }

        // Smooth scroll para referencias
        document.addEventListener("click", function (e) {
          if (e.target.matches("a.reference-link")) {
            e.preventDefault();
            const targetId = e.target.getAttribute("href");
            const targetElement = document.querySelector(targetId);
            if (targetElement) {
              targetElement.scrollIntoView({
                behavior: "smooth",
                block: "start",
              });
            }
          }
        });
      });
    </script>
    <script src="https://www.youtube.com/iframe_api"></script>
  </body>
</html>
